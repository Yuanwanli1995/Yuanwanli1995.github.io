<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yuanwanli1995.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/./public/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="等不是办法，干才有出路">
<meta property="og:type" content="website">
<meta property="og:title" content="brisk">
<meta property="og:url" content="http://yuanwanli1995.github.io/page/7/index.html">
<meta property="og:site_name" content="brisk">
<meta property="og:description" content="等不是办法，干才有出路">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="yuanwanli">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yuanwanli1995.github.io/page/7/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/7/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>brisk</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">brisk</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">welcome</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yuanwanli</p>
  <div class="site-description" itemprop="description">等不是办法，干才有出路</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">77</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/11/08/2021-11-08-k8s%E5%A6%82%E4%BD%95%E4%B8%8Epod%E9%80%9A%E4%BF%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/08/2021-11-08-k8s%E5%A6%82%E4%BD%95%E4%B8%8Epod%E9%80%9A%E4%BF%A1/" class="post-title-link" itemprop="url">k8s如何与pod通信</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-08 00:00:00" itemprop="dateCreated datePublished" datetime="2021-11-08T00:00:00+08:00">2021-11-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="pod通信和服务发现"><a href="#pod通信和服务发现" class="headerlink" title="pod通信和服务发现"></a>pod通信和服务发现</h3><p>在没有k8s的世界里，系统管理员要在用户端配置文件中明确服务的精确的ip地址或主机名来配置客户端的应用，但是在k8s中并不是需要。k8s中应用运行在pod中， 而pod的高可用设计使得无法保证准确的ip, 这里总结一下pod与服务的工作方式。</p>
<h4 id="1-pod特点"><a href="#1-pod特点" class="headerlink" title="1 pod特点"></a>1 pod特点</h4><ol>
<li>pod随时可能启动或关闭，是短暂的</li>
<li>客户端不会提前知道pod的地址，</li>
<li>水平伸缩以为着pod可能会提供相同的服务，每个pod ip不同，但客户端只需要服务，不需要知道pod的地址。 </li>
</ol>
<h4 id="2-服务"><a href="#2-服务" class="headerlink" title="2 服务"></a>2 服务</h4><p>为了解决上述需要，k8s为一组功能相同的pod提供单一不变的接入点，这就是服务。服务的ip和端口不会改变。客户端通过服务被路由pod上，而不需要直接连接pod,这样单个pod被移除或新的pod被创建就不影响。 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/servicepod.png"></p>
<h4 id="3-pod与服务的匹配"><a href="#3-pod与服务的匹配" class="headerlink" title="3 pod与服务的匹配"></a>3 pod与服务的匹配</h4><p>上述的过程可以看出服务创建的一个基本问题，如何把服务和一组特定功能的pod匹配起来呢？ <strong>标签选择器</strong></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/servicepod2.png"></p>
<h4 id="4-创建服务"><a href="#4-创建服务" class="headerlink" title="4  创建服务"></a>4  创建服务</h4><ol>
<li> 创建服务之前，先使用rc创建与之连接的pod </li>
</ol>
   <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kubia-rc.yaml &lt;&lt; EOF  </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ReplicationController</span><br><span class="line">metadata: </span><br><span class="line">  name: kubia</span><br><span class="line">spec: </span><br><span class="line">  replicas: 2</span><br><span class="line">  selector: </span><br><span class="line">    app: kubia </span><br><span class="line">  template: </span><br><span class="line">    metadata: </span><br><span class="line">      labels: </span><br><span class="line">        app: kubia</span><br><span class="line">    spec: </span><br><span class="line">      containers: </span><br><span class="line">      - name: kubia</span><br><span class="line">        image: luksa/kubia</span><br><span class="line">        ports: </span><br><span class="line">        - containerPort: 8080</span><br><span class="line">EOF</span><br><span class="line"># create </span><br><span class="line">kubectl create -f kubia-rc.yaml </span><br><span class="line"></span><br><span class="line"># 查看</span><br><span class="line">[root@nginx test]# kubectl get po </span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE</span><br><span class="line">kubia-66tvd   1/1     Running   0          2m31s</span><br><span class="line">kubia-v8dvv   1/1     Running   0          2m31s</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 创建服务 </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kubia-svc.yaml &lt;&lt; EOF </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata: </span><br><span class="line">  name: kubia</span><br><span class="line">spec: </span><br><span class="line">  ports:</span><br><span class="line">  - port: 80 </span><br><span class="line">    targetPort: 8080</span><br><span class="line">  selector: </span><br><span class="line">    app: kubia </span><br><span class="line">EOF </span><br><span class="line"></span><br><span class="line"># create </span><br><span class="line">kubectl create -f kubia-svc.yaml</span><br><span class="line"></span><br><span class="line"># 查看</span><br><span class="line">[root@nginx test]# kubectl get svc </span><br><span class="line">NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)   AGE</span><br><span class="line">kubernetes   ClusterIP   10.43.0.1      &lt;none&gt;        443/TCP   16d</span><br><span class="line">kubia        ClusterIP   10.43.165.39   &lt;none&gt;        80/TCP    46s</span><br></pre></td></tr></table></figure>

<h4 id="5-为什么服务ip无法ping通-？"><a href="#5-为什么服务ip无法ping通-？" class="headerlink" title="5 为什么服务ip无法ping通 ？"></a>5 为什么服务ip无法ping通 ？</h4><p>我们发现服务curl是可以，但是无法ping通。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-node01 ~]# curl  10.43.165.39 </span><br><span class="line">You&#x27;ve hit kubia-66tvd</span><br><span class="line">[root@k8s-node01 ~]# ping 10.43.165.39 </span><br><span class="line">PING 10.43.165.39 (10.43.165.39) 56(84) bytes of data.</span><br><span class="line">^C</span><br><span class="line">--- 10.43.165.39 ping statistics ---</span><br><span class="line">2 packets transmitted, 0 received, 100% packet loss, time 999ms</span><br></pre></td></tr></table></figure>

<p>有的时候ping不通我们就认为出问题了，其实没有。这是因为集群ip是虚拟ip, 并且只有在与服务端口结合时才有意义。 所以ping不通是正常的。</p>
<h4 id="6-测试与分析"><a href="#6-测试与分析" class="headerlink" title="6 测试与分析"></a>6 测试与分析</h4><p>分配给该服务的ip是10.43.165.39， 但这是cluster-ip，也就是集群ip, 只能在集群内部可以访问。 也就是集群节点上或其他的pod可以访问。 是不是这样呢? 测试一下</p>
<ol>
<li> ssh到集群的一个节点上</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-node01 ~]# curl  10.43.165.39 </span><br><span class="line">You&#x27;ve hit kubia-66tvd </span><br><span class="line"># 服务的cluster ip 在集群内部，节点可与其通信</span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 在pod中执行命令， 执行成功则说明连接</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 测试多次， 每次并不是同一个pod</span><br><span class="line">[root@nginx test]# kubectl exec kubia-vs2kl -- curl -s http://10.43.165.39</span><br><span class="line">You&#x27;ve hit kubia-vs2kl</span><br><span class="line"></span><br><span class="line">[root@nginx test]# kubectl exec kubia-vs2kl -- curl -s http://10.43.165.39</span><br><span class="line">You&#x27;ve hit kubia-l9w94</span><br><span class="line"></span><br><span class="line">[root@nginx test]# kubectl exec kubia-vs2kl -- curl -s http://10.43.165.39</span><br><span class="line">You&#x27;ve hit kubia-vs2kl</span><br></pre></td></tr></table></figure>

<blockquote>
<p> – 表示kubectl 命令结束，之后为在pod中执行的命令</p>
</blockquote>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/servicepod3.png"></p>
<p>上图展示了事件发生的顺序</p>
<ol>
<li>在一个pod中执行命令，这个命令是发送http请求</li>
<li>pod向服务的ip发送请求 </li>
<li>由于这个服务是代理pod的，转发请求到其中一个pod上  </li>
<li>在pod2中处理请求，并返回带有pod名称的相应 </li>
<li>请求结果在主机上打印</li>
</ol>
<p>上述某一个过程出问题，都会使得上述命令失败，所以可用来测试集群网络。</p>
<h4 id="7-同一个服务暴露多个端口"><a href="#7-同一个服务暴露多个端口" class="headerlink" title="7 同一个服务暴露多个端口"></a>7 同一个服务暴露多个端口</h4><p>服务可以暴露一个端口，也可以多个端口。比如http监听8080端口，https监听8443端口。 多个端口需要指定名称, 没有设置名称的端口会在describe 时显示&lt;unset&gt; ， 如果pod中的端口也是命令的，svc中targetport可以使用其名称吗，这样在更换pod端口号的时候也不用修改服务了，因为其是根据名称匹配的。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kubia-svc.yaml &lt;&lt; EOF </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: kubia</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - name: http</span><br><span class="line">    port: 80</span><br><span class="line">    targetPort: 8080</span><br><span class="line">  - name: https</span><br><span class="line">    port: 443</span><br><span class="line">    targetPort: 8443</span><br><span class="line">selector:</span><br><span class="line">    app: kubia</span><br><span class="line">EOF </span><br></pre></td></tr></table></figure>

<h4 id="8-发现服务"><a href="#8-发现服务" class="headerlink" title="8  发现服务"></a>8  发现服务</h4><p>创建服务后， 我们可以通过单一稳定的ip访问到pod， 不管pod如何变化都不影响。 但是在某个服务创建之后新建的pod如何知道服务的ip呢？ 难道手动查询吗? 不需要。</p>
<p>k8s为客户端提供了发现服务的ip和端口的方式——环境变量， 在pod开始运行的时候，k8s会初始化一系列的环境变量指向现在存在的服务。如下： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx test]# kubectl exec kubia-vs2kl -- env</span><br><span class="line">PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin</span><br><span class="line">HOSTNAME=kubia-vs2kl</span><br><span class="line">KUBERNETES_PORT=tcp://10.43.0.1:443</span><br><span class="line">KUBIA_PORT_80_TCP_PORT=80</span><br><span class="line">KUBIA_PORT=tcp://10.43.165.39:80</span><br><span class="line">KUBIA_PORT_80_TCP=tcp://10.43.165.39:80</span><br><span class="line">KUBIA_PORT_80_TCP_PROTO=tcp</span><br><span class="line">KUBIA_PORT_80_TCP_ADDR=10.43.165.39</span><br><span class="line">KUBERNETES_SERVICE_PORT=443</span><br><span class="line">KUBERNETES_PORT_443_TCP_ADDR=10.43.0.1</span><br><span class="line">KUBIA_SERVICE_HOST=10.43.165.39</span><br><span class="line">KUBIA_SERVICE_PORT=80</span><br><span class="line">NPM_CONFIG_LOGLEVEL=info</span><br><span class="line">NODE_VERSION=7.9.0</span><br><span class="line">YARN_VERSION=0.22.0</span><br><span class="line">HOME=/root</span><br></pre></td></tr></table></figure>

<h4 id="9-DNS"><a href="#9-DNS" class="headerlink" title="9 DNS"></a>9 DNS</h4><p>环境变量是获取ip和端口的一种方式，也可以通过DNS获取。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx test]# kubectl get po -n kube-system </span><br><span class="line">NAME                                      READY   STATUS      RESTARTS   AGE</span><br><span class="line">canal-l58m7                               2/2     Running     2          16d</span><br><span class="line">canal-s92dx                               2/2     Running     3          16d</span><br><span class="line">coredns-7c5566588d-rhdtx                  1/1     Running     1          16d</span><br><span class="line">coredns-7c5566588d-tp55c                  1/1     Running     1          16d</span><br><span class="line">coredns-autoscaler-65bfc8d47d-4mdt5       1/1     Running     1          16d</span><br><span class="line">metrics-server-6b55c64f86-zlz4l           1/1     Running     2          16d</span><br></pre></td></tr></table></figure>

<p>kube-system空间中pod有coredns，这表明在运行dns服务，在集群中的其他pod都被配置成使用作为为DNS ， 运行在pod上的进程DNS 查询都会被k8s自身的DNS服务器响应，该服务器知道系统中运行的所有服务。pod中的spec中的dnspolicy值决定是否使用DNS服务器。 </p>
<h4 id="10-endpoints"><a href="#10-endpoints" class="headerlink" title="10 endpoints"></a>10 endpoints</h4><p>我们也希望k8s将服务暴露到外部，在此之前要先介绍一下endpoint, 它是介于pod和svc之间的资源。 就是暴露服务要转发的pod的ip地址和端口的列表。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># 查看endpoints</span><br><span class="line">[root@nginx test]# kubectl get endpoints  kubia </span><br><span class="line">NAME    ENDPOINTS                                                    AGE</span><br><span class="line">kubia   10.42.0.10:8443,10.42.1.10:8443,10.42.1.9:8443 + 3 more...   79m</span><br><span class="line"></span><br><span class="line"># 查看pod IP</span><br><span class="line">NAME          READY   STATUS    RESTARTS   AGE    IP           NODE            NOMINATED NODE   READINESS GATES</span><br><span class="line">kubia-66tvd   1/1     Running   0          161m   10.42.0.10   81.68.101.212   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kubia-l9w94   1/1     Running   0          128m   10.42.1.9    81.68.229.215   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">kubia-vs2kl   1/1     Running   0          125m   10.42.1.10   81.68.229.215   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line"># 从svc中也可以看到， endpoints就是待转发pod的IP与端口的集合</span><br><span class="line">[root@nginx test]# kubectl describe svc kubia </span><br><span class="line">Name:              kubia</span><br><span class="line">Namespace:         default</span><br><span class="line">Labels:            &lt;none&gt;</span><br><span class="line">Annotations:       &lt;none&gt;</span><br><span class="line">Selector:          app=kubia</span><br><span class="line">Type:              ClusterIP</span><br><span class="line">IP Families:       &lt;none&gt;</span><br><span class="line">IP:                10.43.7.83</span><br><span class="line">IPs:               &lt;none&gt;</span><br><span class="line">Port:              http  80/TCP</span><br><span class="line">TargetPort:        8080/TCP</span><br><span class="line">Endpoints:         10.42.0.10:8080,10.42.1.10:8080,10.42.1.9:8080</span><br><span class="line">Port:              https  443/TCP</span><br><span class="line">TargetPort:        8443/TCP</span><br><span class="line">Endpoints:         10.42.0.10:8443,10.42.1.10:8443,10.42.1.9:8443</span><br><span class="line">Session Affinity:  None</span><br><span class="line">Events:            &lt;none&gt;</span><br></pre></td></tr></table></figure>

<p>这表明服务是利用标签匹配pod， 然后建立endpoints,  将请求转发的endpoints中的一个ip: port上。 所以有的时候服务连接失败，需要查看endpoints是否存在正确。</p>
<p>了解到这一层之后，我们也可以不使用标签匹配pod，手动为服务建立endpoints，只要新建一个endpoints资源，使其与服务的名称相同即可。 </p>
<blockquote>
<p>endpoints本身就是一个资源，而不是service的一部分。</p>
</blockquote>
<h4 id="11-将服务暴露给外部"><a href="#11-将服务暴露给外部" class="headerlink" title="11 将服务暴露给外部"></a>11 将服务暴露给外部</h4><p>目前为止，讨论了集群内部pod的使用。有时我们需要将服务暴露给集群之外的网络，比如前端web服务器。有几种方式可以在外部访问服务。 </p>
<ol>
<li>nodeport型的服务，在集群的每个节点上打开一个端口，因此叫nodeport，将该端口山的流量重定向到服务上，使用集群ip:port既可以访问。 </li>
<li>loadbalance型服务，是nodeport的一种扩展， 这使得服务可以通过一个专用的负载均衡器来访问。 </li>
<li>ingress资源，这是一个完全不同的机制，通过一个ip地址公开多个服务——它运行在http层，因此可以比第四层的服务提供更多的资源。 </li>
</ol>
<p>第一种： 使用nodeport暴露服务到外部</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kubia-svc-nodeport.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: v1 </span><br><span class="line">kind: Service </span><br><span class="line">metadata: </span><br><span class="line">  name: kubia-nodeport </span><br><span class="line">spec: </span><br><span class="line">  type: NodePort </span><br><span class="line">  ports: </span><br><span class="line">  - port: 80 </span><br><span class="line">    targetPort: 8080 </span><br><span class="line">    nodePort: 30123 </span><br><span class="line">  selector: </span><br><span class="line">    app: kubia </span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 创建</span><br><span class="line">kubectl create -f kubia-svc-nodeport.yaml</span><br><span class="line"></span><br><span class="line"># 查看</span><br><span class="line">[root@nginx test]# kubectl get svc kubia-nodeport -o wide </span><br><span class="line">NAME             TYPE       CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE   SELECTOR</span><br><span class="line">kubia-nodeport   NodePort   10.43.254.206   &lt;none&gt;        80:30123/TCP   38m   app=kubia</span><br><span class="line"></span><br><span class="line"># 测试， 本地shell连接 </span><br><span class="line">[C:\~]$ curl http://81.68.229.215:30123</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100    23    0    23    0     0     23      0 --:--:-- --:--:-- --:--:--  1533</span><br><span class="line">You&#x27;ve hit kubia-l9w94</span><br><span class="line"># 这表明外部网络可以连接到集群内部的服务，用浏览器也可以打开。</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/servicepod4.png"></p>
<p>第二种： 使用loadbalance暴露服务到外部</p>
<p>对于提供负载均衡器的云构架才可以使用loadbalancer, 如果不支持则nodebanlancer型svc将退化为nodeport。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kubia-svc-loadbalancer.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: v1 </span><br><span class="line">kind: Service</span><br><span class="line">metadata: </span><br><span class="line">  name: kubia-loadbalancer</span><br><span class="line">spec: </span><br><span class="line">  type: LoadBalancer</span><br><span class="line">  ports: </span><br><span class="line">  - port: 80 </span><br><span class="line">    targetPort: 8080</span><br><span class="line">  selector: </span><br><span class="line">    app: kubia</span><br><span class="line">EOF</span><br><span class="line"># 创建</span><br><span class="line">kubectl create -f kubia-svc-loadbalancer.yaml</span><br><span class="line"></span><br><span class="line"># 查看</span><br><span class="line">[root@nginx ~]# kubectl get svc </span><br><span class="line">NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP   PORT(S)          AGE</span><br><span class="line">kubernetes           ClusterIP      10.43.0.1       &lt;none&gt;        443/TCP          17d</span><br><span class="line">kubia                ClusterIP      10.43.7.83      &lt;none&gt;        80/TCP,443/TCP   18h</span><br><span class="line">kubia-loadbalancer   LoadBalancer   10.43.20.104    &lt;pending&gt;     80:31342/TCP     14m</span><br><span class="line">kubia-nodeport       NodePort       10.43.254.206   &lt;none&gt;        80:30123/TCP     16h</span><br><span class="line">nginx-service        NodePort       10.43.66.77     &lt;none&gt;        80:30080/TCP     16h</span><br><span class="line"></span><br><span class="line"># 测试， 本集群不支持loadbalancer, 所以external-ip状态为pending, 此时loadbalancer就是一个nodeport</span><br><span class="line"># 本地shell测试 node-ip:port ， 连接正常</span><br><span class="line">[C:\~]$ curl http://81.68.229.215:31342</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100    23    0    23    0     0     23      0 --:--:-- --:--:-- --:--:--   741</span><br><span class="line">You&#x27;ve hit kubia-vs2kl</span><br><span class="line"></span><br><span class="line"># 换一个腾讯云的弹性集群测试，支持负载均衡器</span><br><span class="line"># 部署同样的deployment, 然后部署loadlancer, 过程相同，省略 </span><br><span class="line"># 查看 </span><br><span class="line">[root@k8s-node02 ~]# kubectl get svc </span><br><span class="line">NAME                 TYPE           CLUSTER-IP      EXTERNAL-IP      PORT(S)        AGE</span><br><span class="line">kubernetes           ClusterIP      192.168.0.1     &lt;none&gt;           443/TCP        3d23h</span><br><span class="line">kubia-loadbalancer   LoadBalancer   192.168.0.201   175.27.192.232   80:30493/TCP   67s</span><br><span class="line"># 本地主机测试 </span><br><span class="line">[C:\~]$ curl http://175.27.192.232</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100    33    0    33    0     0     33      0 --:--:-- --:--:-- --:--:--   702</span><br><span class="line">You&#x27;ve hit kubia-778d98d9c-2zpl5</span><br><span class="line"></span><br><span class="line"># 成功了， 直接访问loadbalancer IP即可</span><br></pre></td></tr></table></figure>

<p>第三种: ingress </p>
<p>为什么需要ingress呢， loadbalancer服务需要独立的共有IP地址，二ingress只需要一个公网IP就可以为许多服务提供访问。 当客户向ingress发送请求时，ingress会根据请求的主机名和路径决定请求转发的服务。也就是一个ingress可以暴露多个服务。如下:</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/servicepod7.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; kubia-ingress.yaml &lt;&lt; EOF </span><br><span class="line">apiVersion: extensions/v1beta1 </span><br><span class="line">kind: Ingress </span><br><span class="line">metadata: </span><br><span class="line">  name: kubia</span><br><span class="line">spec: </span><br><span class="line">  rules: </span><br><span class="line">  - host: kubia.example.com </span><br><span class="line">    http: </span><br><span class="line">      paths: </span><br><span class="line">      - path: / </span><br><span class="line">        backend: </span><br><span class="line">          serviceName: kubia-nodeport </span><br><span class="line">          servicePort: 80</span><br><span class="line">EOF</span><br><span class="line"># 创建</span><br><span class="line">kubectl create -f kubia-ingress.yaml </span><br><span class="line"></span><br><span class="line"># 查看</span><br><span class="line">[root@k8s-node02 ~]# kubectl get ing </span><br><span class="line">NAME    CLASS    HOSTS               ADDRESS        PORTS   AGE</span><br><span class="line">kubia   &lt;none&gt;   kubia.example.com   119.45.3.217   80      34m</span><br><span class="line"></span><br><span class="line"># 访问， 本地要添加dns </span><br><span class="line"># windows在‪C:\Windows\System32\drivers\etc\hosts </span><br><span class="line"># 添加 </span><br><span class="line">119.45.3.217  kubia.example.com</span><br><span class="line"># 访问 </span><br><span class="line">[C:\~]$ curl http://1.13.12.141</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">100    33    0    33    0     0     33      0 --:--:-- --:--:-- --:--:--   532</span><br><span class="line">You&#x27;ve hit kubia-778d98d9c-2zpl5</span><br><span class="line"></span><br><span class="line">[C:\~]$ curl http://kubia.example.com</span><br><span class="line">  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current</span><br><span class="line">                                 Dload  Upload   Total   Spent    Left  Speed</span><br><span class="line">  0     0    0     0    0     0      0      0 --:--:-- --:--:-- --:--:--     0</span><br><span class="line">You&#x27;ve hit kubia-778d98d9c-2zpl5</span><br></pre></td></tr></table></figure>

<blockquote>
<p> ingress意为进入或进入的行为，进入的手段和地点</p>
<p>使用ingress，访问链路为客户端——ingress——service——工作负载， 所以ingress配置的时候一定要保证service正常工作，而且serviceName为转发service的名称。</p>
</blockquote>
<p>参考资料： kubernets in action –服务：客户端发现pod并与之通信</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/11/03/2021-11-03-%E5%9B%9B%E6%88%90%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1HA%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/03/2021-11-03-%E5%9B%9B%E6%88%90%E8%B4%9F%E8%BD%BD%E5%9D%87%E8%A1%A1HA%E9%9B%86%E7%BE%A4%E6%90%AD%E5%BB%BA/" class="post-title-link" itemprop="url">四成负载均衡HA集群搭建</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-03 00:00:00" itemprop="dateCreated datePublished" datetime="2021-11-03T00:00:00+08:00">2021-11-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一-集群介绍"><a href="#一-集群介绍" class="headerlink" title="一 集群介绍"></a>一 集群介绍</h3><p>使用高可用配置的方式在生产环境安装 Rancher，用户可以一直访问 Rancher 服务。在 Kubernetes 集群中安装 Rancher 时，Rancher 会与集群的 etcd 数据库集成，并利用 Kubernetes 调度来实现高可用。下面将使用 RKE 来部署三个节点的集群，并使用 Helm 安装 Rancher。</p>
<p>我们还需要设置一个负载均衡器，以将流量定向到两个节点上的 Rancher 副本。这样可以在单个节点不可用时，继续保障与 Rancher 管理面的连接。</p>
<p>在安装 Rancher 时，Rancher 系统将创建一个 Ingress 资源。该 Ingress 通知 Traefik Ingress 控制器侦听发往 Rancher 主机名的流量。Traefik Ingress 控制器在收到发往 Rancher 主机名的流量时，会将其转发到集群中正在运行的 Rancher Server Pod。</p>
<ul>
<li><strong>4 层负载均衡器</strong> 将 TCP 流量转发到节点。我们建议使用 4 层负载均衡器，将流量从 TCP / 80 端口和 TCP / 443 端口转发到 Rancher 管理面的集群节点上。集群上的 Ingress 控制器会将 HTTP 流量重定向到 HTTPS，并在 TCP / 443 端口上终止 SSL / TLS。Ingress 控制器会将流量转发到 Rancher Server Pod 的 TCP / 443 端口。</li>
</ul>
<h3 id="二-集群部署"><a href="#二-集群部署" class="headerlink" title="二  集群部署"></a>二  集群部署</h3><p>使用RKE部署集群包括四个部分</p>
<ol>
<li>准备工作，包括云主机或虚拟机硬件、软件和网络配置。部署的集群的要求，可以查看<a target="_blank" rel="noopener" href="https://docs.rancher.cn/">rancher官方文档</a></li>
<li>rke部署集群, 包括安装rke，新建操作的普通用户，主节点免密登陆，集群的配置文件，启动集群。</li>
<li>部署rancher web，这里通过helm3部署，需要安装helm3, 生成自签名证书，启动rancher web服务。  </li>
<li>通过rancher server调试集群</li>
</ol>
<blockquote>
<p>什么是RKE? </p>
<p>Rancher Kubernetes Engine，简称 RKE，是一个经过 CNCF 认证的 Kubernetes 安装程序。RKE 支持多种操作系统，包括 MacOS、Linux 和 Windows，可以在裸金属服务器（BMS）和虚拟服务器（Virtualized Server）上运行。市面上的其他 Kubernetes 部署工具存在一个共性问题：在使用工具之前需要满足的先决条件比较多，例如，在使用工具前需要完成安装 kubelet、配置网络等一系列的繁琐操作。而 RKE 简化了部署 Kubernetes 集群的过程，只有一个先决条件：只要您使用的 Docker 是 RKE 支持的版本，就可以通过 RKE 安装 Kubernetes，部署和运行 Kubernetes 集群。RKE 既可以单独使用，作为创建 Kubernetes 集群的工具，也可以配合 Rancher2.x 使用，作为 Rancher2.x 的组件，在 Rancher 中部署和运行 Kubernetes 集群。</p>
</blockquote>
<h4 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1 准备工作"></a>1 准备工作</h4><p><code>1.1 设置节点hostname</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">nginx 192.168.2.40</span><br><span class="line">node1 192.168.2.51</span><br><span class="line">node2 192.168.2.52</span><br><span class="line">node3 192.168.2.53</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx ~]# hostnamectl set-hostname nginx</span><br><span class="line">[root@node1 ~]# hostnamectl set-hostname node1</span><br><span class="line">[root@node2 ~]# hostnamectl set-hostname node2</span><br><span class="line">[root@node3 ~]# hostnamectl set-hostname node3</span><br></pre></td></tr></table></figure>

<p><code>1.2 主机名DNS解析</code><br>主机名DNS解析</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF</span><br><span class="line">192.168.2.40 nginx</span><br><span class="line">192.168.2.51 node1</span><br><span class="line">192.168.2.52 node2</span><br><span class="line">192.168.2.53 node3</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p><code>1.3 关闭防火墙</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<p><code>1.4 关闭swap</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a # 临时关闭；关闭swap主要是为了性能考虑</span><br><span class="line">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab # 永久关闭</span><br></pre></td></tr></table></figure>

<p><code>1.6 关闭selinux </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0 # 临时关闭</span><br><span class="line">sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27; /etc/selinux/config # 永久关闭</span><br></pre></td></tr></table></figure>

<p><code>1.6 同步时间</code></p>
<p>这样可以防止在客户端和服务器之间因为时钟不同步而发生证书验证错误。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install ntpdate -y</span><br><span class="line">ntpdate time.windows.com</span><br></pre></td></tr></table></figure>

<p><code>1.7 kernel性能调优</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/sysctl.conf&lt;&lt;EOF</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">net.ipv4.neigh.default.gc_thresh1=4096</span><br><span class="line">net.ipv4.neigh.default.gc_thresh2=6144</span><br><span class="line">net.ipv4.neigh.default.gc_thresh3=8192</span><br><span class="line">EOF</span><br><span class="line"># 加载配置文件</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>



<p><code>1.8 安装基础软件包</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install lrzsz vim gcc glibc openssl openssl-devel net-tools wget curl</span><br></pre></td></tr></table></figure>

<h4 id="2-部署集群"><a href="#2-部署集群" class="headerlink" title="2 部署集群"></a>2 部署集群</h4><p><code>2.1 安装docker</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install -y yum-utils device-mapper-persistent-data lvm2</span><br><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<p>安装18.09.9稳定版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install docker-ce-18.09.9-3.el7 docker-ce-cli-18.09.9-3.el7</span><br></pre></td></tr></table></figure>

<p>启动docker </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<p>配置镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/docker/daemon.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;oom-score-adjust&quot;: -1000,</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://7bezldxe.mirror.aliyuncs.com/&quot;,&quot;https://kw88y6eh.mirror.aliyuncs.com&quot;],</span><br><span class="line">    &quot;storage-driver&quot;: &quot;overlay2&quot;,</span><br><span class="line">    &quot;storage-opts&quot;: [</span><br><span class="line">    &quot;overlay2.override_kernel_check=true&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>重启并设置自启动</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart docker</span><br><span class="line"># systemctl  status docker 查看docker状态</span><br></pre></td></tr></table></figure>



<p><code>2.2  安装ctl工具</code> </p>
<p>下载安装工具rke,kubectl </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># rke下载地址：https://github.com/rancher/rke/tags，下载v1.0.4</span><br><span class="line">chmod +x rke_linux-amd64 </span><br><span class="line">mv rke_linux-amd64 /usr/bin/rke</span><br><span class="line"></span><br><span class="line"># kubectl </span><br><span class="line">wget http://storage.googleapis.com/kubernetes-release/release/v1.17.2/bin/linux/amd64/kubectl</span><br><span class="line">chmod +x kubectl </span><br><span class="line">mv kubectl /usr/bin/kubectl</span><br></pre></td></tr></table></figure>
<p><code>2.3 设置节点免密登陆</code></p>
<p>rke不支持root用户，所以新建普通用户操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd rancher -G docker</span><br><span class="line">echo &quot;123456&quot; | passwd --stdin rancher</span><br></pre></td></tr></table></figure>

<p>授权免密登陆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su - rancher</span><br><span class="line">cd /home/rancher</span><br><span class="line">ssh-keygen</span><br><span class="line">ssh-copy-id rancher@192.168.2.51</span><br><span class="line">ssh-copy-id rancher@192.168.2.52</span><br><span class="line">ssh-copy-id rancher@192.168.2.53</span><br></pre></td></tr></table></figure>
<p>集群配置yml文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; cluster.yml &lt;&lt; EOF</span><br><span class="line">nodes:</span><br><span class="line">  - address: 192.168.2.51</span><br><span class="line">    internal_address: 192.168.2.51</span><br><span class="line">    user: rancher</span><br><span class="line">    role: [controlplane,worker,etcd]</span><br><span class="line">  - address: 192.168.2.52</span><br><span class="line">    internal_address: 192.168.2.52</span><br><span class="line">    user: rancher</span><br><span class="line">    role: [controlplane,worker,etcd]</span><br><span class="line">  - address: 192.168.2.53</span><br><span class="line">    internal_address: 192.168.2.53</span><br><span class="line">    user: rancher</span><br><span class="line">    role: [controlplane,worker,etcd]</span><br><span class="line">services:</span><br><span class="line">    etcd:</span><br><span class="line">      snapshot: true</span><br><span class="line">      creation: 6h</span><br><span class="line">      retention: 24h</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>创建Kubernetes集群</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 运行RKE命令创建Kubernetes集群</span><br><span class="line">rke up --config ./cluster.yml</span><br></pre></td></tr></table></figure>

<blockquote>
<p>保存kube_config_rancher-cluster.yml和rancher-cluster.yml文件的副本，后期将需要这些文件来维护和升级Rancher实例。</p>
</blockquote>
<p>配置环境变量</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">### 切换到root用户</span><br><span class="line">su - root</span><br><span class="line">vim /etc/profile</span><br><span class="line">export KUBECONFIG=/home/rancher/kube_config_cluster.yml</span><br><span class="line">source /etc/profile</span><br></pre></td></tr></table></figure>

<p>查看集群状态</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/rke1.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/rke2.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/rke3.png"></p>
<p><code>2.4  配置nginx代理</code> </p>
<p>安装nginx，这里最新版本的可能出现模块错误，安装稳定版的。</p>
<p>添加nginx repo</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/yum.repos.d/nginx.repo </span><br><span class="line">[nginx-stable]</span><br><span class="line">name=nginx stable repo</span><br><span class="line">baseurl=http://nginx.org/packages/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=1</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br><span class="line">[nginx-mainline]</span><br><span class="line">name=nginx mainline repo</span><br><span class="line">baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/</span><br><span class="line">gpgcheck=1</span><br><span class="line">enabled=0</span><br><span class="line">gpgkey=https://nginx.org/keys/nginx_signing.key</span><br><span class="line">module_hotfixes=true</span><br></pre></td></tr></table></figure>

<p>yum直接安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 卸载旧版 nginx #yum -y remove nginx</span><br><span class="line">yum -y install nginx-1.18.0 </span><br></pre></td></tr></table></figure>

<p>配置nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/nginx/nginx.conf &lt;&lt; EOF </span><br><span class="line">worker_processes 4;</span><br><span class="line">worker_rlimit_nofile 40000;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 8192;</span><br><span class="line">&#125;</span><br><span class="line">stream &#123;</span><br><span class="line">    upstream rancher_servers_http &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server 192.168.2.51:80 max_fails=3 fail_timeout=5s;</span><br><span class="line">        server 192.168.2.52:80 max_fails=3 fail_timeout=5s;</span><br><span class="line">        server 192.168.2.53:80 max_fails=3 fail_timeout=5s;</span><br><span class="line">&#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        proxy_pass rancher_servers_http;</span><br><span class="line">&#125;</span><br><span class="line">    upstream rancher_servers_https &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server 192.168.2.51:443 max_fails=3 fail_timeout=5s;</span><br><span class="line">        server 192.168.2.52:443 max_fails=3 fail_timeout=5s;</span><br><span class="line">        server 192.168.2.53:443 max_fails=3 fail_timeout=5s;</span><br><span class="line">&#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen     443;</span><br><span class="line">        proxy_pass rancher_servers_https;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># 测试 </span><br><span class="line">cat &gt; /etc/nginx/nginx.conf &lt;&lt; EOF </span><br><span class="line">worker_processes 4;</span><br><span class="line">worker_rlimit_nofile 40000;</span><br><span class="line">include /usr/share/nginx/modules/*.conf;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 8192;</span><br><span class="line">&#125;</span><br><span class="line">stream &#123;</span><br><span class="line">	upstream rancher &#123;</span><br><span class="line">        server 192.168.30.110:80;</span><br><span class="line">        server 192.168.30.129:80;</span><br><span class="line">        server 192.168.30.133:80;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">        default Upgrade;</span><br><span class="line">        &#x27;&#x27;      close;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 443 ssl http2;</span><br><span class="line">        server_name cf.rancher.com;</span><br><span class="line">        ssl_certificate /home/admin/certs/tls.crt;</span><br><span class="line">        ssl_certificate_key /home/admin/certs/tls.key;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">            proxy_set_header X-Forwarded-Port $server_port;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass http://rancher;</span><br><span class="line">            proxy_http_version 1.1;</span><br><span class="line">            proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">            proxy_set_header Connection $connection_upgrade;</span><br><span class="line">            # 这里将允许您在 Rancher UI 中打开命令行窗口时，窗口可以保留最多15分钟。没有这个参数时，默认值为1分钟，一分钟后在Rancher&gt;中的shell会自动关闭。</span><br><span class="line">            proxy_read_timeout 900s;</span><br><span class="line">            proxy_buffering off;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name cf.rancher.com;</span><br><span class="line">        return 301 https://$server_name$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nginx -t  # 测试语法是否有误</span><br><span class="line">nginx -c /etc/nginx/nginx.conf # 设置配置文件</span><br><span class="line">nginx -s reload # 加载更改的配置文件</span><br></pre></td></tr></table></figure>

<p>启动服务，设定nginx自启动服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl restart nginx.service</span><br><span class="line">systemctl enable nginx.service</span><br></pre></td></tr></table></figure>

<p><code>2.5  故障处理</code> </p>
<p>这里可能会出现几个问题： </p>
<p><code>问题1  </code> unknown directive “stream”</p>
<p>先检查nginx的配置有没有错误，或者有没有tab空格，nginx是不支持tab空格的，可以使用下面命令检查格式，对齐或者空格 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat -A  /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure>

<p>如果配置确实没有问题，也有可能是nginx版本问题, 换稳定版的nginx。 </p>
<p><code>问题2</code> 缺少 “/var/run/nginx.pid”文件</p>
<p>解决方法， 没有就新建一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd /var/run/</span><br><span class="line">touch nginx.pid</span><br></pre></td></tr></table></figure>

<p><code>问题3</code> nginx: [error] invalid PID number “” in “/var/run/nginx.pid”</p>
<p>解决，先执行ngingx -c， 再加载配置文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">nginx -c /etc/nginx/nginx.conf</span><br><span class="line">nginx -s reload</span><br></pre></td></tr></table></figure>

<p><code>问题4</code> 80/443端口被占用, 如下: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Job for nginx.service failed because the control process exited with error code. See &quot;systemctl status nginx.service&quot; and &quot;journalctl -xe&quot; for details.</span><br><span class="line">[root@nginx ~]systemctl status nginx.service</span><br><span class="line">bind() to 0.0.0.0:80 failed (98: Address already in use)</span><br><span class="line">bind() to 0.0.0.0:443 failed (98: Address already in use)</span><br></pre></td></tr></table></figure>

<p>要先关闭服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nginx -s quit</span><br></pre></td></tr></table></figure>

<p>如果还是不行，可能是端口被其应用占用，就查看一下占用的进程，这里直接清理占用的进程</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fuser -k 80/tcp</span><br><span class="line">fuser -k 443/tcp</span><br></pre></td></tr></table></figure>

<h4 id="3-部署rancher-server"><a href="#3-部署rancher-server" class="headerlink" title="3 部署rancher server"></a>3 部署rancher server</h4><p><code>3.1 安装helm  </code> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#helm下载地址：https://github.com/helm/helm/tags </span><br><span class="line">tar -zxf helm-v3.2.4-linux-amd64.tar.gz </span><br><span class="line">mv linux-amd64/helm /usr/bin/helm</span><br><span class="line">rm -rf helm-v3.2.4-linux-amd64.tar.gz linux-amd64</span><br></pre></td></tr></table></figure>

<blockquote>
<p>helm3与helm2不同，是不需要安装tiller的</p>
</blockquote>
<p><code>3.2 部署rancher web服务</code></p>
<p>添加Chart仓库地址</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 使用helm repo add命令添加Rancher chart仓库地址，访问Rancher tag和Chart版本</span><br><span class="line"># 替换&lt;CHART_REPO&gt;为您要使用的Helm仓库分支(即latest或stable）。</span><br><span class="line"># helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</span><br><span class="line"># 国内可用镜像</span><br><span class="line"># helm repo add rancher-stable http://rancher-mirror.oss-cn-beijing.aliyuncs.com/server-charts/stable</span><br><span class="line">helm repo update</span><br></pre></td></tr></table></figure>

<p>Rancher Server 默认需要 SSL/TLS 配置来保证访问的安全性，这里我们选择自签名的证书</p>
<p>这里使用官方文档给的生成证书的脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir ssl</span><br><span class="line">cd ssl/</span><br><span class="line">chmod +x create_self-signed-cert.sh  # 执行权限</span><br><span class="line">#然后再用这个脚本生成ssl证书</span><br><span class="line">./create_self-signed-cert.sh --ssl-domain=my.rancher.com --ssl-trusted-ip=192.168.0.41 --ssl-size=2048 --ssl-date=3650</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#查看证书</span><br><span class="line">[root@node1 ssl]# ls</span><br><span class="line">cacerts.pem  cacerts.srl  cakey.pem  create_self-signed-cert.sh  my.rancher.com.crt  my.rancher.com.csr  my.rancher.com.key  openssl.cnf  tls.crt  tls.key</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 为rancher创建命名空间</span><br><span class="line">kubectl create namespace cattle-system</span><br><span class="line"></span><br><span class="line"># 服务证书和私钥密文</span><br><span class="line">kubectl -n cattle-system create \</span><br><span class="line">    secret tls tls-rancher-ingress \</span><br><span class="line">    --cert=/home/rancher/ssl/tls.crt \</span><br><span class="line">    --key=/home/rancher/ssl/tls.key</span><br><span class="line"></span><br><span class="line"># ca证书密文</span><br><span class="line">kubectl -n cattle-system create secret \</span><br><span class="line">    generic tls-ca \</span><br><span class="line">    --from-file=/home/rancher/ssl/cacerts.pem</span><br></pre></td></tr></table></figure>

<p>安装rancher server </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">helm install rancher rancher-stable/rancher \</span><br><span class="line">    --namespace cattle-system \</span><br><span class="line">    --set hostname=my.rancher.com \</span><br><span class="line">    --set ingress.tls.source=secret \</span><br><span class="line">    --set privateCA=true</span><br><span class="line"># hostname需要与证书对应的域名匹配，否则ingress将无法代理访问Rancher。</span><br></pre></td></tr></table></figure>

<p>my.rancher.com是后面访问rancher的域名，需要在/etc/hosts文件中添加关联（所有主机）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node1 ~]$ echo &quot;192.168.0.41 my.rancher.com&quot; &gt;&gt; /etc/hosts</span><br><span class="line">[root@node2 ~]$ echo &quot;192.168.0.41 my.rancher.com&quot; &gt;&gt; /etc/hosts</span><br><span class="line">[root@node3 ~]$ echo &quot;192.168.0.41 my.rancher.com&quot; &gt;&gt; /etc/hosts</span><br><span class="line">[root@nginx ~]$ echo &quot;192.168.0.41 my.rancher.com&quot; &gt;&gt; /etc/hosts</span><br></pre></td></tr></table></figure>

<p><code>3.4 容器配置hosts:</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">kubectl -n cattle-system patch deployments rancher --patch &#x27;&#123;</span><br><span class="line">    &quot;spec&quot;: &#123;</span><br><span class="line">        &quot;template&quot;: &#123;</span><br><span class="line">            &quot;spec&quot;: &#123;</span><br><span class="line">                &quot;hostAliases&quot;: [</span><br><span class="line">                    &#123;</span><br><span class="line">                        &quot;hostnames&quot;:</span><br><span class="line">                        [</span><br><span class="line">                            &quot;my.rancher.com&quot;</span><br><span class="line">                        ],</span><br><span class="line">                            &quot;ip&quot;: &quot;192.168.2.40&quot;</span><br><span class="line">                    &#125;</span><br><span class="line">                ]</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;&#x27;</span><br></pre></td></tr></table></figure>

<p><code>3.5 添加本机hosts</code><br>将刚刚的域名映射关系写入到Windows主机的hosts文件中。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.0.100 my.rancher.com</span><br></pre></td></tr></table></figure>

<h4 id="4-访问rancher-server"><a href="#4-访问rancher-server" class="headerlink" title="4 访问rancher server"></a>4 访问rancher server</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Happy Containering!</span><br><span class="line">[root@node1 ssl]# echo https://my.rancher.com/dashboard/?setup=$(kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#x27;)</span><br><span class="line">https://my.rancher.com/dashboard/?setup=</span><br><span class="line">[root@node1 ssl]# kubectl get secret --namespace cattle-system bootstrap-secret -o go-template=&#x27;&#123;&#123;.data.bootstrapPassword|base64decode&#125;&#125;&#123;&#123; &quot;\n&quot; &#125;&#125;&#x27;</span><br><span class="line">b9bwmrwrs7ndzrpvn6lnqc22hmtf7wbdpkpxh652jbrcbkhtlgxsd2</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/31/2021-10-31-%E3%80%8A%E5%91%A8%E6%81%A9%E6%9D%A5%E4%BC%A0%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/31/2021-10-31-%E3%80%8A%E5%91%A8%E6%81%A9%E6%9D%A5%E4%BC%A0%E3%80%8B/" class="post-title-link" itemprop="url">《周恩来传》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-31 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-31T00:00:00+08:00">2021-10-31</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="《周恩来传》"><a href="#《周恩来传》" class="headerlink" title="《周恩来传》"></a>《周恩来传》</h2><p>原文摘录：</p>
<ul>
<li> 在人们看来，赫鲁晓夫可能令人恼怒地攻击过周的阶级出身“你的这种批评很好，周同志，”他说，“不过你得承认，我来自工人阶级，而你却出于资产阶级家庭。” 一 阵沉默。而后，周镇静地答道：“是的，赫鲁晓夫同志。但是我俩少有一点是共同的，我们俩都背叛了自己的阶级。” </li>
<li>周思来同志 我们要造你一点反，就是请求你改变现在的工作方式和生活习惯，以适应你的身体变化情，从而你才能为党工作得长久一些，更多一些。这是我们从党和革命的最高的长远的利益出发。所以强烈地请求你接受我们的恳求。</li>
<li>周开始向外国人解释为什么中国不能像西方国家那样行事。他告诉一位外国记者： 中国不能轻率地实行像美国、英国和其他真正民主国家那样的民主。中国人民受过长期的压迫，在他们理解诚实投票的重要性和意义之前，还需要几代人的政治训练。我们还没有为一个彻底的民主制度做好准备。我们必须慢慢来。</li>
<li>司徒雷登本想在6月底访问北京，但未能成行，他收到周一封相当消极的私人信件，该信件戳了一些老伤疤，周取消了对司徒雷登的邀请。几周后又把这个运气不佳的大使描绘成“惯于以和蔼可亲的面目掩盖其虚伪和欺骗”。 周的直率和他那不装模作样的共产主义作风在1949年夏季中的一次讲演中大放光彩，他在北京的一次青年大会上对那些共产主义的下一代谈到毛时说，毛是一个伟人，但与普通人没什么两样，他不应该被看成是“一个偶然的、天生的、神秘的、无法学习的领袖”，年轻人向他学实习时应该从他的历史发展来学习，不要只看今天的成就伟大而不看历史的发展”，昨天迷信的孩子可以变成今天的毛主席(当然，我不是说所有的孩子都可以成毛主席)。他再次提醒说，毛也曾在农村问题上犯过错误。然而，毛已经开始美化他自己的历史，允许献媚的助手去篡改文献。这一腐败倾向在7年前的“整风运动”中就开始了。 周讲话结束时表示完全同意刘少奇对毛的赞扬之词，即毛成功地运用普遍真理于中国的实际。但他补充说，为了使老百姓在这一真理中受益，必须首先通过教育和宣传来使他们提高政治觉悟，因此，周正确地预见了以后10年中国的政策路线斗争，表明他选择了一种缓慢而实用的变革进程，而不是向一种难以捉摸的社会主义作疯狂冲刺。</li>
<li>中国不能轻率地实行像美国、英国和其他真正的民主国家那样的民主。中国人民受过长期的压迫，在他们理解诚实投票的重要性和意义之前，还需要几代人的政治训练。我们还没有为一个初底的民主制度做好准备。我们必须慢慢来。</li>
<li>在一次修面时，周恩来突然咳嗽起来，结果理发师刮破了他的下巴。周恩来看到他那惶恐的样子，迅速道歉说：“我本该在咳嗽前先给你打声招呼。”</li>
<li>周恩来一直没有遭到什么毁灭性的麻烦，因为毛泽东和江青都需要他。甚至在某种程度上，当默默羞辱他的时候，他们也需要利用他那别人无法比拟的才能。</li>
<li>在天安门出现了这样一份悼词，它写道：“他没有遗产，他没有嗣息，他没有坟墓，他也没有留下骨灰，他的骨灰撒在祖国的山河中。他似乎什么也没有给我们留下，但是他拥有全中国，他儿孙好几亿，遍地黄士都是他的。”</li>
<li>他的考虑是对方既富有，家中又有权势，自己家中贫穷，将来会受制于人。</li>
<li>从高级领导层看，这场“文化大革命”也可算作一场夺权的斗争。在斗争中，毛泽东依靠他与周来和代表军队的林彪建立的强大联盟，从刘少奇手中重新夺回了他的领导权。西方观察家一般都认为周恩来是一个温和派，但在这场特殊的斗争中，他与毛泽东站在一起。这可能是因为他更信任、尊敬毛泽东。周恩来与他亲密地共同工作了35年，而刘少奇与周恩来却不太熟悉。</li>
<li>诱使一个世界上最有权力的政治领导人，同时也是一个长期以来对中国共产主义怀有深仇大恨的国家的元首来中国进行官方访问(他的政府甚至还没有承认中国)并与中国领导人就悬而未决的双边问题进行谈判，这是周恩来长期外交生涯中最辉煌的成就。甚至周恩来自己也用同样夸张的语言把它称为国际关系中令人高兴的一个突破。</li>
<li>一名医生后来回忆说：“周恩来是被逼死的。······他们不让他休息。······甚至在我们给周总理输血时，江青也会挂电话来命令在她与总理说话时停止输血，她尽扯些无聊的事，她却把这些称为‘国家大事’。”传说有名医生还声称，中国最优秀的癌症专家提出的治疗方案没被采纳。</li>
<li>周恩来接受了这样一个事实，那就是，中国共产主义的活力将不得不由一个农民领袖来提供。这个人知道农民是如何生活的，并清楚他们在想些什么。而另一方面，毛泽东则需要一个能在世界上代表中国共产主义运动的外交家。周恩来并不奉承毛泽东，但他熟悉毛泽东的个性。毛泽东一方面不信任溜须拍马之辈，另一方面又对潜在的背叛十分敏感。周恩来能够熟练地平息这些不安全因素，而毛泽东为周恩来提供了一个坚如磐石般的长者形象，周恩来童年的经历或许已使他对这样一个形象十分向往。</li>
<li>不是周恩来低估了共产主义，而是毛泽东等走的太快，因为他们在目标与手段之间失去了平衡，他们贪心地以违背自然规律的速度去追求效果，准备把人性中最坏的部分引导出来，还着魔似的相信这可以达到好的目的。这不是共产主义，这只是一个壮观的带有孩子气的梦幻。只有周恩来才是真正的共产主义者，别的人只不过是在玩弄空头政治，而这是他所不擅长的，他有着经过改头换面的拿破仑式的博学，还带有梅特涅式的政治上的坚韧。</li>
<li>周恩来一生的事业可以用消极的色彩来描绘。他献身于共产主义事业，而它能否实现还是个问题；他后来发现，甚至在经济发展这类问题上，其精选出来的信条加上他自己那第一流的实干技巧也不能带来所希望的结果。他自己也在20世纪40年代就认识到除非千百万人民被成功地教育过来，把他们的思想改造得具有合作与集体主义精神，否则的话，共产主义在中国就不会起什么作用。但是，一旦他成为这个巨大国家的政府领导人，他就被驱使着为立即实现共产主义的所有目标而全速前进。</li>
<li>周恩来最后没能实现他的诺言，终其一生也没能把中国决定性地带入一个明显有着更高生活水平的更先进的工业和技术发展的现代社会。严格地说，这不是他的错，而更多的应归因于客观条件的无情。任何想在这样一个落后的大国迅速取得巨大进步的人都难免会遭到巨大挫折。然而，周恩来没有在这不可避免的挫折面前撒手不管或是作出过激的反应。他只是不动声色地坚守他的阵地，为使共产党中国的改革能继续下去提供唯一的一股主要动力。他这么做的时候，不像其他领导人那样以一种执拗的、决不通融的方式进行，而是以一种永远使人感到振奋的、非常民主的风格来进行，这就使得别人不断地集合在他的周围并帮助他奋力去实现目标。</li>
<li>苗谴责周为他的革命把少帅当成了牺牲品。 “不，苗兄，不是我的革命，是为了我们民族的命运，为了正在流血牺牲的千千万万个我们的同胞。你在少帅的舒适的司令部里待得太久了。你还没有亲自到川西、陕北，以及那么多无法生活的地方走走，你还没有看见我们的大多数人民是怎样生活的，他们祖祖辈辈都过着非人的生活啊！” 苗坚持说周对少帅没有感情。“我曾听说共产党人从不为自己同志的死而落泪。” “不！”周回答，“我们从不为悲哀落泪，我们只有愤怒的相，这是绝对不同的，我们正在为人民而战，感伤是没有用的。我们的革命经验是我们的同志用生命换来的，我们的政策是用鲜血写成的，靠几滴伤感的泪水是不行的。” </li>
<li>妇女权利是周恩来热忱改革的对象之一。他对上海的一个妇女组织说：“家庭是很重要的。你们不要看不起家务工作。不管怎么说，你们每个人都负责个一人政府。你们每个人都管理着你们家庭的内政部和外交部。还有谁的工作比这还重要？” </li>
<li>他们是一些错误地判断了人类本性的理想主义者。周恩来接着说，社会主义道路应该是一步一步地走，首先要教育群众，使他们达到一个公平社会的道德水平所要求的高度。在过渡时期，必须认识到群众仍是一些普通的人，他们中间有些人先进，有些人落后，因此“物质刺激”是必要的，鉴于那些一厢情愿的思想家曾经一度认为中国在十几年内就能跨入发达国家的行列，周恩来估计中国还将需要30~-40年才能做到资金和消费品的自给自足，而要达到西方那么高的生活水平，还需要差不多100年的时间。</li>
<li>一些国民党人想把他从共产党这里争取过去，“他们从来没有成功过，因为他从不在意个人的安逸、财富和势力”。</li>
<li>像以往一样，周恩来的策略是找出双方的理亏之处，迫使双方都作出使对方满意的让步。</li>
<li>“文化大革命”中所发生的事是如此复杂，使人们几乎不可能对它作一个简单的分析。但是，看清它的最好的方法是重新观察一下三个融合在一起的,性质截然不同而又都刻有“文革”标记的现象。首先，我们看到的是一场为改变大部分党员和非党员头脑中的传统观念以及封建主义和非社会主义 思想而进行的意识形态运动。这场运动的最终目标是使民主、社会主义和集体主义精神达到一个更高的水平，周恩来是这一愿望的拥护者。 后来，周恩来就是从这个意义出发，把“文革”解释为一个漫长过程 第一步，认为它“不可能一下子解决所有的问题”。几年后，他在与费利克斯・格林谈话时引述了毛的革命思想，并说道：“类似这样的革命应该一次又一次地进行，而且每一次都应达到一个更高的阶段，每一次都应比前一次更深入。”周恩来在这里并不是违心地讲话，而是以一个热心的社会主义者的身份讲这番话的。他在这里以他一的乐观主义态度假定下一次革命可以免无政府主义和权力斗争。 从高级领导层看，这场“文化大革命”也可算作一场夺权的斗争。在斗争中、毛泽东依靠他与周恩来和代表军队的林彪建立的强大联盟，从少奇手中新夺回了他的领导权。西方观察家一般都认为周恩来是一个温和派，但在这场特殊的斗争中，他与毛泽东站在起。这可能是因为他更信任、尊敬毛泽东。周恩来与他亲密地共同工作了35年，而刘少奇与周恩来却不太熟悉。 最后，还有一个低层次的“文化大革命”。这一革命发生在远离北京的地方。它打破正常的法律和秩序的限制，允许一些个人和派别进行报复活动权行动。这场革命最初像是一次有益的周期性放血，但最后却演变成 影全国性的混乱，于是周恩来转而坚决反对它并在最后取得了成功。 </li>
<li>他的一个崇拜者后来这样写道：“他甚至能与魔鬼共事，并从中获胜。 毛泽东开始把周恩来叫做“管家”，这是一个善意的称呼。有一个欧洲外交家曾经这样评论道：如果把中国比作一个家庭，那么，“深受人民喜爱的周恩来就扮演了一个母亲的角色，而一开始受人尊敬、后来又让人害怕的毛泽东则扮演了父亲的角色”。 一个美国学者在华盛顿举行的参议院听证会上警告说，不应过于乐观地把周恩来看做一个实用主义者和一个讲道理的人。“实际上”弗朗茨・迈克尔教授说他是一个很难对付的领导人，但迈克尔所代表的观点在美国舆论界的优势地位正在动摇。周恩来那过人的才能使他不仅在国内压倒了林彪和陈伯达，而且在国外也击败了那些反对他的人。</li>
</ul>
<p>同在《毛泽东传》中一样，作者把总理漫长一生的政治道路选择投射到其童年经历，企图追根溯源作出宿命论的诠释。真可笑。不过，算上文化的间隔，总体上还算客观。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/19/2021-10-19-%E3%80%8A%E6%AF%9B%E6%B3%BD%E4%B8%9C%E4%BC%A0%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/19/2021-10-19-%E3%80%8A%E6%AF%9B%E6%B3%BD%E4%B8%9C%E4%BC%A0%E3%80%8B/" class="post-title-link" itemprop="url">《毛泽东传》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-19 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-19T00:00:00+08:00">2021-10-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>迪克•威尔逊 </p>
<ul>
<li>如果老师的课枯燥乏味，他就看小说或打瞌睡——他后来解释说，这是对那些不会用提问和对话引起学生兴趣的老师的一种惩罚。</li>
<li>笔记中说：“我之界当扩而充之，是故宇宙一大我也。”毛指出古代的仁人志士“有杀身亡家而不悔者矣”。毛解释说，这样的人毒蛇螫手，他必断腕。 毛评论说：“彼仁人者，以天下万事为身，而以一身一家为腕，惟其爱天下万世之诚也，是以不敢爱其身家。身家虽死，天下万世固生，仁人之心安矣。”从毛自己写的这些话中可以明显地看出，毛就自己的行为对家庭的影响有一种社会犯罪感，可以看出，他是在为他后来抛弃自己的家庭进行辩护。从笔记中当然也看出毛的使命感。 毛在会上“从不轻易表态”，无论是主持会议还是一般发言——最突出的是他从不作冗长、离题而混乱的讲话。如果他旁边的其他人开始辩论，甚至吵起来的时候，毛都静静地用心倾听各方面的意见。 无论什么时候其他人谈话时，毛都“略低着头或偏着头听别人谈话，而自己只‘嗯’、‘是的’的回答，在倾听对方说完之后，他有条有理地给对谈者分析，提出要点，作出结论。他的话并不多，但每一句都很中肯，都能启发人。” 我过了20年甘露般的生活，对世界一无所知。——毛 他读了查尔斯·达尔文的《物种起源》、亚当斯密的《原富》、穆勒的《名学》、赫伯特·斯宾塞的《群学肆言》、孟德斯鸠的《法意》、让·雅克·卢梭的《社会契约论》以及赫胥黎的《天演论》。 毛在军营中的雇佣兵生活使他懂得，依靠这种军队来达到革命的目的是徒劳的，因为在政治上很难教育他们。毛明白，要成功地进行农村改革运动……就必须武装农民自己。</li>
<li>毛回忆说：“我的军饷是每月七元，每月伙食用去2元。我还得花钱买水。士兵用水必须到城外去挑，但是我是一个学生，不屑挑水，只好向挑夫买水。”毛年轻时很看重劳动的贵贱。 <strong>在大家争辩激烈时，从不轻易表态，等到大家意见发挥已尽，他才从容作出总结</strong>。他的总结总是取长舍短，斟酌尽善；对于一个问题，一种争论，总是分析深入，抓住要害。所以大家都心悦诚服。好些争论即因他精切简当的剖析而得到解决。 署名是“二十八画生启事”——“毛泽东”三个字共有二十八画。 毛反驳说：“如果领袖没有权利，就不可能执行计划，就不能得心应手。领袖拥有的权力多，事情就比较容易办。为了改造一个国家，国民必须刻苦自励，并且需要作出牺牲。” 毛说：“是的，压迫是政治的精髓。如果你压迫得法，说明你的政治是成功的。归根结底，政治的影响力十分简单，不过是经常保持压迫罢了。</li>
</ul>
<p>——争辩往往不能达成共识，除非两个人诚心讨论，这样的情况很少。不表态是更有效的做法。</p>
<ul>
<li>这时，拿未曾改造的知识分子同工人农民比较，就觉得知识分子不干净了，最干净的还是工人农民，尽管他们手是黑的，脚上有牛屎，还是比资产阶级和小资产阶级知识分子都干净。</li>
<li>919年的五四运动是北京自发产生的抗议内忧外患的学生运动，当时毛正在参观他自己国家的圣地——显然他从中汲取了营养。 得出结论认为失败的原因在于中国知识分子脱离广大人民群众。知识领袖要取得任何革命的胜利都必须密切联系这个国家的公民。 我并不想去欧洲。我觉得我对自己的国家还了解的不够，我把时间花在中国会更有益处。</li>
<li>毛清楚地记得在广州听孙讲话以及与他交谈的情景。毛说：“他是一个演说家，一个鼓动家，讲起话来雄辩有力，赢得了一片掌声——他不容别人与他争论，或提出他们自己的观点。实际上他的话<strong>水分很多，油很少</strong>。他不讲民主。</li>
<li>尽管当时工人运动处于低潮，毛任凭风浪起，稳坐钓鱼船。他完全从容自若，似乎一切都在安排之中。 若干年后毛回想起那些日子他进行农村调查的经历。他说，你不能仅下到村里去就希望能了解他们的结构和社会状况。我花了十几年功夫，才搞清楚。茶馆、赌场，什么人都接近、调查……我在家乡，找贫苦农民调查。 但毛也警告他的读者，不要人为地加速造反的行动。“菩萨是农民立起来的，到了一定时期农民会用他们的双手丢开这些菩萨，无需旁人过早地代庖丢菩萨。” 他有突出的军事素质，但缺乏政治判断力，当冲突的命令来自不同的政治司令部时，往往发生动摇。他的忠诚主要是依靠有毛和他在一起。</li>
<li>最初几天起义进行得很顺利，许多重要城镇落到了起义军手里。然而，长沙的工人并没有像毛所期望的那样，起来支持农民。当两支已脱离国民党的部队决定在他们之间开战后，力量单薄的起义军就面临内部火并的危险，于是，安源矿工差不多都被消灭了，毛的农军也中了埋伏。在起义爆发后的一个星期内，毛不得不放弃毫无希望的整个行动。正如他所承认的，“部队的纪律差，政治训练水平低，指战员中有许多动摇分子。开小差的很多。</li>
<li>毛忠告做领导工作的人，“迈开你的双脚，到你的工作范围的各部分各地方去走走，学个孔夫子的’每事问‘。’”“调查就像‘十月怀胎’，解决问题就像‘一朝分娩’。” 你对于某个问题没有调查，就停止你对于某个问题的发言权。——毛 林彪在古田支持了毛，但也许为进一步坚定他的信心，因而毛于1月5日给他写了一封信，题为《星星之火，可以燎原》。</li>
<li>另一个需要纠正的极端是绝对平均主义。“官长骑马，不认为是工作需要，而认为是不平等制度”。有些人要求分物品和背米一律平等：“司令部住了一间大点的房子也要骂起来。” 毛解释说：“就是在社会主义时期”，也“绝无所谓绝对的平均”。1930年元旦，红四军领导在古田举行会议，毛同意重新恢复政治部，牺牲了士兵苏维埃的权力。毛按会议精神对部队官兵进行了整顿，巩固了他的领导，因为类似苏维埃式的民主制度有可能给他的对手钻空子的机会。 他还建议加强党在军队中的作用，党支部由官兵混合组成。那些有“错误的政治倾向”的党员，那些只想大吃大喝、抽鸦片、赌博，或不惜犯罪去获取外币黄金发财又不思悔改的党员，应被从党内清除出去。 至于军队本身，毛建议军事指挥员和政治委员应该“共同的平等的”参与决策。他制定了详细的、新的、严格的纪律条例，要求官兵在党的政治口号下进行工作。 总之，他这样对待他的同志是有点过分的。林彪支持他，但彭德怀有意见。在井冈山周围游击了两年之后，毛的战地指挥员们对以江西的贫瘠农村为支撑红军的根据地，已有了显而易见的不满。从而更倾向于李立三路线，在城市地区振兴革命，现在听来就要比毛的路线更具有吸引力。指挥员们试图立即就移驻到城市去。毛使用整编打乱指挥的方式，才调换了许多高级指挥员。</li>
<li>他告诫说，民主应是集中指导下的民主。党的领导机关要有正确的指导路线，就必须“明了下级机关的情况和群众生活的情况，成为正确指导的客观基础”。决议不要太随便，一经形成，就必须坚决执行。“少数服从多数”，但是党内批评应该加强，必须认识到“党内批评是坚强党的组织、增加党的战斗力的武器……不应当利用批评去做攻击个人的工具”。 由于这样一些原因，革命的进程是缓慢的。“红军每到一地，群众冷冷清清，经过宣传之后，才慢慢地起来。”接下去从毛的笔下流露出的便是他一生中最具动摇和痛苦情绪的句子：“我们深深感觉寂寞，我们时刻盼望这种寂寞生活的终了。” 毛遭到监禁，第三次被从中央委员会中清除出去。由于在莫斯科的王明和在瑞金的博古的共同努力，此时，毛面临被永久排除出中国共产党高级领导层的前景。当听到他被监禁的消息后，一个后来脱党的老伙伴龚楚，带了一些酒和鸡看他，他们一边吃一边回忆上井冈山之前第一次会面的情形。日落后，他们又喝了很长时间，当他的朋友要回去时，毛打着手势说：“唉，井冈山同志的天下一去不复返了。” 两个星期后，长征开始了。</li>
<li>我郑重地向大会提出，我们应该深刻地注意群众生活的问题，从土地、劳动问题，到柴米油盐问题。……一切这些群众生活上的问题，都应该把它提到自己的议事日程上。应该讨论，应该决定，应该实行，应该检查。要使广大群众认识我们是代表他们的利益的，是和他们呼吸相通的。要使他们从这些事情出发，了解我们提出来的最高的任务，革命战争的任务，拥护革命，把革命推到全国去，接受我们的政治号召，为革命的胜利斗争到底。同志们，真正的铜墙铁壁是什么？是群众，是千百万真心实意地拥护革命的群众。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/10/2021-10-10-%E3%80%8A%E7%BB%8F%E6%B5%8E%E5%AD%A6%E9%80%9A%E8%AF%86%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/10/2021-10-10-%E3%80%8A%E7%BB%8F%E6%B5%8E%E5%AD%A6%E9%80%9A%E8%AF%86%E3%80%8B/" class="post-title-link" itemprop="url">《经济学通识》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-10 16:40:00" itemprop="dateCreated datePublished" datetime="2021-10-10T16:40:00+08:00">2021-10-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="《经济学通识》"><a href="#《经济学通识》" class="headerlink" title="《经济学通识》"></a>《经济学通识》</h2><p>作者： 薛兆丰</p>
<p>摘录：</p>
<ul>
<li> 一项资产的价值，总是它未来收入的折线，而过去投入的成本是沉没成本，不论大小都不影响资产的现值。</li>
<li>以纯朴的眼光看，人类至少面临四项普遍约束：（1）东西不够；（2）生命有限；（3）互相依赖；和（4）需要协调。人类种种制度安排，一概是为了应付这些约束而衍生的。粗略地概括，这四项约束对应着四类经济理论：（1）需求定律；（2）利息理论；（3）制度理论；和（4）宏观理论。</li>
<li>读书“瘾”也是一样。没有人生来就喜欢读书。得先在“阅读理解力”上作投资。要识字、要懂文法、要自己写过、要学过天文地理，懂得人情世故，要读得多，享受才能油然而生。有些人酷爱读书，要读书才够过瘾，而有些人则只看杂志，有些人看报纸就满足了，有些人只能看懂漫画，有些人就只看电视。对“阅读理解力”的投资不同，追求享受的方式就不同。</li>
<li>科斯理论的这两个思想渊源，有三个重要的含义： 一，在解决生产资源分配时，要紧的永远是边际的数值，而不是平均或总计的数值； 二，在协调资源的争用时，要紧的是要存在私有产权； 三，只要存在私有产权，产权所有者的个数就并不重要，也就是说，不管生产要素由多少人拥有，只要他们能保持充分的理智，他们就会达致相同的生产资源分配方案。</li>
<li>增加合作，并不意味着減少竞争；要鼓励竞争，也未必要靠遏制合作来实现。我们深化对合作的理解，也就是深化了对竞争的理解。</li>
<li>第六，价格决定成本，而不是成本决定价格。价格是由对最终成品的供求决定的，决定了以后，再倒过来决定生产原料的价格。房价是完全由供求决定的，房价被供求决定后，才倒过来决定土地的拍卖价格和开发商的利润。这因果关系，是学习价格规律的难点和重点，要想个不停，才能明白。到此请重读第四点。    第七，需求旺，有原因。（1）农民进城，数以亿计，创人类纪录。（2）住房面积和质量提高，购房者的平均年龄提前。（3）人均寿命延长，退休年期增加，但养儿防老已不可能，而养老保障并不健全，购房便成了人们储蓄保值的常用手段。购房月供三千，一千实为租金，两千实为储蓄。在上述因素的推动下房价高涨实属正常，而并非个别人的阴谋。非得要说是阴谋，那么大可以清者自清，选择只租不买，自动退出购房大军。到此请重读第三点。    第八，价格规律与市场状态无关。不管中国的市场是否成熟、官商有没有勾结、政府是否廉洁、行业是否垄断</li>
<li>事实上，金融危机的症结，最重要的是银行受到了政府的操控。出于政治需要或裙带关系，银行冒险将借来的外汇转贷给经营不善的国内企业，然而到期后，这些落后的企业无法清偿借款。改变这种状况的药方，就是切断政府意志与银行贷款之间的联系，消灭政策贷款和裙带贷款，增强银行的独立性和风险意识。金融危机并不表明自由经济的机器失效了，恰恰相反，引发连串问题的症结，正在于那些违反自由经济原则的环节。 金融危机的另一个原因，是那些既有中央银行、又实施汇率管制的国家，在将借来的外汇转贷给国内企业时，以该国的本位币来记账。由于这些国家往往未能成功地抑制货币发行量，所以该国的货币一旦贬值，企业到期的还款，就无法折合成足够的外汇，进而引发债务危机。 第三个原因，是大型的私人金融机构的投资失误。如美国“长期资本管理（LTCM）”的亏蚀，致使相关的以高杠杆率放款的银行濒临破产。这些不顾风险的银行，是咎由自取的。 第四个原因，是某些地区的货币体制出现了漏洞，引致投机者兴风作浪。例如香港，在实施警花货币发行局的七项措施以前，只要大量沽出港元，就能大幅扯高港元利率。本来，忠实地执行1983年所设计的联系汇率制度，这种情况是不会发生的。国际投资者看准了这个漏洞，连番操纵香港的汇市和股市，从中获利。</li>
<li>哈耶克断言：如何协调千万人之间的行为，如何利用分散在千万人头脑中的信息，才是真正的经济学核心问题。 </li>
<li>知道此岸，也了解彼岸，改革的困难，都是过渡的困难……经济改革如果不定下“事前规则”，而靠“酌情处理”来推进，就必然阻力重重，越改越难，越改越慢。 其实，成功的经济制度，并不在于改造人们的思想，而在于激励人们的行动。 每个人的资源和时间有限，用来上产此，就不能生产彼。”顾此“的成本就是”失彼“，选择”失彼“最小的”顾此“，就是这个人的相对优势。由于这始终是自己跟自己比的结果，所以任何人都永远具有相对优势。 成本就是放弃了的最好机会。 与富人为伍，你的处境会改善。不是因为你可以仰仗他们的仁慈，而是因为你在某方面的成本必定比他们低，是因为你有颠扑不破的相对优势。他们处于自私，就会与你分工合作。 他们享受现代化成果的同时，呼吁别人选择落后。 革命的蓝图越宏伟，就越容易推延，就越是画饼充饥。</li>
<li>只要知识是增长的，那么必定有部分知识是我们明天才知道而今天不知道的，那既然社会是受我们的知识影响的，那么社会的发展就是不可预测的 </li>
<li>一个能在市场上靠其产品获利的卖家，不可能通过搭售其他产品，来获得超额利润。</li>
<li>现实有约束，愿望得取舍。这是经济学者理解世界的出发点。</li>
<li>供求”先决定最终产品的“价格”，而最终产品的“价格”再决定原材料的“成本”。 </li>
<li>但不要试图说服我，给你个基尼系数，你就有本事告诉我将会发生什么。</li>
<li>数据本身不足以说明问题，因为它至少同时支持两种对立的情况 </li>
<li>这是说，即使是同一个人，究竞是”风险爱好者”、”风险 厌恶者”还是”风险漠视者”，也与其所处的财富水平有关。 美国哲学家罗尔斯（J. Rawls) , 因”公平”而盛名远播。他 用了一个生动的比喻，来证明”公平”是先于一切”公约”的。 罗尔斯说，有人生于豪门，有人生于陋室，一切皆出偶然，只能 听天由命：但是，在投胎之前，若人们能聚首一堂，他们会达成 怎样的协议呢？罗尔斯推断，由于每个人都对自己将来的命运懷 然不知，为了规避风险，即使每个人都出于自私，他们也必定会 达成一个”公平公约”，即在出生后趋向于”均分”每个人与生 俱来的一切，因为这样能使每个人的平均幸福程度达到最大。 罗尔斯这个关于”无知之幕”(veil of ignorance) 的比喻远近 闻名。我的质疑是：即使有过那样的聚会，会上人们真会一致赞 成”公平公约”吗？答案是未必！ 因为只要他们当中有些是”风 险喜爱者”，那么后者就一定宁愿挺而走险，不会受”结果公 平”的方案。毕竞，即使在现实生活中，我们也没见过自愿买完 彩票后，又要求全部参与者平分奖金的人群。</li>
<li>按“价高者得”原则筛选出来的不是贫富，而是需求的大小</li>
<li>而人们从来就只有权衡和取舍，而没有绝对的刚需</li>
<li>人的欲望是无止境的，所以世界上的经济商品永远都是稀缺的。</li>
<li>如何协调千万人之间的行为，如何利用分散在千万人头脑中的信息，才是真正的经济学核心问题 </li>
<li>要解决问题，就必须通过市场，就必须由分立的个人并行处理他们独自拥有的信息，这样才能协调众人的行为和分散的信息</li>
<li>供求决定售价，售价决定成本</li>
<li>这个世界的任何商品，其价值都是因为有人争夺才产生的 </li>
<li>正是一国对异国资源的需求，决定了汇率</li>
<li>寻求知识是辛苦的，保持理性是吃力的 </li>
<li>“民主”是按多数原则，集体商议如何行使国家暴力，来干预人与人之间本来可以缔结的契约，本来可以进行的贸易以及本来可以保有的产业 </li>
<li>任何管制都只能改变人们竞争的方式，而无法消除竞争本身</li>
<li>经济学人应该看清一般人不容易看到的一面</li>
<li>事物的价值完全依赖于每个个人的主观判断</li>
<li>只要有人群，就存在对事物的不同估值，就会出现交易；只要有选择，就必然有机会成本；只要存在时间，就存在耐用品，就会刺激投资 </li>
<li>市场从不失灵。那并不是市场失灵，而是解释失灵。 “外部性”恰恰不是因为市场失灵，而是因为缺乏市场。不是产权失灵，而是产权缺席。 天真的发问，有时可以重塑对世情的理解。 逻辑上可能出现的“市场失灵”，恰恰就是被市场的出现而修复的。 产品的价格不是事前根据成本决定的，而是事后根据市场钞票投票的结果决定的。定价由供求决定，与成本无关。 出价太低的卖家或出价过高的买家，其谈判力强；出价太高的卖家或还价过低的买家，其谈判力弱。</li>
<li>重要的问题是：政府向地产商征税，或者向购房者征税，两者有区别吗？经济学明白无误地告诉我们：两者没有任何区别。不管政府规定税赋是向哪一方征收的，都不影响买卖双方分担税负的比例。这被戏称为“法律无效定律”（The Law of the Irrelevance of the Laws），是任何接触税务问题的经济学学生必学的内容。</li>
<li>投资和投机，从可观察的行为看，是没有区别的。</li>
<li>歧视行为的影响不是单向的，而是双向的，不仅被歧视者要受影响，歧视者本身也要受影响。</li>
<li>更直截了当地说，选择就是歧视。</li>
<li>概括一下：具体情景下的供需关系，决定了单笔交易价；无数单笔交易价累加，形成了统计学意义上的均价；时间和条件不同，均价也就不同，而想求索产品的真正“原价”只能是折腾，注定徒劳无功；真正帮助顾客享受低价的方法，不是通过“纵向原价监管”来减少单笔交易间的价格离差，而是让卖家充分竞争、形成稳定而统一的交易平台，从而让顾客通过“横向实时比价”来获得低价。</li>
<li>消费者的选择行为，是与贸易保护主义者的口号背道而驰的。贸易保护主义者总是声称，消费者需要质量更高的产品，而进口的大米有虫、进口的西红柿太小、进口的香蕉改了基因、进口的面条缺乏韧性。问题不在于他们说的是不是事实，而是他们假借消费者的名义，限制了消费者选择劣质产品的自由。</li>
<li>从经济学看，道路不是公用品（public goods），而是私用品（private goods）。所谓公用品，指的是一个人用不影响其他人用的物品。典型的例子是音乐旋律、故事情节、科学定理等。公用品既可以由政府提供，如公共电视台的节目；也可以由个人提供，如带版权的电影和书籍。 私用品，指“一个人用了别人就不能用”的物品，包括粮食、电力、用水、医疗服务、教育设施、国家公园、交通工具和公路航道等。私用品也是既可以由政府提供，也可以由个人或者私营机构提供的。关键是，不论谁提供，也不论提供者是否向使用者收费，私用品的“一个人用了别人就不能用”的属性不变。公路就是这样：尽管它很可能是政府铺设的，而政府也很可能不收费，但一条车道，一辆车用了，别的车就不能同时同地使用，所以才会发生拥堵。其他私用品，也一概如是。</li>
<li>要知道，经济学家常说交易双方是自愿的，是双赢的。这没错，但他们还说了第三句话，即交易往往会使第三方受损。经济学上所说的“帕雷托最优”状态——交易后双方得益，且没有任何第三方受损的状态——是几乎不会出现的。也就是说，任何自愿交易的背后，几乎总是能够找到一些不同程度受损害的人。</li>
<li>假设市场上存在两个互相竞争的标准或平台，分别称为方案甲和方案乙，两者都具有正的网络效应，即参与的用户越多就越具价值，其中方案甲的价值，能从2人参与时的10元上升到10人参与时的20元，而方案乙的价值，能从2人参与时的4元上升到10人参与时的34元。尽管当参与者增加到10人时，方案乙优于方案甲，但人们是否会由于方案甲的初期价值较高，而在路径依赖的作用下，被方案甲锁住而无法选择当用户数量增加后价值后来居上的方案乙呢？ 两位经济学家的回答是：取决于方案乙是否“有主”。如果方案乙是无主的，那它就会得不到推广而被放弃，而这不是“市场所造成的失败”，而是“缺乏市场所造成的失败”。反之，如果方案乙是有主的，那么其主就会设法先垫支部分未来收入，补贴方案乙的早期用户，从而推动方案乙尽快达到超越方案甲的盈利规模。在这个过程中，拥有标准或平台的产权、从而形成动力、努力预测未来收益、筹资补贴先到用户、从而扩大网络规模、提高网络增值速度等环节，恰恰是市场挣脱“路径依赖陷阱”的关键步骤。</li>
<li>唯一应该反对的垄断，就是政府设置的准入障碍和特许经营。如果解除了政府保护，市场上出现的一切似乎是垄断的竞争形态，其实就都是自由竞争的结果。</li>
<li>弗里德曼（Milton Friedman）曾经列举过四种效率递减的花钱模式：一，花自己的钱替自己办事；二，花自己的钱替别人办事；三，花别人的钱替自己办事；四，花别人的钱替别人办事。</li>
<li>经济学家阿尔钦说得准确：“竞争从来都是在需求者和需求者之间展开的，或在供应者和供应者之间展开的。需求者和供应者之间不存在竞争。”</li>
<li>1960年代，法律经济学创始人戴瑞德（Aaron Director，1901-2004）曾经发现一个规律，即任何政府针对穷人的补贴措施，最终都会让中产阶级得益，而由极穷者和极富者付账。</li>
<li>所谓“管制汇率”，就是一国通过强行控制进出口商品量和外币兑换量，把本国货币的币值，硬性维持在某个先定的价位上。……而“自主汇率”，就是一国的货币当局只盯着本国的物价水平，以维持物价稳定为原则来控制货币流通量，而让本国货币与外币的兑换率自由浮动。至于“联系汇率”，则是本国货币与某国外币按固定汇率进行兑换。</li>
<li><strong>人的思想五花八门，而人的行动却大同小异；因为前者不承受代价，后者承受代价。</strong></li>
<li>很多人并不了解罢工的真正含义。不工作是旷工，集体不工作是集体旷工，生病不工作是请假，雇主允许不工作是放假，要求加薪是劳资协议，集体要求加薪是集体协议，自己卷铺盖走人是辞工。都不是罢工。 只有通过（1）在关键时刻忽然停止工作、使得雇主临时无法找到别人替代，或（2）占着工作岗位不工作，并且设法阻止别人代替自己工作，来要挟雇主增加工资或福利的行为，才叫罢工。占着位置不干活并且不让别人代替自己干活，是罢工的基本特征。罢工就是集体敲竹杠，就是集体违约，而且必然包含暴力因素。 临时以停止工作为威胁来要求加薪，是罢工的雏形。在1902年美国的Alaska Packers’ Association v. Domenico 案中，雇主准备了渔船，雇用了渔民，从旧金山出发到阿拉斯加捕捞三文鱼。船到了目的地后，渔民们便宣布临时要求加薪，否则就停止工作，这叫罢工。同样，1965年在美国爆发了葡萄园罢工，大量的葡萄眼看就要烂掉，采摘工人集体停工并要求增加工资，这也是罢工。敲竹杠是罢工的首要特征。</li>
<li>斯密并非写了两部自相矛盾的著作，分别供市场经济的怀疑这和支持者引用。相反，他通过《道德情操论》和《国富论》构造了一个自洽体系：由于人不仅是自私的，而且还天生需要通过满足小范围的同情心来换取快感，所以不仅需要在私人领域强调爱心，而且也更需要在公众领域强调应由自私之心在看不见的手的引导下来推动公益，并强调要警惕自私的掌权者对市场机制的破坏。只有这样，才能理解斯密为什么被视为市场经济之父，而不是计划经济或福利主义之父。</li>
<li>首次为阿尔钦带来国际声誉，并为经济学科学找到了稳固的落脚点的，是在他1950年发表的《不确定性、进化和经济理论》 （Uncertainty,Evolution, and Economic Theory )一文。该文的背景很简单：当时有两位大经济学家（Richard Lester和Fritz Machlup）在争论，企业家究竟有没有在计算边际成本和边际收益。阿尔钦回答：计算与否不重要，重要的是背后主宰企业家存活的客观规律；由于存在不确定性，所以人们在逻辑上不可能求得最大化； 人们只是在争取存活；即使（或虽然）人人都是傻瓜，物竞天择的规律也仍然时刻在发挥作用。 人们总想随心所欲，但因为必须为自己的所作所为负责，所以才不得不尽量保持理性。这正是阿尔钦（Armen Alchian）在1950年的《莫测、进化和经济理论》一文的深刻主题：不管人的主观上是否有意识地追求最大化，客观上只有那些成功地达到了最大化的人或集体才能在竞争中存活。 </li>
<li>价格有三个作用，一是传递信息，二是激励最有效的生产，三是分配产品。市场上的每个人都根据价格所蕴含的信息，选择生存方式和调整生产节奏，并以社会成本最低的方式分配产品</li>
<li>世界上不存在绝对刚性的需求，人们不可能不惜任何代价地追求某个目标。 人际需求不可比原则：效用只能自己跟自己比，不能拿人与人比。 人们有追求免费服务的自由，却没有逃避付出代价的自由。</li>
<li>正是客流暴增，才导致了火车票的涨价。火车票提价的幅度是多少，取决于客流增加的幅度，而跟乘客的心理承受能力扯不上任何关系。</li>
<li>现实可能不受欢迎，甚至令人憎恶，但经济评论的任务，应该是客观地解释真实的世界，而不是给读者发送歪曲的信息，流于用一厢情愿的愿望来博取读者的欢心。</li>
<li>愿意出高价买火车票的人，他所挣得的钞票，是他在别的场合向社会其他人提供服务换来的。也就是说，他为争夺火车票而作出的努力，已经得到了社会其他人的认可。</li>
<li>多年前、老友尹忠东教了我三件事情、会我受益无穷。一，他要我讨论问题或写文章时不要用比喻；二他告诉我有一个经济学家名字叫“弗里德曼”；三，他告诉我人的言辞与行动往往是背道而驰的，说是一套，做往往是另一套；人的思想和言论可谓五花八门，但行动却是高度一致的 这第三点，是我理解人性、理解学术争论、理解市场之美的起点。要对付“不确定性”，要提高对未来的预测力，减少资源浪费或空置的现象，人类不仅需要精准的知识，还需要追求知识和信息的原始动力，而追求知识和信息，往往是昂贵而痛苦的过程，而其中的试金石，就是到市场上赌一手，因为市场会不动声色地对你的判断恰如其分的奖惩。</li>
<li>政府不再负责分配住房，大量农村人口涌入城市，城市交通网络极不发达，政府批租土地有限，而居民收入预期逐年增长，这些因素全都表明中国的住房需求不是泡沫，而是真实的、强劲的、递增的、不可能靠行政手段打压下去的</li>
<li>这是说，即使‘政府有责任’，也并不等于‘政府有能力’。政府可以轻而易举地推出各种管制措施，但这些管制措施既不能替代、也不能增加真实的供应。这是经济学教训的核心。未掌握经济学的人，往往异想天开，以为政府有多大责任就能有多大能力，于是赋予政府极大的责任，让他包办衣食住行、生老病死，结果造就了上世纪‘计划经济’的大悲剧。</li>
<li>诺贝尔经济学奖得主加里 贝克尔教授，以研究家庭、犯罪和歧视问题闻名，他给‘歧视’下了定义：只有当歧视者愿意放弃一定的利益，例如收入、利益、工资或者享受，以便满足他个人的偏好时，才是歧视。</li>
<li>那个搔首弄姿的明星，之所以赚大钱，是因为市场对她有需求。你可以讨厌她，但得承认，别的很多人喜欢她，所以她的劳动力才值钱；而不是反过来，因为她投入的成本低，所以她的表演就不值钱。培养博士和专家的成本确实很大，但他们如果去扫地，那就只能接受扫地的工资，而他们过去钻研学问的成本与此无关。如果我搬到总统套房里写专栏，那么应该提高我的稿费吗？不。 归根结底，市场的‘供需’是劳动力价格的唯一决定因素。</li>
<li>根据维基百科的定义：‘庞氏骗局就是靠投资者或后继投资者的钱来还钱，而不是靠实际盈利来还钱的运作。它通常靠别人所不能的回报来吸引新的投资者，而这些回报通常是短期还款，它要么高的不正常，要么就是持续地不正常。这种生生不息的回报需要不断增长的现金流来维持。’ …… 有别于次，庞氏骗局的特征，是举债人刻意、反复、系统地向放款人谎报其经营所得和还款来源。甄别的关键，一是举债人的还款究竟来自经营的盈利，还是新的举债；二是放贷人在做出放贷决定时，究竟是清楚了解举债人的财务运作模式，还是受到了刻意的蒙骗。</li>
<li>考试是考书上的，不要东看西看。但平时思想的时候，就要东看西看、东想西想才行。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/03/2021-10-03-%E3%80%8A%E5%8F%97%E6%88%92%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/03/2021-10-03-%E3%80%8A%E5%8F%97%E6%88%92%E3%80%8B/" class="post-title-link" itemprop="url">《受戒》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-03 18:20:00" itemprop="dateCreated datePublished" datetime="2021-10-03T18:20:00+08:00">2021-10-03</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>《受戒》</p>
<p><strong>作者</strong></p>
<p>汪曾祺（1920年3月5日—1997年5月16日），男，汉族，江苏高邮人，当代作家、散文家、戏剧家，京派作家的代表人物。早年毕业于西南联大，历任中学教师、北京市文联干部、《北京文艺》编辑、北京京剧院编辑。汪曾祺在短篇小说创作上颇有成就，著有小说集《邂逅集》，小说《受戒》、《大淖记事》，散文集《蒲桥集》，其大部分作品收录在《汪曾祺全集》中。被誉为“抒情的人道主义者，中国最后一个纯粹的文人，中国最后一个士大夫。”1997年5月16日上午10点30分，汪曾祺因病医治无效去世，享年77岁。 ——豆瓣</p>
<p><strong>摘录</strong></p>
<ul>
<li><p>“当了沙弥尾跟别的和尚有什么不同？</p>
<p>” “沙弥头，沙弥尾，将来都能当方丈。现在的方丈退居了，就当。石桥原本就是沙弥尾。”</p>
<p> “你当沙弥尾吗？”</p>
<p> “还不一定哪。”</p>
<p> “你当方丈，管善因寺？管那么大一个庙？！” </p>
<p>“还早哪！” </p>
<p><strong>划了一气</strong>，小英子说：“你不要当方丈！”</p>
<p> “好，不当。” </p>
<p>“你也不要当沙弥尾！”</p>
<p> “好，不当。” <strong>又划了一气</strong>，看见那一片芦花荡子了。 小英子忽然把桨放下，走到船尾，趴在名字的耳朵旁边，小声地说： “我给你当老婆，你要不要？” <strong>明子眼睛鼓得大大的</strong>。 “你说话呀！” </p>
<p>明子说：“嗯。” </p>
<p>“什么叫‘嗯’呀！要不要，要不要？”</p>
<p> 明子大声地说：“要！” </p>
<p>“你喊什么！” </p>
<p>明子小小声地说：“要——！”</p>
<p> “快点划！” 英子跳到中舱，两只桨<strong>飞快地</strong>划起来，划进了芦花荡。 </p>
<p>——写的太温柔， 小英子的勇敢矜持，明子的懵懂羞涩，人类最美好的感情，是两小无猜的欢喜</p>
</li>
<li><p>各种卖小吃的都来了。卖牛肉高粱酒的，卖回卤豆腐干的，卖五香花生米的、芝麻灌香糖的，卖豆腐脑的，卖煮荸荠的，还有卖河鲜——卖紫皮鲜菱角和新剥鹅头米的……</p>
</li>
<li><p>同事之间为了“联络感情”，时常轮流做东，约好了在星期天早上“吃早茶”。这地方“吃早茶”不是喝茶，主要是吃各种点心——蟹肉包子、火腿烧麦、冬笋蒸饺、脂油千层糕。还可叫一个三鲜煮干丝，小酌两杯。</p>
</li>
<li><p>这家专做“草炉烧饼”。这种烧饼是一箩到底的粗面做的，做蒂子只涂很少一点油，没有什么层，因为是贴在吊炉里用一把稻草烘熟的，故名草炉烧饼，以别于在桶状的炭炉中烤出的加料插酥的“桶炉烧饼”。这种烧饼便宜，也实在，乡下人进城，爱买了当饭。几个草庐烧饼，一碗宽汤饺面，有吃有喝，就饱了。</p>
</li>
<li><p>“晚茶”大都是一碗干拌面，——葱花、猪油、酱油、虾子、虾米为料，面下在里面；或几个麻团、“油墩子”，——白铁敲成浅模，浇入稀面，以萝卜丝为馅，入油炸熟。八千岁家的晚茶，一年三百六十日，都是草炉烧饼，一人两个。这里的店铺，有“客人”，照例早上要请上茶馆。“上茶馆”是喝茶，吃包子、蒸饺、烧麦。照例由店里的“先生”或东家作陪。一般都是叫一笼“杂花色”（即各样包点都有）…… </p>
<p>——汪先生对食物的描写，妙笔柔情，劳苦大众普通的饮食，变得温柔。这些简单的东西，不知道我会写成什么样， 这样的文字应当细品，但是我都没有心思，静下来细读，我们是不是过的太着急？</p>
</li>
<li><p>高先生很孤僻，不出人情，不随份子，几乎不与人通庆吊。他家从不请客，他也从不赴宴。他教书之外，还为人写寿序，撰挽联，委托的人家照例都得请请他，知单送到，他照例都在自己的名字下书一个“谢”字。久而久之，都知道他这脾气，也就不来多此一举了。 他不吃烟，不饮酒，不打牌，不看戏。除了学校和自己的家，哪里也不去，每天他清早出门，傍晚回家。拍拍白木的板门，过了一会儿，门开了。进门是一条狭长的过道，砖缝里长着扫帚苗，苦艾，和一种名叫“七里香”其实是闻不出什么气味，开着蓝色的碎花的野草，有两个黄蝴蝶寂寞的飞着。高先生就从这些野草丛中踏着沉重的步子走进去，走进里面一个小门，好像走进了一个深深的洞穴，高大的背影消失了。木板门又关了，把门上的一副春联关在外面。</p>
</li>
<li><p>  高先生在东街住过的老屋倒塌了，临街的墙壁和白木板门倒还没有倒。板门上高先生写的春联也还在。大红朱笺被风雨漂得几乎是白色的了，墨写的字迹却还很浓，很黑。    辛夸高岭桂    未徙北溟鹏</p>
</li>
</ul>
<p>   ——汪先生笔下皆小人物，高先生有自己的个性，风格，坚持，信仰(尊师)，怎能不令人，动容</p>
<ul>
<li> 一天夜里，李小龙在梦里闻到一股醉人的香味。他忽然惊醒了：昙花开了！ 李小龙一骨碌坐了起来，划根火柴，点亮了煤油灯：昙花真的开了！ 李小龙好像在做梦。 昙花真美呀！雪白雪白的。白的像玉，想通草，像天上的云。花心淡黄，淡得像没有颜色，淡得真雅。她像一个睡醒了的美人，正在舒展着她的肢体，一面吹出醉人的香气。啊呀，真香呀！香死了！ 李小龙两手托着下巴，目不转睛的看着昙花。看了很久，很久。 他困了。他想就这样看他一夜，但是他困了。吹熄了灯，他睡了。一睡就睡着了。 睡着之后，他做了一个梦，梦见昙花开了。 于是李小龙有了两盆昙花。一盆在他的床前，一盆在他的梦里。 </li>
</ul>
<p>​       ——孩子的童心，心思 </p>
<ul>
<li>他们吃饭不怎么嚼，只在嘴里打一个滚，咕咚一声就咽下去了。看他们吃得那样香，你会觉得世界上再没有比这个饭更好吃的饭了。</li>
<li>都到岁数了，心里不是没有。只是像一片薄薄的云，飘过来，飘过去，下不成雨。</li>
<li>她们像男人一样的挣钱，走相、坐相也像男人。走起来一阵风，坐下来两条叉得很开。她们像男人一样亦脚穿草鞋（脚指甲却用风仙花 染红）。她们嘴里不生冷，男人怎么说话她们怎么说话，她们也用男人骂人的话骂人。打起号子来也是“好大娘个歪歪子咧！” 没出门子的姑娘还文雅一点 一做了媳妇就简直是“姜太公在此百无禁忌”，要多野有多野。 这里人家的婚嫁极少明媒正娶，花轿吹鼓手是挣不着他们的钱的媳妇，多是自己跑来的；姑娘，一般是自己找人。她们在男女关系上是比较随便的。姑娘在家生私孩子；一个媳妇，在丈夫之外，再“靠”个，不是稀奇事。这里的女人和男人好，还是恼，只有一个标准：情愿。有的姑娘、媳妇相与了一个男人，自然也跟他要钱买花戴，但是有的不但不要他们的钱，反而把钱给他花，叫做“倒贴”。 因此，街里的人说这里“风气不好” 到底是哪里的风气更好一些呢？难说。</li>
<li>“他们打你，你只要说不再进我家的门，就不打你了，你就不会吃这样大的苦了，你为什么不说？” “你要我说么?” “不要。” “我知道你不要。” “你值么?” “我值。 “十一子,你真好!我喜欢你!你快点好。” “你亲我一下,我就好得快。” “好,亲你!”</li>
</ul>
<p>​     ——大淖人敢爱敢恨</p>
<ul>
<li><p>小吕有一件大红的球衣，干活时他喜欢把外面的衣裳脱去，于是，在果园里就经常看见通红的一团，轻快地、兴冲冲地弹跳出没于高高低低、深深浅浅的丛绿之中，惹得过路的人看了，眼睛里也不由得漾出笑意，觉得天色也明朗，风吹得也舒服</p>
<p>——劳动人民单纯的幸福，我想到了少平把力气都用完。</p>
</li>
<li><p>晚饭米都没得一颗，还你妈的之乎——者也！</p>
</li>
</ul>
<p>——痛苦的文人，哎，读书</p>
<ul>
<li>  全县第一个大画家是季匋民，第一个鉴赏家是叶三。 </li>
</ul>
<p>——传说先秦的琴师伯牙一次在荒山野地弹琴，樵夫钟子期竟能领会这是 描绘“峨峨兮若泰山”和“洋洋兮若江河”。伯牙惊道：“善哉，子之心而与吾心同。”钟子期死后，伯牙痛失知音，摔琴绝弦，终生不弹，故有高山流水之曲。季匋民与叶三现代伯牙子期。</p>
<ul>
<li>陈相公挨了打，当时没敢哭。到了晚上，上了门，一个人呜呜地哭了半天。他向他远在故乡的母亲说：“妈妈，我又挨打了！妈妈，不要紧的，再挨两年打，我就能养活你老人家了！”</li>
<li>陈小手的得名是因为他的手特别小，比女人的手还小，比一般女人的手还更柔软细嫩。他专能治难产。横生、倒生，都能接生下来（他当然也要借助于药物和器械）。据说因为他的手小，动作细腻，可以减少产妇很多的痛苦。大户人家，非到万不得已，是不会请他的。中小户人家，忌讳较少，遇到产妇胎位不正，老娘束手，老娘就会建议：“去请陈小手吧。” …… 有一年，来了联军。我们那里那几年打来打去的，是两支军队。一支是国民革命军，当称之为“党军”；相对的一支是孙传芳的军队。孙传芳自称“五省联军总司令”，他的部队就被称为“联军”。联军驻扎在天王寺，有一团人。团长的太太（谁知道是正太太还是姨太太），要生了，生不下来。叫来几个老娘，还是弄不出来。这太太杀猪也似的乱叫。团长派人去叫称小手。 …… 这女人身上的脂油太多，陈小手费九牛二虎之力，总算把孩子掏出来了…… 陈小手出了天王寺，跨上马。团长掏出枪来，从后面，一枪就把他打了下来。 团长：“我的女人，怎么让他摸来摸去！他身上，除了我，任何男人都不许碰！这小子，太欺负人了！日他奶奶！” 团长觉得怪委屈。</li>
<li>宋侉子每年要在虞小兰家住一两个月，朝朝寒食，夜夜元宵。他老婆死了，也不续弦，这里就是他的家。他有个孩子，有时也带了孩子来玩。他和关家算起来有点远亲，小兰叫他宋大哥。到钱花得差不多了，就说一声：“我明天有事，不来了。”跨上他的踢雪乌骓骏马，一扬鞭子，没影儿了。在一起时，恩恩义义；分开时，潇潇洒洒。 虞小兰有时出来走走，逛逛宜园。夏天的傍晚，穿了一身剪裁合体的白绸衫裤，拿一柄生丝白团扇，站在柳树下面，或倚定红桥栏杆，看人捕鱼采藕。她长得像一颗水蜜桃，皮肤非常白嫩，腰身、手脚都好看。路上行人看见，就不禁放慢了脚步，或者停下来装做看天上的晚霞，好好地看她几眼。他们在心里想：这样的人，这样的命，深深为她惋惜；有人不免想到家中洗衣做饭的黄脸老婆，为自己感到一点不平；或在心里轻轻吟道：“牡丹绝色三春暖，不是梅花处士妻”，情绪相当复杂。</li>
<li>养鸭是一种游离，一种放逐，一种流浪。 </li>
</ul>
<p>——汪先生对劳苦大众有深刻的洞察，有无差别的爱</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/01/2021-10-01-docker-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/01/2021-10-01-docker-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">docker学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-01 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-01T00:00:00+08:00">2021-10-01</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-docker概述"><a href="#1-docker概述" class="headerlink" title="1  docker概述"></a>1  docker概述</h2><h3 id="1-1-docker是什么？"><a href="#1-1-docker是什么？" class="headerlink" title="1.1 docker是什么？"></a>1.1 docker是什么？</h3><p>开发和运维的环境不同，可能导致程序在开发的环境中可以正常运行而在运维的环境中出错。为了解决这个问题， docker可以将项目和环境一起打包，可以保持项目和环境保持一致。（问题驱动，需求驱动）</p>
<h3 id="1-2-docker发展"><a href="#1-2-docker发展" class="headerlink" title="1.2 docker发展"></a>1.2 docker发展</h3><pre><code>1. Docker 公司位于旧金山，由法裔美籍开发者和企业家 Solumon Hykes 创立，起初是一家名为 dotCloud 的提供Paas的公司。
2. 2013年，dotCloud 的 PaaS 业务并不景气，公司需要寻求新的突破。于是他们聘请了 Ben Golub 作为新的 CEO，将公司重命名为“Docker”，放弃dotCloud PaaS 平台，怀揣着“将 Docker 和容器技术推向全世界”的使命，开启了一段新的征程。
</code></pre>
<ol start="3">
<li>现今的Docker 公司已经通过多轮融资，吸纳了来自硅谷的几家风投公司的累计超过 2.4 亿美元的投资。</li>
<li>docker相比于虚拟机，十分的小巧，启动快速 </li>
</ol>
<h3 id="1-3-docker的特点"><a href="#1-3-docker的特点" class="headerlink" title="1.3 docker的特点"></a>1.3 docker的特点</h3><p>与传统虚拟化方法相比， 传统的虚拟机虚拟完整的硬件， 然后在系统上运行软件，而容器没有硬件和内核，所以非常轻便， 而且容器之间隔离的。</p>
<p>[外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-qmn5vXcT-1632447380520)(E:\blogpic\docker1.png)][外链图片转存失败,源站可能有防盗链机制,建议将图片保存下来直接上传(img-eRa8IowA-1632447380524)(E:\blogpic\docker2.png)]</p>
<h3 id="1-4-使用docker后-DevOps-开发与运维的变化"><a href="#1-4-使用docker后-DevOps-开发与运维的变化" class="headerlink" title="1.4  使用docker后 DevOps 开发与运维的变化"></a>1.4  使用docker后 DevOps 开发与运维的变化</h3><ol>
<li> 应用更快速的交付和部署，传统一堆帮助文档需要安装环境，现在一键部署</li>
<li> 更便捷的升级和扩缩容，项目打包成一个镜像，像搭积木一样部署</li>
<li> 更简单的系统运维，开发测试运维的环境高度一致</li>
<li> 更高效的计算资源利用，一个服务器上可以运行多个容器，提高资源利用效率。 </li>
</ol>
<h2 id="2-docker的使用"><a href="#2-docker的使用" class="headerlink" title="2 docker的使用"></a>2 docker的使用</h2><h3 id="2-1-docker基本概念"><a href="#2-1-docker基本概念" class="headerlink" title="2.1 docker基本概念"></a>2.1 docker基本概念</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/0e7c35e8d9a60f643d6dda8d7de66fe9.png"></p>
<ul>
<li>镜像(image)</li>
</ul>
<p>docker镜像就像模板，可以通过模板来创建容器服务，</p>
<ul>
<li>容器(container)</li>
</ul>
<p>通过容器可以独立运行一个或一组应用，就像一个简易的linux系统</p>
<ul>
<li>仓库(repository)</li>
</ul>
<p>仓库就是存放镜像的地方，分为共有仓库和私有仓库</p>
<h3 id="2-2安装docker"><a href="#2-2安装docker" class="headerlink" title="2.2安装docker"></a>2.2安装docker</h3><h4 id="2-2-1环境准备"><a href="#2-2-1环境准备" class="headerlink" title="2.2.1环境准备"></a>2.2.1环境准备</h4><blockquote>
<p>服务器：腾讯云服务器</p>
<p>系统: centos 7 </p>
<p>内核版本: 3.10.0-1160.31.1.el7.x86_64 </p>
<p>系统版本：[root@VM-4-6-centos ~]$ cat /etc/os-release<br>NAME=”CentOS Linux”<br>VERSION=”7 (Core)”<br>ID=”centos”<br>ID_LIKE=”rhel fedora”<br>VERSION_ID=”7”<br>PRETTY_NAME=”CentOS Linux 7 (Core)”<br>ANSI_COLOR=”0;31”<br>CPE_NAME=”cpe:/o:centos:centos:7”<br>HOME_URL=”<a target="_blank" rel="noopener" href="https://www.centos.org/&quot;">https://www.centos.org/&quot;</a><br>BUG_REPORT_URL=”<a target="_blank" rel="noopener" href="https://bugs.centos.org/&quot;">https://bugs.centos.org/&quot;</a></p>
<p>CENTOS_MANTISBT_PROJECT=”CentOS-7”<br>CENTOS_MANTISBT_PROJECT_VERSION=”7”<br>REDHAT_SUPPORT_PRODUCT=”centos”<br>REDHAT_SUPPORT_PRODUCT_VERSION=”7”</p>
</blockquote>
<h4 id="2-2-2-安装"><a href="#2-2-2-安装" class="headerlink" title="2.2.2 安装"></a>2.2.2 安装</h4><ol>
<li><p>[docker官网](<a target="_blank" rel="noopener" href="https://docs.docker.com/get-docker/">Get Docker | Docker Documentation</a>)选择适合的系统，版本 </p>
</li>
<li><p>若安装过，卸载旧的版本 </p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">sudo yum remove docker \</span><br><span class="line">                 docker-client \</span><br><span class="line">                 docker-client-latest \</span><br><span class="line">                 docker-common \</span><br><span class="line">                 docker-latest \</span><br><span class="line">                 docker-latest-logrotate \</span><br><span class="line">                 docker-logrotate \</span><br><span class="line">                 docker-engine</span><br></pre></td></tr></table></figure></li>
<li><p>通过库安装</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"># 1 安装依赖库</span><br><span class="line"> sudo yum install -y yum-utils</span><br><span class="line"> </span><br><span class="line"># 2 安装docker仓库</span><br><span class="line"> sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">   </span><br><span class="line"># 国外的仓库很慢，可以使用国内的镜像快一点 </span><br><span class="line"> sudo yum-config-manager \</span><br><span class="line">	--add-repo \</span><br><span class="line">	http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"># 3 安装docker</span><br><span class="line"> sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"></span><br><span class="line"># 安装docker compose </span><br><span class="line">curl -L https://get.daocloud.io/docker/compose/releases/download/1.19.0/docker-compose-`uname -s`-`uname -m` &gt; /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">chmod +x /usr/local/bin/docker-compose</span><br><span class="line"></span><br><span class="line">　　docker-compose version # 查看版本号，测试是否安装成功</span><br><span class="line">      你可以通过修改URL中的版本，可以自定义您的需要的版本。</span><br></pre></td></tr></table></figure></li>
<li><p>启动docker</p>
</li>
</ol>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment"># 1 启动  </span></span><br><span class="line">  sudo systemctl start docker</span><br><span class="line">  <span class="comment"># 2 参看版本</span></span><br><span class="line">  docker version</span><br><span class="line">  <span class="comment"># 成功以后会出现以下信息:</span></span><br><span class="line">Client: Docker Engine - Community</span><br><span class="line"> Version:           20.10.8</span><br><span class="line"> API version:       1.41</span><br><span class="line"> Go version:        go1.16.6</span><br><span class="line"> Git commit:        3967b7d</span><br><span class="line"> Built:             Fri Jul 30 19:55:49 2021</span><br><span class="line"> OS/Arch:           linux/amd64</span><br><span class="line"> Context:           default</span><br><span class="line"> Experimental:      <span class="literal">true</span></span><br><span class="line"></span><br><span class="line">Server: Docker Engine - Community</span><br><span class="line"> Engine:</span><br><span class="line">  Version:          20.10.8</span><br><span class="line">  API version:      1.41 (minimum version 1.12)</span><br><span class="line">  Go version:       go1.16.6</span><br><span class="line">  Git commit:       75249d8</span><br><span class="line">  Built:            Fri Jul 30 19:54:13 2021</span><br><span class="line">  OS/Arch:          linux/amd64</span><br><span class="line">  Experimental:     <span class="literal">false</span></span><br><span class="line"> containerd:</span><br><span class="line">  Version:          1.4.9</span><br><span class="line">  GitCommit:        e25210fe30a0a703442421b0f60afac609f950a3</span><br><span class="line"> runc:</span><br><span class="line">  Version:          1.0.1</span><br><span class="line">  GitCommit:        v1.0.1-0-g4144b63</span><br><span class="line"> docker-init:</span><br><span class="line">  Version:          0.19.0</span><br><span class="line">  GitCommit:        de40ad0</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>docker hello word </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker run hello-world</span><br></pre></td></tr></table></figure>



<h3 id="2-2-3-卸载dcoker"><a href="#2-2-3-卸载dcoker" class="headerlink" title="2.2.3 卸载dcoker"></a>2.2.3 卸载dcoker</h3><blockquote>
<p>分为两步，卸载docekr,删除文件 </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 1 卸载</span><br><span class="line">  sudo yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line"># 2删除文件</span><br><span class="line">  sudo rm -rf /var/lib/docker</span><br><span class="line">  sudo rm -rf /var/lib/containerd</span><br></pre></td></tr></table></figure>

<h3 id="2-2-4-配置腾讯云镜像加速"><a href="#2-2-4-配置腾讯云镜像加速" class="headerlink" title="2.2.4 配置腾讯云镜像加速"></a>2.2.4 配置腾讯云镜像加速</h3><h3 id="使用腾讯云-Docker-镜像源加速镜像下载"><a href="#使用腾讯云-Docker-镜像源加速镜像下载" class="headerlink" title="使用腾讯云 Docker 镜像源加速镜像下载"></a>使用腾讯云 Docker 镜像源加速镜像下载</h3><p>安装 Docker 软件后，如果未配置镜像加速源，直接拉取 DockerHub 中的镜像，通常下载速度会比较慢。<br>为此，我们推荐您使用腾讯云 Docker 镜像源加速镜像下载。</p>
<blockquote>
<p>适用于 Linux 操作系统实例：    </p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#1 找到配置文件</span><br><span class="line"> cd /etc/docker/daemon.json</span><br><span class="line">#2 vim编辑配置文件</span><br><span class="line"> vim /etc/docker/daemon.json</span><br><span class="line">#3 添加以下内容并保存</span><br><span class="line">    &#123;</span><br><span class="line">    &quot;registry-mirrors&quot;: [</span><br><span class="line">     &quot;https://mirror.ccs.tencentyun.com&quot;</span><br><span class="line">    ]</span><br><span class="line">    &#125;</span><br><span class="line">#4 重启docker生效</span><br><span class="line"> systemctl restart docker</span><br></pre></td></tr></table></figure>

<h2 id="3-docker是如何工作的？"><a href="#3-docker是如何工作的？" class="headerlink" title="3 docker是如何工作的？"></a>3 docker是如何工作的？</h2><h3 id="3-1运行docker-run-image发生什么"><a href="#3-1运行docker-run-image发生什么" class="headerlink" title="3.1运行docker run image发生什么"></a>3.1运行docker run image发生什么</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/ebcff54d9e066f086c0ccee88831f2cc.png"></p>
<h3 id="3-2-docker-底层原理"><a href="#3-2-docker-底层原理" class="headerlink" title="3.2 docker 底层原理"></a>3.2 docker 底层原理</h3><p>docker是一个client-server结构的系统，docker的守护进程运行在宿主机上，通过socket连接。</p>
<p>dockerserver 接收到dockerclient的指令，就好执行这个命令。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/dcf0532a3fdcab47c3f9e55610f72ecf.png"></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/f9fc6ab580adc10823714351cfba8864.png"></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/70165617fe4144021e8e40b7f79d3e82.png"></p>
<ul>
<li>docker比vm更少的抽象层，不需要guest os,省去了很多启动引导过程。</li>
</ul>
<h2 id="4-docker-命令"><a href="#4-docker-命令" class="headerlink" title="4 docker 命令"></a>4 docker 命令</h2><p>docker官网有所有的命令说明(<a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">Reference documentation | Docker Documentation</a>)， 菜鸟网也有中文版本的命令说明。命令详细用法在help和文档中都可以查到，这个不再赘述，主要给出常用命令，对docker能做什么以及怎么做有个概念。</p>
<h3 id="4-1基础命令"><a href="#4-1基础命令" class="headerlink" title="4.1基础命令"></a>4.1基础命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker command --help # 帮助命令</span><br><span class="line">docker info # 系统信息</span><br><span class="line">docker version # 版本信息</span><br></pre></td></tr></table></figure>

<h3 id="4-2-镜像命令"><a href="#4-2-镜像命令" class="headerlink" title="4.2 镜像命令"></a>4.2 镜像命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker images # 查看镜像</span><br><span class="line">docker search image # 搜索镜像</span><br><span class="line">decher pull image # 下载镜像</span><br><span class="line">docker rmi image # 删除镜像</span><br></pre></td></tr></table></figure>

<h3 id="4-3-容器命令"><a href="#4-3-容器命令" class="headerlink" title="4.3 容器命令"></a>4.3 容器命令</h3><blockquote>
<p>有了镜像才可以下载容器</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">docker run container # 启动容器</span><br><span class="line">exit # 停止运行并退出容器</span><br><span class="line">ctrl + p + q # 退出容器</span><br><span class="line">docker ps # 查看运行的容器</span><br><span class="line">docker rm container # 删除容器</span><br><span class="line">docker start container # 启动容器</span><br><span class="line">docker restart # 重启容器</span><br><span class="line">docker stop container # 停止容器运行</span><br><span class="line">docker kill container # 强制停止容器</span><br></pre></td></tr></table></figure>

<h3 id="4-4-其他常用命令"><a href="#4-4-其他常用命令" class="headerlink" title="4.4 其他常用命令"></a>4.4 其他常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker logs # 查看日志</span><br><span class="line">docker ps # 查看容器进程</span><br><span class="line">docker top # 查看容器内进程</span><br><span class="line">docker inspect # 查看镜像的元数据</span><br><span class="line">docker exec container_id # 进入在执行的容器打开新的终端</span><br><span class="line">docker attach container_id # 进入容器正在执行的终端</span><br><span class="line">docker ps container_id:path hostpath # 容器内复制文件到宿主机</span><br></pre></td></tr></table></figure>

<p>按照字母排序总结： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">attach    Attach to a running container  #当前shell下attach连接指定运行镜像</span><br><span class="line">build     Build an image from a Dockerfile  #通过Dockerfile定制镜像</span><br><span class="line">commit    Create a new image from a containers changes  #提交当前容器为新的镜像</span><br><span class="line">cp    Copy files/folders from a container to a HOSTDIR or to STDOUT  #从容器中拷贝指定文件或者目录到宿主机中</span><br><span class="line">create    Create a new container  #创建一个新的容器，同run 但不启动容器</span><br><span class="line">diff    Inspect changes on a containers filesystem  #查看docker容器变化</span><br><span class="line">events    Get real time events from the server#从docker服务获取容器实时事件</span><br><span class="line">exec    Run a command in a running container#在已存在的容器上运行命令</span><br><span class="line">export    Export a containers filesystem as a tar archive  #导出容器的内容流作为一个tar归档文件(对应import)</span><br><span class="line">history    Show the history of an image  #展示一个镜像形成历史</span><br><span class="line">images    List images  #列出系统当前镜像</span><br><span class="line">import    Import the contents from a tarball to create a filesystem image  #从tar包中的内容创建一个新的文件系统映像(对应export)</span><br><span class="line">info    Display system-wide information  #显示系统相关信息</span><br><span class="line">inspect    Return low-level information on a container or image  #查看容器详细信息</span><br><span class="line">kill    Kill a running container  #kill指定docker容器</span><br><span class="line">load    Load an image from a tar archive or STDIN  #从一个tar包中加载一个镜像(对应save)</span><br><span class="line">login    Register or log in to a Docker registry#注册或者登陆一个docker源服务器</span><br><span class="line">logout    Log out from a Docker registry  #从当前Docker registry退出</span><br><span class="line">logs    Fetch the logs of a container  #输出当前容器日志信息</span><br><span class="line">pause    Pause all processes within a container#暂停容器</span><br><span class="line">port    List port mappings or a specific mapping for the CONTAINER  #查看映射端口对应的容器内部源端口</span><br><span class="line">ps    List containers  #列出容器列表</span><br><span class="line">pull    Pull an image or a repository from a registry  #从docker镜像源服务器拉取指定镜像或者库镜像</span><br><span class="line">push    Push an image or a repository to a registry  #推送指定镜像或者库镜像至docker源服务器</span><br><span class="line">rename    Rename a container  #重命名容器</span><br><span class="line">restart    Restart a running container  #重启运行的容器</span><br><span class="line">rm    Remove one or more containers  #移除一个或者多个容器</span><br><span class="line">rmi    Remove one or more images  #移除一个或多个镜像(无容器使用该镜像才可以删除，否则需要删除相关容器才可以继续或者-f强制删除)</span><br><span class="line">run    Run a command in a new container  #创建一个新的容器并运行一个命令</span><br><span class="line">save    Save an image(s) to a tar archive#保存一个镜像为一个tar包(对应load)</span><br><span class="line">search    Search the Docker Hub for images  #在docker</span><br><span class="line">hub中搜索镜像</span><br><span class="line">start    Start one or more stopped containers#启动容器</span><br><span class="line">stats    Display a live stream of container(s) resource usage statistics  #统计容器使用资源</span><br><span class="line">stop    Stop a running container  #停止容器</span><br><span class="line">tag         Tag an image into a repository  #给源中镜像打标签</span><br><span class="line">top       Display the running processes of a container #查看容器中运行的进程信息</span><br><span class="line">unpause    Unpause all processes within a container  #取消暂停容器</span><br><span class="line">version    Show the Docker version information#查看容器版本号</span><br><span class="line">wait         Block until a container stops, then print its exit code  #截取容器停止时的退出状态值</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/39eb949eeb5bd5d4556599bb612867ef.png"></p>
<h2 id="5-docker实例操作"><a href="#5-docker实例操作" class="headerlink" title="5 docker实例操作"></a>5 docker实例操作</h2><h3 id="5-1-部署Nginx"><a href="#5-1-部署Nginx" class="headerlink" title="5.1 部署Nginx"></a>5.1 部署Nginx</h3><p><code>1 搜索nginx镜像 </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@VM-4-6-centos /]# docker search nginx</span><br><span class="line">NAME                              DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">nginx                             Official build of Nginx.                        15374     [OK]       </span><br><span class="line">jwilder/nginx-proxy               Automated Nginx reverse proxy for docker con…   2060                 [OK]</span><br><span class="line">richarvey/nginx-php-fpm           Container running Nginx + PHP-FPM capable of…   816                  [OK]</span><br><span class="line">jc21/nginx-proxy-manager          Docker container for managing Nginx proxy ho…   236   </span><br></pre></td></tr></table></figure>

<blockquote>
<p>docker hub可以看大更详细的镜像信息</p>
</blockquote>
<p><code>2 下载镜像</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos /]# docker pull nginx</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from library/nginx</span><br><span class="line">e1acddbe380c: Pull complete </span><br><span class="line">e21006f71c6f: Pull complete </span><br><span class="line">f3341cc17e58: Pull complete </span><br><span class="line">2a53fa598ee2: Pull complete </span><br><span class="line">12455f71a9b5: Pull complete </span><br><span class="line">b86f2ba62d17: Pull complete </span><br><span class="line">Digest: sha256:4d4d96ac750af48c6a551d757c1cbfc071692309b491b70b2b8976e102dd3fef</span><br><span class="line">Status: Downloaded newer image for nginx:latest</span><br><span class="line">docker.io/library/nginx:latest </span><br><span class="line"># 下载成功</span><br></pre></td></tr></table></figure>

<p><code>3 查看镜像</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker images </span><br><span class="line">REPOSITORY    TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">nginx         latest    dd34e67e3371   10 days ago    133MB</span><br></pre></td></tr></table></figure>

<p><code>4  运行容器</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker run -d --name nginx001 -p 80:80 nginx</span><br><span class="line">44c86d145d151622d0e7512050c4fead714047be0256c7f6af098ec0452ba428</span><br></pre></td></tr></table></figure>

<p><code>5 查看容器</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE     COMMAND                  CREATED          STATUS          PORTS                               NAMES</span><br><span class="line">44c86d145d15   nginx     &quot;/docker-entrypoint.…&quot;   35 minutes ago   Up 35 minutes   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp   nginx001</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>6 测试</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker exec -it nginx001 /bin/bash</span><br><span class="line">root@44c86d145d15:/# ls</span><br><span class="line">bin   dev                  docker-entrypoint.sh  home  lib64  mnt  proc  run   srv  tmp  var</span><br><span class="line">boot  docker-entrypoint.d  etc                   lib   media  opt  root  sbin  sys  usr</span><br></pre></td></tr></table></figure>

<p>外网访问：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/97843e56232d1d4cfb59d6ba53a48d01.png"></p>
<p><code>7关闭容器</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker stop nginx001</span><br><span class="line">nginx001</span><br></pre></td></tr></table></figure>



<h3 id="5-2-部署tomcat"><a href="#5-2-部署tomcat" class="headerlink" title="5.2 部署tomcat"></a>5.2 部署tomcat</h3><p><code>1 搜索nginx镜像 </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker search tomcat </span><br><span class="line">NAME                          DESCRIPTION                                     STARS     OFFICIAL   AUTOMATED</span><br><span class="line">tomcat                        Apache Tomcat is an open source implementati…   3106      [OK]       </span><br><span class="line">tomee                         Apache TomEE is an all-Apache Java EE certif…   92        [OK]       </span><br><span class="line">dordoka/tomcat                Ubuntu 14.04, Oracle JDK 8 and Tomcat 8 base…   58                   [OK]</span><br><span class="line">kubeguide/tomcat-app          Tomcat image for Chapter 1                      30                   </span><br><span class="line">consol/tomcat-7.0             Tomcat 7.0.57, 8080, &quot;admin/admin&quot;              18                   [OK]</span><br><span class="line">cloudesire/tomcat             Tomcat server, 6/7/8                            15                   [OK]</span><br><span class="line">aallam/tomcat-mysql           Debian, Oracle JDK, Tomcat &amp; MySQL              13                   [OK]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>docker hub可以看大更详细的镜像信息</p>
</blockquote>
<p><code>2 下载镜像</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker pull tomcat Using default tag: latestlatest: Pulling from library/tomcat1cfaf5c6f756: Pull complete c4099a935a96: Pull complete f6e2960d8365: Pull complete dffd4e638592: Pull complete a60431b16af7: Pull complete 4869c4e8de8d: Pull complete 9815a275e5d0: Pull complete c36aa3d16702: Pull complete cc2e74b6c3db: Pull complete 1827dd5c8bb0: Pull complete Digest: sha256:1af502b6fd35c1d4ab6f24dc9bd36b58678a068ff1206c25acc129fb90b2a76aStatus: Downloaded newer image for tomcat:latestdocker.io/library/tomcat:latest# 下载成功</span><br></pre></td></tr></table></figure>

<p><code>3 查看镜像</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker imagesREPOSITORY    TAG       IMAGE ID       CREATED        SIZEtomcat        latest    266d1269bb29   9 days ago     668MBnginx         latest    dd34e67e3371   10 days ago    133MB</span><br></pre></td></tr></table></figure>

<p><code>4  运行容器</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker run -d --name tomcat001 -p 80:8080 tomcat4400a14a931baa9fbc324d003ce26e06debba3456435b233ed5b77eccf7b4379</span><br></pre></td></tr></table></figure>

<p><code>5 查看容器</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker psCONTAINER ID   IMAGE     COMMAND             CREATED          STATUS          PORTS                                         NAMES4400a14a931b   tomcat    &quot;catalina.sh run&quot;   25 seconds ago   Up 25 seconds   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp, 8080/tcp   tomcat001</span><br></pre></td></tr></table></figure>

<p><code>6 测试</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker exec -it tomcat001 /bin/bashroot@4400a14a931b:/usr/local/tomcat# lsBUILDING.txt     LICENSE  README.md      RUNNING.txt  conf  logs            temp     webapps.distCONTRIBUTING.md  NOTICE   RELEASE-NOTES  bin          lib   native-jni-lib  webapps  workroot@4400a14a931b:/usr/local/tomcat# cp -r  webapps.dist/*  webapps</span><br></pre></td></tr></table></figure>

<p>外网访问：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/82aabf75dda02775eef5b166dd6f0e4f.png"></p>
<p>7关闭容器`</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker stop tomcat001tomcat001</span><br></pre></td></tr></table></figure>

<p>经过实例的练习之后，前面学的命令熟练了许多。</p>
<h2 id="6-图形交互面板"><a href="#6-图形交互面板" class="headerlink" title="6 图形交互面板"></a>6 图形交互面板</h2><h3 id="6-1portainer"><a href="#6-1portainer" class="headerlink" title="6.1portainer"></a>6.1portainer</h3><ol>
<li>portainer是什么？</li>
</ol>
<p>Portainer是一个可视化的容器镜像的图形管理工具，利用Portainer可以轻松构建，管理和维护Docker环境。 而且完全免费，基于容器化的安装方式，方便高效部署。</p>
<ol start="2">
<li><p>安装 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 1. 下载镜像</span><br><span class="line">docker pull portainer/portainer</span><br><span class="line"># 2. 启动服务</span><br><span class="line">docker run -d --name portainerUI -p 80:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</span><br></pre></td></tr></table></figure>

<p>示例： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker pull portainer/portainer</span><br><span class="line">Using default tag: latest</span><br><span class="line">latest: Pulling from portainer/portainer</span><br><span class="line">94cfa856b2b1: Pull complete </span><br><span class="line">49d59ee0881a: Pull complete </span><br><span class="line">a2300fd28637: Pull complete </span><br><span class="line">Digest: sha256:fb45b43738646048a0a0cc74fcee2865b69efde857e710126084ee5de9be0f3f</span><br><span class="line">Status: Downloaded newer image for portainer/portainer:latest</span><br><span class="line">docker.io/portainer/portainer:latest</span><br><span class="line">[root@VM-4-6-centos lighthouse]# docker run -d --name portainerUI -p 80:9000 -v /var/run/docker.sock:/var/run/docker.sock portainer/portainer</span><br><span class="line">b9be7097fe79eecbff8f201103c641692684cad7726a5103dbc33a68bfff8e71</span><br></pre></td></tr></table></figure></li>
<li><p>使用 </p>
<p>使用服务器ip:端口，即可打开</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/1f56411b989346c08a2c9e290be195a5.png"></p>
</li>
</ol>
<p><img src="https://img-blog.csdnimg.cn/img_convert/726c21817579deb8ec8074da769e8640.png"></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/58e4f7f86f810e15d8c18893f525b3be.png"></p>
<h2 id="7-docker镜像加载原理"><a href="#7-docker镜像加载原理" class="headerlink" title="7 docker镜像加载原理"></a>7 docker镜像加载原理</h2><h3 id="7-1联合文件系统-Union-Filesystem"><a href="#7-1联合文件系统-Union-Filesystem" class="headerlink" title="7.1联合文件系统(Union Filesystem)"></a>7.1联合文件系统(Union Filesystem)</h3><p>联合文件系统是一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修改作为一次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下。<br>联合文件系统是 Docker 镜像的基础。镜像可以通过分层来进行继承，基于基础镜像（没有父镜像），可以制作各种具体的应用镜像。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/d17c361c9fc9b847164489e6ad28cdef.png"></p>
<p>特性：一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文件系统会包含所有底层的文件和目录。</p>
<h3 id="7-2-docker-镜像加载"><a href="#7-2-docker-镜像加载" class="headerlink" title="7.2 docker 镜像加载"></a>7.2 docker 镜像加载</h3><p>docker的镜像实际上由一层一层的文件系统组成，这种层级的文件系统UnionFS。<br>boots(boot file system）主要包含 bootloader和 Kernel, bootloader主要是引导加 kernel, Linux刚启动时会加bootfs文件系统，在 Docker镜像的最底层是 boots。这一层与我们典型的Linux/Unix系统是一样的，包含boot加載器和内核。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权已由 bootfs转交给内核，此时系统也会卸载bootfs。<br>rootfs（root file system),在 bootfs之上。包含的就是典型 Linux系统中的/dev,/proc,/bin,/etc等标准目录和文件。 rootfs就是各种不同的操作系统发行版，比如 Ubuntu, Centos等等。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/dc540ea7f18314b12ec4fd0b71a83f55.png"></p>
<p>对于个精简的OS,rootfs可以很小，只需要包合最基本的命令，工具和程序库就可以了，因为底层直接用Host的kernel，自己只需要提供rootfs就可以了。由此可见对于不同的Linux发行版， boots基本是一致的， rootfs会有差別，因此不同的发行版可以公用bootfs.</p>
<p>虚拟机是分钟级别，容器是秒级！</p>
<h3 id="7-3-分层"><a href="#7-3-分层" class="headerlink" title="7.3 分层"></a>7.3 分层</h3><p>当我们去观察镜像的下载的输出日志，是在一层一层下载。这中分层最大的好处就是资源共享。比如有多个镜像都从相同的Base镜像构建而来，那么宿主机只需在磁盘上保留一份base镜像，同时内存中也只需要加载一份base镜像，这样就可以为所有的容器服务了，而且镜像的每一层都可以被共享。</p>
<p>查看镜像分层的方式可以通过<code>docker image inspect</code> 命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lighthouse]# docker image inspect tomcat</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;Id&quot;: &quot;sha256:266d1269bb298d6a3259fc2c2a9deaedf8be945482a2d596b64f73343289a56c&quot;,</span><br><span class="line">        &quot;RepoTags&quot;: [</span><br><span class="line">            &quot;tomcat:latest&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;RepoDigests&quot;: [</span><br><span class="line">            &quot;tomcat@sha256:1af502b6fd35c1d4ab6f24dc9bd36b58678a068ff1206c25acc129fb90b2a76a&quot;</span><br><span class="line">        ],</span><br><span class="line">        &quot;Parent&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Comment&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Created&quot;: &quot;2021-08-18T20:48:04.549796116Z&quot;,</span><br><span class="line">        &quot;Container&quot;: &quot;d2ecb6a64fdc3e7fef05d7909154d295574519fa144d8507cf7c9a5a6c5ea8b3&quot;,</span><br><span class="line">        &quot;ContainerConfig&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;d2ecb6a64fdc&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;8080/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/tomcat/bin:/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;JAVA_HOME=/usr/local/openjdk-11&quot;,</span><br><span class="line">                &quot;LANG=C.UTF-8&quot;,</span><br><span class="line">                &quot;JAVA_VERSION=11.0.12&quot;,</span><br><span class="line">                &quot;CATALINA_HOME=/usr/local/tomcat&quot;,</span><br><span class="line">                &quot;TOMCAT_NATIVE_LIBDIR=/usr/local/tomcat/native-jni-lib&quot;,</span><br><span class="line">                &quot;LD_LIBRARY_PATH=/usr/local/tomcat/native-jni-lib&quot;,</span><br><span class="line">                &quot;GPG_KEYS=48F8E69F6390C9F25CFEDCD268248959359E722B A9C5DF4D22E99998D9875A5110C01C5A2F6059E7 DCFD35E0BF8CA7344752DE8B6FB21E8933C60243&quot;,</span><br><span class="line">                &quot;TOMCAT_MAJOR=9&quot;,</span><br><span class="line">                &quot;TOMCAT_VERSION=9.0.52&quot;,</span><br><span class="line">                &quot;TOMCAT_SHA512=35e007e8e30e12889da27f9c71a6f4997b9cb5023b703d99add5de9271828e7d8d4956bf34dd2f48c7c71b4f8480f318c9067a4cd2a6d76eaae466286db4897b&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;/bin/sh&quot;,</span><br><span class="line">                &quot;-c&quot;,</span><br><span class="line">                &quot;#(nop) &quot;,</span><br><span class="line">                &quot;CMD [\&quot;catalina.sh\&quot; \&quot;run\&quot;]&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:5196276371ce4bad78ffcbb6032a04d381437b0719075d11ae1c24f496303f32&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;/usr/local/tomcat&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;DockerVersion&quot;: &quot;20.10.7&quot;,</span><br><span class="line">        &quot;Author&quot;: &quot;&quot;,</span><br><span class="line">        &quot;Config&quot;: &#123;</span><br><span class="line">            &quot;Hostname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;Domainname&quot;: &quot;&quot;,</span><br><span class="line">            &quot;User&quot;: &quot;&quot;,</span><br><span class="line">            &quot;AttachStdin&quot;: false,</span><br><span class="line">            &quot;AttachStdout&quot;: false,</span><br><span class="line">            &quot;AttachStderr&quot;: false,</span><br><span class="line">            &quot;ExposedPorts&quot;: &#123;</span><br><span class="line">                &quot;8080/tcp&quot;: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Tty&quot;: false,</span><br><span class="line">            &quot;OpenStdin&quot;: false,</span><br><span class="line">            &quot;StdinOnce&quot;: false,</span><br><span class="line">            &quot;Env&quot;: [</span><br><span class="line">                &quot;PATH=/usr/local/tomcat/bin:/usr/local/openjdk-11/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin&quot;,</span><br><span class="line">                &quot;JAVA_HOME=/usr/local/openjdk-11&quot;,</span><br><span class="line">                &quot;LANG=C.UTF-8&quot;,</span><br><span class="line">                &quot;JAVA_VERSION=11.0.12&quot;,</span><br><span class="line">                &quot;CATALINA_HOME=/usr/local/tomcat&quot;,</span><br><span class="line">                &quot;TOMCAT_NATIVE_LIBDIR=/usr/local/tomcat/native-jni-lib&quot;,</span><br><span class="line">                &quot;LD_LIBRARY_PATH=/usr/local/tomcat/native-jni-lib&quot;,</span><br><span class="line">                &quot;GPG_KEYS=48F8E69F6390C9F25CFEDCD268248959359E722B A9C5DF4D22E99998D9875A5110C01C5A2F6059E7 DCFD35E0BF8CA7344752DE8B6FB21E8933C60243&quot;,</span><br><span class="line">                &quot;TOMCAT_MAJOR=9&quot;,</span><br><span class="line">                &quot;TOMCAT_VERSION=9.0.52&quot;,</span><br><span class="line">                &quot;TOMCAT_SHA512=35e007e8e30e12889da27f9c71a6f4997b9cb5023b703d99add5de9271828e7d8d4956bf34dd2f48c7c71b4f8480f318c9067a4cd2a6d76eaae466286db4897b&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Cmd&quot;: [</span><br><span class="line">                &quot;catalina.sh&quot;,</span><br><span class="line">                &quot;run&quot;</span><br><span class="line">            ],</span><br><span class="line">            &quot;Image&quot;: &quot;sha256:5196276371ce4bad78ffcbb6032a04d381437b0719075d11ae1c24f496303f32&quot;,</span><br><span class="line">            &quot;Volumes&quot;: null,</span><br><span class="line">            &quot;WorkingDir&quot;: &quot;/usr/local/tomcat&quot;,</span><br><span class="line">            &quot;Entrypoint&quot;: null,</span><br><span class="line">            &quot;OnBuild&quot;: null,</span><br><span class="line">            &quot;Labels&quot;: null</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Architecture&quot;: &quot;amd64&quot;,</span><br><span class="line">        &quot;Os&quot;: &quot;linux&quot;,</span><br><span class="line">        &quot;Size&quot;: 667866261,</span><br><span class="line">        &quot;VirtualSize&quot;: 667866261,</span><br><span class="line">        &quot;GraphDriver&quot;: &#123;</span><br><span class="line">            &quot;Data&quot;: &#123;</span><br><span class="line">                &quot;LowerDir&quot;: &quot;/var/lib/docker/overlay2/14d6effb2d8347a8f2140b8eb6bb914ffe5209cc9ed880c55657cb8e6c30f0b4/diff:/var/lib/docker/overlay2/304d8484e5dd5fd4386fd5fefcd8e32ef38743801a7bf3ba513fb3ff8f38ad89/diff:/var/lib/docker/overlay2/bd7bfc9ebc87f6f5c11e110877e54b7e2180aac478637a207b105b4b319e925e/diff:/var/lib/docker/overlay2/00ca651a87602d2e11175f932c6f32fd7b43ae98159416ad908fa050b47b3fed/diff:/var/lib/docker/overlay2/aa5cce0f487b2a05c13bb8929a2411314690d2b4d305cd3e1bc171cb1b173089/diff:/var/lib/docker/overlay2/3815d6dbfabe611f9dc4ffac4690fb4c72870794c7ea9d2e930487d0eaa6d5f4/diff:/var/lib/docker/overlay2/f14c65162848b2a6061d043343db3ccff14c64bf99d6fe3bb947331fc7882778/diff:/var/lib/docker/overlay2/7acfe353937d2289e2cbf8b63e938e579b5a5d952cefe0973125b38555c04416/diff:/var/lib/docker/overlay2/67693c8b74406bd5c6603fe38ce5e5ac9380eca61504103ae70e35c5703d8d57/diff&quot;,</span><br><span class="line">                &quot;MergedDir&quot;: &quot;/var/lib/docker/overlay2/517208d37dec0c6abf702063df2aec59802520e1e5ef5b6bcefce7a6f3a379aa/merged&quot;,</span><br><span class="line">                &quot;UpperDir&quot;: &quot;/var/lib/docker/overlay2/517208d37dec0c6abf702063df2aec59802520e1e5ef5b6bcefce7a6f3a379aa/diff&quot;,</span><br><span class="line">                &quot;WorkDir&quot;: &quot;/var/lib/docker/overlay2/517208d37dec0c6abf702063df2aec59802520e1e5ef5b6bcefce7a6f3a379aa/work&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &quot;Name&quot;: &quot;overlay2&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;RootFS&quot;: &#123;</span><br><span class="line">            &quot;Type&quot;: &quot;layers&quot;,</span><br><span class="line">            &quot;Layers&quot;: [</span><br><span class="line">                &quot;sha256:c2ddc1bc2645ab5d982c60434d8bbc6aecee1bd4e8eee0df7fd08c96df2d58bb&quot;,</span><br><span class="line">                &quot;sha256:62d14713f2e98841ec3927e3ab611b13e414a21fb82fc0e604a9008ac53e45dc&quot;,</span><br><span class="line">                &quot;sha256:1235daf38153d083ae5b4f605acc54f9401143b5fbd033801ba373a8cfb04845&quot;,</span><br><span class="line">                &quot;sha256:7d890913ab6955350bdd25d04c60dd444db13890c401cbcdc8e00e9bd29c90fc&quot;,</span><br><span class="line">                &quot;sha256:c2e2307780ac2fa0d39cec874c4545156da890c1bcc42b3259114ac29bb598f1&quot;,</span><br><span class="line">                &quot;sha256:75f6a0e6e441cd3d74125443fc73eb26bf9ceb557b269b25bddaa2ef459227f7&quot;,</span><br><span class="line">                &quot;sha256:b19f17003e5ae07f7aba99f95736627aaa1ff3c92832f7d6920158dc6b138bcf&quot;,</span><br><span class="line">                &quot;sha256:2dad09b8a57e12408adc0366cbd2a642eaab1c82bbfb2b442245928b60d337f1&quot;,</span><br><span class="line">                &quot;sha256:83a14c3e974e700768197a3061f840618a924d3154fcb338a85b6da5fd4eb886&quot;,</span><br><span class="line">                &quot;sha256:19f8bd134bcf7c5870f8294b1d3bba4c970d0b622772865e44d200d248ed2676&quot;</span><br><span class="line">            ]</span><br><span class="line">        &#125;,</span><br><span class="line">        &quot;Metadata&quot;: &#123;</span><br><span class="line">            &quot;LastTagTime&quot;: &quot;0001-01-01T00:00:00Z&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>理解：</p>
</blockquote>
<p>所有的 Docker镜像都起始于一个基础镜像层，当进行修改或培加新的内容时，就会在当前镜像层之上，创建新的镜像层。举一个简单的例子，假如基于 Ubuntu Linux16.04创建一个新的镜像，这就是新镜像的第一层；如果在该镜像中添加 Python包，就会在基础镜像层之上创建第二个镜像层；如果继续添加一个安全补丁，就会创健第三个镜像层该像当前已经包含3个镜像层，如下图所示,在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/10a1a3a8998077f4e4f6c3497c6c513e.png"></p>
<p>在添加额外的镜像层的同时，镜像始终保持是当前所有镜像的组合，理解这一点非常重要。下图中举了一个简单的例子，每个镜像层包含3个文件，而镜像包含了来自两个镜像层的6个文件。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/7d14f1ac3365d88d607298f5167d0ac3.png"></p>
<p>上图中的镜像层跟之前图中的略有区別，主要目的是便于展示文件<br>下图中展示了一个稍微复杂的三层镜像，在外部看来整个镜像只有6个文件，这是因为最上层中的文件7是文件5的一个更新版。</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/7ce12a7eee33d7c7ca8080acabc20302.png"></p>
<p>文种情況下，上层镜像层中的文件覆盖了底层镜像层中的文件。这样就使得文件的更新版本作为一个新镜像层添加到镜像当中</p>
<p>Docker通过存储引擎（新版本采用快照机制）的方式来实现镜像层堆栈，并保证多镜像层对外展示为统一的文件系统</p>
<p>Linux上可用的存储引撃有AUFS、 Overlay2、 Device Mapper、Btrfs以及ZFS。顾名思义，每种存储引擎都基于 Linux中对应的件系统或者块设备技术，井且每种存储引擎都有其独有的性能特点。</p>
<p>Docker在 Windows上仅支持 windowsfilter 一种存储引擎，该引擎基于NTFS文件系统之上实现了分层和CoW [1]。</p>
<p>下图展示了与系统显示相同的三层镜像。所有镜像层堆并合井，对外提供统一的视图。<br><img src="https://img-blog.csdnimg.cn/img_convert/10a1332519d3223be103297272a0978f.png"></p>
<blockquote>
<p>特点</p>
</blockquote>
<p>Docker 镜像都是只读的，当容器启动时，一个新的可写层加载到镜像的顶部！</p>
<p>这一层就是我们通常说的容器层，容器之下的都叫镜像层！</p>
<h2 id="第八讲-docker容器数据卷"><a href="#第八讲-docker容器数据卷" class="headerlink" title="第八讲 docker容器数据卷"></a>第八讲 docker容器数据卷</h2><h3 id="8-1-容器数据卷是什么"><a href="#8-1-容器数据卷是什么" class="headerlink" title="8.1 容器数据卷是什么"></a>8.1 容器数据卷是什么</h3><p>当我们在使用docker容器的时候，会产生一系列的数据文件，这些数据文件在我们关闭docker容器时是会消失的，但是其中产生的部分内容我们是希望能够把它给保存起来另作用途的，Docker将应用与运行环境打包成容器发布，我们希望在运行过程钟产生的部分数据是可以持久化的的，而且容器之间我们希望能够实现数据共享。容器数据卷可以帮助我们实现这个需求。docker容器数据卷可以看成使我们生活中常用的u盘，它存在于一个或多个的容器中，由docker挂载到容器，但不属于联合文件系统，Docker不会在容器删除时删除其挂载的数据卷。</p>
<blockquote>
<p>特点：</p>
</blockquote>
<p>1：数据卷可以在容器之间共享或重用数据</p>
<p>2：数据卷中的更改可以直接生效</p>
<p>3：数据卷中的更改不会包含在镜像的更新中</p>
<p>4：数据卷的生命周期一直持续到没有容器使用它为止</p>
<h3 id="8-2-如何添加容器数据卷"><a href="#8-2-如何添加容器数据卷" class="headerlink" title="8.2 如何添加容器数据卷"></a>8.2 如何添加容器数据卷</h3><h4 id="8-2-1-通过命令挂载"><a href="#8-2-1-通过命令挂载" class="headerlink" title="8.2.1 通过命令挂载"></a>8.2.1 通过命令挂载</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 1 通过docker run -v 挂载 </span><br><span class="line">[root@VM-4-6-centos lighthouse]# docker run -it -v /home/test:/home centos </span><br><span class="line">[root@672f22246a83 /]# [root@VM-4-6-centos lighthouse]# </span><br><span class="line">[root@VM-4-6-centos lighthouse]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE     COMMAND       CREATED          STATUS          PORTS     NAMES</span><br><span class="line">672f22246a83   centos    &quot;/bin/bash&quot;   22 seconds ago   Up 22 seconds             # 2 通过</span><br><span class="line"># 2 docker inspect containerID 查看挂载是否成功</span><br><span class="line">[root@VM-4-6-centos lighthouse]# docker inspect 672f22246a83</span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/home/test&quot;,  </span><br><span class="line">                &quot;Destination&quot;: &quot;/home&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line"># 3手动查看挂载是否成功，能否同步文件</span><br><span class="line">[root@VM-4-6-centos lighthouse]# cd /home/test </span><br><span class="line"># 新建测试文件mounttest.tet</span><br><span class="line">[root@VM-4-6-centos test]# touch mounttest.tet </span><br><span class="line">[root@VM-4-6-centos test]# ls</span><br><span class="line">mounttest.tet</span><br><span class="line">[root@VM-4-6-centos test]# docker exec -it 672f22246a83 /bin/bash </span><br><span class="line">[root@672f22246a83 /]# cd /home </span><br><span class="line"># 查看容器对应文件是否同步</span><br><span class="line">[root@672f22246a83 home]# ls</span><br><span class="line">mounttest.tet</span><br><span class="line"># 生成反向同步测试文件</span><br><span class="line">[root@672f22246a83 home]# touch mounttest111.tet </span><br><span class="line">[root@672f22246a83 home]# read escape sequence</span><br><span class="line">[root@VM-4-6-centos test]# ls </span><br><span class="line">mounttest111.tet  mounttest.tet</span><br><span class="line"># 双向同步 </span><br></pre></td></tr></table></figure>

<blockquote>
<p>案例： 部署mysql容器数据卷</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># 启动mysql容器并挂载文件</span><br><span class="line">[root@VM-4-6-centos ~]# docker images </span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED        SIZE</span><br><span class="line">tomcat                latest    266d1269bb29   2 weeks ago    668MB</span><br><span class="line">nginx                 latest    dd34e67e3371   2 weeks ago    133MB</span><br><span class="line">mysql                 latest    5a4e492065c7   2 weeks ago    514MB</span><br><span class="line">centos                latest    300e315adb2f   8 months ago   209MB</span><br><span class="line"></span><br><span class="line">[root@VM-4-6-centos ~]# docker run -d -p 1433:3306 -v /home/mysql/conf:/etc/mysql/conf.d </span><br><span class="line">-v /home/mysql/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 --name mysql001 mysql:latest</span><br><span class="line">8988e75401bcbbc73d018ae14c8fce9f53ae3e9e4f15058436f839039dd9cdcf</span><br><span class="line"></span><br><span class="line">[root@VM-4-6-centos ~]# docker ps </span><br><span class="line">CONTAINER ID   IMAGE          COMMAND                  CREATED          STATUS          PORTS                                              NAMES</span><br><span class="line">8988e75401bc   mysql:latest   &quot;docker-entrypoint.s…&quot;   12 seconds ago   Up 11 seconds   33060/tcp, 0.0.0.0:80-&gt;3306/tcp, :::80-&gt;3306/tcp   mysql001</span><br><span class="line">672f22246a83   centos         &quot;/bin/bash&quot;              6 hours ago      Up 6 hours                                                         interesting_tu</span><br><span class="line"></span><br><span class="line">[root@VM-4-6-centos ~]# docker inspect mysql001</span><br><span class="line"></span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/home/mysql/data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/var/lib/mysql&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;bind&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/home/mysql/conf&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;/etc/mysql/conf.d&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;rprivate&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>具名挂载和匿名挂载 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"># 匿名挂载</span><br><span class="line">-v 容器内路径!</span><br><span class="line">$ docker run -d -P --name nginx01 -v /etc/nginx nginx</span><br><span class="line"></span><br><span class="line"># 查看所有的volume(卷)的情况</span><br><span class="line">$ docker volume ls    </span><br><span class="line">DRIVER              VOLUME NAME # 容器内的卷名(匿名卷挂载)</span><br><span class="line">local               21159a8518abd468728cdbe8594a75b204a10c26be6c36090cde1ee88965f0d0</span><br><span class="line">local               b17f52d38f528893dd5720899f555caf22b31bf50b0680e7c6d5431dbda2802c</span><br><span class="line">         </span><br><span class="line"># 这里发现，这种就是匿名挂载，我们在 -v只写了容器内的路径，没有写容器外的路径！</span><br><span class="line"></span><br><span class="line"># 具名挂载 -P:表示随机映射端口</span><br><span class="line">$ docker run -d -P --name nginx02 -v juming-nginx:/etc/nginx nginx</span><br><span class="line">9663cfcb1e5a9a1548867481bfddab9fd7824a6dc4c778bf438a040fe891f0ee</span><br><span class="line"></span><br><span class="line"># 查看所有的volume(卷)的情况</span><br><span class="line">$ docker volume ls                  </span><br><span class="line">DRIVER              VOLUME NAME</span><br><span class="line">local               21159a8518abd468728cdbe8594a75b204a10c26be6c36090cde1ee88965f0d0</span><br><span class="line">local               b17f52d38f528893dd5720899f555caf22b31bf50b0680e7c6d5431dbda2802c</span><br><span class="line">local               juming-nginx #多了一个名字</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 通过 -v 卷名：查看容器内路径</span><br><span class="line"># 查看一下这个卷</span><br><span class="line">$ docker volume inspect juming-nginx</span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">        &quot;CreatedAt&quot;: &quot;2020-05-23T13:55:34+08:00&quot;,</span><br><span class="line">        &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">        &quot;Labels&quot;: null,</span><br><span class="line">        &quot;Mountpoint&quot;: &quot;/var/lib/docker/volumes/juming-nginx/_data&quot;, #默认目录</span><br><span class="line">        &quot;Name&quot;: &quot;juming-nginx&quot;,</span><br><span class="line">        &quot;Options&quot;: null,</span><br><span class="line">        &quot;Scope&quot;: &quot;local&quot;</span><br><span class="line">    &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>所有的docker容器内的卷，没有指定目录的情况下都是在**/var/lib/docker/volumes/自定义的卷名/_data**下，<br><strong>如果指定了目录，docker volume ls 是查看不到的</strong>。</p>
<p><strong>区分三种挂载方式</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 三种挂载： 匿名挂载、具名挂载、指定路径挂载</span><br><span class="line">-v 容器内路径			#匿名挂载</span><br><span class="line">-v 卷名：容器内路径		  #具名挂载</span><br><span class="line">-v /宿主机路径：容器内路径 #指定路径挂载 docker volume ls 是查看不到的</span><br></pre></td></tr></table></figure>

<p>拓展：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 通过 -v 容器内路径： ro rw 改变读写权限</span><br><span class="line">ro #readonly 只读</span><br><span class="line">rw #readwrite 可读可写</span><br><span class="line">$ docker run -d -P --name nginx05 -v juming:/etc/nginx:ro nginx</span><br><span class="line">$ docker run -d -P --name nginx05 -v juming:/etc/nginx:rw nginx</span><br><span class="line"># ro 只要看到ro就说明这个路径只能通过宿主机来操作，容器内部是无法操作！</span><br></pre></td></tr></table></figure>

<h3 id="8-3-通过dockerfile挂载"><a href="#8-3-通过dockerfile挂载" class="headerlink" title="8.3 通过dockerfile挂载"></a>8.3 通过dockerfile挂载</h3><p>dockerfile就是是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># 创建一个dockerfile文件，名字可以随便建议Dockerfile</span><br><span class="line"># 文件中的内容： 指令(大写) + 参数</span><br><span class="line">$ vim dockerfile1</span><br><span class="line">    FROM centos 					# 当前这个镜像是以centos为基础的</span><br><span class="line"></span><br><span class="line">    VOLUME [&quot;volume01&quot;,&quot;volume02&quot;] 	# 挂载卷的卷目录列表(多个目录)</span><br><span class="line"></span><br><span class="line">    CMD echo &quot;-----end-----&quot;		# 输出一下用于测试</span><br><span class="line">    CMD /bin/bash					# 默认走bash控制台</span><br><span class="line"></span><br><span class="line"># 这里的每个命令，就是镜像的一层！</span><br><span class="line"># 构建出这个镜像 </span><br><span class="line">-f dockerfile1 			# f代表file，指这个当前文件的地址(这里是当前目录下的dockerfile1)</span><br><span class="line">-t caoshipeng/centos 	# t就代表target，指目标目录(注意caoshipeng镜像名前不能加斜杠‘/’)</span><br><span class="line">. 						# 表示生成在当前目录下</span><br><span class="line">$ docker build -f dockerfile1 -t caoshipeng/centos .</span><br><span class="line">Sending build context to Docker daemon   2.56kB</span><br><span class="line">Step 1/4 : FROM centos</span><br><span class="line">latest: Pulling from library/centos</span><br><span class="line">8a29a15cefae: Already exists </span><br><span class="line">Digest: sha256:fe8d824220415eed5477b63addf40fb06c3b049404242b31982106ac204f6700</span><br><span class="line">Status: Downloaded newer image for centos:latest</span><br><span class="line"> ---&gt; 470671670cac</span><br><span class="line">Step 2/4 : VOLUME [&quot;volume01&quot;,&quot;volume02&quot;] 			# 卷名列表</span><br><span class="line"> ---&gt; Running in c18eefc2c233</span><br><span class="line">Removing intermediate container c18eefc2c233</span><br><span class="line"> ---&gt; 623ae1d40fb8</span><br><span class="line">Step 3/4 : CMD echo &quot;-----end-----&quot;					# 输出 脚本命令</span><br><span class="line"> ---&gt; Running in 70e403669f3c</span><br><span class="line">Removing intermediate container 70e403669f3c</span><br><span class="line"> ---&gt; 0eba1989c4e6</span><br><span class="line">Step 4/4 : CMD /bin/bash</span><br><span class="line"> ---&gt; Running in 4342feb3a05b</span><br><span class="line">Removing intermediate container 4342feb3a05b</span><br><span class="line"> ---&gt; f4a6b0d4d948</span><br><span class="line">Successfully built f4a6b0d4d948</span><br><span class="line">Successfully tagged caoshipeng/centos:latest</span><br><span class="line"></span><br><span class="line"># 查看自己构建的镜像</span><br><span class="line">$ docker images</span><br><span class="line">REPOSITORY          TAG          IMAGE ID            CREATED              SIZE</span><br><span class="line">caoshipeng/centos   latest       f4a6b0d4d948        About a minute ago   237MB</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>启动新建的镜像 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos lib]#docker run -it new/centos /bin/bash</span><br><span class="line">#</span><br><span class="line">[root@VM-4-6-centos lib]# docker ps</span><br><span class="line">CONTAINER ID   IMAGE        COMMAND                  CREATED         STATUS         PORTS                 NAMES</span><br><span class="line">d0da4c77e1a9   new/centos   &quot;/bin/bash&quot;              5 minutes ago   Up 5 minutes                         priceless_hawking</span><br><span class="line"></span><br><span class="line"># 查看挂载</span><br><span class="line">[root@VM-4-6-centos lib]# docker inspect d0da4c77e1a9</span><br><span class="line">&quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;575269012a409d421b59c45cc5591a7ac7b44d4fa5cbf80a196817c589ea3848&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/575269012a409d421b59c45cc5591a7ac7b44d4fa5cbf80a196817c589ea3848/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;colume2&quot;,#  挂载成功</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;099c9f4fe900e5550ca4ad2aff381b09e969c158ca62591b1817d9a8b26d1967&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/099c9f4fe900e5550ca4ad2aff381b09e969c158ca62591b1817d9a8b26d1967/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume1&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<h4 id="8-4-数据卷容器"><a href="#8-4-数据卷容器" class="headerlink" title="8.4 数据卷容器"></a>8.4 数据卷容器</h4><p>多个容器数据之间实现数据共享 。 实例： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos /]# docker images</span><br><span class="line">hello-world           latest    d1165f221234   6 months ago     13.3kB</span><br><span class="line">centos                latest    300e315adb2f   9 months ago     209MB</span><br><span class="line"></span><br><span class="line"># 容器1 </span><br><span class="line">[root@VM-4-6-centos /]# docker run -it --name centos01 new/centos </span><br><span class="line">[root@fff6b286c371 /]# ls</span><br><span class="line">bin  colume2  dev  etc	home  lib  lib64  lost+found  media  mnt  opt  proc  root  run	sbin  srv  sys	tmp  usr  var  volume1</span><br><span class="line">[root@fff6b286c371 /]# cd volume1/</span><br><span class="line"></span><br><span class="line"># 容器1 挂载目录下 新建测试文件</span><br><span class="line">[root@fff6b286c371 volume1]# touch test.txt </span><br><span class="line">[root@fff6b286c371 volume1]# ls</span><br><span class="line">test.txt</span><br><span class="line">[root@fff6b286c371 volume1]# [root@VM-4-6-centos /]# </span><br><span class="line"></span><br><span class="line"># 容器2继承容器1 </span><br><span class="line">[root@VM-4-6-centos /]# docker run -it --name centos02 --volumes-from  centos01 new/centos</span><br><span class="line">[root@41f919150a90 /]# ls</span><br><span class="line">bin  colume2  dev  etc	home  lib  lib64  lost+found  media  mnt  opt  proc  root  run	sbin  srv  sys	tmp  usr  var  volume1</span><br><span class="line">[root@41f919150a90 /]# cd volume1</span><br><span class="line">[root@41f919150a90 volume1]# ls</span><br><span class="line">test.txt</span><br><span class="line"># 容器2 与容器1 实现数据共享</span><br><span class="line">[root@41f919150a90 volume1]# [root@VM-4-6-centos /]# </span><br><span class="line"></span><br><span class="line"># 查看挂载宿主机地址 </span><br><span class="line">[root@VM-4-6-centos /]# docker inspect centos01 </span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;b83567b3f8e3818762cd87e5dc7c48a98846929f4c035d5eadc3c89ea364746b&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/b83567b3f8e3818762cd87e5dc7c48a98846929f4c035d5eadc3c89ea364746b/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume1&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">[root@VM-4-6-centos /]# docker inspect centos01 </span><br><span class="line">        &quot;Mounts&quot;: [</span><br><span class="line">            &#123;</span><br><span class="line">                &quot;Type&quot;: &quot;volume&quot;,</span><br><span class="line">                &quot;Name&quot;: &quot;b83567b3f8e3818762cd87e5dc7c48a98846929f4c035d5eadc3c89ea364746b&quot;,</span><br><span class="line">                &quot;Source&quot;: &quot;/var/lib/docker/volumes/b83567b3f8e3818762cd87e5dc7c48a98846929f4c035d5eadc3c89ea364746b/_data&quot;,</span><br><span class="line">                &quot;Destination&quot;: &quot;volume1&quot;,</span><br><span class="line">                &quot;Driver&quot;: &quot;local&quot;,</span><br><span class="line">                &quot;Mode&quot;: &quot;&quot;,</span><br><span class="line">                &quot;RW&quot;: true,</span><br><span class="line">                &quot;Propagation&quot;: &quot;&quot;</span><br><span class="line">            &#125;,</span><br><span class="line"># 发现两个容器挂载在宿主机的同一位置 </span><br><span class="line"># 即使所有挂载的容器被删除， 宿主机的文件不受影响 </span><br><span class="line">[root@VM-4-6-centos /]# docker rm  centos02</span><br><span class="line">centos02</span><br><span class="line">[root@VM-4-6-centos /]# docker rm  centos01</span><br><span class="line">centos01</span><br><span class="line">[root@VM-4-6-centos home]# cd /var/lib/docker/volumes/</span><br><span class="line">[root@VM-4-6-centos volumes]# cd b83567b3f8e3818762cd87e5dc7c48a98846929f4c035d5eadc3c89ea364746b/</span><br><span class="line">[root@VM-4-6-centos b83567b3f8e3818762cd87e5dc7c48a98846929f4c035d5eadc3c89ea364746b]# ls</span><br><span class="line">_data</span><br><span class="line">[root@VM-4-6-centos b83567b3f8e3818762cd87e5dc7c48a98846929f4c035d5eadc3c89ea364746b]# cd _data</span><br><span class="line">[root@VM-4-6-centos _data]# ls</span><br><span class="line">test.txt</span><br><span class="line"># 测试表明， 即使删除所有容器，宿主机上的文件也会持久化储存。</span><br></pre></td></tr></table></figure>

<h2 id="第九讲-dockerfile-开发"><a href="#第九讲-dockerfile-开发" class="headerlink" title="第九讲 dockerfile 开发"></a>第九讲 dockerfile 开发</h2><h3 id="9-1-什么是dockerfile"><a href="#9-1-什么是dockerfile" class="headerlink" title="9.1 什么是dockerfile"></a>9.1 什么是dockerfile</h3><p>Dockerfile 是一个用来构建镜像的文本文件，文本内容包含了一条条构建镜像所需的指令和说明。</p>
<h3 id="9-2-dockerfile构建镜像的流程"><a href="#9-2-dockerfile构建镜像的流程" class="headerlink" title="9.2 dockerfile构建镜像的流程"></a>9.2 dockerfile构建镜像的流程</h3><ol>
<li> 编写一个dockerfile文本</li>
<li> docker bulild构建一个镜像</li>
<li> docker run 运行镜像 </li>
<li> docker push 发布镜像(dockerhub， 阿里云镜像仓库)</li>
</ol>
<h3 id="9-3-dockerfile-命令"><a href="#9-3-dockerfile-命令" class="headerlink" title="9.3 dockerfile 命令"></a>9.3 dockerfile 命令</h3><p><img src="https://img-blog.csdnimg.cn/img_convert/9b638ef392015ca96221200f883b96c4.png"></p>
<h4 id="9-4-实例测试——新建一个带vim和net-tools的centos镜像"><a href="#9-4-实例测试——新建一个带vim和net-tools的centos镜像" class="headerlink" title="9.4 实例测试——新建一个带vim和net-tools的centos镜像"></a>9.4 实例测试——新建一个带vim和net-tools的centos镜像</h4><ol>
<li><p>编写dockerfle </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos mydocker]# vim dockerfile1 </span><br><span class="line">FROM centos </span><br><span class="line">MAINTAINER ywl&lt;yuan.wanli@qq.com&gt;</span><br><span class="line">ENV MYPATH /usr/local </span><br><span class="line">WORKDIR $MYPATH </span><br><span class="line">RUN yum -y install vim </span><br><span class="line">RUN yum -y install net-tools </span><br><span class="line">EXPOSE 80 </span><br><span class="line">CMD ehco $MYPATH</span><br><span class="line">CMD /bin/bash </span><br></pre></td></tr></table></figure></li>
<li><p>构建镜像 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos mydocker]# docker build --help </span><br><span class="line"></span><br><span class="line">Usage:  docker build [OPTIONS] PATH | URL | -</span><br><span class="line"></span><br><span class="line">Build an image from a Dockerfile</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">      --add-host list           Add a custom host-to-IP mapping (host:ip)</span><br><span class="line">      --build-arg list          Set build-time variables</span><br><span class="line">      --cache-from strings      Images to consider as cache sources</span><br><span class="line">      --cgroup-parent string    Optional parent cgroup for the container</span><br><span class="line">      --compress                Compress the build context using gzip</span><br><span class="line">      --cpu-period int          Limit the CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">      --cpu-quota int           Limit the CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">  -c, --cpu-shares int          CPU shares (relative weight)</span><br><span class="line">      --cpuset-cpus string      CPUs in which to allow execution (0-3, 0,1)</span><br><span class="line">      --cpuset-mems string      MEMs in which to allow execution (0-3, 0,1)</span><br><span class="line">      --disable-content-trust   Skip image verification (default true)</span><br><span class="line">  -f, --file string             Name of the Dockerfile (Default is &#x27;PATH/Dockerfile&#x27;)</span><br><span class="line">      --force-rm                Always remove intermediate containers</span><br><span class="line">      --iidfile string          Write the image ID to the file</span><br><span class="line">      --isolation string        Container isolation technology</span><br><span class="line">      --label list              Set metadata for an image</span><br><span class="line">  -m, --memory bytes            Memory limit</span><br><span class="line">      --memory-swap bytes       Swap limit equal to memory plus swap: &#x27;-1&#x27; to enable unlimited swap</span><br><span class="line">      --network string          Set the networking mode for the RUN instructions during build (default &quot;default&quot;)</span><br><span class="line">      --no-cache                Do not use cache when building the image</span><br><span class="line">      --pull                    Always attempt to pull a newer version of the image</span><br><span class="line">  -q, --quiet                   Suppress the build output and print image ID on success</span><br><span class="line">      --rm                      Remove intermediate containers after a successful build (default true)</span><br><span class="line">      --security-opt strings    Security options</span><br><span class="line">      --shm-size bytes          Size of /dev/shm</span><br><span class="line">  -t, --tag list                Name and optionally a tag in the &#x27;name:tag&#x27; format</span><br><span class="line">      --target string           Set the target build stage to build.</span><br><span class="line">      --ulimit ulimit           Ulimit options (default [])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[root@VM-4-6-centos mydocker]# docker build -f dockerfile1 -t mycentos:1.0 .</span><br><span class="line">Sending build context to Docker daemon  2.048kB</span><br><span class="line">Step 1/9 : FROM centos</span><br><span class="line"> ---&gt; 300e315adb2f</span><br><span class="line">Step 2/9 : MAINTAINER ywl&lt;yuan.wanli@qq.com&gt;</span><br><span class="line"> ---&gt; Running in 2f009ebbce45</span><br><span class="line">Removing intermediate container 2f009ebbce45</span><br><span class="line"> ---&gt; 3e039c5d5963</span><br><span class="line">Step 3/9 : ENV MYPATH /usr/local</span><br><span class="line"> ---&gt; Running in 902ec92baf9a</span><br><span class="line">Removing intermediate container 902ec92baf9a</span><br><span class="line"> ---&gt; 0d77fd7a4baf</span><br><span class="line">Step 4/9 : WORKDIR $MYPATH</span><br><span class="line"> ---&gt; Running in 9d8012ef4523</span><br><span class="line">Removing intermediate container 9d8012ef4523</span><br><span class="line"> ---&gt; 7f363b93ec76</span><br><span class="line">Step 5/9 : RUN yum -y install vim</span><br><span class="line"> ---&gt; Running in 9e54c5f8edfe</span><br><span class="line">CentOS Linux 8 - AppStream                      6.7 MB/s | 8.8 MB     00:01    </span><br><span class="line">CentOS Linux 8 - BaseOS                         4.6 MB/s | 5.6 MB     00:01    </span><br><span class="line">CentOS Linux 8 - Extras                          21 kB/s |  10 kB     00:00    </span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package             Arch        Version                   Repository      Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> vim-enhanced        x86_64      2:8.0.1763-15.el8         appstream      1.4 M</span><br><span class="line">Installing dependencies:</span><br><span class="line"> gpm-libs            x86_64      1.20.7-17.el8             appstream       39 k</span><br><span class="line"> vim-common          x86_64      2:8.0.1763-15.el8         appstream      6.3 M</span><br><span class="line"> vim-filesystem      noarch      2:8.0.1763-15.el8         appstream       48 k</span><br><span class="line"> which               x86_64      2.21-12.el8               baseos          49 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  5 Packages</span><br><span class="line"></span><br><span class="line">Total download size: 7.8 M</span><br><span class="line">Installed size: 30 M</span><br><span class="line">Downloading Packages:</span><br><span class="line">(1/5): gpm-libs-1.20.7-17.el8.x86_64.rpm        425 kB/s |  39 kB     00:00    </span><br><span class="line">(2/5): vim-filesystem-8.0.1763-15.el8.noarch.rp 1.6 MB/s |  48 kB     00:00    </span><br><span class="line">(3/5): vim-enhanced-8.0.1763-15.el8.x86_64.rpm  4.6 MB/s | 1.4 MB     00:00    </span><br><span class="line">(4/5): which-2.21-12.el8.x86_64.rpm             280 kB/s |  49 kB     00:00    </span><br><span class="line">(5/5): vim-common-8.0.1763-15.el8.x86_64.rpm    9.4 MB/s | 6.3 MB     00:00    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           5.2 MB/s | 7.8 MB     00:01     </span><br><span class="line">warning: /var/cache/dnf/appstream-02e86d1c976ab532/packages/gpm-libs-1.20.7-17.el8.x86_64.rpm: Header V3 RSA/SHA256 Signature, key ID 8483c65d: NOKEY</span><br><span class="line">CentOS Linux 8 - AppStream                      1.6 MB/s | 1.6 kB     00:00    </span><br><span class="line">Importing GPG key 0x8483C65D:</span><br><span class="line"> Userid     : &quot;CentOS (CentOS Official Signing Key) &lt;security@centos.org&gt;&quot;</span><br><span class="line"> Fingerprint: 99DB 70FA E1D7 CE22 7FB6 4882 05B5 55B3 8483 C65D</span><br><span class="line"> From       : /etc/pki/rpm-gpg/RPM-GPG-KEY-centosofficial</span><br><span class="line">Key imported successfully</span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : which-2.21-12.el8.x86_64                               1/5 </span><br><span class="line">  Installing       : vim-filesystem-2:8.0.1763-15.el8.noarch                2/5 </span><br><span class="line">  Installing       : vim-common-2:8.0.1763-15.el8.x86_64                    3/5 </span><br><span class="line">  Installing       : gpm-libs-1.20.7-17.el8.x86_64                          4/5 </span><br><span class="line">  Running scriptlet: gpm-libs-1.20.7-17.el8.x86_64                          4/5 </span><br><span class="line">  Installing       : vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-enhanced-2:8.0.1763-15.el8.x86_64                  5/5 </span><br><span class="line">  Running scriptlet: vim-common-2:8.0.1763-15.el8.x86_64                    5/5 </span><br><span class="line">  Verifying        : gpm-libs-1.20.7-17.el8.x86_64                          1/5 </span><br><span class="line">  Verifying        : vim-common-2:8.0.1763-15.el8.x86_64                    2/5 </span><br><span class="line">  Verifying        : vim-enhanced-2:8.0.1763-15.el8.x86_64                  3/5 </span><br><span class="line">  Verifying        : vim-filesystem-2:8.0.1763-15.el8.noarch                4/5 </span><br><span class="line">  Verifying        : which-2.21-12.el8.x86_64                               5/5 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  gpm-libs-1.20.7-17.el8.x86_64         vim-common-2:8.0.1763-15.el8.x86_64    </span><br><span class="line">  vim-enhanced-2:8.0.1763-15.el8.x86_64 vim-filesystem-2:8.0.1763-15.el8.noarch</span><br><span class="line">  which-2.21-12.el8.x86_64             </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container 9e54c5f8edfe</span><br><span class="line"> ---&gt; 5dea379858f6</span><br><span class="line">Step 6/9 : RUN yum -y install net-tools</span><br><span class="line"> ---&gt; Running in a238f0f61bd1</span><br><span class="line">Last metadata expiration check: 0:00:11 ago on Wed Sep  8 05:20:26 2021.</span><br><span class="line">Dependencies resolved.</span><br><span class="line">================================================================================</span><br><span class="line"> Package         Architecture Version                        Repository    Size</span><br><span class="line">================================================================================</span><br><span class="line">Installing:</span><br><span class="line"> net-tools       x86_64       2.0-0.52.20160912git.el8       baseos       322 k</span><br><span class="line"></span><br><span class="line">Transaction Summary</span><br><span class="line">================================================================================</span><br><span class="line">Install  1 Package</span><br><span class="line"></span><br><span class="line">Total download size: 322 k</span><br><span class="line">Installed size: 942 k</span><br><span class="line">Downloading Packages:</span><br><span class="line">net-tools-2.0-0.52.20160912git.el8.x86_64.rpm   1.1 MB/s | 322 kB     00:00    </span><br><span class="line">--------------------------------------------------------------------------------</span><br><span class="line">Total                                           547 kB/s | 322 kB     00:00     </span><br><span class="line">Running transaction check</span><br><span class="line">Transaction check succeeded.</span><br><span class="line">Running transaction test</span><br><span class="line">Transaction test succeeded.</span><br><span class="line">Running transaction</span><br><span class="line">  Preparing        :                                                        1/1 </span><br><span class="line">  Installing       : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Running scriptlet: net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line">  Verifying        : net-tools-2.0-0.52.20160912git.el8.x86_64              1/1 </span><br><span class="line"></span><br><span class="line">Installed:</span><br><span class="line">  net-tools-2.0-0.52.20160912git.el8.x86_64                                     </span><br><span class="line"></span><br><span class="line">Complete!</span><br><span class="line">Removing intermediate container a238f0f61bd1</span><br><span class="line"> ---&gt; fe15f2802369</span><br><span class="line">Step 7/9 : EXPOSE 80</span><br><span class="line"> ---&gt; Running in dd05e3d35f52</span><br><span class="line">Removing intermediate container dd05e3d35f52</span><br><span class="line"> ---&gt; 8b2ed813e0cc</span><br><span class="line">Step 8/9 : CMD ehco $MYPATH</span><br><span class="line"> ---&gt; Running in 3abafde69c99</span><br><span class="line">Removing intermediate container 3abafde69c99</span><br><span class="line"> ---&gt; 7a93ce354052</span><br><span class="line">Step 9/9 : CMD /bin/bash</span><br><span class="line"> ---&gt; Running in 0737c0226cf2</span><br><span class="line">Removing intermediate container 0737c0226cf2</span><br><span class="line"> ---&gt; b531a51cbc3e</span><br><span class="line">Successfully built b531a51cbc3e</span><br><span class="line">Successfully tagged mycentos:1.0</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><p>测试 </p>
<p>查看镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos mydocker]# docker images </span><br><span class="line">REPOSITORY            TAG       IMAGE ID       CREATED         SIZE</span><br><span class="line">mycentos              1.0       b531a51cbc3e   4 minutes ago   307MB</span><br><span class="line">centos                latest    300e315adb2f   9 months ago    209MB</span><br></pre></td></tr></table></figure>

<p>运行一个容器 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos mydocker]# docker run -it b531a51cbc3e</span><br><span class="line">[root@915fe46d200b local]# ls</span><br><span class="line">bin  etc  games  include  lib  lib64  libexec  sbin  share  src</span><br><span class="line">[root@915fe46d200b local]# pwd </span><br><span class="line">/usr/local</span><br><span class="line">[root@915fe46d200b local]# vim test.txt</span><br></pre></td></tr></table></figure></li>
<li><p>查看镜像构建历史 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos mydocker]# docker history --human b531a51cbc3e</span><br><span class="line">IMAGE          CREATED          CREATED BY                                      SIZE      COMMENT</span><br><span class="line">b531a51cbc3e   14 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;/bin…   0B     </span><br><span class="line">7a93ce354052   14 minutes ago   /bin/sh -c #(nop)  CMD [&quot;/bin/sh&quot; &quot;-c&quot; &quot;ehco…   0B     </span><br><span class="line">8b2ed813e0cc   14 minutes ago   /bin/sh -c #(nop)  EXPOSE 80                    0B     </span><br><span class="line">fe15f2802369   14 minutes ago   /bin/sh -c yum -y install net-tools             29.5M </span><br><span class="line">5dea379858f6   14 minutes ago   /bin/sh -c yum -y install vim                   68.1MB </span><br><span class="line">7f363b93ec76   14 minutes ago   /bin/sh -c #(nop) WORKDIR /usr/local            0B     </span><br><span class="line">0d77fd7a4baf   14 minutes ago   /bin/sh -c #(nop)  ENV MYPATH=/usr/local        0B     </span><br><span class="line">3e039c5d5963   14 minutes ago   /bin/sh -c #(nop)  MAINTAINER ywl&lt;yuan.wanli…   0B     </span><br><span class="line">300e315adb2f   9 months ago     /bin/sh -c #(nop)  CMD [&quot;/bin/bash&quot;]            0B     </span><br><span class="line">&lt;missing&gt;      9 months ago     /bin/sh -c #(nop)  LABEL org.label-schema.sc…   0B     </span><br><span class="line">&lt;missing&gt;      9 months ago     /bin/sh -c #(nop) ADD file:bd7a2aed6ede423b7…   209MB </span><br></pre></td></tr></table></figure></li>
</ol>
<p>9.5 CMD 于 ENTRYPOINT区别 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CMD				# 指定这个容器启动的时候要运行的命令，只有最后一个会生效，可被替代。</span><br><span class="line">ENTRYPOINT	   # 指定这个容器启动的时候要运行的命令，可以追加命令*</span><br></pre></td></tr></table></figure>

<p>测试CMD </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"># 编写dockerfile文件</span><br><span class="line">$ vim dockerfile-test-cmd</span><br><span class="line">FROM centos</span><br><span class="line">CMD [&quot;ls&quot;,&quot;-a&quot;]					# 启动后执行 ls -a 命令</span><br><span class="line"></span><br><span class="line"># 构建镜像</span><br><span class="line">$ docker build  -f dockerfile-test-cmd -t cmd-test:0.1 .</span><br><span class="line"></span><br><span class="line"># 运行镜像</span><br><span class="line">$ docker run cmd-test:0.1		# 由结果可得，运行后就执行了 ls -a 命令</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line"></span><br><span class="line"># 想追加一个命令  -l 成为ls -al：展示列表详细数据</span><br><span class="line">$ docker run cmd-test:0.1 -l</span><br><span class="line">docker: Error response from daemon: OCI runtime create failed: container_linux.go:349: starting container process caused &quot;exec: \&quot;-l\&quot;:</span><br><span class="line">executable file not found in $PATH&quot;: unknown.</span><br><span class="line">ERRO[0000] error waiting for container: context canceled </span><br><span class="line"></span><br><span class="line"># cmd的情况下 -l 替换了CMD[&quot;ls&quot;,&quot;-l&quot;] 而 -l  不是命令所以报错</span><br></pre></td></tr></table></figure>

<p>测试ENTRYPOINT </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"># 编写dockerfile文件</span><br><span class="line">$ vim dockerfile-test-entrypoint</span><br><span class="line">FROM centos</span><br><span class="line">ENTRYPOINT [&quot;ls&quot;,&quot;-a&quot;]</span><br><span class="line"></span><br><span class="line"># 构建镜像</span><br><span class="line">$ docker build  -f dockerfile-test-entrypoint -t cmd-test:0.1 .</span><br><span class="line"></span><br><span class="line"># 运行镜像</span><br><span class="line">$ docker run entrypoint-test:0.1</span><br><span class="line">.</span><br><span class="line">..</span><br><span class="line">.dockerenv</span><br><span class="line">bin</span><br><span class="line">dev</span><br><span class="line">etc</span><br><span class="line">home</span><br><span class="line">lib</span><br><span class="line">lib64</span><br><span class="line">lost+found ...</span><br><span class="line"></span><br><span class="line"># 我们的命令，是直接拼接在我们得ENTRYPOINT命令后面的</span><br><span class="line">$ docker run entrypoint-test:0.1 -l</span><br><span class="line">total 56</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 16 06:32 .</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 16 06:32 ..</span><br><span class="line">-rwxr-xr-x   1 root root    0 May 16 06:32 .dockerenv</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 bin -&gt; usr/bin</span><br><span class="line">drwxr-xr-x   5 root root  340 May 16 06:32 dev</span><br><span class="line">drwxr-xr-x   1 root root 4096 May 16 06:32 etc</span><br><span class="line">drwxr-xr-x   2 root root 4096 May 11  2019 home</span><br><span class="line">lrwxrwxrwx   1 root root    7 May 11  2019 lib -&gt; usr/lib</span><br><span class="line">lrwxrwxrwx   1 root root    9 May 11  2019 lib64 -&gt; usr/lib64 ....</span><br></pre></td></tr></table></figure>

<p>Dockerfile中很多命令都十分的相似，我们需要了解它们的区别，我们最好的学习就是对比他们然后测试效果！</p>
<h2 id="实战：Tomcat镜像"><a href="#实战：Tomcat镜像" class="headerlink" title="实战：Tomcat镜像"></a>实战：Tomcat镜像</h2><h5 id="1、准备镜像文件"><a href="#1、准备镜像文件" class="headerlink" title="1、准备镜像文件"></a>1、准备镜像文件</h5><p>准备tomcat 和 jdk 到当前目录，编写好README</p>
<h5 id="2、编写dokerfile"><a href="#2、编写dokerfile" class="headerlink" title="2、编写dokerfile"></a>2、编写dokerfile</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim dockerfileFROM centos 										# 基础镜像centosMAINTAINER cao&lt;1165680007@qq.com&gt;					# 作者COPY README /usr/local/README 						# 复制README文件ADD jdk-8u231-linux-x64.tar.gz /usr/local/ 			# 添加jdk，ADD 命令会自动解压ADD apache-tomcat-9.0.35.tar.gz /usr/local/ 		# 添加tomcat，ADD 命令会自动解压RUN yum -y install vim								# 安装 vim 命令ENV MYPATH /usr/local 								# 环境变量设置 工作目录WORKDIR $MYPATHENV JAVA_HOME /usr/local/jdk1.8.0_231 				# 环境变量： JAVA_HOME环境变量ENV CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jarENV CATALINA_HOME /usr/local/apache-tomcat-9.0.35 	# 环境变量： tomcat环境变量ENV CATALINA_BASH /usr/local/apache-tomcat-9.0.35# 设置环境变量 分隔符是：ENV PATH $PATH:$JAVA_HOME/bin:$CATALINA_HOME/lib:$CATALINA_HOME/bin 	EXPOSE 8080 										# 设置暴露的端口CMD /usr/local/apache-tomcat-9.0.35/bin/startup.sh &amp;&amp; tail -F /usr/local/apache-tomcat-9.0.35/logs/catalina.out 					# 设置默认命令</span><br></pre></td></tr></table></figure>



<h5 id="3、构建镜像"><a href="#3、构建镜像" class="headerlink" title="3、构建镜像"></a>3、构建镜像</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 因为dockerfile命名使用默认命名 因此不用使用-f 指定文件$ docker build -t mytomcat:0.1 .</span><br></pre></td></tr></table></figure>



<h5 id="4、run镜像"><a href="#4、run镜像" class="headerlink" title="4、run镜像"></a>4、run镜像</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># -d:后台运行 -p:暴露端口 --name:别名 -v:绑定路径 $ docker run -d -p 8080:8080 --name tomcat01 -v /home/kuangshen/build/tomcat/test:/usr/local/apache-tomcat-9.0.35/webapps/test -v /home/kuangshen/build/tomcat/tomcatlogs/:/usr/local/apache-tomcat-9.0.35/logs mytomcat:0.1</span><br></pre></td></tr></table></figure>

<h5 id="5、访问测试"><a href="#5、访问测试" class="headerlink" title="5、访问测试"></a>5、访问测试</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it 自定义容器的id /bin/bash$ cul localhost:8080</span><br></pre></td></tr></table></figure>

<h5 id="6、发布项目"><a href="#6、发布项目" class="headerlink" title="6、发布项目"></a>6、发布项目</h5><p>(由于做了卷挂载，我们直接在本地编写项目就可以发布了！)</p>
<p>发现：项目部署成功，可以直接访问！</p>
<p>我们以后开发的步骤：需要掌握Dockerfile的编写！我们之后的一切都是使用docker镜像来发布运行！</p>
<h2 id="第十讲-发布docker镜像"><a href="#第十讲-发布docker镜像" class="headerlink" title="第十讲 发布docker镜像"></a>第十讲 发布docker镜像</h2><h4 id="10-1-发布到dockerhub"><a href="#10-1-发布到dockerhub" class="headerlink" title="10.1 发布到dockerhub"></a>10.1 发布到dockerhub</h4><p>1、地址 <a target="_blank" rel="noopener" href="https://hub.docker.com/">https://hub.docker.com/</a></p>
<p>2、确定这个账号可以登录</p>
<p>3、登录</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ docker login --help</span><br><span class="line">Usage:  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">Log in to a Docker registry.</span><br><span class="line">If no server is specified, the default is defined by the daemon.</span><br><span class="line"></span><br><span class="line">Options:</span><br><span class="line">  -p, --password string   Password</span><br><span class="line">      --password-stdin    Take the password from stdin</span><br><span class="line">  -u, --username string   Username</span><br><span class="line"></span><br><span class="line">$ docker login -u 你的用户名 -p 你的密码</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>4、提交 push镜像</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/6880624df46a68aa5a4fb4f44d3ac93b.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 会发现push不上去，因为如果没有前缀的话默认是push到 官方的library</span><br><span class="line"># 解决方法：</span><br><span class="line"># 第一种 build的时候添加你的dockerhub用户名，然后在push就可以放到自己的仓库了</span><br><span class="line">$ docker build -t kuangshen/mytomcat:0.1 .</span><br><span class="line"></span><br><span class="line"># 第二种 使用docker tag #然后再次push</span><br><span class="line">$ docker tag 容器id kuangshen/mytomcat:1.0 #然后再次push</span><br><span class="line">$ docker push kuangshen/mytomcat:1.0</span><br></pre></td></tr></table></figure>

<p>10.2 发布到阿里云镜像</p>
<p>看官网 很详细<a target="_blank" rel="noopener" href="https://cr.console.aliyun.com/repository/">https://cr.console.aliyun.com/repository/</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ sudo docker login --username=zchengx registry.cn-shenzhen.aliyuncs.com</span><br><span class="line">$ sudo docker tag [ImageId] registry.cn-shenzhen.aliyuncs.com/dsadxzc/cheng:[镜像版本号]</span><br><span class="line"></span><br><span class="line"># 修改id 和 版本</span><br><span class="line">sudo docker tag a5ef1f32aaae registry.cn-shenzhen.aliyuncs.com/dsadxzc/cheng:1.0</span><br><span class="line"># 修改版本</span><br><span class="line">$ sudo docker push registry.cn-shenzhen.aliyuncs.com/dsadxzc/cheng:[镜像版本号]</span><br></pre></td></tr></table></figure>

<p>总结：</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/5fcac2393e232435f2fbe109bf54c461.png"></p>
<h2 id="第十一讲-docker网络"><a href="#第十一讲-docker网络" class="headerlink" title="第十一讲 docker网络"></a>第十一讲 docker网络</h2><p>清空镜像</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker rmi -f $(docker images -aq)</span><br></pre></td></tr></table></figure>

<p>查看网卡</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-4-6-centos ~]# ip addr </span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: eth0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 52:54:00:e6:fb:2d brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 10.0.4.6/22 brd 10.0.7.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::5054:ff:fee6:fb2d/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;NO-CARRIER,BROADCAST,MULTICAST,UP&gt; mtu 1500 qdisc noqueue state DOWN group default </span><br><span class="line">    link/ether 02:42:d6:9a:ed:b7 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.0.1/16 brd 172.17.255.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:d6ff:fe9a:edb7/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>docker如何处理容器于宿主机的网络</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"># 测试  运行一个tomcat</span><br><span class="line">$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line"></span><br><span class="line"># 查看容器内部网络地址</span><br><span class="line">$ docker exec -it 容器id ip addr</span><br><span class="line"></span><br><span class="line"># 发现容器启动的时候会得到一个 eth0@if91 ip地址，docker分配！</span><br><span class="line">$ ip addr</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">261: eth0@if91: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">    link/ether 02:42:ac:12:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">    inet 172.18.0.2/16 brd 172.18.255.255 scope global eth0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line">       </span><br><span class="line"># 思考？ linux能不能ping通容器内部！ 可以 容器内部可以ping通外界吗？ 可以！</span><br><span class="line">$ ping 172.18.0.2</span><br><span class="line">PING 172.18.0.2 (172.18.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=1 ttl=64 time=0.069 ms</span><br><span class="line">64 bytes from 172.18.0.2: icmp_seq=2 ttl=64 time=0.074 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li><p>我们每启动一个docker容器，docker就会给docker容器分配一个ip，我们只要按照了docker，就会有一个docker0桥接模式，使用的技术是veth-pair技术！</p>
</li>
<li><p>再启动一个容器测试，发现又多了一对网络. </p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/ad6d849117e30fda5f1d864b80508950.png"></p>
</li>
</ol>
<p>我们发现这个容器带来网卡，都是一对对的,veth-pair 就是一对的虚拟设备接口，他们都是成对出现的，一端连着协议，一端彼此相连正因为有这个特性 veth-pair 充当一个桥梁，连接各种虚拟网络设备的OpenStac,Docker容器之间的连接，OVS的连接，都是使用evth-pair技术</p>
<p>3、我们来测试下tomcat01和tomcat02是否可以ping通</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">#获取tomcat01的ip 172.17.0.2</span><br><span class="line">$ docker-tomcat docker exec -it tomcat01 ip addr  </span><br><span class="line">550: eth0@if551: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc noqueue state UP group default </span><br><span class="line">link/ether 02:42:ac:11:00:02 brd ff:ff:ff:ff:ff:ff link-netnsid 0</span><br><span class="line">inet 172.17.0.2/16 brd 172.17.255.255 scope global eth0</span><br><span class="line"> valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 让tomcat02 ping tomcat01       </span><br><span class="line">$ docker-tomcat docker exec -it tomcat02 ping 172.17.0.2</span><br><span class="line">PING 172.17.0.2 (172.17.0.2) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=1 ttl=64 time=0.098 ms</span><br><span class="line">64 bytes from 172.17.0.2: icmp_seq=2 ttl=64 time=0.071 ms</span><br><span class="line"></span><br><span class="line"># 结论：容器和容器之间是可以互相ping通</span><br></pre></td></tr></table></figure>

<p><strong>网络模型图</strong></p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/42da936b21f047bb0d54430eb2095b85.png"></p>
<p>结论：tomcat01和tomcat02公用一个路由器，docker0。</p>
<p>所有的容器不指定网络的情况下，都是docker0路由的，docker会给我们的容器分配一个默认的可用ip。</p>
<blockquote>
<p>小结</p>
</blockquote>
<p>Docker使用的是Linux的桥接，宿主机是一个Docker容器的网桥 docker0</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/d64348fa5254aee5a30a4ec3ea161a62.png"></p>
<p>Docker中所有网络接口都是虚拟的，虚拟的转发效率高（内网传递文件）</p>
<p>只要容器删除，对应的网桥一对就没了！</p>
<p><strong>思考一个场景：我们编写了一个微服务，database url=ip: 项目不重启，数据ip换了，我们希望可以处理这个问题，可以通过名字来进行访问容器</strong>？</p>
<h5 id="–-link"><a href="#–-link" class="headerlink" title="–-link"></a>–-link</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ docker exec -it tomcat02 ping tomca01   # ping不通</span><br><span class="line">ping: tomca01: Name or service not known</span><br><span class="line"></span><br><span class="line"># 运行一个tomcat03 --link tomcat02 </span><br><span class="line">$ docker run -d -P --name tomcat03 --link tomcat02 tomcat</span><br><span class="line">5f9331566980a9e92bc54681caaac14e9fc993f14ad13d98534026c08c0a9aef</span><br><span class="line"></span><br><span class="line"># 3连接2</span><br><span class="line"># 用tomcat03 ping tomcat02 可以ping通</span><br><span class="line">$ docker exec -it tomcat03 ping tomcat02</span><br><span class="line">PING tomcat02 (172.17.0.3) 56(84) bytes of data.</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=1 ttl=64 time=0.115 ms</span><br><span class="line">64 bytes from tomcat02 (172.17.0.3): icmp_seq=2 ttl=64 time=0.080 ms</span><br><span class="line"></span><br><span class="line"># 2连接3</span><br><span class="line"># 用tomcat02 ping tomcat03 ping不通</span><br></pre></td></tr></table></figure>

<p><strong>探究：</strong></p>
<p>docker network inspect 网络id 网段相同</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/28a9ff1c86e4487e05ed57b4339803da.png"></p>
<p>docker inspect tomcat03</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/8813ee7857c38f9b33357e9c4c7b3998.png"></p>
<p>查看tomcat03里面的/etc/hosts发现有tomcat02的配置</p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/6718b40add3cbbd0601c9cb7093ff74b.png"></p>
<p>–link 本质就是在hosts配置中添加映射</p>
<p>现在使用Docker已经不建议使用–link了！</p>
<p>自定义网络，不适用docker0！</p>
<p>docker0问题：不支持容器名连接访问！</p>
<h5 id="自定义网络"><a href="#自定义网络" class="headerlink" title="自定义网络"></a>自定义网络</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker network</span><br><span class="line">connect     -- Connect a container to a network</span><br><span class="line">create      -- Creates a new network with a name specified by the</span><br><span class="line">disconnect  -- Disconnects a container from a network</span><br><span class="line">inspect     -- Displays detailed information on a network</span><br><span class="line">ls          -- Lists all the networks created by the user</span><br><span class="line">prune       -- Remove all unused networks</span><br><span class="line">rm          -- Deletes one or more networks</span><br></pre></td></tr></table></figure>

<p><strong>网络模式</strong></p>
<p>bridge ：桥接 docker（默认，自己创建也是用bridge模式）</p>
<p>none ：不配置网络，一般不用</p>
<p>host ：和所主机共享网络</p>
<p>container ：容器网络连通（用得少！局限很大）</p>
<p>测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 我们直接启动的命令 --net bridge,而这个就是我们得docker0</span><br><span class="line"># bridge就是docker0</span><br><span class="line">$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line">等价于 =&gt; docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"></span><br><span class="line"># docker0，特点：默认，域名不能访问。 --link可以打通连接，但是很麻烦！</span><br><span class="line"># 我们可以 自定义一个网络</span><br><span class="line">$ docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/2cb31c620d7c02723333ada621392f31.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network inspect mynet;</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/6e9d3cfe891cff4ef8b663c54e7400d7.png"></p>
<p>启动两个tomcat,再次查看网络情况,在自定义的网络下，服务可以互相ping通，不用使用–link.</p>
<p>我们自定义的网络docker当我们维护好了对应的关系，推荐我们平时这样使用网络！</p>
<p>好处：</p>
<p>redis -不同的集群使用不同的网络，保证集群是安全和健康的</p>
<p>mysql-不同的集群使用不同的网络，保证集群是安全和健康的</p>
<h2 id="网络连通"><a href="#网络连通" class="headerlink" title="网络连通"></a>网络连通</h2><p>容器和网卡的网路连通 </p>
<p><img src="https://img-blog.csdnimg.cn/img_convert/cfbacb1af865b2fb5ba797ecb518e81a.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 测试两个不同的网络连通  再启动两个tomcat 使用默认网络，即docker0$ docker run -d -P --name tomcat01 tomcat$ docker run -d -P --name tomcat02 tomcat# 此时ping不通</span><br></pre></td></tr></table></figure>

<p><img src="https://img-blog.csdnimg.cn/img_convert/4838a93c072a1c5608ff7c020a538038.png"></p>
<p>结论：假设要跨网络操作别人，就需要使用docker network connect 连通！</p>
<p>查看tomcat03里面的/etc/hosts发现有tomcat02的配置</p>
<p>[外链图片转存中…(img-IV7ISb15-1632447380551)]</p>
<p>–link 本质就是在hosts配置中添加映射</p>
<p>现在使用Docker已经不建议使用–link了！</p>
<p>自定义网络，不适用docker0！</p>
<p>docker0问题：不支持容器名连接访问！</p>
<h5 id="自定义网络-1"><a href="#自定义网络-1" class="headerlink" title="自定义网络"></a>自定义网络</h5><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">docker network</span><br><span class="line">connect     -- Connect a container to a network</span><br><span class="line">create      -- Creates a new network with a name specified by the</span><br><span class="line">disconnect  -- Disconnects a container from a network</span><br><span class="line">inspect     -- Displays detailed information on a network</span><br><span class="line">ls          -- Lists all the networks created by the user</span><br><span class="line">prune       -- Remove all unused networks</span><br><span class="line">rm          -- Deletes one or more networks</span><br></pre></td></tr></table></figure>

<p><strong>网络模式</strong></p>
<p>bridge ：桥接 docker（默认，自己创建也是用bridge模式）</p>
<p>none ：不配置网络，一般不用</p>
<p>host ：和所主机共享网络</p>
<p>container ：容器网络连通（用得少！局限很大）</p>
<p>测试</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 我们直接启动的命令 --net bridge,而这个就是我们得docker0</span><br><span class="line"># bridge就是docker0</span><br><span class="line">$ docker run -d -P --name tomcat01 tomcat</span><br><span class="line">等价于 =&gt; docker run -d -P --name tomcat01 --net bridge tomcat</span><br><span class="line"></span><br><span class="line"># docker0，特点：默认，域名不能访问。 --link可以打通连接，但是很麻烦！</span><br><span class="line"># 我们可以 自定义一个网络</span><br><span class="line">$ docker network create --driver bridge --subnet 192.168.0.0/16 --gateway 192.168.0.1 mynet</span><br></pre></td></tr></table></figure>

<p>[外链图片转存中…(img-VQpRBRbV-1632447380552)]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ docker network inspect mynet;</span><br></pre></td></tr></table></figure>

<p>[外链图片转存中…(img-i1ByXXaq-1632447380553)]</p>
<p>启动两个tomcat,再次查看网络情况,在自定义的网络下，服务可以互相ping通，不用使用–link.</p>
<p>我们自定义的网络docker当我们维护好了对应的关系，推荐我们平时这样使用网络！</p>
<p>好处：</p>
<p>redis -不同的集群使用不同的网络，保证集群是安全和健康的</p>
<p>mysql-不同的集群使用不同的网络，保证集群是安全和健康的</p>
<h2 id="网络连通-1"><a href="#网络连通-1" class="headerlink" title="网络连通"></a>网络连通</h2><p>容器和网卡的网路连通 </p>
<p>[外链图片转存中…(img-kSj5c9Wq-1632447380554)]</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># 测试两个不同的网络连通  再启动两个tomcat 使用默认网络，即docker0$ docker run -d -P --name tomcat01 tomcat$ docker run -d -P --name tomcat02 tomcat# 此时ping不通</span><br></pre></td></tr></table></figure>

<p>[外链图片转存中…(img-iZD6LTom-1632447380556)]</p>
<p>结论：假设要跨网络操作别人，就需要使用docker network connect 连通！</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/30/2021-09-30-%E3%80%8A%E7%BE%8E%E4%B8%BD%E6%96%B0%E4%B8%96%E7%95%8C%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/30/2021-09-30-%E3%80%8A%E7%BE%8E%E4%B8%BD%E6%96%B0%E4%B8%96%E7%95%8C%E3%80%8B/" class="post-title-link" itemprop="url">《美丽新世界》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-30 17:17:00" itemprop="dateCreated datePublished" datetime="2021-09-30T17:17:00+08:00">2021-09-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>《美丽新世界》</p>
<p><strong>作者</strong></p>
<p>奥尔德斯•赫胥黎（Aldous Huxley, 1894—1963），英国杰出的小说家、诗人、散文家、批评家和剧作家，著名的人道主义者。他以大量的小说和散文、杂文、评论作品，有意识地担负起一个人文主义知识分子的道义职责，充当了社会道德和现代文明的拷问者。</p>
<p><strong>摘录</strong></p>
<ul>
<li>有一种东西叫做民主。好像人和人之间除了物理和化学性能平等之外还有什么别的东西也会平等似的。</li>
<li>“如果人不必考虑幸福的话，”他想，“哪会多么有趣！”</li>
<li>慢性悔恨是一种最不健康的情绪。如果你做错了事，你可以忏悔，然后尽自己所能进行弥补，让自己下一次做得更好。千万不要沉浸在过去的错误中，在淤泥中打滚绝对无法让你变得干净</li>
<li>他们为人类准备好了床，如果人类不适应这张床，那就只能自认倒霉，只能把人拉长或截短。</li>
<li>例如，我们去一个热带岛屿，在DDT杀虫剂的帮助下，我们消灭了疟疾，在两三年的时间里，拯救了成千上万的生命。这显然是件好事。但是这些被拯救的成千上万人生育了数百万的孩子，这个岛屿上的可利用资源无法满足这些孩子衣食住行和教育的需要。疟疾带来的快速死亡已经不存在了，但是由于营养不良和拥挤，这里的生活痛苦不堪，饥饿造成的慢性死亡威胁着更多人的生命。</li>
<li>在一个大规模生产和营销的世界里，资金不足的小人物常常处于劣势，在和大人物的竞争中，他失去自己的资本，最后被大人物吞食，失去作为独立生产者存在的权利。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/22/2021-09-22-%E3%80%8A%E6%88%91%E4%BB%AC%E3%80%8B%20%E6%91%98%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/22/2021-09-22-%E3%80%8A%E6%88%91%E4%BB%AC%E3%80%8B%20%E6%91%98%E5%BD%95/" class="post-title-link" itemprop="url">《我们》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-22 00:00:00" itemprop="dateCreated datePublished" datetime="2021-09-22T00:00:00+08:00">2021-09-22</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="《我们》-摘录"><a href="#《我们》-摘录" class="headerlink" title="《我们》 摘录"></a>《我们》 摘录</h2><p>叶甫盖尼·扎米亚京  陈超译 </p>
<ul>
<li>上帝曾经让天堂里那两位作出自己的选择：或者选择没有自由的幸福，或者选择没有幸福的自由，第三种选择是没有的。</li>
<li>“这表明，你喜欢。你怕它，是因为它的力量大于你。你讨厌它，是因为你怕它。你喜欢它，是因为你无法使它顺从你。人只喜欢他无法占有的东西。”</li>
<li>自由与犯罪是密不可分的，就像…嗯，就像飞机的运动与它的速度，当它速度为零时，它就是静止的，当人没有自由时，他就不会犯罪。这是很清楚的道理。不让人犯罪的唯一途径就是剥夺他的自由。</li>
<li>“告诉我们什么是最后的数字，最终的数字，最大的数字。” “但这太荒唐了！数字的数目是无限的，怎么会有最后的数字呢？” “那怎么会有最后的革命呢？最后的革命是不存在的：革命是无休止的。” </li>
</ul>
<p><strong>附录部分：</strong></p>
<ul>
<li>革命无处不在， 革命蕴涵在万物之中。他是无限的，没有最后的革命，也没有最终的数字。 社会革命只是无限的数字革命中的一个：革命的法则不是社会法则，而是无法估量的更伟大的法则。它是普世的宇宙法则——就像能亮守恒法则和能量耗散法则。终有一天，一道确切的革命法则公式将会确立，在这道公司里，国家、阶级、星星——还有书籍，都会作为数字变量加以描述。</li>
<li>有害的文学作品要比有用的文学作品更有意义，因为它在与熵对抗，它是对抗僵化、硬化、结痂、苔藓、静止的手段。 </li>
<li>异端对于健康是必须的，如果没有异端，就应该催生异端。 </li>
<li>孩子们是最勇敢的哲学家，他们赤裸裸的来到世上，不为最细微的教条、绝对真理、信条所蒙蔽。这就是为什么他们问的每一个问题都很荒唐、天真而又复杂的惊人。</li>
<li>生机勃勃的人总在犯错，总是在追寻、提问、受折磨。</li>
<li>答案可能是错的，哲学可能是谬误——错误比真理更有价值：真理就像机器， 而错误是鲜活的。</li>
<li>荒唐吗？是的。平行线相交也是荒唐的，但它只是在欧几里得的经典几何才是荒唐的。在非欧几何里，它是一则定理，你需要做的就是不再局限于平面，超越平面。</li>
<li>刺痛自己是很困难的，甚至是危险的。但对于那些活着的人来说，在今天像昨天一样生活是更加困难的事情。 </li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/20/2021-09-20-%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/20/2021-09-20-%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A6/" class="post-title-link" itemprop="url">行为经济学</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-09-20T00:00:00+08:00">2021-09-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="导论"><a href="#导论" class="headerlink" title="导论"></a>导论</h2><h2 id="第十二讲-损失厌恶：-赢与输总是绝对的吗？"><a href="#第十二讲-损失厌恶：-赢与输总是绝对的吗？" class="headerlink" title="第十二讲 损失厌恶： 赢与输总是绝对的吗？"></a>第十二讲 损失厌恶： 赢与输总是绝对的吗？</h2><p>损失厌恶：人们讨厌损失</p>
<p>但真的是一种非理性的行为吗? </p>
<p>实验： 训练猴子使用硬币。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A61.png"></p>
<p>从进化论，错配的角度来说，损失厌恶让我更有动力， 有更大的冒险欲望。大脑对盈利和损失是不对称的。 </p>
<p>例子：为什么经营不好的时候， 公司不减低工资而去裁员。降低工资会给员工带来损失厌恶。</p>
<p>框架效应： 同样一个东西， 可以在一个框架下，是盈利的。另一个框架下，是损失的。</p>
<p>处置效应： 卖掉挣钱的，保留亏钱的。 </p>
<p>应用： </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A62.png"></p>
<p>改进：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A63.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A65.png"></p>
<p>沉没成本： </p>
<p>已经失去的损失，我们不应该再留恋他。</p>
<h2 id="第十三讲：-突出事件放大：-为什么有人买彩票"><a href="#第十三讲：-突出事件放大：-为什么有人买彩票" class="headerlink" title="第十三讲： 突出事件放大： 为什么有人买彩票"></a>第十三讲： 突出事件放大： 为什么有人买彩票</h2><p>小概率事件高估： 预期中的偏差 </p>
<p>突出事件较大的权重： 偏好的偏差</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A66.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A67.png"></p>
<h2 id="第十四讲：心智账户：我们把钱存在哪-？"><a href="#第十四讲：心智账户：我们把钱存在哪-？" class="headerlink" title="第十四讲：心智账户：我们把钱存在哪 ？"></a>第十四讲：心智账户：我们把钱存在哪 ？</h2><p>心智账户，人常把钱分到不同的想象的账户里</p>
<p>由于CEO和部门经理的心智账户不同，导致不同投资策略。 </p>
<p>每个人的心智账户都不同。 </p>
<p>一块100元巧克力自己吃，你可能会觉得贵，但是买送给女朋友，你觉得不贵。</p>
<p>因为自己消费的账户和社交不是一个账户</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A68.png"></p>
<p><strong>禀赋效应</strong>是指当个人一旦拥有某项物品，那么他对该物品价值的评价要比未拥有之前大大提高。它是由Richard Thaler(1980)提出的。这一<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%8E%B0%E8%B1%A1/2808631">现象</a>可以用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%A1%8C%E4%B8%BA%E9%87%91%E8%9E%8D%E5%AD%A6/58795">行为金融学</a>中的“<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8D%9F%E5%A4%B1%E5%8E%8C%E6%81%B6/2921704">损失厌恶</a>”理论来解释，该理论认为一定量的损失给人们带来的效用降低要多过相同的收益给人们带来的效用增加。因此人们在决策过程中对利害的权衡是不均衡的，对“避害”的考虑远大于对“趋利”的考虑。出于对损失的畏惧，人们在出卖商品时往往索要过高的价格。</p>
<h2 id="第十五章：-羊群效应：人为什么喜欢模仿"><a href="#第十五章：-羊群效应：人为什么喜欢模仿" class="headerlink" title="第十五章： 羊群效应：人为什么喜欢模仿"></a>第十五章： 羊群效应：人为什么喜欢模仿</h2><p>羊群效应：人类的群体模仿行为</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A69.png"></p>
<p>人有盲目跟从的冲动 。</p>
<p>镜像神经元：来体会别人的感受</p>
<h2 id="第十六章：-当前偏差-拖延症是怎么来的？"><a href="#第十六章：-当前偏差-拖延症是怎么来的？" class="headerlink" title="第十六章： 当前偏差 拖延症是怎么来的？"></a>第十六章： 当前偏差 拖延症是怎么来的？</h2><p>当前偏差：当前的折现率会高于未来的折现率。会导致我们更看重当前的快乐。</p>
<p>原因：错配</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A610.png"></p>
<p>当前偏差和讲话语言有没有未来时态有关</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A611.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A612.png"></p>
<p>自控是需要消耗能量的，累的时候更难自控</p>
<p>冥想有助于增加前额皮层的灰质 </p>
<p>呼吸变慢有助于让你冷静</p>
<h2 id="第17讲-市场情绪：怎么衡量非理性？"><a href="#第17讲-市场情绪：怎么衡量非理性？" class="headerlink" title="第17讲 市场情绪：怎么衡量非理性？"></a>第17讲 市场情绪：怎么衡量非理性？</h2><p>投资者情绪高：投资者对它有过分的需求，过高的预期，并非基本面的原因</p>
<p>各种偏差的总结。</p>
<p>投资者心情影响股票市场。 </p>
<p>投资者心情可能受到月亮的影响。</p>
<p>罪恶股票和社会价值股票的差异</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A613.png"></p>
<p>如何测量市场情绪？</p>
<p>ipo数量， 新开账户等。</p>
<p>百度指数 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A613.png"></p>
<h2 id="第18讲-低风险策略：低风险可以有高收益么？"><a href="#第18讲-低风险策略：低风险可以有高收益么？" class="headerlink" title="第18讲 低风险策略：低风险可以有高收益么？"></a>第18讲 低风险策略：低风险可以有高收益么？</h2><h2 id="第19讲-高品质策略：巴菲特真的喜欢价值投资么？"><a href="#第19讲-高品质策略：巴菲特真的喜欢价值投资么？" class="headerlink" title="第19讲 高品质策略：巴菲特真的喜欢价值投资么？"></a>第19讲 高品质策略：巴菲特真的喜欢价值投资么？</h2><p>大佬的投资策略</p>
<p>索罗斯和沃森 ：低风险高收益</p>
<p>巴菲特： 高品质投资， 价值投资</p>
<h2 id="第20讲-量化投资的风险有哪些？"><a href="#第20讲-量化投资的风险有哪些？" class="headerlink" title="第20讲 量化投资的风险有哪些？"></a>第20讲 量化投资的风险有哪些？</h2><p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A615.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A616.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A617.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A618.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A619.png"></p>
<p>量化投资策略三个风险： </p>
<p>失效风险</p>
<p>流通性风险 </p>
<p>模型风险</p>
<h2 id="第二十一讲：-量化投资误区有哪些？"><a href="#第二十一讲：-量化投资误区有哪些？" class="headerlink" title="第二十一讲： 量化投资误区有哪些？"></a>第二十一讲： 量化投资误区有哪些？</h2><p>1 基本面好就会收益率高，不一定。 国家GDP增速好不一定股票表现好， 新新行业不一定比老行业收益率高。 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A620.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A621.png"></p>
<p>2 AI 投资不一定比人好。 </p>
<p>3 智能投顾效果有限</p>
<p>4 在国外市场得出的经验不一定在中国有效</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yuanwanli</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>




  





</body>
</html>
