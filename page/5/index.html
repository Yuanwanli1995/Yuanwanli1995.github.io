<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yuanwanli1995.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/./public/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="等不是办法，干才有出路">
<meta property="og:type" content="website">
<meta property="og:title" content="brisk">
<meta property="og:url" content="http://yuanwanli1995.github.io/page/5/index.html">
<meta property="og:site_name" content="brisk">
<meta property="og:description" content="等不是办法，干才有出路">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="yuanwanli">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yuanwanli1995.github.io/page/5/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/5/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>brisk</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">brisk</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">welcome</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yuanwanli</p>
  <div class="site-description" itemprop="description">等不是办法，干才有出路</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">78</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/12/15/2021-12-14-influxdb/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/15/2021-12-14-influxdb/" class="post-title-link" itemprop="url">influxdb</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-15 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-15T00:00:00+08:00">2021-12-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>97  2021-12-10 16:05:20 wget  <a target="_blank" rel="noopener" href="https://dl.influxdata.com/influxdb/releases/influxdb-1.8.0.x86_64.rpm">https://dl.influxdata.com/influxdb/releases/influxdb-1.8.0.x86_64.rpm</a><br>   98  2021-12-10 16:06:43 yum localinstall -y influxdb-1.8.0.x86_64.rpm</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/12/15/2021-12-15-git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%9A%84%E5%B8%B8%E8%A7%84%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/15/2021-12-15-git%E7%89%88%E6%9C%AC%E6%8E%A7%E5%88%B6%E7%9A%84%E5%B8%B8%E8%A7%84%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">git版本控制的常规用法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-15 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-15T00:00:00+08:00">2021-12-15</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-22 16:04:37" itemprop="dateModified" datetime="2022-02-22T16:04:37+08:00">2022-02-22</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>[TOC]</p>
<p>最近在改服务器上改代码的时候，每次都要在本地备份，有时在本地改完还要同步，搞多个版本把我自己都搞乱了，是时候使用git了。 我的需求之一就是在多台机器上操作，能够同步，在服务器上能下载最新的版本， 更改后再更新到仓库，git可以解决我的需求，github作为仓库，有的时候网络不稳定，gitee更快一点，所以就选择gitee作为远程仓库。</p>
<h3 id="gitee"><a href="#gitee" class="headerlink" title="gitee"></a>gitee</h3><p>首先要创建gitee账户，再新建仓库。 </p>
<h3 id="linux系统"><a href="#linux系统" class="headerlink" title="linux系统"></a>linux系统</h3><p>安装git , 配置密钥，然后就可以拉取或者更新。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"># 源里有git，直接yum安装即可</span><br><span class="line">yum -y install git</span><br><span class="line"># 新建一个文件夹，作为gitee仓库交互的仓库</span><br><span class="line">mkdir gitee &amp;&amp; cd gitee </span><br><span class="line"># git 初始化</span><br><span class="line">git init </span><br><span class="line"># 初始化一个.git文件，是一个工作目录， 保存status, 克隆是不需要的.git的, 查找.git顺序， 同级目录，上级目录。</span><br><span class="line"># 配置用户</span><br><span class="line">git config --global user.name &quot;yuanwl&quot;</span><br><span class="line">git config --global user.email &quot;yuan.wanli@qq.com&quot;</span><br><span class="line"># 配置远端地址 - 目标远程仓库的下载链接 #origin 远端仓库本地名称</span><br><span class="line">git remote add origin https://gitee.com/yuanwl/k8s.git</span><br><span class="line"># 会生成一些配置文件，看一下</span><br><span class="line">[root@node61 gitee]# ll -a</span><br><span class="line">drwxr-xr-x   8 root root 4096 Dec 15 15:39 .git</span><br><span class="line">[root@node61 gitee]# ll -a .git/</span><br><span class="line">total 60</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec 15 10:39 branches </span><br><span class="line"># 分支</span><br><span class="line">-rw-r--r--  1 root root    5 Dec 15 15:31 COMMIT_EDITMSG</span><br><span class="line"># commit 信息  </span><br><span class="line">-rw-r--r--  1 root root  352 Dec 15 15:39 config  ---远端配置文件在这里</span><br><span class="line"># 配置文件</span><br><span class="line">-rw-r--r--  1 root root   73 Dec 15 10:39 description</span><br><span class="line">-rw-r--r--  1 root root   82 Dec 15 14:35 FETCH_HEAD</span><br><span class="line">-rw-r--r--  1 root root   23 Dec 15 10:39 HEAD</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec 15 10:39 hooks</span><br><span class="line"># 命令</span><br><span class="line">-rw-r--r--  1 root root 1241 Dec 15 15:30 index</span><br><span class="line">drwxr-xr-x  2 root root 4096 Dec 15 10:39 info </span><br><span class="line">drwxr-xr-x  3 root root 4096 Dec 15 10:45 logs</span><br><span class="line"># 日志</span><br><span class="line">drwxr-xr-x 55 root root 4096 Dec 15 14:56 objects </span><br><span class="line">-rw-r--r--  1 root root   41 Dec 15 14:35 ORIG_HEAD</span><br><span class="line">drwxr-xr-x  5 root root 4096 Dec 15 14:36 refs </span><br><span class="line"># 许多文件也不清楚作用， 但应该git配置和操作的信息都在这</span><br></pre></td></tr></table></figure>

<p>git配置后之后，已经可以和gitee或其他线上仓库交互了，比如拉取一个仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">git clone origin https://gitee.com/yuanwl/k8s.git</span><br><span class="line"># 或者</span><br><span class="line">git pull origin https://gitee.com/yuanwl/k8s.git</span><br></pre></td></tr></table></figure>

<p>可以在本地修改同步到远程仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 例如刚修改了 README.md, 提交到暂存区</span><br><span class="line">git add README.md </span><br><span class="line"># 这就告诉了git, 做了哪些修改</span><br><span class="line">git commit -m &quot;test&quot;</span><br><span class="line"># commit就是确认提交到了本地仓库， -m 的参数是这次提交的注释，虽然写注释有点麻烦，但是写一下还是有用的，知道是提交了什么 </span><br><span class="line">git push  </span><br><span class="line"># 之后会提示输入用户和密码，然后就可以提交了</span><br></pre></td></tr></table></figure>

<p>这是一个变更同步到仓库的过程，第一次接触可能会疑问，为什么不能一步到位，要三个命令才能同步呢？这是因为git的工作台机制，为了版本控制。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/git.drawio.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"># 测试</span><br><span class="line">[root@node61 k8s]#echo &quot;this is a test &quot;work stage&quot;&quot; &gt;&gt; test.md </span><br><span class="line"># 更改后查看状态， not staged </span><br><span class="line">[root@node61 k8s]# git status  </span><br><span class="line"># On branch master</span><br><span class="line"># Changes not staged for commit:</span><br><span class="line">#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">#   (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">#</span><br><span class="line">#	modified:   test.md</span><br><span class="line">#</span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br><span class="line">[root@node61 k8s]# git add test.md</span><br><span class="line"># add后查看状态， not commited </span><br><span class="line">[root@node61 k8s]# git status </span><br><span class="line"># On branch master</span><br><span class="line"># Changes to be committed:</span><br><span class="line">#   (use &quot;git reset HEAD &lt;file&gt;...&quot; to unstage)</span><br><span class="line">#</span><br><span class="line">#	modified:   test.md</span><br><span class="line">#</span><br><span class="line">[root@node61 k8s]# git commit -m &quot;1&quot;</span><br><span class="line">[master 31f1e76] 1</span><br><span class="line"> 1 file changed, 1 insertion(+), 1 deletion(-)</span><br><span class="line"> # commit后查看状态， 没有push</span><br><span class="line">[root@node61 k8s]# git status</span><br><span class="line"># On branch master</span><br><span class="line"># Your branch is ahead of &#x27;origin/master&#x27; by 1 commit.</span><br><span class="line">#   (use &quot;git push&quot; to publish your local commits)</span><br><span class="line">#</span><br><span class="line">nothing to commit, working directory clean</span><br><span class="line">[root@node61 k8s]# git push </span><br><span class="line">Counting objects: 5, done.</span><br><span class="line">Compressing objects: 100% (2/2), done.</span><br><span class="line">Writing objects: 100% (3/3), 271 bytes | 0 bytes/s, done.</span><br><span class="line">Total 3 (delta 1), reused 0 (delta 0)</span><br><span class="line">remote: Powered by GITEE.COM [GNK-6.2]</span><br><span class="line">To https://gitee.com/yuanwl/k8s.git</span><br><span class="line">   d664e8f..31f1e76  master -&gt; master</span><br><span class="line"># push之后，工作台干净了</span><br><span class="line">[root@node61 k8s]# git status</span><br><span class="line"># On branch master</span><br><span class="line">nothing to commit, working directory clean</span><br></pre></td></tr></table></figure>

<p>这样搞清了每一步要干啥，但麻烦的是每次都要输入账号密码。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># 可以配置记住密码</span><br><span class="line">git config --global credential.helper store</span><br><span class="line"># 产生一个文件 /root/.gitconfig</span><br><span class="line">[root@VM-4-15-centos ~]# cat .gitconfig </span><br><span class="line">[credential]</span><br><span class="line">	helper = store</span><br><span class="line">[user]</span><br><span class="line">	email = yuan.wanli@qq.com</span><br><span class="line">	name = yuanwl</span><br><span class="line"># 记录了账号与用户 </span><br><span class="line"># 然后执行git pull 之后， 就会记住密码，存在/root/.git-credentials以后就不用输入了</span><br><span class="line">[root@VM-4-15-centos ~]# cat .git-credentials </span><br><span class="line">https://yuanwl:123456789@gitee.com</span><br><span class="line"># 这问题明显了，密码明文可见，一点都不安全，平时自己用用测试是可以的</span><br></pre></td></tr></table></figure>

<p>ssh免密登陆</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 删除原有的通信方式 # 可选</span><br><span class="line">git remote rm origin </span><br><span class="line"># 生成密钥</span><br><span class="line">ssh-keygen </span><br><span class="line"># 将公钥~/.ssh/id_rsa.pub放在gitee公钥上，设置--ssh公钥--添加</span><br><span class="line"># 添加ssh路径，git开头，和http路径不同 </span><br><span class="line">git init git remote add origin </span><br><span class="line">git remote add origin git@gitee.com:uxpi/zsites.git</span><br><span class="line"># 测试 </span><br><span class="line">[root@node61 ~]# ssh -T git@gitee.com</span><br><span class="line">Hi yuanwanli! You&#x27;ve successfully authenticated, but GITEE.COM does not provide shell access. </span><br><span class="line"># 然后就可以免密提交了</span><br></pre></td></tr></table></figure>

<h3 id="windows"><a href="#windows" class="headerlink" title="windows"></a>windows</h3><p>我很多时候是在window多台主机上做修改。windows中在官网<a target="_blank" rel="noopener" href="https://www.git-scm.com/download/win">Git - Downloading Package (git-scm.com)</a>下载git应用，安装一路next即可。 </p>
<p>新建同步文件夹之后，右键选择 git bash here. 之后操作就和linux一样了。 </p>
<h3 id="进一步使用"><a href="#进一步使用" class="headerlink" title="进一步使用"></a>进一步使用</h3><p><strong>删除文件</strong>， 如果删除了一个文件， 就不能git add filename ，可以使用 <code>git rm</code>确认删除了，然后commit.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">rm -f test.md </span><br><span class="line">git rm test.md </span><br><span class="line"># 这样可能比较麻烦，有时也会忘，也没有关系。 如果在add 的时候提示： </span><br><span class="line">warning: You ran &#x27;git add&#x27; with neither &#x27;-A (--all)&#x27; or &#x27;--ignore-removal&#x27;,</span><br><span class="line">whose behaviour will change in Git 2.0 with respect to paths you removed.</span><br><span class="line">Paths like &#x27;test.md&#x27; that are</span><br><span class="line">removed from your working tree are ignored with this version of Git.</span><br><span class="line"></span><br><span class="line">* &#x27;git add --ignore-removal &lt;pathspec&gt;&#x27;, which is the current default,</span><br><span class="line">  ignores paths you removed from your working tree.</span><br><span class="line"></span><br><span class="line">* &#x27;git add --all &lt;pathspec&gt;&#x27; will let you also record the removals.</span><br><span class="line"># 这时候再使用， git add -A 或者 git add --ignore-removal 也可以。</span><br><span class="line"># 也可以直接用git rm test.md</span><br></pre></td></tr></table></figure>

<p>另一种情况是， 如果是<strong>误删</strong>呢？ 也可有恢复<code>checkout</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@node61 k8s]# git checkout -- test.md</span><br><span class="line">[root@node61 k8s]# ls </span><br><span class="line">-rw-r--r-- 1 root root  320 Dec 16 16:04  test.md</span><br><span class="line"># 文件回来了, 但只有commit之后才能恢复，没有commit的东西git根本不知道，也无法恢复。</span><br></pre></td></tr></table></figure>

<p>如果我第二天不知道自己昨天改了什么呢？<code>git diff</code> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node61 k8s]# git diff test.md</span><br><span class="line">diff --git a/test.md b/test.md</span><br><span class="line">index 90bfcb5..2178a28 100644</span><br><span class="line">--- a/test.md</span><br><span class="line">+++ b/test.md</span><br><span class="line">@@ -1 +1,2 @@</span><br><span class="line"> this is a test</span><br><span class="line">+this is a test</span><br></pre></td></tr></table></figure>
<p>如果我不知道现在改的文件有没有提交怎么办呢？<code>git status</code> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">[root@node61 k8s]# git status test.md</span><br><span class="line"># On branch master</span><br><span class="line"># Your branch is ahead of &#x27;origin/master&#x27; by 1 commit.</span><br><span class="line">#   (use &quot;git push&quot; to publish your local commits)</span><br><span class="line">#</span><br><span class="line"># Changes not staged for commit:</span><br><span class="line">#   (use &quot;git add &lt;file&gt;...&quot; to update what will be committed)</span><br><span class="line">#   (use &quot;git checkout -- &lt;file&gt;...&quot; to discard changes in working directory)</span><br><span class="line">#</span><br><span class="line">#	modified:   test.md</span><br><span class="line">#</span><br><span class="line">no changes added to commit (use &quot;git add&quot; and/or &quot;git commit -a&quot;)</span><br></pre></td></tr></table></figure>

<p>当然了，在实际工作中，我们脑子里怎么可能记得一个几千行的文件每次都改了什么内容，不然要版本控制系统干什么。版本控制系统肯定有某个命令可以告诉我们<strong>历史记录</strong>，在Git中，我们用<code>git log</code>可以查看：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@node61 k8s]# git log</span><br><span class="line">commit 088a4167f946247ced6766c58ffd0568369ce69d</span><br><span class="line">Author: yuanwl &lt;yuan.wanli@qq.com&gt;</span><br><span class="line">Date:   Thu Dec 16 11:41:56 2021 +0800</span><br><span class="line">    first commit </span><br><span class="line">commit ca0ffde7153d0f4eee8473cfa23797835ed74ae9</span><br><span class="line">Merge: e72ac3d 259e9bf</span><br><span class="line"># 可以看最近三次的提交日志 </span><br></pre></td></tr></table></figure>

<p><strong>版本回退</strong>，如果我提交了错误的修改，可以回退到上个版本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@node61 k8s]# git reset --hard HEAD^</span><br><span class="line">HEAD is now at 818a7ff test</span><br><span class="line"># 也可以根据版本commit 版本号回退， git reflog</span><br><span class="line">[root@node61 k8s]# git reflog</span><br><span class="line">d664e8f HEAD@&#123;0&#125;: pull: Fast-forward</span><br><span class="line">818a7ff HEAD@&#123;1&#125;: reset: moving to HEAD^</span><br><span class="line">d664e8f HEAD@&#123;2&#125;: pull: Fast-forward</span><br><span class="line">818a7ff HEAD@&#123;3&#125;: commit: test</span><br><span class="line">088a416 HEAD@&#123;4&#125;: clone: from https://gitee.com/yuanwl/k8s.git</span><br><span class="line">[root@node61 k8s]# git reset HEAD 818a7ff</span><br></pre></td></tr></table></figure>

<h3 id="分支合并"><a href="#分支合并" class="headerlink" title="分支合并"></a>分支合并</h3><p>分支合并是git中最核心的操作， 开始的时候只有一条分支master, 这样的问题是如果多人一起开发，那么可能出现每次push都会遇到别人修改的仓库。每个人一个分支, 在本地修改好再同步到master， 保证master是稳定的，其余分支是工作的。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/gitbranch.drawio.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"># 创建分支 </span><br><span class="line">git branch lenovo </span><br><span class="line"># 切换分支  </span><br><span class="line">git checkout lenovo </span><br><span class="line"># pull 特定分支</span><br><span class="line">git pull -b main url</span><br><span class="line"># 切换到一个新的分支 git checkout -b levono </span><br><span class="line"># 查看分支 , 当前的分支前有星号 </span><br><span class="line">$ git branch</span><br><span class="line">* lenovo</span><br><span class="line">  master</span><br><span class="line"># 在levono分支修改后，切换回master分支是看不到修改内容的，需要同步一下。 </span><br><span class="line">git merge lenovo </span><br><span class="line"># 同步有两种情况： </span><br><span class="line"># 1 lenovo只是新增了内容， 没有冲突， 可以快速合并 </span><br><span class="line"># 2 lenovo上修改了内容，两条分支内容有冲突， 所以需要手动确认内容。 下面是冲突的情况</span><br><span class="line"># lenovo 中 tesk.md 如下： </span><br><span class="line">$ cat test.md</span><br><span class="line">which is the stable branch?</span><br><span class="line">lenovo</span><br><span class="line"></span><br><span class="line"># master 中tesk.md 如下：</span><br><span class="line">$ cat test.md</span><br><span class="line">which is the stable branch?</span><br><span class="line">master</span><br><span class="line"></span><br><span class="line"># 这是两个分支是有冲突的， git merge之后回提示需要手动解决冲突，冲突会在test.md文档中标记</span><br><span class="line">$ cat test.md</span><br><span class="line">which is the stable branch?</span><br><span class="line">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD   # 当前指向 </span><br><span class="line">master</span><br><span class="line">=======</span><br><span class="line">lenovo</span><br><span class="line">&gt;&gt;&gt;&gt;&gt;&gt;&gt; lenovo  # lenovo分支内容  </span><br><span class="line"></span><br><span class="line"># 需要手动修改文档成最终我们需要的内容,然后commit就同步了 </span><br><span class="line">$ cat test.md</span><br><span class="line">which is the stable branch?</span><br><span class="line">master</span><br><span class="line"></span><br><span class="line"># 删除分支 </span><br><span class="line">git checkout -d lenovo </span><br><span class="line"></span><br><span class="line"># 本地lenovo分支推送远程master分支 </span><br><span class="line">git push origin lenovo:master</span><br><span class="line"></span><br><span class="line"># 拉取远程master到本地lenovo分子</span><br><span class="line">git pull origin master:lenovo</span><br><span class="line"># 总结就是 git push/pull origin  &lt;源仓库名称&gt;:&lt;目标仓库名称&gt;</span><br></pre></td></tr></table></figure>

<h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a>标签</h3><p>tag就是一个让人容易记住的有意义的名字，它跟某个commit绑在一起。 发布一个版本时，我们通常先在版本库中打一个标签（tag），这样，就唯一确定了打标签时刻的版本。将来无论什么时候，取某个标签的版本，就是把那个打标签的时刻的历史版本取出来。所以，标签也是版本库的一个快照。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"># 标签是commit的称呼，所以先看commit </span><br><span class="line">$ git log --abbrev-commit</span><br><span class="line">commit 0e8c272 (HEAD -&gt; master, tag: v3.0)</span><br><span class="line">Author: yuanwanli &lt;yuan.wanli@qq.com&gt;</span><br><span class="line">Date:   Sun Dec 19 10:52:18 2021 +0800</span><br><span class="line"></span><br><span class="line">    add C 10.53</span><br><span class="line"></span><br><span class="line">commit 98ea6fb</span><br><span class="line">Author: yuanwanli &lt;yuan.wanli@qq.com&gt;</span><br><span class="line">Date:   Sun Dec 19 10:51:54 2021 +0800</span><br><span class="line"></span><br><span class="line">    add b 10.52</span><br><span class="line"></span><br><span class="line">commit 8350365</span><br><span class="line">Author: yuanwanli &lt;yuan.wanli@qq.com&gt;</span><br><span class="line">Date:   Sun Dec 19 10:51:22 2021 +0800</span><br><span class="line"></span><br><span class="line">    add a 10.51</span><br><span class="line"># 给最近的修改加标签 </span><br><span class="line">$ git ag v3.0 0e8c272</span><br><span class="line">$ git tag v2.0 98ea6fb</span><br><span class="line"></span><br><span class="line"># 查看标签列表 </span><br><span class="line">$ git tag</span><br><span class="line">v2.0</span><br><span class="line">v3.0</span><br><span class="line"></span><br><span class="line"># 查看标签明细</span><br><span class="line">$ git show v3.0</span><br><span class="line">commit 0e8c272709f6ac07155849fd7d0d3727161bf1f6 (HEAD -&gt; master, tag: v3.0)</span><br><span class="line">Author: yuanwanli &lt;yuan.wanli@qq.com&gt;</span><br><span class="line">Date:   Sun Dec 19 10:52:18 2021 +0800</span><br><span class="line"></span><br><span class="line">    add C 10.53</span><br><span class="line"></span><br><span class="line">diff --git a/test.md b/test.md</span><br><span class="line">index 422c2b7..de98044 100644</span><br><span class="line">--- a/test.md</span><br><span class="line">+++ b/test.md</span><br><span class="line">@@ -1,2 +1,3 @@</span><br><span class="line"> a</span><br><span class="line"> b</span><br><span class="line">+c</span><br><span class="line"></span><br><span class="line"># 标签推送，讲v3.0推送到远端仓库</span><br><span class="line">$ git push origin v3.0</span><br><span class="line">Enumerating objects: 18, done.</span><br><span class="line">Counting objects: 100% (18/18), done.</span><br><span class="line">Delta compression using up to 8 threads</span><br><span class="line">Compressing objects: 100% (11/11), done.</span><br><span class="line">Writing objects: 100% (16/16), 1.20 KiB | 204.00 KiB/s, done.</span><br><span class="line">Total 16 (delta 7), reused 0 (delta 0), pack-reused 0</span><br><span class="line">remote: Powered by GITEE.COM [GNK-6.2]</span><br><span class="line">To https://gitee.com/yuanwl/k8s.git</span><br><span class="line"> * [new tag]         v3.0 -&gt; v3.0</span><br><span class="line"></span><br><span class="line"># 标签删除</span><br><span class="line">$ git tag -d v2.0</span><br><span class="line">Deleted tag &#x27;v2.0&#x27; (was 98ea6fb)</span><br></pre></td></tr></table></figure>

<h3 id="问题解决"><a href="#问题解决" class="headerlink" title="问题解决"></a>问题解决</h3><p>在push的时候遇到这样一个错误</p>
<p>error: failed to push some refs to ‘<a target="_blank" rel="noopener" href="https://gitee.com/yuanwl/k8s.git&#39;">https://gitee.com/yuanwl/k8s.git&#39;</a><br>Updates were rejected because the remote contains work that you do<br>not have locally. This is usually caused by another repository pushing<br>to the same ref. You may want to first merge the remote changes (e.g.,<br>hint: ‘git pull’) before pushing again.</p>
<p>就是线上的仓库在上次我clone之后有了改动(是我删了一个文件)， 这样不能直接commit, </p>
<p>git会记下上次pull的版本，如果pull之后远程又做了修改，无法直接push, 这也很好理解，git不知道如何处理远程仓库的改动。</p>
<p>可以使用git pull同步。</p>
<h3 id="简易git"><a href="#简易git" class="headerlink" title="简易git"></a>简易git</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">简易的命令行入门教程:</span><br><span class="line">Git 全局设置:</span><br><span class="line"></span><br><span class="line">git config --global user.name &quot;yuanwanli&quot;</span><br><span class="line">git config --global user.email &quot;yuan.wanli@qq.com&quot;</span><br><span class="line">创建 git 仓库:</span><br><span class="line"></span><br><span class="line">mkdir autoblog</span><br><span class="line">cd autoblog</span><br><span class="line">git init </span><br><span class="line">touch README.md</span><br><span class="line">git add README.md</span><br><span class="line">git commit -m &quot;first commit&quot;</span><br><span class="line">git remote add origin https://gitee.com/yuanwl/autoblog.git</span><br><span class="line">git push -u origin &quot;master&quot;</span><br><span class="line">已有仓库?</span><br><span class="line"></span><br><span class="line">cd existing_git_repo</span><br><span class="line">git remote add origin https://gitee.com/yuanwl/autoblog.git</span><br><span class="line">git push -u origin &quot;master&quot;</span><br></pre></td></tr></table></figure>





<h3 id="gitsubmodule"><a href="#gitsubmodule" class="headerlink" title="gitsubmodule"></a>gitsubmodule</h3><p>面对比较复杂的项目，我们有可能会将代码根据功能拆解成不同的子模块。主项目对子模块有依赖关系，却又并不关心子模块的内部开发流程细节。</p>
<p>这种情况下，通常不会把所有源码都放在同一个 Git 仓库中。</p>
<p>有一种比较简单的方式，是在当前工作目录下，将子模块文件夹加入到 <code>.gitignore</code> 文件内容中，这样主项目就能够无视子项目的存在。这样做有一个弊端就是，使用主项目的人需要有一个先验知识：需要在当前目录下放置一份某版本的子模块代码。</p>
<p>.gitignore是始终忽略这些文件，也不上传。</p>
<p>还有另外一种方式可供借鉴，可以使用 Git 的 <code>submodule</code> 功能，实际上 Git 工具的 <code>submodule</code> 功能就是建立了当前项目与子模块之间的依赖关系：<code>子模块路径</code>、<code>子模块的远程仓库</code>、<code>子模块的版本号</code>。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 创建子项目</span><br><span class="line">git submodule add &lt;submodule_url&gt;  </span><br><span class="line"></span><br><span class="line">drwxr-xr-x 9 root root 4096 Feb 15 17:26 .git</span><br><span class="line">-rw-r--r-- 1 root root   67 Feb 15 17:25 .gitmodules</span><br><span class="line">drwxr-xr-x 2 root root 4096 Feb 15 17:25 md</span><br><span class="line">多了三个文件</span><br><span class="line">git add </span><br><span class="line">git commit -m &#x27;add sub module &#x27; </span><br><span class="line"></span><br><span class="line"># 获取子项目代码</span><br><span class="line">pull  --recurse-submodules</span><br><span class="line">#</span><br><span class="line">git submodule init</span><br><span class="line">git submodule update </span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/12/13/2021-12-13-promethus%E8%81%94%E9%82%A6+-%E8%BF%9C%E7%A8%8B%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8+-%E5%8F%AF%E8%A7%86%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/13/2021-12-13-promethus%E8%81%94%E9%82%A6+-%E8%BF%9C%E7%A8%8B%E6%8C%81%E4%B9%85%E5%8C%96%E5%AD%98%E5%82%A8+-%E5%8F%AF%E8%A7%86%E5%8C%96/" class="post-title-link" itemprop="url">promethus联邦+ 远程持久化存储+ 可视化</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-13 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-13T00:00:00+08:00">2021-12-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="联邦集群"><a href="#联邦集群" class="headerlink" title="联邦集群"></a>联邦集群</h3><p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%81%94%E9%82%A6%E9%9B%86%E7%BE%A4.png">    </p>
<h3 id="实验架构"><a href="#实验架构" class="headerlink" title="实验架构"></a>实验架构</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 两个集群</span><br><span class="line"># prometheus_cluster1</span><br><span class="line"># prometheus_cluster2 </span><br><span class="line"># 一个主机承担 </span><br><span class="line"># prometheus_master + influxdb + grafana</span><br></pre></td></tr></table></figure>

<h3 id="实验操作"><a href="#实验操作" class="headerlink" title="实验操作"></a>实验操作</h3><h4 id="1-集群部署prometheus"><a href="#1-集群部署prometheus" class="headerlink" title="1 集群部署prometheus"></a>1 集群部署prometheus</h4><p>集群部署文件存在gitee/k8s仓库</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git clone https://gitee.com/yuanwl/k8s.git</span><br><span class="line">cd  k8s/pig</span><br><span class="line"># 新建一个监控namespace</span><br><span class="line">kubectl apply -f monitor.ns.yml</span><br><span class="line">cd prometheus</span><br><span class="line"># 启动prometheus监控</span><br><span class="line">kubectl apply -f  </span><br><span class="line"># 测试可以访问</span><br><span class="line">http://&lt;node_ip&gt;/graph</span><br></pre></td></tr></table></figure>

<ol>
<li>多个k8s集群，这里两个集群，并且已经配置prometheus服务，接口分别是: </li>
</ol>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">- &#x27;1.13.92.201:30003&#x27;</span><br><span class="line">- &#x27;1.13.102.83:30003&#x27;</span><br><span class="line"># 测试http://1.13.102.83:30003/graph 可查当前数据中心数据即可</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>一个主机 main </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1.117.61.155 centOS 7.6 2C4G</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="主机main配置"><a href="#主机main配置" class="headerlink" title="主机main配置"></a>主机main配置</h3><h4 id="1-配置influxdb"><a href="#1-配置influxdb" class="headerlink" title="1 配置influxdb"></a>1 配置influxdb</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 下载</span><br><span class="line">wget https://dl.influxdata.com/influxdb/releases/influxdb-1.8.1.x86_64.rpm </span><br><span class="line"># 安装</span><br><span class="line">yum -y localinstall influxdb-1.8.1.x86_64.rpm </span><br><span class="line"># 配置/etc/influxdb/influxdb.conf 开启http </span><br><span class="line"># 新建一个database </span><br><span class="line">curl -XPOST http://localhost:8086/query --data-urlencode &quot;q=CREATE DATABASE prometheus&quot;</span><br></pre></td></tr></table></figure>

<p>也可以docker启动influxdb </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">#使用docker-compose定义并启动Influxdb数据库服务，docker-compose.yml定义如下：</span><br><span class="line"></span><br><span class="line">version: &#x27;2&#x27;</span><br><span class="line">services:</span><br><span class="line">  influxdb:</span><br><span class="line">    image: influxdb:1.3.5</span><br><span class="line">    command: -config /etc/influxdb/influxdb.conf</span><br><span class="line">    ports:</span><br><span class="line">      - &quot;8086:8086&quot;</span><br><span class="line">    environment:</span><br><span class="line">      - INFLUXDB_DB=prometheus</span><br><span class="line">      - INFLUXDB_ADMIN_ENABLED=true</span><br><span class="line">      - INFLUXDB_ADMIN_USER=admin</span><br><span class="line">      - INFLUXDB_ADMIN_PASSWORD=admin</span><br><span class="line">      - INFLUXDB_USER=prom</span><br><span class="line">      - INFLUXDB_USER_PASSWORD=prom</span><br><span class="line"># 启动influxdb服务</span><br><span class="line">docker-compose up -d</span><br><span class="line">docker ps</span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES</span><br><span class="line">795d0ead87a1        influxdb:1.3.5      &quot;/entrypoint.sh -c...&quot;   3 hours ago         Up 3 hours          0.0.0.0:8086-&gt;8086/tcp   localhost_influxdb_1</span><br><span class="line"># 获取并启动Prometheus提供的Remote Storage Adapter：</span><br><span class="line"># 先配置golang , 官方下载安装包，再添加路径</span><br><span class="line"># go get 下载并编译</span><br><span class="line">go get github.com/prometheus/prometheus/documentation/examples/remote_storage/remote_storage_adapter</span><br><span class="line"># 获取remote_storage_adapter源码后，go会自动把相关的源码编译成可执行文件，并且保存在$GOPATH/bin/目录下。</span><br><span class="line"></span><br><span class="line"># 启动remote_storage_adapter并且设置Influxdb相关的认证信息：</span><br><span class="line"></span><br><span class="line">INFLUXDB_PW=prom $GOPATH/bin/remote_storage_adapter -influxdb-url=http://localhost:8086 -influxdb.username=prom -influxdb.database=prometheus -influxdb.retention-policy=autogen</span><br></pre></td></tr></table></figure>



<h4 id="2-配置prometheus"><a href="#2-配置prometheus" class="headerlink" title="2 配置prometheus"></a>2 配置prometheus</h4><p>使用docker或者安装包部署prometheus都可以，这里使用安装包</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"># 1 下载安装包prometheus-1.6.2.linux-amd64.tar.gz</span><br><span class="line">https://github.com/prometheus/prometheus/releases/tag/v1.6.2</span><br><span class="line"># 2 解压</span><br><span class="line">tar -xvf prometheus-1.6.2.linux-amd64.tar.gz</span><br><span class="line">cd prometheus-1.6.2.linux-amd64</span><br><span class="line"># 3 配置prometheus.yml， 配置prometheus联邦，拉取两个cluster的数据。</span><br><span class="line"></span><br><span class="line">cat &gt; prometheus.yml &lt;&lt; EOF</span><br><span class="line"># my global config</span><br><span class="line">global:</span><br><span class="line">  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.</span><br><span class="line">  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.</span><br><span class="line">  # scrape_timeout is set to the global default (10s).</span><br><span class="line"></span><br><span class="line">  # Attach these labels to any time series or alerts when communicating with</span><br><span class="line">  # external systems (federation, remote storage, Alertmanager).</span><br><span class="line">  external_labels:</span><br><span class="line">      monitor: &#x27;codelab-monitor&#x27;</span><br><span class="line"></span><br><span class="line"># Load rules once and periodically evaluate them according to the global &#x27;evaluation_interval&#x27;.</span><br><span class="line">rule_files:</span><br><span class="line">  # - &quot;first.rules&quot;</span><br><span class="line">  # - &quot;second.rules&quot;</span><br><span class="line"></span><br><span class="line"># A scrape configuration containing exactly one endpoint to scrape:</span><br><span class="line"># Here it&#x27;s Prometheus itself.</span><br><span class="line">scrape_configs:</span><br><span class="line">  - job_name: &#x27;federate&#x27;</span><br><span class="line">    scrape_interval: 15s</span><br><span class="line"></span><br><span class="line">    honor_labels: true</span><br><span class="line">    metrics_path: &#x27;/federate&#x27;</span><br><span class="line"># 联邦集群</span><br><span class="line">    params:</span><br><span class="line">      &#x27;match[]&#x27;:</span><br><span class="line">        - &#x27;&#123;job=&quot;prometheus&quot;&#125;&#x27;</span><br><span class="line">        - &#x27;&#123;job=&quot;kubernetes-apiservers&quot;&#125;&#x27;</span><br><span class="line">        - &#x27;&#123;job=&quot;kubernetes-nodes&quot;&#125;&#x27;</span><br><span class="line">        - &#x27;&#123;job=&quot;kubernetes-cadvisor&quot;&#125;&#x27;</span><br><span class="line">        - &#x27;&#123;job=&quot;kubernetes-service-endpoints&quot;&#125;&#x27;</span><br><span class="line">        - &#x27;&#123;job=&quot;kubernetes-services&quot;&#125;&#x27;</span><br><span class="line">        - &#x27;&#123;job=&quot;kubernetes-ingresses&quot;&#125;&#x27;</span><br><span class="line">        - &#x27;&#123;job=&quot;kubernetes-pods&quot;&#125;&#x27;</span><br><span class="line">        - &#x27;&#123;__name__=~&quot;job:.*&quot;&#125;&#x27;</span><br><span class="line"># 这里抓的matrics与集群prometheus服务中的job匹配</span><br><span class="line">#    static_configs:</span><br><span class="line">#      - targets:</span><br><span class="line">#        - &#x27;1.13.92.201:30003&#x27;</span><br><span class="line">#        - &#x27;1.13.102.83:30003&#x27;</span><br><span class="line"># 配置数据中心， 集群任意节点加nodeport端口 </span><br><span class="line"># 为了在展示中心展示数据中心的名称， 可在grafanaz主机添加host,然后通过名称导入</span><br><span class="line">    static_configs:</span><br><span class="line">      - targets:</span><br><span class="line">        - &#x27;cluster1:30003&#x27;</span><br><span class="line">        - &#x27;cluster2:30003&#x27;</span><br><span class="line"># 使用名称后需要加个数据中心的标签重写， 并加入正则匹配数据中心</span><br><span class="line">    relabel_configs:</span><br><span class="line">      - source_labels:  [&quot;__address__&quot;]</span><br><span class="line">        target_label: &quot;data_center&quot;</span><br><span class="line">        regex: (.+):\d*</span><br><span class="line"># 远程读写</span><br><span class="line">#remote_write:</span><br><span class="line"># - url: &quot;http://localhost:8086/api/v1/prom/write?db=prometheus&quot;       </span><br><span class="line">EOF</span><br><span class="line"># /etc/hosts配置</span><br><span class="line">cluster1 1.13.92.201</span><br><span class="line">cluster2 11.13.102.83</span><br><span class="line"># 4 启动</span><br><span class="line">nohup ./prometheus -config.file=prometheus.yml &gt; myout.file  2&gt;&amp;1 &amp;</span><br><span class="line"></span><br><span class="line"># 5 WEB页面访问http://1.117.61.155:9090/ ，可以看到两个数据中心</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/prom.png"></p>
<h4 id="3-配置grafana"><a href="#3-配置grafana" class="headerlink" title="3 配置grafana"></a>3 配置grafana</h4><p>面配置grafana展示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># 1 下载 </span><br><span class="line">wget https://dl.grafana.com/oss/release/grafana-6.7.1-1.x86_64.rpm</span><br><span class="line"># 2 安装</span><br><span class="line">yum -y install grafana-6.7.1-1.x86_64.rpm</span><br><span class="line"># 3 启动服务， 默认配置即可</span><br><span class="line">systemctl restart grafana-server.service</span><br><span class="line">systemctl enable grafana-server.service  </span><br><span class="line"># 4 默认端口3000 </span><br><span class="line">http://&lt;ip&gt;:3000 访问</span><br><span class="line"># 5 配置数据源为promethues, http://1.117.61.155:9090/ </span><br></pre></td></tr></table></figure>

<p>数据源配置具体部分省略，也已经同步到influxdb仓库中。 </p>
<p>grafana的面板配置在k8s/grafana中，可直接导入json生成面板。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/12/10/2021-12-10-linux%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/10/2021-12-10-linux%E5%B8%B8%E7%94%A8%E5%BF%AB%E6%8D%B7%E9%94%AE/" class="post-title-link" itemprop="url">linux常用快捷键</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-10 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-10T00:00:00+08:00">2021-12-10</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>linux中常用的快捷键，总结备查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">tab # 命令或路径等的补全键，linux用的最多的一个快捷键 </span><br><span class="line"># 光标移动</span><br><span class="line">ctrl+a # 光标回到行首 </span><br><span class="line">ctrl+e # 光标回到行尾</span><br><span class="line">ctrl+f # 光标向右移动一个字符 forwards</span><br><span class="line">ctrl+b # 光标向左移动一个字符 behind</span><br><span class="line">esc+. # 注意那个&quot;.“ 意思是获取上一条命令的(以空格为分隔符)最后的部分</span><br><span class="line">esc+b # 移动到当前单词的开头</span><br><span class="line">esc+f # 移动到当前单词的结尾</span><br><span class="line"># 剪切 </span><br><span class="line">ctrl+u # 剪切光标处到行首的所有字符, 也就是删除</span><br><span class="line">ctrl+k # 剪切光标处到行尾的所有字符</span><br><span class="line">ctrl+w # 剪切光标前的一个单词(word)</span><br><span class="line">ctrl+h # 删除光标前的一个字符（相当于退格键）</span><br><span class="line"># 粘贴</span><br><span class="line">ctrl+y # 粘贴 ctrl+k、ctrl+u、ctrl+w 删除的字符</span><br><span class="line"># 中断</span><br><span class="line">ctrl+c # 中断终端正在执行的任务并开启一个新的一行</span><br><span class="line">ctrl+z # 暂停在终端运行的任务,使用&quot;fg&quot;命令可以使暂停恢复</span><br><span class="line">ctrl+d # 退出当前shell命令行，如果是切换过来的用户，则执行这个命令回退到原用户</span><br><span class="line"># 清空</span><br><span class="line">ctrl+l # 清空屏幕所有的内容，并开启一个新的一行，等价于clear,似乎比clear快一点</span><br><span class="line"># 锁定</span><br><span class="line">ctrl+s # 锁定终端，使之任何人无法输入</span><br><span class="line">ctrl+q # 解锁ctrl+s的锁定状态</span><br><span class="line"># 历史命令</span><br><span class="line">ctrl+r # 搜索命令行使用过的历史命令记录，比history好用一点</span><br><span class="line">ctrl+g # 从ctrl+r的搜索历史命令模式中退出</span><br><span class="line">!! # 执行上一条命令 </span><br><span class="line">!commdand # 这是一个例子，是执行以ommdand开头的命令，这里的ommdand可以换成任何已经执行过的字符</span><br><span class="line">!commdand:p # 这是一个例子，是仅打印以commdand开头的命令，但不执行，最后的那个“p”是命令固定字符</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以上命令不区分大小写，如ctrl+a与ctrl+A效果相同</p>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/12/09/2021-12-09-promQL/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/09/2021-12-09-promQL/" class="post-title-link" itemprop="url">promQL</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-09 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-09T00:00:00+08:00">2021-12-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>Prometheus的自定义查询语言PromQL(promtheus query language) 。通过PromQL用户可以非常方便地对监控样本数据进行统计分析，PromQL支持常见的运算操作符，同时PromQL中还提供了大量的内置函数可以实现对数据的高级处理。PromQL作为Prometheus的核心能力除了实现数据的对外查询和展现，同时告警监控也是依赖PromQL实现的。</p>
<p>promql本质上和sql没什么不同，根据不同的标签查询数据麻。只是promtheus是时序性数据库，使其和关系性数据库有区别。所系我们需要先了解Prometheus的样本数据模型。</p>
<h3 id="1-prometheus样本数据模型"><a href="#1-prometheus样本数据模型" class="headerlink" title="1 prometheus样本数据模型"></a>1 prometheus样本数据模型</h3><p>Prometheus会将所有采集到的样本数据以时间序列（time-series）的方式保存在内存数据库中，并且定时保存到硬盘上。</p>
<p>在time-series中的每一个点称为一个样本（sample），样本由以下三部分组成：</p>
<ul>
<li>指标(metric)：metric name和描述当前样本特征的labelsets;</li>
<li>时间戳(timestamp)：一个精确到毫秒的时间戳;</li>
<li>样本值(value)： 一个float64的浮点型数据表示当前样本的值。</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;--------------- metric ---------------------&gt;&lt;-timestamp -&gt;&lt;-value-&gt;</span><br><span class="line">http_request_total&#123;status=&quot;200&quot;, method=&quot;GET&quot;&#125;@1434417560938 =&gt; 94355</span><br><span class="line">http_request_total&#123;status=&quot;200&quot;, method=&quot;GET&quot;&#125;@1434417561287 =&gt; 94334</span><br><span class="line"></span><br><span class="line">http_request_total&#123;status=&quot;404&quot;, method=&quot;GET&quot;&#125;@1434417560938 =&gt; 38473</span><br><span class="line">http_request_total&#123;status=&quot;404&quot;, method=&quot;GET&quot;&#125;@1434417561287 =&gt; 38544</span><br><span class="line"></span><br><span class="line">http_request_total&#123;status=&quot;200&quot;, method=&quot;POST&quot;&#125;@1434417560938 =&gt; 4748</span><br><span class="line">http_request_total&#123;status=&quot;200&quot;, method=&quot;POST&quot;&#125;@1434417561287 =&gt; 4785</span><br></pre></td></tr></table></figure>

<p>样本点的集合成为集合(vector)</p>
<h3 id="2-指标-metric"><a href="#2-指标-metric" class="headerlink" title="2 指标(metric)"></a>2 指标(metric)</h3><p>在形式上，所有的指标(Metric)都通过如下格式标示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;metric name&gt;&#123;&lt;label name&gt;=&lt;label value&gt;, ...&#125;</span><br></pre></td></tr></table></figure>

<p>指标的名称(metric name)可以反映被监控样本的含义（比如，<code>http_request_total</code> - 表示当前系统接收到的HTTP请求总量）。</p>
<p>标签(label)反映了当前样本的特征维度，通过这些维度Prometheus可以对样本数据进行过滤，聚合等。</p>
<p>在Prometheus的存储实现上所有的监控样本都是以time-series的形式保存在Prometheus内存的TSDB（时序数据库）中，而time-series所对应的监控指标(metric)也是通过labelset进行唯一命名的。</p>
<p>从存储上来讲所有的监控指标metric都是相同的，但是根据不同的展示需求，可以讲metric分为不同的类型。</p>
<p>Prometheus定义了4中不同的指标类型(metric type)：Counter（计数器）、Gauge（仪表盘）、Histogram（直方图）、Summary（摘要）。如果要看累计的值，比如访问总量就是Counter。看瞬时的值比如当前内存剩余就是gauge。而histogram</p>
<p>在Exporter返回的样本数据中，其注释中也包含了该样本的类型。例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># HELP node_cpu Seconds the cpus spent in each mode.</span><br><span class="line"># TYPE node_cpu counter</span><br><span class="line">node_cpu&#123;cpu=&quot;cpu0&quot;,mode=&quot;idle&quot;&#125; 362812.7890625</span><br></pre></td></tr></table></figure>

<h4 id="Counter：只增不减的计数器"><a href="#Counter：只增不减的计数器" class="headerlink" title="Counter：只增不减的计数器"></a>Counter：只增不减的计数器</h4><p>Counter类型的指标其工作方式和计数器一样，只增不减（除非系统发生重置）。常见的监控指标，如http_requests_total，node_cpu都是Counter类型的监控指标。 一般在定义Counter类型指标的名称时推荐使用_total作为后缀。</p>
<p>Counter是一个简单但有强大的工具，例如我们可以在应用程序中记录某些事件发生的次数，通过以时序的形式存储这些数据，我们可以轻松的了解该事件产生速率的变化。 PromQL内置的聚合操作和函数可以让用户对这些数据进行进一步的分析：</p>
<p>例如，通过rate()函数获取HTTP请求量的增长率：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rate(http_requests_total[5m])</span><br></pre></td></tr></table></figure>

<p>查询当前系统中，访问量前10的HTTP地址：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">topk(10, http_requests_total)</span><br></pre></td></tr></table></figure>

<h4 id="Gauge：可增可减的仪表盘"><a href="#Gauge：可增可减的仪表盘" class="headerlink" title="Gauge：可增可减的仪表盘"></a>Gauge：可增可减的仪表盘</h4><p>与Counter不同，Gauge类型的指标侧重于反应系统的当前状态。因此这类指标的样本数据可增可减。常见指标如：node_memory_MemFree（主机当前空闲的内容大小）、node_memory_MemAvailable（可用内存大小）都是Gauge类型的监控指标。</p>
<p>通过Gauge指标，用户可以直接查看系统的当前状态：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">node_memory_MemFree</span><br></pre></td></tr></table></figure>

<p>对于Gauge类型的监控指标，通过PromQL内置函数delta()可以获取样本在一段时间返回内的变化情况。例如，计算CPU温度在两个小时内的差异：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">delta(cpu_temp_celsius&#123;host=&quot;zeus&quot;&#125;[2h])</span><br></pre></td></tr></table></figure>

<p>还可以使用deriv()计算样本的线性回归模型，甚至是直接使用predict_linear()对数据的变化趋势进行预测。例如，预测系统磁盘空间在4个小时之后的剩余情况：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">predict_linear(node_filesystem_free&#123;job=&quot;node&quot;&#125;[1h], 4 * 3600)</span><br></pre></td></tr></table></figure>

<h4 id="分布情况——Histogram和Summary"><a href="#分布情况——Histogram和Summary" class="headerlink" title="分布情况——Histogram和Summary"></a>分布情况——Histogram和Summary</h4><p>除了Counter和Gauge类型的监控指标以外，Prometheus还定义了Histogram和Summary的指标类型。Histogram和Summary主用用于统计和分析样本的分布情况。</p>
<p>在大多数情况下人们都倾向于使用某些量化指标的平均值，例如CPU的平均使用率、页面的平均响应时间。这种方式的问题很明显，以系统API调用的平均响应时间为例：如果大多数API请求都维持在100ms的响应时间范围内，而个别请求的响应时间需要5s，那么就会导致某些WEB页面的响应时间落到中位数的情况，而这种现象被称为长尾问题。</p>
<p>为了区分是平均的慢还是长尾的慢，最简单的方式就是按照请求延迟的范围进行分组。例如，统计延迟在0<del>10ms之间的请求数有多少而10</del>20ms之间的请求数又有多少。通过这种方式可以快速分析系统慢的原因。Histogram和Summary都是为了能够解决这样问题的存在，通过Histogram和Summary类型的监控指标，我们可以快速了解监控样本的分布情况。</p>
<p>例如，指标prometheus_tsdb_wal_fsync_duration_seconds的指标类型为Summary。 它记录了Prometheus Server中wal_fsync处理的处理时间，通过访问Prometheus Server的/metrics地址，可以获取到以下监控样本数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># HELP prometheus_tsdb_wal_fsync_duration_seconds Duration of WAL fsync.</span><br><span class="line"># TYPE prometheus_tsdb_wal_fsync_duration_seconds summary</span><br><span class="line">prometheus_tsdb_wal_fsync_duration_seconds&#123;quantile=&quot;0.5&quot;&#125; 0.012352463</span><br><span class="line">prometheus_tsdb_wal_fsync_duration_seconds&#123;quantile=&quot;0.9&quot;&#125; 0.014458005</span><br><span class="line">prometheus_tsdb_wal_fsync_duration_seconds&#123;quantile=&quot;0.99&quot;&#125; 0.017316173</span><br><span class="line">prometheus_tsdb_wal_fsync_duration_seconds_sum 2.888716127000002</span><br><span class="line">prometheus_tsdb_wal_fsync_duration_seconds_count 216</span><br></pre></td></tr></table></figure>

<p>从上面的样本中可以得知当前Prometheus Server进行wal_fsync操作的总次数为216次，耗时2.888716127000002s。其中中位数（quantile=0.5）的耗时为0.012352463，9分位数（quantile=0.9）的耗时为0.014458005s。</p>
<p>在Prometheus Server自身返回的样本数据中，我们还能找到类型为Histogram的监控指标prometheus_tsdb_compaction_chunk_range_bucket。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># HELP prometheus_tsdb_compaction_chunk_range Final time range of chunks on their first compaction</span><br><span class="line"># TYPE prometheus_tsdb_compaction_chunk_range histogram</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;100&quot;&#125; 0</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;400&quot;&#125; 0</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;1600&quot;&#125; 0</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;6400&quot;&#125; 0</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;25600&quot;&#125; 0</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;102400&quot;&#125; 0</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;409600&quot;&#125; 0</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;1.6384e+06&quot;&#125; 260</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;6.5536e+06&quot;&#125; 780</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;2.62144e+07&quot;&#125; 780</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_bucket&#123;le=&quot;+Inf&quot;&#125; 780</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_sum 1.1540798e+09</span><br><span class="line">prometheus_tsdb_compaction_chunk_range_count 780</span><br></pre></td></tr></table></figure>

<p>与Summary类型的指标相似之处在于Histogram类型的样本同样会反应当前指标的记录的总数(以_count作为后缀)以及其值的总量（以_sum作为后缀）。不同在于Histogram指标直接反应了在不同区间内样本的个数，区间通过标签len进行定义。</p>
<p>同时对于Histogram的指标，我们还可以通过histogram_quantile()函数计算出其值的分位数。不同在于Histogram通过histogram_quantile函数是在服务器端计算的分位数。 而Sumamry的分位数则是直接在客户端计算完成。因此对于分位数的计算而言，Summary在通过PromQL进行查询时有更好的性能表现，而Histogram则会消耗更多的资源。反之对于客户端而言Histogram消耗的资源更少。在选择这两种方式时用户应该按照自己的实际场景进行选择。</p>
<h3 id="3-promQL"><a href="#3-promQL" class="headerlink" title="3 promQL"></a>3 promQL</h3><p>Prometheus通过指标名称（metrics name）以及对应的一组标签（labelset）唯一定义一条时间序列。指标名称反映了监控样本的基本标识，而label则在这个基本特征上为采集到的数据提供了多种特征维度。用户可以基于这些特征维度过滤，聚合，统计从而产生新的计算后的一条时间序列。</p>
<p>PromQL是Prometheus内置的数据查询语言，其提供对时间序列数据丰富的查询，聚合以及逻辑运算能力的支持。并且被广泛应用在Prometheus的日常应用当中，包括对数据查询、可视化、告警处理当中。</p>
<h4 id="查询时间序列"><a href="#查询时间序列" class="headerlink" title="查询时间序列"></a>查询时间序列</h4><p>当Prometheus通过Exporter采集到相应的监控指标样本数据后，我们就可以通过PromQL对监控样本数据进行查询。</p>
<p>当我们直接使用监控指标名称查询时，可以查询该指标下的所有时间序列。如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total</span><br></pre></td></tr></table></figure>

<p>等同于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>该表达式会返回指标名称为http_requests_total的所有时间序列：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;code=&quot;200&quot;,handler=&quot;alerts&quot;,instance=&quot;localhost:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;&#125;=(20889@1518096812.326)</span><br><span class="line">http_requests_total&#123;code=&quot;200&quot;,handler=&quot;graph&quot;,instance=&quot;localhost:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;&#125;=(21287@1518096812.326)</span><br></pre></td></tr></table></figure>

<p>PromQL还支持用户根据时间序列的标签匹配模式来对时间序列进行过滤，目前主要支持两种匹配模式：完全匹配和正则匹配。</p>
<p>PromQL支持使用<code>=</code>和<code>!=</code>两种完全匹配模式：</p>
<ul>
<li>通过使用<code>label=value</code>可以选择那些标签满足表达式定义的时间序列；</li>
<li>反之使用<code>label!=value</code>则可以根据标签匹配排除时间序列；</li>
</ul>
<p>例如，如果我们只需要查询所有http_requests_total时间序列中满足标签instance为localhost:9090的时间序列，则可以使用如下表达式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;instance=&quot;localhost:9090&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>反之使用<code>instance!=&quot;localhost:9090&quot;</code>则可以排除这些时间序列：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;instance!=&quot;localhost:9090&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>除了使用完全匹配的方式对时间序列进行过滤以外，PromQL还可以支持使用正则表达式作为匹配条件，多个表达式之间使用<code>|</code>进行分离：</p>
<ul>
<li>使用<code>label=~regx</code>表示选择那些标签符合正则表达式定义的时间序列；</li>
<li>反之使用<code>label!~regx</code>进行排除；</li>
</ul>
<p>例如，如果想查询多个环节下的时间序列序列可以使用如下表达式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;environment=~&quot;staging|testing|development&quot;,method!=&quot;GET&quot;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="范围查询"><a href="#范围查询" class="headerlink" title="范围查询"></a>范围查询</h2><p>直接通过类似于PromQL表达式http*requests*total查询时间序列时，返回值中只会包含该时间序列中的最新的一个样本值，这样的返回结果我们称之为<strong>瞬时向量</strong>。而相应的这样的表达式称之为__瞬时向量表达式**。</p>
<p>而如果我们想过去一段时间范围内的样本数据时，我们则需要使用<strong>区间向量表达式</strong>。区间向量表达式和瞬时向量表达式之间的差异在于在区间向量表达式中我们需要定义时间选择的范围，时间范围通过时间范围选择器<code>[]</code>进行定义。例如，通过以下表达式可以选择最近5分钟内的所有样本数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http_request_total&#123;&#125;[5m]</span><br></pre></td></tr></table></figure>

<p>该表达式将会返回查询到的时间序列中最近5分钟的所有样本数据：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">http_requests_total&#123;code=&quot;200&quot;,handler=&quot;alerts&quot;,instance=&quot;localhost:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;&#125;=[</span><br><span class="line">    1@1518096812.326</span><br><span class="line">    1@1518096817.326</span><br><span class="line">    1@1518096822.326</span><br><span class="line">    1@1518096827.326</span><br><span class="line">    1@1518096832.326</span><br><span class="line">    1@1518096837.325</span><br><span class="line">]</span><br><span class="line">http_requests_total&#123;code=&quot;200&quot;,handler=&quot;graph&quot;,instance=&quot;localhost:9090&quot;,job=&quot;prometheus&quot;,method=&quot;get&quot;&#125;=[</span><br><span class="line">    4 @1518096812.326</span><br><span class="line">    4@1518096817.326</span><br><span class="line">    4@1518096822.326</span><br><span class="line">    4@1518096827.326</span><br><span class="line">    4@1518096832.326</span><br><span class="line">    4@1518096837.325</span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>通过区间向量表达式查询到的结果我们称为<strong>区间向量</strong>。</p>
<p>除了使用m表示分钟以外，PromQL的时间范围选择器支持其它时间单位：</p>
<ul>
<li>s - 秒</li>
<li>m - 分钟</li>
<li>h - 小时</li>
<li>d - 天</li>
<li>w - 周</li>
<li>y - 年</li>
</ul>
<h2 id="时间位移操作"><a href="#时间位移操作" class="headerlink" title="时间位移操作"></a>时间位移操作</h2><p>在瞬时向量表达式或者区间向量表达式中，都是以当前时间为基准：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http_request_total&#123;&#125; # 瞬时向量表达式，选择当前最新的数据</span><br><span class="line">http_request_total&#123;&#125;[5m] # 区间向量表达式，选择以当前时间为基准，5分钟内的数据</span><br></pre></td></tr></table></figure>

<p>而如果我们想查询，5分钟前的瞬时样本数据，或昨天一天的区间内的样本数据呢? 这个时候我们就可以使用位移操作，位移操作的关键字为<strong>offset</strong>。</p>
<p>可以使用offset时间位移操作：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http_request_total&#123;&#125; offset 5m</span><br><span class="line">http_request_total&#123;&#125;[1d] offset 1d</span><br></pre></td></tr></table></figure>

<h2 id="使用聚合操作"><a href="#使用聚合操作" class="headerlink" title="使用聚合操作"></a>使用聚合操作</h2><p>一般来说，如果描述样本特征的标签(label)在并非唯一的情况下，通过PromQL查询数据，会返回多条满足这些特征维度的时间序列。而PromQL提供的聚合操作可以用来对这些时间序列进行处理，形成一条新的时间序列：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># 查询系统所有http请求的总量</span><br><span class="line">sum(http_request_total)</span><br><span class="line"></span><br><span class="line"># 按照mode计算主机CPU的平均使用时间</span><br><span class="line">avg(node_cpu) by (mode)</span><br><span class="line"></span><br><span class="line"># 按照主机查询各个主机的CPU使用率</span><br><span class="line">sum(sum(irate(node_cpu&#123;mode!=&#x27;idle&#x27;&#125;[5m]))  / sum(irate(node_cpu[5m]))) by (instance)</span><br></pre></td></tr></table></figure>

<h2 id="标量和字符串"><a href="#标量和字符串" class="headerlink" title="标量和字符串"></a>标量和字符串</h2><p>除了使用瞬时向量表达式和区间向量表达式以外，PromQL还直接支持用户使用标量(Scalar)和字符串(String)。</p>
<h3 id="标量（Scalar）：一个浮点型的数字值"><a href="#标量（Scalar）：一个浮点型的数字值" class="headerlink" title="标量（Scalar）：一个浮点型的数字值"></a>标量（Scalar）：一个浮点型的数字值</h3><p>标量只有一个数字，没有时序。</p>
<p>例如：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">10</span><br></pre></td></tr></table></figure>

<blockquote>
<p>需要注意的是，当使用表达式count(http_requests_total)，返回的数据类型，依然是瞬时向量。用户可以通过内置函数scalar()将单个瞬时向量转换为标量。</p>
</blockquote>
<h3 id="字符串（String）：一个简单的字符串值"><a href="#字符串（String）：一个简单的字符串值" class="headerlink" title="字符串（String）：一个简单的字符串值"></a>字符串（String）：一个简单的字符串值</h3><p>直接使用字符串，作为PromQL表达式，则会直接返回字符串。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&quot;this is a string&quot;</span><br><span class="line">&#x27;these are unescaped: \n \\ \t&#x27;</span><br><span class="line">`these are not unescaped: \n &#x27; &quot; \t`</span><br></pre></td></tr></table></figure>

<h2 id="合法的PromQL表达式"><a href="#合法的PromQL表达式" class="headerlink" title="合法的PromQL表达式"></a>合法的PromQL表达式</h2><p>所有的PromQL表达式都必须至少包含一个指标名称(例如http_request_total)，或者一个不会匹配到空字符串的标签过滤器(例如{code=”200”})。</p>
<p>因此以下两种方式，均为合法的表达式：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">http_request_total # 合法</span><br><span class="line">http_request_total&#123;&#125; # 合法</span><br><span class="line">&#123;method=&quot;get&quot;&#125; # 合法</span><br></pre></td></tr></table></figure>

<p>而如下表达式，则不合法：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;job=~&quot;.*&quot;&#125; # 不合法</span><br></pre></td></tr></table></figure>

<p>同时，除了使用<code>&lt;metric name&gt;&#123;label=value&#125;</code>的形式以外，我们还可以使用内置的<code>__name__</code>标签来指定监控指标名称：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;__name__=~&quot;http_request_total&quot;&#125; # 合法</span><br><span class="line">&#123;__name__=~&quot;node_disk_bytes_read|node_disk_bytes_written&quot;&#125; # 合法</span><br></pre></td></tr></table></figure>

<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>224a31b93706e3592cb8961318638e3dca071f41</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/12/08/2021-12-08-curl-k8s%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/08/2021-12-08-curl-k8s%E9%83%A8%E7%BD%B2%E6%9C%8D%E5%8A%A1/" class="post-title-link" itemprop="url">curl k8s部署服务</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-08 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-08T00:00:00+08:00">2021-12-08</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>curl –insecure -sfL <a target="_blank" rel="noopener" href="https://1.13.14.236/v3/import/c2mpgqvfmt8xfx2qss2qqvtrb9jh77f7d4x4tq8vxshk9t4jwbwbdg.yaml">https://1.13.14.236/v3/import/c2mpgqvfmt8xfx2qss2qqvtrb9jh77f7d4x4tq8vxshk9t4jwbwbdg.yaml</a> | kubectl apply -f -</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/12/06/2021-12-06-grafana%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%A6%BB%E7%BA%BF%E6%8F%92%E4%BB%B6%E4%B8%8B%E8%BD%BD/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/06/2021-12-06-grafana%E9%83%A8%E7%BD%B2%E4%B8%8E%E7%A6%BB%E7%BA%BF%E6%8F%92%E4%BB%B6%E4%B8%8B%E8%BD%BD/" class="post-title-link" itemprop="url">grafana部署与离线插件下载</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-06 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-06T00:00:00+08:00">2021-12-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><p>grafana使用yum下载非常方便</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># wget https://dl.grafana.com/oss/release/grafana-6.7.1-1.x86_64.rpm</span><br><span class="line"># yum -y install grafana-6.7.1-1.x86_64.rpm</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">启动grafana并设置开机自启动</span><br><span class="line"># systemctl restart grafana-server.service</span><br><span class="line"># systemctl enable grafana-server.service </span><br></pre></td></tr></table></figure>

<p>默认3000端口，<a href="http://ip:3000即可访问，默认用户密码为admin。">http://ip:3000即可访问，默认用户密码为admin。</a> </p>
<h3 id="插件安装"><a href="#插件安装" class="headerlink" title="插件安装"></a>插件安装</h3><p>grafana插件下载都是外站，有时网络不稳定下载不了，采用离线下载的方式也不麻烦。</p>
<p>以grafana-cli plugins install alexanderzobnin-zabbix-app 为例。</p>
<p>使用命令grafana-cli plugins install </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grafana-cli plugins install alexanderzobnin-zabbix-app </span><br></pre></td></tr></table></figure>

<p>若超时，就手动下载吧。 </p>
<p>先去官网下载安装包，<a target="_blank" rel="noopener" href="https://grafana.com/grafana/plugins?orderBy=weight&amp;direction=asc">https://grafana.com/grafana/plugins?orderBy=weight&amp;direction=asc</a> </p>
<p>搜索需要的插件，选好与grafana版本匹配的版本。 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/grafana.png"></p>
<p>可点击download the .zip file下载，也可wget直接下载。</p>
<p>获取下载地址，<a target="_blank" rel="noopener" href="https://grafana.com/api/plugins/alexanderzobnin-zabbix-app/versions/3.12.0/download">https://grafana.com/api/plugins/alexanderzobnin-zabbix-app/versions/3.12.0/download</a> </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># wget获取</span><br><span class="line">wget https://grafana.com/api/plugins/alexanderzobnin-zabbix-app/versions/3.12.0/download  -O zabbix.zip </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 解压 </span><br><span class="line">unzip zabbix.zip</span><br><span class="line"># 移动到plugins 文件夹中 </span><br><span class="line">mv alexanderzobnin-grafana-zabbix-d0e8319/  /var/lib/grafana/plugins/</span><br><span class="line"># 重启grafana-server使生效。 </span><br><span class="line"> systemctl restart grafana-server </span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/12/06/2021-12-06-%E9%80%9A%E8%BF%87kubeconfig%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/12/06/2021-12-06-%E9%80%9A%E8%BF%87kubeconfig%E6%96%87%E4%BB%B6%E7%AE%A1%E7%90%86%E9%9B%86%E7%BE%A4/" class="post-title-link" itemprop="url">通过kubeconfig文件管理集群</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-12-06 00:00:00" itemprop="dateCreated datePublished" datetime="2021-12-06T00:00:00+08:00">2021-12-06</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>kubeconfig是与集群交互的身份认证，有集群的kubeconfig文件即可与其交互。 </p>
<h3 id="安装kubectl"><a href="#安装kubectl" class="headerlink" title="安装kubectl"></a>安装kubectl</h3><p>交互的工具就是kubectl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget http://rancher-mirror.cnrancher.com/kubectl/v1.21.4/linux-amd64-v1.21.4-kubectl</span><br><span class="line">mv linux-amd64-v1.21.4-kubectl /usr/local/bin/kubectl</span><br><span class="line">chmod +x /usr/local/bin/kubectl</span><br></pre></td></tr></table></figure>

<h3 id="下载或者写入kubeconfig文件"><a href="#下载或者写入kubeconfig文件" class="headerlink" title="下载或者写入kubeconfig文件"></a>下载或者写入kubeconfig文件</h3><p>这里我是从腾讯云TKE起的集群，直接下载集群的kubeconfig文件。 </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@monitor01 ~]# ll</span><br><span class="line">-rw-r--r-- 1 root root    4675 Dec  6 17:09 mytest_kubeconfig</span><br></pre></td></tr></table></figure>

<h3 id="配置-kube-config"><a href="#配置-kube-config" class="headerlink" title="配置~/.kube/config"></a>配置~/.kube/config</h3><p>如果当前kubectl没有管理的集群，那么没有~/.kube/config文件，则新建一个，如果有，省略这一步。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">touch ~/.kube/config</span><br></pre></td></tr></table></figure>

<p>若当前访问客户端已配置了其他集群的访问凭证，可并执行以下指令以合并多个集群的 config</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">KUBECONFIG=~/.kube/config:~/mytest_kubeconfig kubectl config view --merge --flatten &gt; ~/.kube/config</span><br><span class="line">export KUBECONFIG=~/.kube/config</span><br></pre></td></tr></table></figure>

<blockquote>
<p>其中，~/mytest_kubeconfig为集群的 kubeconfig 的文件路径，请替换为下载至本地后的实际路径。</p>
</blockquote>
<h3 id="访问-Kubernetes-集群"><a href="#访问-Kubernetes-集群" class="headerlink" title="访问 Kubernetes 集群"></a>访问 Kubernetes 集群</h3><p>完成 kubeconfig 配置后，执行以下指令查看并切换 context 以访问本集群：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@monitor root]# kubectl config get-contexts</span><br><span class="line">CURRENT   NAME                   CLUSTER                AUTHINFO   NAMESPACE</span><br><span class="line">*         test1                  test1                  test1  </span><br><span class="line">[root@monitor root]# kubectl config use-context &quot;test1&quot;</span><br><span class="line">Switched to context &quot;test1&quot;.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>test1 为集群名称</p>
</blockquote>
<p>而后可执行 kubectl get node 测试是否可正常访问集群。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@monitor01 root]# kubectl get node</span><br><span class="line">NAME             STATUS   ROLES                      AGE   VERSION</span><br><span class="line">k8s-node01       Ready    controlplane,etcd,worker   81m   v1.19.15</span><br><span class="line">k8s-node02       Ready    controlplane,etcd,worker   85m   v1.19.15</span><br><span class="line">k8s-node03       Ready    controlplane,etcd,worker   81m   v1.19.15</span><br><span class="line">k8s-node04       Ready    controlplane,etcd,worker   85m   v1.19.15</span><br></pre></td></tr></table></figure>

<p>可以访问了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/11/29/2021-11-29-%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4-%E9%80%9A%E8%BF%87RKE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/29/2021-11-29-%E4%B8%80%E9%94%AE%E9%83%A8%E7%BD%B2%E9%9B%86%E7%BE%A4-%E9%80%9A%E8%BF%87RKE/" class="post-title-link" itemprop="url">脚本一键部署k8s集群</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-29 00:00:00" itemprop="dateCreated datePublished" datetime="2021-11-29T00:00:00+08:00">2021-11-29</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/k8s/" itemprop="url" rel="index"><span itemprop="name">k8s</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>使用rke部署集群时，虽然已经很方便了，但是如果节点个数较多，每个节点要手动配置，防火墙，selinux, iptables等等。还是挺麻烦的， 这些配置每个节点都一样，完全可以通过脚本批量配置。 </p>
<p>过程参考<a href="%5BRKE%E9%83%A8%E7%BD%B2K8S_%E4%BA%8C%E9%83%8E%E9%93%B6%E7%9A%84%E5%8D%9A%E5%AE%A2-CSDN%E5%8D%9A%E5%AE%A2%5D(https://blog.csdn.net/weixin_43705953/article/details/120879544)">RKE部署K8S</a> </p>
<p><strong>脚本主要分为四个部分</strong>： </p>
<ol>
<li> 批量配置服务器环境</li>
<li> 配置免密登录 </li>
<li> 自动生成cluster.yml文件</li>
<li> 下载安装RKE,部署集群。 </li>
</ol>
<p>主要使用的工具就是expecet, 关于expcet的使用参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/iloveyoucc/archive/2012/05/11/2496433.html">expect用法 </a></p>
<p>在配置固定时， 我们只需要了解，节点的ip, 账号及密码。 先将这些信息写入ip.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@VM-16-15-centos ~]# cat ip.txt </span><br><span class="line">10.206.16.8 root 123456</span><br><span class="line">10.206.16.4 root 123456</span><br><span class="line">10.206.16.7 root 123456</span><br><span class="line">10.206.16.9 root 123456</span><br><span class="line">10.206.16.2 root 123456</span><br></pre></td></tr></table></figure>

<p><strong>脚本如下</strong>： </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br></pre></td><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">help ()</span><br><span class="line">&#123;</span><br><span class="line">    echo  &#x27; ================================================================ &#x27;</span><br><span class="line">    echo  &#x27; 脚本没有参数，请在ip.txt中写入ip地址，用户及其密码&#x27;</span><br><span class="line">    echo  &#x27; 如果rke或kubectl下载失败请手动下载或者翻墙或者国外节点&#x27;</span><br><span class="line">    echo  &#x27; ================================================================&#x27;</span><br><span class="line">&#125;</span><br><span class="line">case &quot;$1&quot; in</span><br><span class="line">    -h|--help) help; exit;;</span><br><span class="line">esac</span><br><span class="line">if [[ $1 == &#x27;&#x27; ]];then</span><br><span class="line">    help;</span><br><span class="line">    exit;</span><br><span class="line">fi</span><br><span class="line">rke_user=&quot;rke&quot;</span><br><span class="line">rpm -qa | grep &quot;expect&quot; </span><br><span class="line">if [ $? -eq 0 ]</span><br><span class="line">then</span><br><span class="line">  echo &quot;expect installed&quot;</span><br><span class="line">else</span><br><span class="line">  yum install -y expect</span><br><span class="line">fi</span><br><span class="line">cat ip.txt | while read line  #使用while命令循环登录主机进行配置</span><br><span class="line">do</span><br><span class="line">  ip=`echo $&#123;line&#125;|awk  &#x27;&#123;print $1&#125;&#x27;`  #ip地址</span><br><span class="line">  user=`echo $&#123;line&#125;|awk  &#x27;&#123;print $2&#125;&#x27;`</span><br><span class="line">  passwd=`echo $&#123;line&#125;|awk  &#x27;&#123;print $3&#125;&#x27;`</span><br><span class="line">  set timeout 30</span><br><span class="line">  expect &lt;&lt; EOF </span><br><span class="line">    spawn ssh $user@$ip</span><br><span class="line">    expect &#123;</span><br><span class="line">        &quot;yes/no&quot; &#123; send &quot;yes\r&quot;;exp_continue &#125;</span><br><span class="line">        &quot;password&quot; &#123; send &quot;$passwd\r&quot;;exp_continue &#125;</span><br><span class="line">        &quot;already installed&quot; &#123; send &quot;\r&quot;&#125;</span><br><span class="line">      &#125;</span><br><span class="line">    # expect &quot;yes/no&quot;; send &quot;yes\r&quot;</span><br><span class="line">    # expect &quot;password&quot;; send &quot;$passwd\r&quot;</span><br><span class="line">    # 基本配置 </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;hostnamectl set-hostname node$&#123;ip: 6&#125;\r&quot; </span><br><span class="line">     # 配置hostname，缺一个计数器  </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;systemctl stop firewalld\r&quot; </span><br><span class="line">     # 关闭防火墙 </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;systemctl disable firewalld\r&quot;  </span><br><span class="line">     # 关闭防火墙自启动</span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;echo \`date +\&quot;%Y-%m-%d %H:%M:%S\&quot;\` firewalld diabled &gt; /root/.k8s.log\r&quot;   </span><br><span class="line">     # 日志</span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;swapoff -a\r&quot; </span><br><span class="line">      # 关闭swap  </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab\r&quot;  </span><br><span class="line">     # 永久关闭swap   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;echo \`date +\&quot;%Y-%m-%d %H:%M:%S\&quot;\` swap diabled &gt;&gt; /root/.k8s.log\r&quot;   </span><br><span class="line">     # 日志</span><br><span class="line">    </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;setenforce 0\r&quot; </span><br><span class="line">     #  关闭selinux</span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27; /etc/selinux/config\r&quot; </span><br><span class="line">      # 永久关闭selinux  </span><br><span class="line">    # expect &quot;*root&quot; ; send  &quot;yum install ntpdate -y\r &quot;  # 安装ntpdate  </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;ntpdate time.windows.com\r&quot; </span><br><span class="line">     # 时间同步   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;cat &gt;&gt; /etc/sysctl.conf&lt;&lt;EOF</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">net.ipv4.neigh.default.gc_thresh1=4096</span><br><span class="line">net.ipv4.neigh.default.gc_thresh2=6144</span><br><span class="line">net.ipv4.neigh.default.gc_thresh3=8192</span><br><span class="line">EOF\r&quot;</span><br><span class="line">      # kernel性能调优</span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;cp /etc/sysctl.conf /etc/sysctl.conf_copy\r&quot;</span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;sort -n /etc/sysctl.conf_copy | uniq &gt;/etc/sysctl.conf\r&quot;</span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;rm -f /etc/sysctl.conf_copy\r&quot;</span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;sysctl -p\r&quot; </span><br><span class="line">     # 加载配置文件   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;yum -y install lrzsz\r&quot;</span><br><span class="line">    # expect &quot;*root&quot; ; send  &quot;yum -y install lrzsz vim gcc glibc openssl openssl-devel net-tools wget curl\r&quot;</span><br><span class="line">      # 安装基础软件包</span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;echo \&quot;test soft\&quot; &gt;&gt; test.txt\r&quot;   </span><br><span class="line">    # 安装docker </span><br><span class="line">    </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;install -y yum-utils device-mapper-persistent-data lvm2\r&quot;   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo\r&quot;   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;yum -y install docker-ce-18.09.9-3.el7 docker-ce-cli-18.09.9-3.el7\r&quot;   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;systemctl start docker\r&quot;   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;cat &gt; /etc/docker/daemon.json &lt;&lt;EOF</span><br><span class="line">&#123;</span><br><span class="line">  \&quot;oom-score-adjust\&quot;: -1000,</span><br><span class="line">  \&quot;registry-mirrors\&quot;: \[\&quot;https://7bezldxe.mirror.aliyuncs.com/\&quot;,\&quot;https://kw88y6eh.mirror.aliyuncs.com\&quot;\],</span><br><span class="line">  \&quot;storage-driver\&quot;: \&quot;overlay2\&quot;,</span><br><span class="line">  \&quot;storage-opts\&quot;: \[\&quot;overlay2.override_kernel_check=true\&quot;\]</span><br><span class="line">&#125;</span><br><span class="line">EOF\r&quot;</span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;echo \`date +\&quot;%Y-%m-%d %H:%M:%S\&quot;\` docker installed &gt;&gt; /root/.k8s.log\r&quot;   </span><br><span class="line">    # 日志</span><br><span class="line">    # 创建rke用户  </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;useradd $rke_user -G docker\r&quot;   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;echo \&quot;123456\&quot; | passwd --stdin $rke_user\r&quot;   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;echo \`date +\&quot;%Y-%m-%d %H:%M:%S\&quot;\`  user $rke_user created &gt;&gt; /root/.k8s.log\r&quot;   </span><br><span class="line">    expect &quot;*root&quot; ; send  &quot;exit\r&quot;   </span><br><span class="line">    expect eof</span><br><span class="line">EOF</span><br><span class="line">done</span><br><span class="line"># 判断id_rsa密钥文件是否存在， 没有则创建</span><br><span class="line">rke_user=&quot;rke&quot;</span><br><span class="line"></span><br><span class="line">if [ ! -e /home/$rke_user/.ssh ];then </span><br><span class="line">  runuser -l $rke_user -c &quot;mkdir /home/$rke_user/.ssh&quot;</span><br><span class="line">fi </span><br><span class="line">if [ ! -f /home/$rke_user/.ssh/id_rsa ];then</span><br><span class="line">  runuser -l $rke_user -c &quot;ssh-keygen -t rsa -P \&quot;\&quot; -f /home/$rke_user/.ssh/id_rsa&quot;</span><br><span class="line">else</span><br><span class="line"> echo &quot;id_rsa has created ...&quot;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">#密钥分发到各个节点</span><br><span class="line">while read line</span><br><span class="line">  do</span><br><span class="line">    ip=`echo $line | cut -d &quot; &quot; -f 1`</span><br><span class="line">    expect &lt;&lt;EOF</span><br><span class="line">      set timeout 30</span><br><span class="line">      spawn su rke</span><br><span class="line">        expect &quot;rke&quot;; send &quot;ssh-copy-id -i /home/$rke_user/.ssh/id_rsa.pub $rke_user@$ip\r&quot;</span><br><span class="line">        expect &#123;</span><br><span class="line">          &quot;yes/no&quot; &#123; send &quot;yes\r&quot;;exp_continue &#125;</span><br><span class="line">          &quot;password&quot; &#123; send &quot;123456\r&quot;;exp_continue &#125;</span><br><span class="line">          &quot;WARNING&quot; &#123;send &quot;exit\r&quot;&#125;</span><br><span class="line">        &#125;</span><br><span class="line">EOF</span><br><span class="line">  done &lt;  ip.txt</span><br><span class="line"></span><br><span class="line"># 创建cluster.yml</span><br><span class="line">path_cluster_yml=&quot;/home/$rke_user/cluster.yml&quot;</span><br><span class="line">if [ ! -e $path_cluster_yml ]</span><br><span class="line">then</span><br><span class="line">  cat &gt; $path_cluster_yml &lt;&lt; EOF</span><br><span class="line">nodes:</span><br><span class="line">EOF</span><br><span class="line">  while read line </span><br><span class="line">    do</span><br><span class="line">    ip=`echo $line | cut -d &quot; &quot; -f 1`</span><br><span class="line">    cat &gt;&gt; $path_cluster_yml &lt;&lt; EOF</span><br><span class="line">  - address: $ip</span><br><span class="line">    internal_address: $ip</span><br><span class="line">    user: $rke_user</span><br><span class="line">    role: [controlplane,worker,etcd]</span><br><span class="line">EOF</span><br><span class="line">  done &lt; ip.txt</span><br><span class="line"></span><br><span class="line">  cat &gt;&gt; $path_cluster_yml &lt;&lt; EOF</span><br><span class="line">services:</span><br><span class="line">  etcd:</span><br><span class="line">    snapshot: true</span><br><span class="line">    creation: 6h</span><br><span class="line">    retention: 24h</span><br><span class="line">EOF</span><br><span class="line">fi</span><br><span class="line"># 安装rke </span><br><span class="line">if [ -e /usr/bin/rke ]</span><br><span class="line">then</span><br><span class="line">  echo &quot;rke already installed&quot;</span><br><span class="line">else</span><br><span class="line">  wget https://github.com/rancher/rke/releases/download/v1.3.0/rke_linux-amd64</span><br><span class="line">  chmod +x rke_linux-amd64 </span><br><span class="line">  mv rke_linux-amd64 /usr/bin/rke </span><br><span class="line">fi</span><br><span class="line"># 安装kubectl </span><br><span class="line">if [ -e /usr/local/bin/kubectl ]</span><br><span class="line">then </span><br><span class="line">  echo &quot;kubectl already installed&quot;</span><br><span class="line">else </span><br><span class="line">  wget http://rancher-mirror.cnrancher.com/kubectl/v1.21.4/linux-amd64-v1.21.4-kubectl</span><br><span class="line">  mv linux-amd64-v1.21.4-kubectl /usr/local/bin/kubectl</span><br><span class="line">  chmod +x /usr/local/bin/kubectl</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line"># 部署集群</span><br><span class="line">runuser -l $rke_user -c &quot;rke up --config /home/$rke_user/cluster.yml&quot;</span><br><span class="line">export KUBECONFIG=/home/$rke_user/kube_config_cluster.yml</span><br><span class="line">echo &quot;cluster nodes:&quot; </span><br><span class="line">kubectl get no </span><br></pre></td></tr></table></figure>

<p><strong>使用方法</strong>，登录其中一个节点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">chmod +x ./main.sh </span><br><span class="line"># ip.txt在同一个目录下</span><br><span class="line">./main.sh </span><br></pre></td></tr></table></figure>

<p><strong>然后等待</strong>， 结果： </p>
<p><img src="https://img-blog.csdnimg.cn/820d0db593d24029ab523e916e02a52f.png?x-oss-process=image/watermark,type_ZHJvaWRzYW5zZmFsbGJhY2s,shadow_50,text_Q1NETiBA5LqM6YOO6ZO2,size_20,color_FFFFFF,t_70,g_se,x_16#pic_center" alt="在这里插入图片描述"></p>
<p><img src="https://img-blog.csdnimg.cn/49ecdcd52ba84a46a05e34f04a813ad6.png#pic_center" alt="在这里插入图片描述"></p>
<p><strong>脚本缺点</strong>：</p>
<p>上面的脚本只是简单实现了功能， 并没有深入去写，存在一些问题。 比如：</p>
<ol>
<li> 异常处理并没有怎么做。 如果更进一步改进，可以加ip.txt文件的检查，格式检查，docker等软件是否安装的检查，环境配置检查等。  </li>
<li>脚本安装rke的下载链接并不稳定，我没找到国内的rke安装包镜像， 可能下载的很慢。 没有下载成功需要手动下载安装rke。</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/11/26/2021-11-16-shell%E4%B8%AD$%E7%9A%84%E7%94%A8%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/11/26/2021-11-16-shell%E4%B8%AD$%E7%9A%84%E7%94%A8%E6%B3%95/" class="post-title-link" itemprop="url">shell中$*的用法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-11-26 00:00:00" itemprop="dateCreated datePublished" datetime="2021-11-26T00:00:00+08:00">2021-11-26</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2022-02-21 14:54:31" itemprop="dateModified" datetime="2022-02-21T14:54:31+08:00">2022-02-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/linux/" itemprop="url" rel="index"><span itemprop="name">linux</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="一、Shell脚本中-0、-、-、-、-、-、-等用法"><a href="#一、Shell脚本中-0、-、-、-、-、-、-等用法" class="headerlink" title="一、Shell脚本中$0、$?、$!、$$、$*、$#、$@等用法"></a>一、Shell脚本中$0、$?、$!、$$、$*、$#、$@等用法</h3><ul>
<li><p>$$    Shell本身的PID（ProcessID，即脚本运行的当前进程ID号）</p>
</li>
<li><p>$!     Shell最后运行的后台Process的PID(后台运行的最后一个进程的[进程ID]</p>
</li>
<li><p>$?  最后运行的命令的结束代码（返回值）即执行上一个指令的返回值 (显示最后命令的退出状态。0表示没有错误，其他任何值表明有错误)</p>
</li>
<li><p>$$  显示shell使用的当前选项，与set命令功能相同</p>
</li>
<li><p>$* 所有参数列表。如”$*”用「”」括起来的情况、以”$1 $2 … $n”的形式输出所有参数，此选项参数可超过9个。</p>
</li>
<li><p>$@ 所有参数列表。如”$@”用「”」括起来的情况、以”$1” “$2” … “$n” 的形式输出所有参数。</p>
</li>
<li><p>$* 跟$@类似，但是可以当作数组用</p>
</li>
<li><p>$# 添加到Shell的参数个数</p>
</li>
<li><p>$0 Shell本身的文件名</p>
</li>
<li><p>$1～$n 添加到Shell的各参数值。$1是第1参数、$2是第2参数…</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/8/">8</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yuanwanli</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  
<script src="/js/third-party/search/local-search.js"></script>




  





</body>
</html>
