<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yuanwanli1995.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="等不是办法，干才有出路">
<meta property="og:type" content="website">
<meta property="og:title" content="brisk">
<meta property="og:url" content="http://yuanwanli1995.github.io/index.html">
<meta property="og:site_name" content="brisk">
<meta property="og:description" content="等不是办法，干才有出路">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="yuanwanli">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yuanwanli1995.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>brisk</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">brisk</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">welcome</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yuanwanli</p>
  <div class="site-description" itemprop="description">等不是办法，干才有出路</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">31</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/27/%E4%BA%8C%E7%BA%A7%E5%88%B6%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/27/%E4%BA%8C%E7%BA%A7%E5%88%B6%E6%90%AD%E5%BB%BAk8s%E9%9B%86%E7%BE%A4/" class="post-title-link" itemprop="url">二级制方法搭建k8s集群</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-27 15:20:00" itemprop="dateCreated datePublished" datetime="2021-09-27T15:20:00+08:00">2021-09-27</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-28 23:08:44" itemprop="dateModified" datetime="2021-09-28T23:08:44+08:00">2021-09-28</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1 准备工作"></a>1 准备工作</h2><h3 id="1-1-服务器或虚拟机"><a href="#1-1-服务器或虚拟机" class="headerlink" title="1.1 服务器或虚拟机"></a>1.1 服务器或虚拟机</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">操作系统：</span><br><span class="line">    CentOS7</span><br><span class="line">内核： </span><br><span class="line"></span><br><span class="line">三台或更多节点及其地址</span><br><span class="line">master：</span><br><span class="line">192.168.2.20  kube-apiserver，kube-controller-manager，kube-scheduler，etcd</span><br><span class="line"></span><br><span class="line">node1：</span><br><span class="line">192.168.2.21  kubelet，kube-proxy，docker，flannel，etcd</span><br><span class="line"></span><br><span class="line">node2：</span><br><span class="line">192.168.2.21  kubelet，kube-proxy，docker，flannel，etcd</span><br></pre></td></tr></table></figure>

<h3 id="1-2-修改主机名-所有节点操作"><a href="#1-2-修改主机名-所有节点操作" class="headerlink" title="1.2 修改主机名  ( 所有节点操作 )"></a>1.2 修改主机名  ( 所有节点操作 )</h3><p>master:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname master</span><br></pre></td></tr></table></figure>

<p>node1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname node1</span><br></pre></td></tr></table></figure>

<p>node2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname node2</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果命令失败， 直接修改 /etc/hostname, 重启后生效  </p>
<p>hostname # 可查看是否修改成功</p>
</blockquote>
<h3 id="1-3-关闭防火强-所有节点操作"><a href="#1-3-关闭防火强-所有节点操作" class="headerlink" title="1.3 关闭防火强 ( 所有节点操作 )"></a>1.3 关闭防火强 ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<blockquote>
<p>所有节点相同操作可使用同时发送到所有会话</p>
</blockquote>
<h3 id="1-4-关闭selinux-所有节点操作"><a href="#1-4-关闭selinux-所有节点操作" class="headerlink" title="1.4 关闭selinux ( 所有节点操作 )"></a>1.4 关闭selinux ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0 # 临时关闭</span><br><span class="line">sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27; /etc/selinux/config # 永久关闭</span><br></pre></td></tr></table></figure>

<h3 id="1-5-关闭swap-所有节点操作"><a href="#1-5-关闭swap-所有节点操作" class="headerlink" title="1.5 关闭swap ( 所有节点操作 )"></a>1.5 关闭swap ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a # 临时关闭；关闭swap主要是为了性能考虑</span><br><span class="line">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br></pre></td></tr></table></figure>

<blockquote>
<p>free # 可以通过这个命令查看swap是否关闭了 </p>
</blockquote>
<h3 id="1-6-同步时间-所有节点操作"><a href="#1-6-同步时间-所有节点操作" class="headerlink" title="1.6 同步时间 ( 所有节点操作 )"></a>1.6 同步时间 ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install ntpdate -y</span><br><span class="line">ntpdate time.windows.com</span><br></pre></td></tr></table></figure>

<h3 id="1-7-将桥接的IPv4流量传递到iptables的链-所有节点操作"><a href="#1-7-将桥接的IPv4流量传递到iptables的链-所有节点操作" class="headerlink" title="1.7 将桥接的IPv4流量传递到iptables的链 ( 所有节点操作 )"></a>1.7 将桥接的IPv4流量传递到iptables的链 ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysctl.d/k8s.conf &lt;&lt; EOF</span><br><span class="line">net.bridge.bridge-nf-call-ip6tables = 1</span><br><span class="line">net.bridge.bridge-nf-call-iptables = 1</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 加载配置文件</span><br><span class="line">sysctl --system</span><br></pre></td></tr></table></figure>

<h3 id="1-8-添加主机名与IP对应的关系-master操作"><a href="#1-8-添加主机名与IP对应的关系-master操作" class="headerlink" title="1.8 添加主机名与IP对应的关系 ( master操作 )"></a>1.8 添加主机名与IP对应的关系 ( master操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF </span><br><span class="line">192.168.2.20 master</span><br><span class="line">192.168.2.21 node1</span><br><span class="line">192.168.2.22 node2</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h2 id="2-cfssl证书-master操作"><a href="#2-cfssl证书-master操作" class="headerlink" title="2  cfssl证书  (master操作)"></a>2  cfssl证书  (master操作)</h2><h3 id="2-1-下载文件"><a href="#2-1-下载文件" class="headerlink" title="2.1 下载文件"></a>2.1 下载文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 安装wget </span><br><span class="line">yum -y install wget </span><br><span class="line"># 下载cfssl工具：</span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64</span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64</span><br><span class="line">wget https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64 </span><br><span class="line"># 添加执行权限</span><br><span class="line">chmod +x cfssl_linux-amd64 cfssljson_linux-amd64 cfssl-certinfo_linux-amd64 </span><br><span class="line"># 移动配置文件</span><br><span class="line">mv cfssl_linux-amd64 /usr/local/bin/cfssl</span><br><span class="line">mv cfssljson_linux-amd64 /usr/local/bin/cfssljson</span><br><span class="line">mv cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo</span><br></pre></td></tr></table></figure>

<blockquote>
<p>若wget失败验证失败， 加 –no-check-certificate参数可解决</p>
</blockquote>
<h3 id="2-2-创建配置文件"><a href="#2-2-创建配置文件" class="headerlink" title="2.2 创建配置文件"></a>2.2 创建配置文件</h3><p>创建以下三个文件：</p>
<ol>
<li>ca-config.json  </li>
<li> ca-csr.json </li>
<li>server-csr.json</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir ssl #创建一个目录来存放配置文件</span><br><span class="line">cd ssl </span><br></pre></td></tr></table></figure>

<p>ca-config.json  </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; ca-config.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;signing&quot;: &#123;</span><br><span class="line">    &quot;default&quot;: &#123;</span><br><span class="line">      &quot;expiry&quot;: &quot;87600h&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;profiles&quot;: &#123;</span><br><span class="line">      &quot;www&quot;: &#123;</span><br><span class="line">         &quot;expiry&quot;: &quot;87600h&quot;,</span><br><span class="line">         &quot;usages&quot;: [</span><br><span class="line">            &quot;signing&quot;,</span><br><span class="line">            &quot;key encipherment&quot;,</span><br><span class="line">            &quot;server auth&quot;,</span><br><span class="line">            &quot;client auth&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>ca-csr.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; ca-csr.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;CN&quot;: &quot;etcd CA&quot;,</span><br><span class="line">    &quot;key&quot;: &#123;</span><br><span class="line">        &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">        &quot;size&quot;: 2048</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;names&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">            &quot;L&quot;: &quot;Beijing&quot;,</span><br><span class="line">            &quot;ST&quot;: &quot;Beijing&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>
<p>server-csr.json</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; server-csr.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;CN&quot;: &quot;etcd&quot;,</span><br><span class="line">    &quot;hosts&quot;: [</span><br><span class="line">    &quot;192.168.2.20&quot;,      </span><br><span class="line">    &quot;192.168.2.21&quot;,</span><br><span class="line">    &quot;192.168.2.22&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;key&quot;: &#123;</span><br><span class="line">        &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">        &quot;size&quot;: 2048</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;names&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">            &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">            &quot;ST&quot;: &quot;BeiJing&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<blockquote>
<p>etcd集群的ip地址<br>“hosts”:<br>   “192.168.2.20”,<br>   “192.168.2.21”,<br>   “192.168.2.22”</p>
</blockquote>
<h3 id="2-3-生成证书"><a href="#2-3-生成证书" class="headerlink" title="2.3 生成证书"></a>2.3 生成证书</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#生成证书：</span><br><span class="line">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -</span><br><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=www server-csr.json | cfssljson -bare server</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">2021/09/25 23:56:21 [WARNING] This certificate lacks a &quot;hosts&quot; field. This makes it unsuitable for</span><br><span class="line">websites. For more information see the Baseline Requirements for the Issuance and Management</span><br><span class="line">of Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum (https://cabforum.org);</span><br><span class="line">specifically, section 10.2.3 (&quot;Information Requirements&quot;).</span><br><span class="line"></span><br><span class="line">ls *pem</span><br><span class="line">ca-key.pem  ca.pem  server-key.pem  server.pem</span><br><span class="line">#四个.pem文件证书</span><br></pre></td></tr></table></figure>

<h2 id="3-部署etcd"><a href="#3-部署etcd" class="headerlink" title="3 部署etcd"></a>3 部署etcd</h2><h3 id="3-1-下载二进制包-master操作"><a href="#3-1-下载二进制包-master操作" class="headerlink" title="3.1 下载二进制包 ( master操作 )"></a>3.1 下载二进制包 ( master操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#二进制包下载地址：</span><br><span class="line">https://github.com/etcd-io/etcd/releases/download/v3.2.12/etcd-v3.2.12-linux-amd64.tar.gz</span><br></pre></td></tr></table></figure>
<h3 id="3-2-解压二进制包-master操作"><a href="#3-2-解压二进制包-master操作" class="headerlink" title="3.2  解压二进制包 ( master操作 )"></a>3.2  解压二进制包 ( master操作 )</h3><p>以下部署步骤在三个etcd节点操作一样，唯一不同的是etcd配置文件中的<strong>服务器IP要写当前本机</strong>的， 所以我们在master节点上配置，然后将配置文件复制到node节点上在修改名称和IP，这样方便一点。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 解压二进制包：</span><br><span class="line">mkdir /opt/etcd/&#123;bin,cfg,ssl&#125; -p   </span><br><span class="line">tar zxvf etcd-v3.2.12-linux-amd64.tar.gz</span><br><span class="line">mv etcd-v3.2.12-linux-amd64/&#123;etcd,etcdctl&#125; /opt/etcd/bin/</span><br></pre></td></tr></table></figure>
<blockquote>
<ul>
<li><p>/opt/etcd/bin 里面存放的是可执行文件 etcd 、 etcdctl</p>
</li>
<li><p>/opt/etcd/cfg 里面存放的是配置文件 etcd.conf </p>
</li>
<li><p>/opt/etcd/ssl  里面存放的是证书ca-key.pem 、 ca.pem 、server-key.pem 、server.pem</p>
</li>
</ul>
</blockquote>
<h3 id="3-3-配置etcd-conf-master操作"><a href="#3-3-配置etcd-conf-master操作" class="headerlink" title="3.3 配置etcd.conf  ( master操作 )"></a>3.3 配置etcd.conf  ( master操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#创建etcd.conf配置文件：</span><br><span class="line">cat &gt; /opt/etcd/cfg/etcd &lt;&lt; EOF</span><br><span class="line">#[Member]</span><br><span class="line">ETCD_NAME=&quot;etcd01&quot;</span><br><span class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</span><br><span class="line">ETCD_LISTEN_PEER_URLS=&quot;https://192.168.2.20:2380&quot;</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.2.20:2379&quot;</span><br><span class="line">#[Clustering]</span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.2.20:2380&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.2.20:2379&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER=&quot;etcd01=https://192.168.2.20:2380,etcd02=https://192.168.2.21:2380,etcd03=https://192.168.2.22:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>ETCD_NAME 节点名称    （master 是etcd01 node1是etcd02 node2是etcd03）</li>
</ul>
<ul>
<li>ETCD_DATA_DIR 数据目录 （不用修改）</li>
<li>ETCD_LISTEN_PEER_URLS 集群通信监听地址   （修改为本机ip）</li>
<li>ETCD_LISTEN_CLIENT_URLS 客户端访问监听地址   （修改为本机ip）</li>
<li>ETCD_INITIAL_ADVERTISE_PEER_URLS 集群通告地址  （修改为本机ip）</li>
<li>ETCD_ADVERTISE_CLIENT_URLS 客户端通告地址    （修改为本机ip）</li>
<li>ETCD_INITIAL_CLUSTER 集群节点地址    （跟上面节点名称要一一对应）</li>
<li>ETCD_INITIAL_CLUSTER_TOKEN 集群Token</li>
<li>ETCD_INITIAL_CLUSTER_STATE （加入集群的当前状态，new是新集群，existing表示加入已有集群，因为我们是新创建的所以设置为new，否则用existing）</li>
</ul>
</blockquote>
<h3 id="3-4-配置etcd-service-master操作"><a href="#3-4-配置etcd-service-master操作" class="headerlink" title="3.4 配置etcd.service  ( master操作 )"></a>3.4 配置etcd.service  ( master操作 )</h3><p>三个节点相同</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"># systemd管理etcd：（方便使用systemctl启动，而不是用一长串的绝对路径启动）</span><br><span class="line">rm -f /usr/lib/systemd/system/etcd.service</span><br><span class="line">vi /usr/lib/systemd/system/etcd.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Etcd Server</span><br><span class="line">After=network.target</span><br><span class="line">After=network-online.target</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=/opt/etcd/cfg/etcd</span><br><span class="line">ExecStart=/opt/etcd/bin/etcd \</span><br><span class="line">--name=$&#123;ETCD_NAME&#125; \</span><br><span class="line">--data-dir=$&#123;ETCD_DATA_DIR&#125; \</span><br><span class="line">--listen-peer-urls=$&#123;ETCD_LISTEN_PEER_URLS&#125; \</span><br><span class="line">--listen-client-urls=$&#123;ETCD_LISTEN_CLIENT_URLS&#125;,http://127.0.0.1:2379 \</span><br><span class="line">--advertise-client-urls=$&#123;ETCD_ADVERTISE_CLIENT_URLS&#125; \</span><br><span class="line">--initial-advertise-peer-urls=$&#123;ETCD_INITIAL_ADVERTISE_PEER_URLS&#125; \</span><br><span class="line">--initial-cluster=$&#123;ETCD_INITIAL_CLUSTER&#125; \</span><br><span class="line">--initial-cluster-token=$&#123;ETCD_INITIAL_CLUSTER_TOKEN&#125; \</span><br><span class="line">--initial-cluster-state=new \</span><br><span class="line">--cert-file=/opt/etcd/ssl/server.pem \</span><br><span class="line">--key-file=/opt/etcd/ssl/server-key.pem \</span><br><span class="line">--peer-cert-file=/opt/etcd/ssl/server.pem \</span><br><span class="line">--peer-key-file=/opt/etcd/ssl/server-key.pem \</span><br><span class="line">--trusted-ca-file=/opt/etcd/ssl/ca.pem \</span><br><span class="line">--peer-trusted-ca-file=/opt/etcd/ssl/ca.pem \</span><br><span class="line">--enable-v2</span><br><span class="line"></span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>

<blockquote>
<p>\ 为换行连接符，不可省略</p>
</blockquote>
<h3 id="3-5-拷贝证书-master操作"><a href="#3-5-拷贝证书-master操作" class="headerlink" title="3.5  拷贝证书  ( master操作 )"></a>3.5  拷贝证书  ( master操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 把刚才生成的证书拷贝到配置文件中的位置：（对应上面systemd管理中的路径）</span><br><span class="line">cp ~/ssl/ca*pem ~/ssl/server*pem /opt/etcd/ssl/</span><br></pre></td></tr></table></figure>
<h3 id="3-6-将文件复制到node节点-master操作"><a href="#3-6-将文件复制到node节点-master操作" class="headerlink" title="3.6  将文件复制到node节点 ( master操作 )"></a>3.6  将文件复制到node节点 ( master操作 )</h3><p>主要有两个部分文件需要复制</p>
<ul>
<li> /opt/etcd/ 下面的文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 因为证书我们是在master上配置的，所以我们需要拷贝给所有node </span><br><span class="line">scp -r /opt/etcd/ root@192.168.2.21:/opt/ # 发送到node1</span><br><span class="line">scp -r /opt/etcd/ root@192.168.2.22:/opt/ # 发送到node2 </span><br></pre></td></tr></table></figure>
<ul>
<li> /usr/lib/systemd/system/etcd.service 文件</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">scp /usr/lib/systemd/system/etcd.service root@192.168.2.21:/usr/lib/systemd/system/</span><br><span class="line">scp /usr/lib/systemd/system/etcd.service root@192.168.2.22:/usr/lib/systemd/system/</span><br></pre></td></tr></table></figure>

<blockquote>
<p>传送完成检查node节点上文件是否存在</p>
</blockquote>
<h3 id="3-7-修改node节点etcd-conf-中的名称和IP"><a href="#3-7-修改node节点etcd-conf-中的名称和IP" class="headerlink" title="3.7 修改node节点etcd.conf 中的名称和IP"></a>3.7 修改node节点etcd.conf 中的名称和IP</h3><ul>
<li> node1 操作</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/etcd/cfg/etcd&lt;&lt; EOF</span><br><span class="line">#[Member]</span><br><span class="line">ETCD_NAME=&quot;etcd02&quot;</span><br><span class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</span><br><span class="line">ETCD_LISTEN_PEER_URLS=&quot;https://192.168.2.21:2380&quot;</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.2.21:2379&quot;</span><br><span class="line">#[Clustering]</span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.2.21:2380&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.2.21:2379&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER=&quot;etcd01=https://192.168.2.20:2380,etcd02=https://192.168.2.21:2380,etcd03=https://192.168.2.22:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<blockquote>
<p>修改ETCD_NAME 和IP</p>
</blockquote>
<ul>
<li> node2 操作</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/etcd/cfg/etcd&lt;&lt; EOF</span><br><span class="line">#[Member]</span><br><span class="line">ETCD_NAME=&quot;etcd03&quot;</span><br><span class="line">ETCD_DATA_DIR=&quot;/var/lib/etcd/default.etcd&quot;</span><br><span class="line">ETCD_LISTEN_PEER_URLS=&quot;https://192.168.2.22:2380&quot;</span><br><span class="line">ETCD_LISTEN_CLIENT_URLS=&quot;https://192.168.2.22:2379&quot;</span><br><span class="line">#[Clustering]</span><br><span class="line">ETCD_INITIAL_ADVERTISE_PEER_URLS=&quot;https://192.168.2.22:2380&quot;</span><br><span class="line">ETCD_ADVERTISE_CLIENT_URLS=&quot;https://192.168.2.22:2379&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER=&quot;etcd01=https://192.168.2.20:2380,etcd02=https://192.168.2.21:2380,etcd03=https://192.168.2.22:2380&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_TOKEN=&quot;etcd-cluster&quot;</span><br><span class="line">ETCD_INITIAL_CLUSTER_STATE=&quot;new&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>


<h3 id="3-8-启动并设置开启启动："><a href="#3-8-启动并设置开启启动：" class="headerlink" title="3.8 启动并设置开启启动："></a>3.8 启动并设置开启启动：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start etcd</span><br><span class="line">systemctl enable etcd</span><br></pre></td></tr></table></figure>

<h3 id="3-9-检查etcd集群状态："><a href="#3-9-检查etcd集群状态：" class="headerlink" title="3.9 检查etcd集群状态："></a>3.9 检查etcd集群状态：</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"># 移动命令路径</span><br><span class="line">cp /opt/etcd/bin/etcdctl /bin </span><br><span class="line"># 配置etcdctl 3 环境变量</span><br><span class="line">export ETCDCTL_API=3</span><br><span class="line"></span><br><span class="line">/opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints=&quot;https://192.168.2.20:2379,https://192.168.2.21:2379,https://192.168.2.22:2379&quot; endpoint status --write-out=table</span><br><span class="line"></span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">+---------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line">|         ENDPOINT          |        ID        | VERSION | DB SIZE | IS LEADER | IS LEARNER | RAFT TERM | RAFT INDEX | RAFT APPLIED INDEX | ERRORS |</span><br><span class="line">+---------------------------+------------------+---------+---------+-----------+------------+-----------+------------+--------------------+--------+</span><br><span class="line">| https://192.168.2.20:2379 | 3ae8ea54109f8cad |  3.4.14 |   20 kB |      true |      false |        61 |         16 |                 16 |        |</span><br><span class="line">| https://192.168.2.21:2379 | cb408b517db6d952 |  3.4.14 |   20 kB |     false |      false |        61 |         16 |                 16 |        |</span><br><span class="line">| https://192.168.2.22:2379 | eca9a4bbb09d42e4 |  3.4.14 |   20 kB |     false |      false |        61 |         16 |                 16 |        |</span><br><span class="line">/opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints=&quot;https://192.168.2.20:2379,https://192.168.2.21:2379,https://192.168.2.22:2379&quot; endpoint health</span><br><span class="line"># 用 etcd2 重新配置后查看集群状态</span><br><span class="line">ETCDCTL_API=2 /opt/etcd/bin/etcdctl --ca-file=/opt/etcd/ssl/ca.pem --cert-file=/opt/etcd/ssl/server.pem --key-file=/opt/etcd/ssl/server-key.pem --endpoints=&quot;https://192.168.2.20:2379,https://192.168.2.21:2379,https://192.168.2.22:2379&quot; cluster-health</span><br><span class="line"># 重新配置子网 删除原来的配置</span><br><span class="line">/opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints=&quot;https://192.168.2.20:2379,https://192.168.2.21:2379,https://192.168.2.22:2379&quot;   del /coreos.com/network/config</span><br><span class="line"># 重新配置</span><br><span class="line">ETCDCTL_API=2 /opt/etcd/bin/etcdctl --ca-file=/opt/etcd/ssl/ca.pem --cert-file=/opt/etcd/ssl/server.pem --key-file=/opt/etcd/ssl/server-key.pem --endpoints=&quot;https://192.168.2.20:2379,https://192.168.2.21:2379,https://192.168.2.22:2379&quot; set /coreos.com/network/config &#x27;&#123; &quot;Network&quot;: &quot;172.17.0.0/16&quot;, &quot;Backend&quot;: &#123;&quot;Type&quot;: &quot;vxlan&quot;&#125;&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="4-在work-node节点上安装docker"><a href="#4-在work-node节点上安装docker" class="headerlink" title="4 在work node节点上安装docker"></a>4 在work node节点上安装docker</h2><h3 id="4-1-node1-node2安装docker"><a href="#4-1-node1-node2安装docker" class="headerlink" title="4.1 node1 node2安装docker"></a>4.1 node1 node2安装docker</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 安装依赖库</span><br><span class="line">yum install -y yum-utils</span><br><span class="line"># 安装docker仓库</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"># 国外的仓库很慢，可以使用国内的镜像快一点</span><br><span class="line">yum-config-manager --add-repo http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"># 安装docker</span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io</span><br></pre></td></tr></table></figure>

<h3 id="4-2-systemd-管理-docker"><a href="#4-2-systemd-管理-docker" class="headerlink" title="4.2 systemd 管理 docker"></a>4.2 systemd 管理 docker</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /usr/lib/systemd/system/docker.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">ExecStart=/usr/bin/dockerd</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 启动</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>





<h2 id="5-kube-apiserver-（master操作）"><a href="#5-kube-apiserver-（master操作）" class="headerlink" title="5 kube-apiserver （master操作）"></a>5 kube-apiserver （master操作）</h2><h3 id="5-1-生成-kube-apiserver-需要的配置文件"><a href="#5-1-生成-kube-apiserver-需要的配置文件" class="headerlink" title="5.1 生成 kube-apiserver 需要的配置文件"></a>5.1 生成 kube-apiserver 需要的配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd TLS/k8s </span><br><span class="line">#保存 ca-config.json  ca-csr.json server-csr.json</span><br></pre></td></tr></table></figure>

<ul>
<li> 配置 ca-config.json</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; ca-config.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;signing&quot;: &#123;</span><br><span class="line">    &quot;default&quot;: &#123;</span><br><span class="line">      &quot;expiry&quot;: &quot;87600h&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;profiles&quot;: &#123;</span><br><span class="line">      &quot;kubernetes&quot;: &#123;</span><br><span class="line">         &quot;expiry&quot;: &quot;87600h&quot;,</span><br><span class="line">         &quot;usages&quot;: [</span><br><span class="line">            &quot;signing&quot;,</span><br><span class="line">            &quot;key encipherment&quot;,</span><br><span class="line">            &quot;server auth&quot;,</span><br><span class="line">            &quot;client auth&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ul>
<li>配置 cca-csr.json</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; ca-csr.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;CN&quot;: &quot;kubernetes&quot;,</span><br><span class="line">    &quot;key&quot;: &#123;</span><br><span class="line">        &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">        &quot;size&quot;: 2048</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;names&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">            &quot;L&quot;: &quot;Beijing&quot;,</span><br><span class="line">            &quot;ST&quot;: &quot;Beijing&quot;,</span><br><span class="line">            &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">            &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ul>
<li>配置 server-csr.json</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; server-csr.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">    &quot;CN&quot;: &quot;kubernetes&quot;,</span><br><span class="line">    &quot;hosts&quot;: [</span><br><span class="line">      &quot;10.0.0.1&quot;,</span><br><span class="line">      &quot;127.0.0.1&quot;,</span><br><span class="line">      &quot;192.168.2.20&quot;,</span><br><span class="line">      &quot;192.168.2.21&quot;,</span><br><span class="line">      &quot;192.168.2.22&quot;,</span><br><span class="line">      &quot;kubernetes&quot;,</span><br><span class="line">      &quot;kubernetes.default&quot;,</span><br><span class="line">      &quot;kubernetes.default.svc&quot;,</span><br><span class="line">      &quot;kubernetes.default.svc.cluster&quot;,</span><br><span class="line">      &quot;kubernetes.default.svc.cluster.local&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;key&quot;: &#123;</span><br><span class="line">        &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">        &quot;size&quot;: 2048</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;names&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">            &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">            &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">            &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">            &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-2-生成证书"><a href="#5-2-生成证书" class="headerlink" title="5.2 生成证书"></a>5.2 生成证书</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cfssl gencert -initca ca-csr.json | cfssljson -bare ca -</span><br><span class="line">ls *pem</span><br><span class="line"></span><br><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server</span><br><span class="line"></span><br><span class="line">ls server*pem</span><br><span class="line"># 拷贝证书</span><br><span class="line">cp ~/k8s/ca*pem ~/k8s/server*pem /opt/kubernetes/ssl/</span><br></pre></td></tr></table></figure>



<h3 id="5-2-部署-kube-apiserver"><a href="#5-2-部署-kube-apiserver" class="headerlink" title="5.2 部署 kube apiserver"></a>5.2 部署 kube apiserver</h3><p>下载kubernetes-server-linux-amd64.tar.gz，包含了所需的所有组件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG/CHANGELOG- 1.20.1.md#v1183</span><br></pre></td></tr></table></figure>

<h3 id="解压"><a href="#解压" class="headerlink" title="解压"></a>解压</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/kubernetes/&#123;bin,cfg,ssl,logs&#125;</span><br><span class="line">tar zxvf kubernetes-server-linux-amd64.tar.gz</span><br><span class="line">cd kubernetes/server/bin</span><br><span class="line"># 拷贝</span><br><span class="line">cp kube-apiserver kube-scheduler kube-controller-manager /opt/kubernetes/bin</span><br><span class="line">cp kubectl /usr/bin/</span><br></pre></td></tr></table></figure>

<h3 id="5-3-配置kube-apiserver-conf"><a href="#5-3-配置kube-apiserver-conf" class="headerlink" title="5.3 配置kube-apiserver.conf"></a>5.3 配置kube-apiserver.conf</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/kubernetes/cfg/kube-apiserver.conf &lt;&lt; EOF</span><br><span class="line">KUBE_APISERVER_OPTS=&quot;--logtostderr=false \\</span><br><span class="line">--v=2 \\</span><br><span class="line">--log-dir=/opt/kubernetes/logs \\</span><br><span class="line">--etcd-servers=https://192.168.2.20:2379,https://192.168.2.21:2379,https://192.168.2.22:2379 \\</span><br><span class="line">--bind-address=192.168.2.20 \\</span><br><span class="line">--secure-port=6443 \\</span><br><span class="line">--advertise-address=192.168.2.20 \\</span><br><span class="line">--allow-privileged=true \\</span><br><span class="line">--service-cluster-ip-range=10.0.0.0/24 \\</span><br><span class="line">--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \\</span><br><span class="line">--authorization-mode=RBAC,Node \\</span><br><span class="line">--enable-bootstrap-token-auth=true \\</span><br><span class="line">--token-auth-file=/opt/kubernetes/cfg/token.csv \\</span><br><span class="line">--service-node-port-range=30000-32767 \\</span><br><span class="line">--kubelet-client-certificate=/opt/kubernetes/ssl/server.pem \\</span><br><span class="line">--kubelet-client-key=/opt/kubernetes/ssl/server-key.pem \\</span><br><span class="line">--tls-cert-file=/opt/kubernetes/ssl/server.pem  \\</span><br><span class="line">--tls-private-key-file=/opt/kubernetes/ssl/server-key.pem \\</span><br><span class="line">--client-ca-file=/opt/kubernetes/ssl/ca.pem \\</span><br><span class="line">--service-account-key-file=/opt/kubernetes/ssl/ca-key.pem \\</span><br><span class="line">--etcd-cafile=/opt/etcd/ssl/ca.pem \\</span><br><span class="line">--etcd-certfile=/opt/etcd/ssl/server.pem \\</span><br><span class="line">--etcd-keyfile=/opt/etcd/ssl/server-key.pem \\</span><br><span class="line">--audit-log-maxage=30 \\</span><br><span class="line">--audit-log-maxbackup=3 \\</span><br><span class="line">--audit-log-maxsize=100 \\</span><br><span class="line">--audit-log-path=/opt/kubernetes/logs/k8s-audit.log&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>



<blockquote>
<p>上面两个\ \ 第一个是转义符，第二个是换行符，使用转义符是为了使用 EOF 保留换 行符。</p>
<ul>
<li>logtostderr：启用日志</li>
<li>v：日志等级</li>
<li>log-dir：日志目录</li>
<li>etcd-servers：etcd 集群地址</li>
<li>bind-address：监听地址</li>
<li>secure-port：https 安全端口</li>
<li>advertise-address：集群通告地址</li>
<li>allow-privileged：启用授权</li>
<li>service-cluster-ip-range：Service 虚拟 IP 地址段</li>
<li>enable-admission-plugins：准入控制模块</li>
<li>authorization-mode：认证授权，启用 RBAC 授权和节点自管理</li>
<li>enable-bootstrap-token-auth：启用 TLS bootstrap 机制</li>
<li>token-auth-file：bootstrap token 文件</li>
<li>service-node-port-range：Service nodeport 类型默认分配端口范围</li>
<li>kubelet-client-xxx：apiserver 访问 kubelet 客户端证书</li>
<li>tls-xxx-file：apiserver https 证书</li>
<li>etcd-xxxfile：连接 Etcd 集群证书</li>
<li>audit-log-xxx：审计日志</li>
</ul>
</blockquote>
<h3 id="5-4-配置token-csv"><a href="#5-4-配置token-csv" class="headerlink" title="5.4 配置token.csv"></a>5.4 配置token.csv</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/kubernetes/cfg/token.csv &lt;&lt; EOF</span><br><span class="line">c47ffb939f5ca36231d9e3121a252940,kubelet-bootstrap,10001,&quot;system:node-bootstrapper&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">head -c 16 /dev/urandom | od -An -t x | tr -d &#x27; &#x27;</span><br><span class="line">a266c491e557753ef5d43e467c600d10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cat &gt;&gt; /etc/profile&lt;&lt; EOF</span><br><span class="line">export KUBERNETES_MASTER=&quot;127.0.0.1:8080&quot;</span><br><span class="line">EOF</span><br><span class="line">保存退出</span><br><span class="line">source /etc/profile</span><br><span class="line">刷新环境变量</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="5-5-配置kube-apiserver-service"><a href="#5-5-配置kube-apiserver-service" class="headerlink" title="5.5 配置kube-apiserver.service"></a>5.5 配置kube-apiserver.service</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /usr/lib/systemd/system/kube-apiserver.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes API Server</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/opt/kubernetes/cfg/kube-apiserver.conf</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kube-apiserver \$KUBE_APISERVER_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="5-6-设置自启动与启动"><a href="#5-6-设置自启动与启动" class="headerlink" title="5.6 设置自启动与启动"></a>5.6 设置自启动与启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-apiserver</span><br><span class="line">systemctl enable kube-apiserver</span><br><span class="line">systemctl status kube-apiserver </span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">kube-apiserver.service - Kubernetes API Server</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/kube-apiserver.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Mon 2021-09-27 01:25:36 EDT; 48s ago</span><br><span class="line">     Docs: https://github.com/kubernetes/kubernetes</span><br><span class="line"> Main PID: 10945 (kube-apiserver)</span><br><span class="line">   CGroup: /system.slice/kube-apiserver.service</span><br><span class="line">           └─10945 /opt/kubernetes/bin/kube-apiserver --logtostderr=false --v=2 --log-dir=/opt/kubernetes/logs --etcd-servers=https://192.168.2.20:2379.</span><br></pre></td></tr></table></figure>

<h3 id="5-7-授权-kubelet-bootstrap-用户允许请求证书"><a href="#5-7-授权-kubelet-bootstrap-用户允许请求证书" class="headerlink" title="5.7 授权 kubelet-bootstrap 用户允许请求证书"></a>5.7 授权 kubelet-bootstrap 用户允许请求证书</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">kubectl create clusterrolebinding kubelet-bootstrap \</span><br><span class="line">--clusterrole=system:node-bootstrapper \</span><br><span class="line">--user=kubelet-bootstrap</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">kubectl create clusterrolebinding kubelet-bootstrap \</span><br><span class="line">--clusterrole=system:node-bootstrapper \</span><br><span class="line">--user=kubelet-bootstrap</span><br></pre></td></tr></table></figure>

<h2 id="6-部署-kube-controller-manager（master操作）"><a href="#6-部署-kube-controller-manager（master操作）" class="headerlink" title="6 部署 kube-controller-manager（master操作）"></a>6 部署 kube-controller-manager（master操作）</h2><h3 id="6-1-配置kube-controller-manager-conf"><a href="#6-1-配置kube-controller-manager-conf" class="headerlink" title="6.1 配置kube-controller-manager.conf"></a>6.1 配置kube-controller-manager.conf</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cat &gt; /opt/kubernetes/cfg/kube-controller-manager.conf &lt;&lt; EOF</span><br><span class="line">KUBE_CONTROLLER_MANAGER_OPTS=&quot;--logtostderr=false \\</span><br><span class="line">--v=2 \\</span><br><span class="line">--log-dir=/opt/kubernetes/logs \\</span><br><span class="line">--leader-elect=true \\</span><br><span class="line">--master=127.0.0.1:8080 \\</span><br><span class="line">--bind-address=127.0.0.1 \\</span><br><span class="line">--allocate-node-cidrs=true \\</span><br><span class="line">--cluster-cidr=10.244.0.0/16 \\</span><br><span class="line">--service-cluster-ip-range=10.0.0.0/24 \\</span><br><span class="line">--cluster-signing-cert-file=/opt/kubernetes/ssl/ca.pem \\</span><br><span class="line">--cluster-signing-key-file=/opt/kubernetes/ssl/ca-key.pem  \\</span><br><span class="line">--root-ca-file=/opt/kubernetes/ssl/ca.pem \\</span><br><span class="line">--service-account-private-key-file=/opt/kubernetes/ssl/ca-key.pem \\</span><br><span class="line">--experimental-cluster-signing-duration=87600h0m0s&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="6-2-systemd-管理-controller-manager"><a href="#6-2-systemd-管理-controller-manager" class="headerlink" title="6.2 systemd 管理 controller-manager"></a>6.2 systemd 管理 controller-manager</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /usr/lib/systemd/system/kube-controller-manager.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Controller Manager</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/opt/kubernetes/cfg/kube-controller-manager.conf</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kube-controller-manager \$KUBE_CONTROLLER_MANAGER_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="6-3-设置kube-controller-manager的自启动并启动"><a href="#6-3-设置kube-controller-manager的自启动并启动" class="headerlink" title="6.3 设置kube-controller-manager的自启动并启动"></a>6.3 设置kube-controller-manager的自启动并启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-controller-manager</span><br><span class="line">systemctl enable kube-controller-manager</span><br><span class="line">systemctl status kube-controller-manager</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">● kube-controller-manager.service - Kubernetes Controller Manager</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/kube-controller-manager.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Mon 2021-09-27 01:33:06 EDT; 137ms ago</span><br><span class="line">     Docs: https://github.com/kubernetes/kubernetes</span><br><span class="line"> Main PID: 11011 (kube-controller)</span><br><span class="line">   CGroup: /system.slice/kube-controller-manager.service</span><br><span class="line">           └─11011 /opt/kubernetes/bin/kube-controller-manager --logtostderr=false --v=2 --log-dir=/opt/kubernetes/logs --leader-elect=true --master=12...</span><br><span class="line"></span><br><span class="line">Sep 27 01:33:06 master systemd[1]: Started Kubernetes Controller Manager.</span><br></pre></td></tr></table></figure>



<h2 id="7-部署-kube-scheduler（master操作）"><a href="#7-部署-kube-scheduler（master操作）" class="headerlink" title="7 部署 kube-scheduler（master操作）"></a>7 部署 kube-scheduler（master操作）</h2><h3 id="7-1-配置kube-scheduler-conf"><a href="#7-1-配置kube-scheduler-conf" class="headerlink" title="7.1 配置kube-scheduler.conf"></a>7.1 配置kube-scheduler.conf</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/kubernetes/cfg/kube-scheduler.conf &lt;&lt; EOF</span><br><span class="line">KUBE_SCHEDULER_OPTS=&quot;--logtostderr=false \</span><br><span class="line">--v=2 \</span><br><span class="line">--log-dir=/opt/kubernetes/logs \</span><br><span class="line">--leader-elect \</span><br><span class="line">--master=127.0.0.1:8080 \</span><br><span class="line">--bind-address=127.0.0.1&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="7-2-配置-kube-scheduler-service"><a href="#7-2-配置-kube-scheduler-service" class="headerlink" title="7.2 配置 kube-scheduler.service"></a>7.2 配置 kube-scheduler.service</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /usr/lib/systemd/system/kube-scheduler.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Scheduler</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/opt/kubernetes/cfg/kube-scheduler.conf</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kube-scheduler \$KUBE_SCHEDULER_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="7-3-kube-scheduler自启动"><a href="#7-3-kube-scheduler自启动" class="headerlink" title="7.3 kube-scheduler自启动"></a>7.3 kube-scheduler自启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-scheduler</span><br><span class="line">systemctl enable kube-scheduler</span><br><span class="line">systemctl status kube-scheduler</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">● kube-scheduler.service - Kubernetes Scheduler</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/kube-scheduler.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Mon 2021-09-27 01:36:04 EDT; 123ms ago</span><br><span class="line">     Docs: https://github.com/kubernetes/kubernetes</span><br><span class="line"> Main PID: 11065 (kube-scheduler)</span><br><span class="line">   CGroup: /system.slice/kube-scheduler.service</span><br><span class="line">           └─11065 /opt/kubernetes/bin/kube-scheduler --logtostderr=false --v=2 --log-dir=/opt/kubernetes/logs --leader-elect --master=127.0.0.1:8080 -...</span><br><span class="line">Sep 27 01:36:04 master systemd[1]: Started Kubernetes Scheduler.</span><br></pre></td></tr></table></figure>

<h3 id="7-4-查看集群状态"><a href="#7-4-查看集群状态" class="headerlink" title="7.4 查看集群状态"></a>7.4 查看集群状态</h3><p>master节点的组件已经部署完成，查看状态</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# kubectl get cs</span><br><span class="line">NAME                 STATUS    MESSAGE              ERROR</span><br><span class="line">controller-manager   Healthy   ok                   </span><br><span class="line">scheduler            Healthy   ok                   </span><br><span class="line">etcd-1               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line">etcd-2               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;  </span><br></pre></td></tr></table></figure>

<h2 id="8-部署work-node-的组件"><a href="#8-部署work-node-的组件" class="headerlink" title="8 部署work node 的组件"></a>8 部署work node 的组件</h2><p>这里我们在master上也部署node的组件，打上污点不使用，不影响</p>
<h3 id="8-1-拷贝文件"><a href="#8-1-拷贝文件" class="headerlink" title="8.1 拷贝文件"></a>8.1 拷贝文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /opt/kubernetes/&#123;bin,cfg,ssl,logs&#125;</span><br><span class="line"># 从master拷贝需要的文件</span><br><span class="line">scp -r root@192.168.2.20:/root/kubernetes/server/bin/kubelet  /opt/kubernetes/bin</span><br><span class="line">scp -r root@192.168.2.20:/root/kubernetes/server/bin/kube-proxy  /opt/kubernetes/bin</span><br><span class="line">scp -r root@192.168.2.20:/root/kubernetes/server/bin/kubectl  /usr/bin/</span><br><span class="line">scp -r root@192.168.2.20:/opt/kubernetes/ssl  /opt/kubernetes</span><br></pre></td></tr></table></figure>

<h3 id="8-2-配置kubelet-conf"><a href="#8-2-配置kubelet-conf" class="headerlink" title="8.2 配置kubelet.conf"></a>8.2 配置kubelet.conf</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/kubernetes/cfg/kubelet.conf &lt;&lt; EOF</span><br><span class="line">KUBELET_OPTS=&quot;--logtostderr=tr \\</span><br><span class="line">--v=2 \\</span><br><span class="line">--log-dir=/opt/kubernetes/logs \\</span><br><span class="line">--hostname-override=node1 \\</span><br><span class="line">--network-plugin=cni \\</span><br><span class="line">--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \\</span><br><span class="line">--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \\</span><br><span class="line">--config=/opt/kubernetes/cfg/kubelet-config.yml \\</span><br><span class="line">--cert-dir=/opt/kubernetes/ssl \\</span><br><span class="line">--pod-infra-container-image=lizhenliang/pause-amd64:3.0&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<blockquote>
<ul>
<li>hostname-override：显示名称，集群中唯一</li>
<li> network-plugin：启用CNI</li>
<li>kubeconfig：空路径，会自动生成，后面用于连接apiserver</li>
<li>bootstrap-kubeconfig：首次启动向apiserver申请证书</li>
<li>config：配置参数文件</li>
<li>cert-dir：kubelet证书生成目录</li>
<li>pod-infra-container-image：管理Pod网络容器的镜像</li>
</ul>
</blockquote>
<h3 id="8-3-配置kubelet-config-yml"><a href="#8-3-配置kubelet-config-yml" class="headerlink" title="8.3 配置kubelet-config.yml"></a>8.3 配置kubelet-config.yml</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/kubernetes/cfg/kubelet-config.yml &lt;&lt; EOF</span><br><span class="line">kind: KubeletConfiguration</span><br><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">address: 192.168.2.21</span><br><span class="line">port: 10250</span><br><span class="line">readOnlyPort: 10255</span><br><span class="line">cgroupDriver: cgroupfs</span><br><span class="line">clusterDNS:</span><br><span class="line">- 10.0.0.2</span><br><span class="line">clusterDomain: cluster.local </span><br><span class="line">failSwapOn: false</span><br><span class="line">authentication:</span><br><span class="line">  anonymous:</span><br><span class="line">    enabled: false</span><br><span class="line">  webhook:</span><br><span class="line">    cacheTTL: 2m0s</span><br><span class="line">    enabled: true</span><br><span class="line">  x509:</span><br><span class="line">    clientCAFile: /opt/kubernetes/ssl/ca.pem </span><br><span class="line">authorization:</span><br><span class="line">  mode: Webhook</span><br><span class="line">  webhook:</span><br><span class="line">    cacheAuthorizedTTL: 5m0s</span><br><span class="line">    cacheUnauthorizedTTL: 30s</span><br><span class="line">evictionHard:</span><br><span class="line">  imagefs.available: 15%</span><br><span class="line">  memory.available: 100Mi</span><br><span class="line">  nodefs.available: 10%</span><br><span class="line">  nodefs.inodesFree: 5%</span><br><span class="line">maxOpenFiles: 1000000</span><br><span class="line">maxPods: 110</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="8-4-生成bootstrap-kubeconfig文件"><a href="#8-4-生成bootstrap-kubeconfig文件" class="headerlink" title="8.4 生成bootstrap.kubeconfig文件"></a>8.4 生成bootstrap.kubeconfig文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">KUBE_APISERVER=&quot;https://192.168.2.20:6443&quot; # apiserver IP:PORT ?</span><br><span class="line">TOKEN=&quot;c47ffb939f5ca36231d9e3121a252940&quot; # 与token.csv里保持一致</span><br></pre></td></tr></table></figure>

<h3 id="8-5-生成-kubelet-bootstrap-kubeconfig-配置文件"><a href="#8-5-生成-kubelet-bootstrap-kubeconfig-配置文件" class="headerlink" title="8.5 生成 kubelet bootstrap kubeconfig 配置文件"></a>8.5 生成 kubelet bootstrap kubeconfig 配置文件</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=$&#123;KUBE_APISERVER&#125; \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">  </span><br><span class="line">kubectl config set-credentials &quot;kubelet-bootstrap&quot; \</span><br><span class="line">  --token=$&#123;TOKEN&#125; \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=&quot;kubelet-bootstrap&quot; \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line">kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"># 拷贝</span><br><span class="line">mv bootstrap.kubeconfig /opt/kubernetes/cfg</span><br></pre></td></tr></table></figure>

<h3 id="8-6-systemd管理kubelet-service"><a href="#8-6-systemd管理kubelet-service" class="headerlink" title="8.6 systemd管理kubelet.service"></a>8.6 systemd管理kubelet.service</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /usr/lib/systemd/system/kubelet.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kubelet</span><br><span class="line">After=docker.service</span><br><span class="line">Requires=docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/opt/kubernetes/cfg/kubelet.conf</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kubelet \$KUBELET_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="8-7-kubelet-启动"><a href="#8-7-kubelet-启动" class="headerlink" title="8.7 kubelet 启动"></a>8.7 kubelet 启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl enabel kubelet</span><br><span class="line">systemctl start kubelet</span><br><span class="line">systemctl status kubelet</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">● kubelet.service - Kubernetes Kubelet</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/kubelet.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Mon 2021-09-27 02:26:01 EDT; 1min 18s ago</span><br><span class="line"> Main PID: 26821 (kubelet)</span><br><span class="line">   CGroup: /system.slice/kubelet.service</span><br><span class="line">           └─26821 /opt/kubernetes/bin/kubelet --logtostderr=false --v=2 --log-dir=/opt/kubernetes/logs --hostname-override=m1 --network-plugin=cni ..</span><br><span class="line">Sep 27 02:26:01 node1 systemd[1]: Started Kubernetes Kubelet.</span><br></pre></td></tr></table></figure>

<h3 id="8-8-批准加入集群-（master操作）"><a href="#8-8-批准加入集群-（master操作）" class="headerlink" title="8.8 批准加入集群 （master操作）"></a>8.8 批准加入集群 （master操作）</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"># 查看kubelet证书请求 </span><br><span class="line">[root@master bin]# kubectl get csr</span><br><span class="line">NAME                                                   AGE    SIGNERNAME                                    REQUESTOR           CONDITION</span><br><span class="line">node-csr-JZLQ2x99c69eRpOjkzoxoDYi3NGF0t5PXEu8AQhkr8M   3m5s   kubernetes.io/kube-apiserver-client-kubelet   kubelet-bootstrap   Pending</span><br><span class="line"></span><br><span class="line"># 批准请求</span><br><span class="line">[root@master bin]# kubectl certificate approve node-csr-JZLQ2x99c69eRpOjkzoxoDYi3NGF0t5PXEu8AQhkr8M</span><br><span class="line">certificatesigningrequest.certificates.k8s.io/node-csr-JZLQ2x99c69eRpOjkzoxoDYi3NGF0t5PXEu8AQhkr8M approved</span><br><span class="line"></span><br><span class="line"># 查看节点</span><br><span class="line">kubectl get node</span><br><span class="line">NAME          STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master1   NotReady    &lt;none&gt;   24m   v1.18.2</span><br></pre></td></tr></table></figure>



<h2 id="9-部署kube-proxy"><a href="#9-部署kube-proxy" class="headerlink" title="9 部署kube-proxy"></a>9 部署kube-proxy</h2><h3 id="9-1-kube-proxy-conf-node操作"><a href="#9-1-kube-proxy-conf-node操作" class="headerlink" title="9.1 kube-proxy.conf (node操作)"></a>9.1 kube-proxy.conf (node操作)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/kubernetes/cfg/kube-proxy.conf &lt;&lt; EOF</span><br><span class="line">KUBE_PROXY_OPTS=&quot;--logtostderr=false \\</span><br><span class="line">--v=2 \\</span><br><span class="line">--log-dir=/opt/kubernetes/logs \\</span><br><span class="line">--config=/opt/kubernetes/cfg/kube-proxy-config.yml&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="9-2-kube-proxy-config-yml-node操作"><a href="#9-2-kube-proxy-config-yml-node操作" class="headerlink" title="9.2 kube-proxy-config.yml (node操作)"></a>9.2 kube-proxy-config.yml (node操作)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /opt/kubernetes/cfg/kube-proxy-config.yml &lt;&lt; EOF</span><br><span class="line">kind: KubeProxyConfiguration</span><br><span class="line">apiVersion: kubeproxy.config.k8s.io/v1alpha1</span><br><span class="line">bindAddress: 0.0.0.0</span><br><span class="line">metricsBindAddress: 0.0.0.0:10249</span><br><span class="line">clientConnection:</span><br><span class="line">  kubeconfig: /opt/kubernetes/cfg/kube-proxy.kubeconfig</span><br><span class="line">hostnameOverride: m1</span><br><span class="line">clusterCIDR: 10.0.0.0/24</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h3 id="9-3-生成证书-master操作"><a href="#9-3-生成证书-master操作" class="headerlink" title="9.3 生成证书 (master操作)"></a>9.3 生成证书 (master操作)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 因为cfssl安装在master上， 在master上生成证书发到nodo上</span><br><span class="line">cd /root/k8s</span><br><span class="line">cat &gt; kube-proxy-csr.json &lt;&lt; EOF</span><br><span class="line">&#123;</span><br><span class="line">  &quot;CN&quot;: &quot;system:kube-proxy&quot;,</span><br><span class="line">  &quot;hosts&quot;: [],</span><br><span class="line">  &quot;key&quot;: &#123;</span><br><span class="line">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">    &quot;size&quot;: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;names&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">      &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">      &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 生成证书</span><br><span class="line">cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy</span><br><span class="line"></span><br><span class="line"># 拷贝到node </span><br><span class="line">scp -r /root/k8s root@192.168.2.21:/opt/ # node1</span><br><span class="line">scp -r /root/k8s root@192.168.2.22:/opt/ # node2 </span><br></pre></td></tr></table></figure>

<h3 id="9-4-生成kubeconfig-node操作"><a href="#9-4-生成kubeconfig-node操作" class="headerlink" title="9.4 生成kubeconfig  (node操作)"></a>9.4 生成kubeconfig  (node操作)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cd /opt/k8s</span><br><span class="line">kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=$&#123;KUBE_APISERVER&#125; \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config set-credentials kube-proxy \</span><br><span class="line">  --client-certificate=./kube-proxy.pem \</span><br><span class="line">  --client-key=./kube-proxy-key.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kube-proxy \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line">kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">cp kube-proxy.kubeconfig /opt/kubernetes/cfg/</span><br></pre></td></tr></table></figure>

<h3 id="9-5-配置kube-proxy-service-node操作"><a href="#9-5-配置kube-proxy-service-node操作" class="headerlink" title="9.5 配置kube-proxy.service (node操作)"></a>9.5 配置kube-proxy.service (node操作)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /usr/lib/systemd/system/kube-proxy.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Proxy</span><br><span class="line">After=network.target</span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/opt/kubernetes/cfg/kube-proxy.conf</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kube-proxy \$KUBE_PROXY_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line">LimitNOFILE=65536</span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="9-6-kube-proxy启动-node操作"><a href="#9-6-kube-proxy启动-node操作" class="headerlink" title="9.6 kube-proxy启动 (node操作)"></a>9.6 kube-proxy启动 (node操作)</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kube-proxy</span><br><span class="line">systemctl enable kube-proxy</span><br><span class="line">systemctl status kube-proxy</span><br><span class="line">Created symlink from /etc/systemd/system/multi-user.target.wants/kube-proxy.service to /usr/lib/systemd/system/kube-proxy.service.</span><br><span class="line">[root@node1 k8s]# </span><br><span class="line">[root@node1 k8s]# systemctl status kube-proxy</span><br><span class="line">● kube-proxy.service - Kubernetes Proxy</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/kube-proxy.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Mon 2021-09-27 03:19:53 EDT; 137ms ago</span><br><span class="line"> Main PID: 31089 (kube-proxy)</span><br><span class="line">   CGroup: /system.slice/kube-proxy.service</span><br><span class="line">           └─31089 /opt/kubernetes/bin/kube-proxy --logtostderr=false --v=2 --log-dir=/opt/kubernetes/logs --config=/opt/kubernetes/cfg/kube-proxy-c...</span><br><span class="line">Sep 27 03:19:53 node1 systemd[1]: Started Kubernetes Proxy.</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="10-部署网络组件"><a href="#10-部署网络组件" class="headerlink" title="10 部署网络组件"></a>10 部署网络组件</h2><p>Calico是一个纯三层的数据中心网络方案，是目前Kubernetes主流的网络方案</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#安装calico</span><br><span class="line">kubectl apply -f calico.yaml</span><br><span class="line">#列出“kube-system”命名空间下的所有pod</span><br><span class="line">kubectl get pods -n kube-system</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">kubectl get node</span><br><span class="line">NAME          STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master1   Ready    &lt;none&gt;   28m   v1.18.2</span><br><span class="line">k8s-node1     Ready    &lt;none&gt;   13m   v1.18.2</span><br><span class="line">k8s-node2     Ready    &lt;none&gt;   14m   v1.18.2</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="授权-apiserver-访问-kubelet"><a href="#授权-apiserver-访问-kubelet" class="headerlink" title="授权 apiserver 访问 kubelet"></a>授权 apiserver 访问 kubelet</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; apiserver-to-kubelet-rbac.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRole</span><br><span class="line">metadata:</span><br><span class="line">  annotations:</span><br><span class="line">    rbac.authorization.kubernetes.io/autoupdate: &quot;true&quot;</span><br><span class="line">  labels:</span><br><span class="line">    kubernetes.io/bootstrapping: rbac-defaults</span><br><span class="line">  name: system:kube-apiserver-to-kubelet</span><br><span class="line">rules:</span><br><span class="line">  - apiGroups:</span><br><span class="line">      - &quot;&quot;</span><br><span class="line">    resources:</span><br><span class="line">      - nodes/proxy</span><br><span class="line">      - nodes/stats</span><br><span class="line">      - nodes/log</span><br><span class="line">      - nodes/spec</span><br><span class="line">      - nodes/metrics</span><br><span class="line">      - pods/log</span><br><span class="line">    verbs:</span><br><span class="line">      - &quot;*&quot;</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: system:kube-apiserver</span><br><span class="line">  namespace: &quot;&quot;</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: system:kube-apiserver-to-kubelet</span><br><span class="line">subjects:</span><br><span class="line">  - apiGroup: rbac.authorization.k8s.io</span><br><span class="line">    kind: User</span><br><span class="line">    name: kubernetes</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f apiserver-to-kubelet-rbac.yaml</span><br></pre></td></tr></table></figure>

<h2 id="11-新增加-Worker-Node"><a href="#11-新增加-Worker-Node" class="headerlink" title="11 新增加 Worker-Node"></a>11 新增加 Worker-Node</h2><h3 id="11-1-拷贝已部署好的Node相关文件到新节点"><a href="#11-1-拷贝已部署好的Node相关文件到新节点" class="headerlink" title="11.1 拷贝已部署好的Node相关文件到新节点"></a>11.1 拷贝已部署好的Node相关文件到新节点</h3><p>在Master节点中，将Worker Node涉及文件拷贝到另外2个节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#拷贝工作目录</span><br><span class="line">scp -r /opt/kubernetes root@192.168.200.201:/opt/</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#拷贝配置文件</span><br><span class="line">scp -r /usr/lib/systemd/system/&#123;kubelet,kube-proxy&#125;.service root@192.168.200.201:/usr/lib/systemd/system</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#拷贝证书文件</span><br><span class="line">scp /opt/kubernetes/ssl/ca.pem root@192.168.200.201:/opt/kubernetes/ssl</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#对node2机器同样执行一遍</span><br><span class="line">scp -r /opt/kubernetes root@192.168.200.202:/opt/</span><br><span class="line">scp -r /usr/lib/systemd/system/&#123;kubelet,kube-proxy&#125;.service root@192.168.200.202:/usr/lib/systemd/system</span><br><span class="line">scp /opt/kubernetes/ssl/ca.pem root@192.168.200.202:/opt/kubernetes/ssl</span><br></pre></td></tr></table></figure>

<h3 id="11-2-删除-kubelet-证书和-kubeconfig-文件"><a href="#11-2-删除-kubelet-证书和-kubeconfig-文件" class="headerlink" title="11.2 删除 kubelet 证书和 kubeconfig 文件"></a>11.2 删除 kubelet 证书和 kubeconfig 文件</h3><p>由于这几个文件是证书申请审批后自动生成的，每个Node不同，因此必须删除</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#在node1、node2两个节点上分别执行如下命令</span><br><span class="line">rm -f /opt/kubernetes/cfg/kubelet.kubeconfig </span><br><span class="line">rm -f /opt/kubernetes/ssl/kubelet*</span><br></pre></td></tr></table></figure>

<h3 id="11-3-修改主机名"><a href="#11-3-修改主机名" class="headerlink" title="11.3 修改主机名"></a>11.3 修改主机名</h3><p>在两台机器上分别打开2个配置文件，并修改主机名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 修改node1 kubelet配置文件</span><br><span class="line">vi /opt/kubernetes/cfg/kubelet.conf</span><br><span class="line">--hostname-override=k8s-node1</span><br><span class="line"># 或者sed -i直接替换</span><br><span class="line"># sed -i &quot;s/k8s-master1/k8s-node1/g&quot; /opt/kubernetes/cfg/kubelet.conf  </span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#修改kube-proxy配置文件</span><br><span class="line">vi /opt/kubernetes/cfg/kube-proxy-config.yml</span><br><span class="line">hostnameOverride: k8s-node1</span><br><span class="line"># 或者sed -i直接替换</span><br><span class="line"># sed -i &quot;s/k8s-master1/k8s-node1/g&quot; /opt/kubernetes/cfg/kube-proxy-config.yml</span><br></pre></td></tr></table></figure>

<p>node2操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># sed -i &quot;s/k8s-master1/k8s-node2/g&quot; /opt/kubernetes/cfg/kubelet.conf  </span><br><span class="line"># sed -i &quot;s/k8s-master1/k8s-node2/g&quot; /opt/kubernetes/cfg/kube-proxy-config.yml</span><br></pre></td></tr></table></figure>



<h3 id="11-4-启动并设置开机启动"><a href="#11-4-启动并设置开机启动" class="headerlink" title="11.4 启动并设置开机启动"></a>11.4 启动并设置开机启动</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start kubelet kube-proxy</span><br><span class="line">systemctl enable kubelet kube-proxy</span><br><span class="line">systemctl status kubelet kube-proxy</span><br><span class="line">&gt;&gt;&gt;</span><br><span class="line">● kube-proxy.service - Kubernetes Proxy</span><br><span class="line">   Loaded: loaded (/usr/lib/systemd/system/kube-proxy.service; enabled; vendor preset: disabled)</span><br><span class="line">   Active: active (running) since Tue 2021-09-28 06:14:10 EDT; 40min ago</span><br><span class="line"> Main PID: 3279 (kube-proxy)</span><br><span class="line">    Tasks: 8</span><br><span class="line">   Memory: 12.3M</span><br><span class="line">   CGroup: /system.slice/kube-proxy.service</span><br><span class="line">           └─3279 /opt/kubernetes/bin/kube-proxy --logtostderr=false --v=2 --log-...</span><br><span class="line"></span><br><span class="line">Sep 28 06:14:10 k8s-master1 systemd[1]: Started Kubernetes Proxy.</span><br><span class="line">Hint: Some lines were ellipsized, use -l to show in full.</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="11-5-在Master上批准新的Node-kubelet证书申请"><a href="#11-5-在Master上批准新的Node-kubelet证书申请" class="headerlink" title="11.5 在Master上批准新的Node kubelet证书申请"></a>11.5 在Master上批准新的Node kubelet证书申请</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"># 先查看证书请求：</span><br><span class="line">kubectl get csr </span><br><span class="line">在两台node机器上分别执行完前4步操作之后（node节点中启动kubelet后就会有请求信息），查</span><br><span class="line"></span><br><span class="line">#授权ndoe1</span><br><span class="line">kubectl certificate approve node-csr-MYWfZXy8o2n8Gb6dZ-fVKw1qVFkmgEkSFdg7m1VL56w</span><br><span class="line">#授权node2</span><br><span class="line">kubectl certificate approve node-csr-XAp5v8JU6qlAkDwzXPiN0DkJ9xlqsq4KbMekUFqBwKM</span><br></pre></td></tr></table></figure>
<h3 id="11-6：查看Node状态"><a href="#11-6：查看Node状态" class="headerlink" title="11.6：查看Node状态"></a>11.6：查看Node状态</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@k8s-master1 ~]# kubectl get node</span><br><span class="line">NAME          STATUS   ROLES    AGE   VERSION</span><br><span class="line">k8s-master1   Ready    &lt;none&gt;   45m   v1.18.2</span><br><span class="line">k8s-node1     Ready    &lt;none&gt;   30m   v1.18.2</span><br><span class="line">k8s-node2     Ready    &lt;none&gt;   31m   v1.18.2</span><br></pre></td></tr></table></figure>

<h2 id="12-测试kubernetes集群"><a href="#12-测试kubernetes集群" class="headerlink" title="12 测试kubernetes集群"></a>12 测试kubernetes集群</h2><p>在Kubernetes集群中创建一个pod，验证是否正常运行：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ kubectl create deployment nginx --image=nginx</span><br><span class="line">$ kubectl expose deployment nginx --port=80 --type=NodePort</span><br><span class="line">$ kubectl get pod,svc</span><br></pre></td></tr></table></figure>
<p>访问地址：<a href="http://NodeIP:Port">http://NodeIP:Port</a>  </p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/27/2021-09-27-k8s%E9%85%8D%E7%BD%AEflannel%E7%BD%91%E7%BB%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/27/2021-09-27-k8s%E9%85%8D%E7%BD%AEflannel%E7%BD%91%E7%BB%9C/" class="post-title-link" itemprop="url">配置flannel</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-27 09:09:00 / 修改时间：12:23:46" itemprop="dateCreated datePublished" datetime="2021-09-27T09:09:00+08:00">2021-09-27</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="5-部署Flannel网络"><a href="#5-部署Flannel网络" class="headerlink" title="5 部署Flannel网络"></a>5 部署Flannel网络</h2><p>Falnnel要用etcd存储自身一个子网信息，所以要保证能成功连接Etcd，写入预定义子网段<br> ( master操作 )</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># etcdctl 3</span><br><span class="line">cd /opt/etcd/ssl</span><br><span class="line">/opt/etcd/bin/etcdctl --cacert=/opt/etcd/ssl/ca.pem --cert=/opt/etcd/ssl/server.pem --key=/opt/etcd/ssl/server-key.pem --endpoints=&quot;https://192.168.2.20:2379,https://192.168.2.21:2379,https://192.168.2.22:2379&quot; put /coreos.com/network/config  &#x27;&#123; &quot;Network&quot;: &quot;172.17.0.0/16&quot;, &quot;Backend&quot;: &#123;&quot;Type&quot;: &quot;vxlan&quot;&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>这是etcdctl 3 的用法，与etcdctl 2 不一样:</p>
<p>/opt/etcd/bin/etcdctl <br>–ca-file=ca.pem –cert-file=server.pem –key-file=server-key.pem <br>–endpoints=”<a href="https://192.168.13.141:2379,https://192.168.13.142:2379,https://192.168.13.143:2379&quot;">https://192.168.13.141:2379,https://192.168.13.142:2379,https://192.168.13.143:2379&quot;</a> <br>set /coreos.com/network/config  ‘{ “Network”: “172.17.0.0/16”, “Backend”: {“Type”: “vxlan”}}’</p>
</blockquote>
<p>以下部署步骤在规划的每个node节点都操作。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 下载二进制包</span><br><span class="line">wget https://github.com/coreos/flannel/releases/download/v0.10.0/flannel-v0.10.0-linux-amd64.tar.gz</span><br><span class="line">tar zxvf flannel-v0.10.0-linux-amd64.tar.gz</span><br><span class="line">mkdir -pv /opt/kubernetes/bin</span><br><span class="line">mv flanneld mk-docker-opts.sh /opt/kubernetes/bin</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">#配置Flannel：</span><br><span class="line">mkdir -pv /opt/kubernetes/cfg/</span><br><span class="line">cat &gt; /opt/kubernetes/cfg/flanneld &lt;&lt; EOF</span><br><span class="line">FLANNEL_OPTIONS=&quot;--etcd-endpoints=https://192.168.2.20:2379,https://192.168.2.21:2379,https://192.168.2.22:2379 -etcd-cafile=/opt/etcd/ssl/ca.pem -etcd-certfile=/opt/etcd/ssl/server.pem -etcd-keyfile=/opt/etcd/ssl/server-key.pem&quot;</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#systemd管理Flannel：</span><br><span class="line">cat &gt; /usr/lib/systemd/system/flanneld.service &lt;&lt; EOF</span><br><span class="line">[Unit]</span><br><span class="line">Description=Flanneld overlay address etcd agent</span><br><span class="line">After=network-online.target network.target</span><br><span class="line">Before=docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=/opt/kubernetes/cfg/flanneld</span><br><span class="line">ExecStart=/opt/kubernetes/bin/flanneld --ip-masq $FLANNEL_OPTIONS</span><br><span class="line">ExecStartPost=/opt/kubernetes/bin/mk-docker-opts.sh -k DOCKER_NETWORK_OPTIONS -d /run/flannel/subnet.env</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果没有/run/flannel/subnet.env， 创建一个</p>
<p>mkdir /run/flannel</p>
<p>cat &gt; /run/flannel/subnet.env &lt;&lt; EOF<br>FLANNEL_NETWORK=172.17.0.0/16<br>FLANNEL_SUBNET=172.17.207.1/24<br>FLANNEL_MTU=1500<br>FLANNEL_IPMASQ=false<br>EOF</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">#配置Docker启动指定子网段：</span><br><span class="line">cat &gt; /usr/lib/systemd/system/docker.service &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">EnvironmentFile=/run/flannel/subnet.env</span><br><span class="line">ExecStart=/usr/bin/dockerd $DOCKER_NETWORK_OPTIONS</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">LimitCORE=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>重启flannel和docker：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl restart flanneld</span><br><span class="line">systemctl enable flanneld</span><br><span class="line">systemctl restart docker</span><br></pre></td></tr></table></figure>

<p>检查是否生效：（确保docker0与flannel.1在同一网段。）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line">[root@node2 ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 00:0c:29:cc:02:29 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.13.143/24 brd 192.168.13.255 scope global ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::d059:defe:bc38:137e/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP </span><br><span class="line">    link/ether 02:42:ce:fa:ff:66 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.69.1/24 brd 172.17.69.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:ceff:fefa:ff66/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: flannel.1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/ether ce:eb:c2:70:84:a2 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.69.0/32 scope global flannel.1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::cceb:c2ff:fe70:84a2/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">[root@node1 ~]# ip a</span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN qlen 1</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP qlen 1000</span><br><span class="line">    link/ether 00:0c:29:27:d1:4f brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.13.142/24 brd 192.168.13.255 scope global ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::4e07:7b5b:8315:984a/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">3: docker0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UP </span><br><span class="line">    link/ether 02:42:f4:33:f5:e0 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.91.1/24 brd 172.17.91.255 scope global docker0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::42:f4ff:fe33:f5e0/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">4: flannel.1: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1450 qdisc noqueue state UNKNOWN </span><br><span class="line">    link/ether 42:de:f7:5d:a5:74 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 172.17.91.0/32 scope global flannel.1</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::40de:f7ff:fe5d:a574/64 scope link </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">       </span><br><span class="line">测试不同节点互通，在当前节点访问另一个Node节点docker0 IP：</span><br><span class="line">(一个node节点去ping另一个node节点的docker0的IP,能通就说明Flannel部署成功)</span><br><span class="line">[root@node1 ~]# ping 172.17.69.1    </span><br><span class="line">PING 172.17.69.1 (172.17.69.1) 56(84) bytes of data.</span><br><span class="line">64 bytes from 172.17.69.1: icmp_seq=1 ttl=64 time=0.625 ms</span><br><span class="line">64 bytes from 172.17.69.1: icmp_seq=2 ttl=64 time=0.391 ms</span><br><span class="line">64 bytes from 172.17.69.1: icmp_seq=3 ttl=64 time=0.400 ms</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">#创建CA证书：</span><br><span class="line">[root@master ~]# mkdir k8s        #同样创建证书文件存放目录</span><br><span class="line">[root@master ~]# cd k8s</span><br><span class="line">[root@master k8s]# vim ca-config.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;signing&quot;: &#123;</span><br><span class="line">    &quot;default&quot;: &#123;</span><br><span class="line">      &quot;expiry&quot;: &quot;87600h&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;profiles&quot;: &#123;</span><br><span class="line">      &quot;kubernetes&quot;: &#123;</span><br><span class="line">         &quot;expiry&quot;: &quot;87600h&quot;,</span><br><span class="line">         &quot;usages&quot;: [</span><br><span class="line">            &quot;signing&quot;,</span><br><span class="line">            &quot;key encipherment&quot;,</span><br><span class="line">            &quot;server auth&quot;,</span><br><span class="line">            &quot;client auth&quot;</span><br><span class="line">        ]</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@master k8s]# vim ca-csr.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;CN&quot;: &quot;kubernetes&quot;,</span><br><span class="line">    &quot;key&quot;: &#123;</span><br><span class="line">        &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">        &quot;size&quot;: 2048</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;names&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">            &quot;L&quot;: &quot;Beijing&quot;,</span><br><span class="line">            &quot;ST&quot;: &quot;Beijing&quot;,</span><br><span class="line">            &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">            &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">生成apiserver证书：</span><br><span class="line">[root@master k8s]# vim server-csr.json</span><br><span class="line">&#123;</span><br><span class="line">    &quot;CN&quot;: &quot;kubernetes&quot;,</span><br><span class="line">    &quot;hosts&quot;: [</span><br><span class="line">      &quot;10.0.0.1&quot;,</span><br><span class="line">      &quot;127.0.0.1&quot;,</span><br><span class="line">      &quot;192.168.13.141&quot;,</span><br><span class="line">      &quot;192.168.13.142&quot;,</span><br><span class="line">      &quot;192.168.13.143&quot;,</span><br><span class="line">      &quot;kubernetes&quot;,</span><br><span class="line">      &quot;kubernetes.default&quot;,</span><br><span class="line">      &quot;kubernetes.default.svc&quot;,</span><br><span class="line">      &quot;kubernetes.default.svc.cluster&quot;,</span><br><span class="line">      &quot;kubernetes.default.svc.cluster.local&quot;</span><br><span class="line">    ],</span><br><span class="line">    &quot;key&quot;: &#123;</span><br><span class="line">        &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">        &quot;size&quot;: 2048</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;names&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">            &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">            &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">            &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">            &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line">=============================================</span><br><span class="line">&quot;10.0.0.1&quot;,   //这个是后边dns要用的虚拟网络的网关,不用改,就用这个--service-cluster-ip-range=10.0.0.0/24 \ 切忌</span><br><span class="line">      &quot;127.0.0.1&quot;,</span><br><span class="line">      &quot;192.168.13.141&quot;,    #k8s集群的ip，也就是三台虚拟机的ip</span><br><span class="line">      &quot;192.168.13.142&quot;,</span><br><span class="line">      &quot;192.168.13.143&quot;,</span><br><span class="line">=============================================</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">生成kube-proxy证书：</span><br><span class="line">[root@master k8s]# vim kube-proxy-csr.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;CN&quot;: &quot;system:kube-proxy&quot;,</span><br><span class="line">  &quot;hosts&quot;: [],</span><br><span class="line">  &quot;key&quot;: &#123;</span><br><span class="line">    &quot;algo&quot;: &quot;rsa&quot;,</span><br><span class="line">    &quot;size&quot;: 2048</span><br><span class="line">  &#125;,</span><br><span class="line">  &quot;names&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;C&quot;: &quot;CN&quot;,</span><br><span class="line">      &quot;L&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;ST&quot;: &quot;BeiJing&quot;,</span><br><span class="line">      &quot;O&quot;: &quot;k8s&quot;,</span><br><span class="line">      &quot;OU&quot;: &quot;System&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[root@master k8s]# cfssl gencert -initca ca-csr.json | cfssljson -bare ca -</span><br><span class="line">[root@master k8s]# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes server-csr.json | cfssljson -bare server</span><br><span class="line">[root@master k8s]# cfssl gencert -ca=ca.pem -ca-key=ca-key.pem -config=ca-config.json -profile=kubernetes kube-proxy-csr.json | cfssljson -bare kube-proxy</span><br><span class="line">最终生成以下证书文件：</span><br><span class="line">[root@master k8s]# ls *pem</span><br><span class="line">ca-key.pem  ca.pem  kube-proxy-key.pem  kube-proxy.pem  server-key.pem  server.pem</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br></pre></td><td class="code"><pre><span class="line">部署apiserver组件</span><br><span class="line">下载二进制包：https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG-1.11.md</span><br><span class="line">下载这个包（kubernetes-server-linux-amd64.tar.gz）就够了，包含了所需的所有组件。</span><br><span class="line">[root@master ~]# mkdir /opt/kubernetes/&#123;bin,cfg,ssl&#125; -pv</span><br><span class="line">[root@master ~]# tar zxvf kubernetes-server-linux-amd64.tar.gz</span><br><span class="line">[root@master ~]# cd kubernetes/server/bin</span><br><span class="line">[root@master ~]# cp kube-apiserver kube-scheduler kube-controller-manager kubectl /opt/kubernetes/bin</span><br><span class="line">从生成证书的机器拷贝证书到master(因为是在一台机器上的 所以直接复制就行)</span><br><span class="line">[root@master ~]# cd k8s</span><br><span class="line">[root@master k8s]# cp server.pem  server-key.pem ca.pem ca-key.pem /opt/kubernetes/ssl/</span><br><span class="line">创建token文件，后面会用到：</span><br><span class="line">[root@master ~]# vim /opt/kubernetes/cfg/token.csv</span><br><span class="line">674c457d4dcf2eefe4920d7dbb6b0ddc,kubelet-bootstrap,10001,&quot;system:kubelet-bootstrap&quot;</span><br><span class="line">第一列：随机字符串，自己可生成（最好不要改，后面会用到这串数字）</span><br><span class="line">第二列：用户名</span><br><span class="line">第三列：UID</span><br><span class="line">第四列：用户组</span><br><span class="line"></span><br><span class="line">创建apiserver配置文件：</span><br><span class="line">[root@master ~]# vim /opt/kubernetes/cfg/kube-apiserver </span><br><span class="line"></span><br><span class="line">KUBE_APISERVER_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--etcd-servers=https://192.168.13.141:2379,https://192.168.13.142:2379,https://192.168.13.143:2379 \</span><br><span class="line">--bind-address=192.168.13.141 \</span><br><span class="line">--secure-port=6443 \</span><br><span class="line">--advertise-address=192.168.13.141 \</span><br><span class="line">--allow-privileged=true \</span><br><span class="line">--service-cluster-ip-range=10.0.0.0/24 \</span><br><span class="line">--enable-admission-plugins=NamespaceLifecycle,LimitRanger,ServiceAccount,ResourceQuota,NodeRestriction \</span><br><span class="line">--authorization-mode=RBAC,Node \</span><br><span class="line">--enable-bootstrap-token-auth \</span><br><span class="line">--token-auth-file=/opt/kubernetes/cfg/token.csv \</span><br><span class="line">--service-node-port-range=30000-50000 \</span><br><span class="line">--tls-cert-file=/opt/kubernetes/ssl/server.pem  \</span><br><span class="line">--tls-private-key-file=/opt/kubernetes/ssl/server-key.pem \</span><br><span class="line">--client-ca-file=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">--service-account-key-file=/opt/kubernetes/ssl/ca-key.pem \</span><br><span class="line">--etcd-cafile=/opt/etcd/ssl/ca.pem \</span><br><span class="line">--etcd-certfile=/opt/etcd/ssl/server.pem \</span><br><span class="line">--etcd-keyfile=/opt/etcd/ssl/server-key.pem&quot;</span><br><span class="line">============================================================</span><br><span class="line">参数说明：</span><br><span class="line">* --logtostderr 启用日志</span><br><span class="line">* --v 日志等级</span><br><span class="line">* --etcd-servers etcd集群地址</span><br><span class="line">* --bind-address 监听地址（本机）</span><br><span class="line">* --secure-port https安全端口</span><br><span class="line">* --advertise-address 集群通告地址（本机）</span><br><span class="line">* --allow-privileged 启用授权</span><br><span class="line">* --service-cluster-ip-range Service虚拟IP地址段    //这里就用这个网段，切忌不要改</span><br><span class="line">* --enable-admission-plugins 准入控制模块</span><br><span class="line">* --authorization-mode 认证授权，启用RBAC授权和节点自管理</span><br><span class="line">* --enable-bootstrap-token-auth 启用TLS bootstrap功能，后面会讲到</span><br><span class="line">* --token-auth-file token文件</span><br><span class="line">* --service-node-port-range Service Node类型默认分配端口范围</span><br><span class="line">============================================================</span><br><span class="line"></span><br><span class="line">systemd管理apiserver：</span><br><span class="line">[root@master ~]# vim /usr/lib/systemd/system/kube-apiserver.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes API Server</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/opt/kubernetes/cfg/kube-apiserver</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kube-apiserver $KUBE_APISERVER_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line">[root@master ~]# systemctl daemon-reload</span><br><span class="line">[root@master ~]# systemctl enable kube-apiserver</span><br><span class="line">[root@master ~]# systemctl start kube-apiserver</span><br><span class="line"></span><br><span class="line">部署schduler组件</span><br><span class="line">创建schduler配置文件：</span><br><span class="line">[root@master ~]# vim /opt/kubernetes/cfg/kube-scheduler </span><br><span class="line"></span><br><span class="line">KUBE_SCHEDULER_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--master=127.0.0.1:8080 \</span><br><span class="line">--leader-elect&quot;</span><br><span class="line">============================================</span><br><span class="line">参数说明：</span><br><span class="line">* --master 连接本地apiserver</span><br><span class="line">* --leader-elect 当该组件启动多个时，自动选举（HA）</span><br><span class="line">============================================</span><br><span class="line"></span><br><span class="line">systemd管理schduler组件：</span><br><span class="line">[root@master ~]# vim cat /usr/lib/systemd/system/kube-scheduler.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Scheduler</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/opt/kubernetes/cfg/kube-scheduler</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kube-scheduler $KUBE_SCHEDULER_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line">[root@master ~]# systemctl daemon-reload</span><br><span class="line">[root@master ~]# systemctl enable kube-scheduler </span><br><span class="line">[root@master ~]# systemctl start kube-scheduler </span><br><span class="line"></span><br><span class="line">部署controller-manager组件</span><br><span class="line">创建controller-manager配置文件：</span><br><span class="line">[root@master ~]# cat /opt/kubernetes/cfg/kube-controller-manager </span><br><span class="line">KUBE_CONTROLLER_MANAGER_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--master=127.0.0.1:8080 \</span><br><span class="line">--leader-elect=true \</span><br><span class="line">--address=127.0.0.1 \</span><br><span class="line">--service-cluster-ip-range=10.0.0.0/24 \</span><br><span class="line">--cluster-name=kubernetes \</span><br><span class="line">--cluster-signing-cert-file=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">--cluster-signing-key-file=/opt/kubernetes/ssl/ca-key.pem  \</span><br><span class="line">--root-ca-file=/opt/kubernetes/ssl/ca.pem \</span><br><span class="line">--service-account-private-key-file=/opt/kubernetes/ssl/ca-key.pem&quot;</span><br><span class="line"></span><br><span class="line">systemd管理controller-manager组件：</span><br><span class="line">[root@master ~]# cat /usr/lib/systemd/system/kube-controller-manager.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Controller Manager</span><br><span class="line">Documentation=https://github.com/kubernetes/kubernetes</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/opt/kubernetes/cfg/kube-controller-manager</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kube-controller-manager $KUBE_CONTROLLER_MANAGER_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line">[root@master ~]# systemctl daemon-reload</span><br><span class="line">[root@master ~]# systemctl enable kube-controller-manager</span><br><span class="line">[root@master ~]# systemctl start kube-controller-manager</span><br><span class="line"></span><br><span class="line">所有组件都已经启动成功，通过kubectl工具查看当前集群组件状态：</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl get cs</span><br><span class="line">NAME                 STATUS    MESSAGE             ERROR</span><br><span class="line">scheduler            Healthy   ok                  </span><br><span class="line">etcd-0               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;   </span><br><span class="line">etcd-1               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;   </span><br><span class="line">etcd-2               Healthy   &#123;&quot;health&quot;:&quot;true&quot;&#125;   </span><br><span class="line">controller-manager   Healthy   ok</span><br><span class="line">如上输出说明组件都正常。</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">在Node节点部署组件</span><br><span class="line">Master apiserver启用TLS认证后，Node节点kubelet组件想要加入集群，必须使用CA签发的有效证书才能与apiserver通信，当Node节点很多时，签署证书是一件很繁琐的事情，因此有了TLS Bootstrapping机制，kubelet会以一个低权限用户自动向apiserver申请证书，kubelet的证书由apiserver动态签署。</span><br><span class="line"></span><br><span class="line">master节点部署</span><br><span class="line">将kubelet-bootstrap用户绑定到系统集群角色</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl create clusterrolebinding kubelet-bootstrap \</span><br><span class="line">  --clusterrole=system:node-bootstrapper \</span><br><span class="line">  --user=kubelet-bootstrap</span><br><span class="line"></span><br><span class="line">创建kubeconfig文件:</span><br><span class="line">在生成kubernetes证书的目录下执行以下命令生成kubeconfig文件：</span><br><span class="line">[root@master ~]# cd /k8s</span><br><span class="line">指定apiserver 内网负载均衡地址</span><br><span class="line">[root@master k8s]# KUBE_APISERVER=&quot;https://10.206.176.19:6443&quot;</span><br><span class="line">[root@master k8s]# BOOTSTRAP_TOKEN=674c457d4dcf2eefe4920d7dbb6b0ddc   #这个和上面创建token文件的一致</span><br><span class="line"></span><br><span class="line">设置集群参数</span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=./ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=$&#123;KUBE_APISERVER&#125; \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">设置客户端认证参数</span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-credentials kubelet-bootstrap \</span><br><span class="line">  --token=$&#123;BOOTSTRAP_TOKEN&#125; \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">设置上下文参数</span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kubelet-bootstrap \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">设置默认上下文</span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">创建kube-proxy kubeconfig文件</span><br><span class="line"></span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=./ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=$&#123;KUBE_APISERVER&#125; \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-credentials kube-proxy \</span><br><span class="line">  --client-certificate=./kube-proxy.pem \</span><br><span class="line">  --client-key=./kube-proxy-key.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kube-proxy \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">[root@master k8s]# ls    #会多出下面两个.kubeconfig文件</span><br><span class="line">bootstrap.kubeconfig  kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">将这两个文件拷贝到Node节点/opt/kubernetes/cfg目录下。 !!!!不能忽略</span><br><span class="line">[root@master k8s]# scp bootstrap.kubeconfig  kube-proxy.kubeconfig node1:/opt/kubernetes/cfg</span><br><span class="line">[root@master k8s]# scp bootstrap.kubeconfig  kube-proxy.kubeconfig node2:/opt/kubernetes/cfg</span><br><span class="line"></span><br><span class="line">部署kubelet组件</span><br><span class="line">将前面下载的二进制包中的kubelet和kube-proxy拷贝到/opt/kubernetes/bin目录下。 </span><br><span class="line">（master节点）</span><br><span class="line">cd /root/kubernetes/server/bin/</span><br><span class="line">scp kubelet kube-proxy node1:/opt/kubernetes/bin</span><br><span class="line">scp kubelet kube-proxy node2:/opt/kubernetes/bin</span><br><span class="line">----------------------下面这些操作在所有node节点完成：---------------------------</span><br><span class="line">创建kubelet配置文件：</span><br><span class="line"># vim /opt/kubernetes/cfg/kubelet</span><br><span class="line">KUBELET_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--hostname-override=192.168.13.142 \</span><br><span class="line">--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \</span><br><span class="line">--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \</span><br><span class="line">--config=/opt/kubernetes/cfg/kubelet.config \</span><br><span class="line">--cert-dir=/opt/kubernetes/ssl \</span><br><span class="line">--pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0&quot;</span><br><span class="line">===============================================================</span><br><span class="line">参数说明：</span><br><span class="line">* --hostname-override 在集群中显示的主机名（你改成node1，node2也可以）</span><br><span class="line">* --kubeconfig 指定kubeconfig文件位置，会自动生成</span><br><span class="line">* --bootstrap-kubeconfig 指定刚才生成的bootstrap.kubeconfig文件</span><br><span class="line">* --cert-dir 颁发证书存放位置</span><br><span class="line">* --pod-infra-container-image 管理Pod网络的镜像</span><br><span class="line">===============================================================</span><br><span class="line">其中/opt/kubernetes/cfg/kubelet.config配置文件如下：</span><br><span class="line"># vim /opt/kubernetes/cfg/kubelet.config</span><br><span class="line">kind: KubeletConfiguration</span><br><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">address: 192.168.13.142</span><br><span class="line">port: 10250</span><br><span class="line">readOnlyPort: 10255</span><br><span class="line">cgroupDriver: cgroupfs</span><br><span class="line">clusterDNS: [&quot;10.0.0.2&quot;]</span><br><span class="line">clusterDomain: cluster.local.</span><br><span class="line">failSwapOn: false</span><br><span class="line">authentication:</span><br><span class="line">  anonymous:</span><br><span class="line">    enabled: true </span><br><span class="line">  webhook:</span><br><span class="line">    enabled: false</span><br><span class="line"></span><br><span class="line">systemd管理kubelet组件：</span><br><span class="line"># vim /usr/lib/systemd/system/kubelet.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kubelet</span><br><span class="line">After=docker.service</span><br><span class="line">Requires=docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/opt/kubernetes/cfg/kubelet</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kubelet $KUBELET_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line">KillMode=process</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line"># systemctl daemon-reload</span><br><span class="line"># systemctl enable kubelet</span><br><span class="line"># systemctl start kubelet</span><br><span class="line"></span><br><span class="line">master节点：</span><br><span class="line">在Master审批Node加入集群：</span><br><span class="line">启动后还没加入到集群中，需要手动允许该节点才可以。</span><br><span class="line">在Master节点查看请求签名的Node：</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl get csr</span><br><span class="line">找到NAME</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl certificate approve 刚刚获取到的NAME</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl get node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">node节点：</span><br><span class="line">部署kube-proxy组件</span><br><span class="line">创建kube-proxy配置文件：</span><br><span class="line"># vim /opt/kubernetes/cfg/kube-proxy</span><br><span class="line">KUBE_PROXY_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--hostname-override=192.168.13.142 \</span><br><span class="line">--cluster-cidr=10.0.0.0/24 \</span><br><span class="line">--kubeconfig=/opt/kubernetes/cfg/kube-proxy.kubeconfig&quot;</span><br><span class="line"></span><br><span class="line">systemd管理kube-proxy组件：</span><br><span class="line"># vim /usr/lib/systemd/system/kube-proxy.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Proxy</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/opt/kubernetes/cfg/kube-proxy</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kube-proxy $KUBE_PROXY_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line"># systemctl daemon-reload</span><br><span class="line"># systemctl enable kube-proxy</span><br><span class="line"># systemctl start kube-proxy</span><br><span class="line"></span><br><span class="line">master节点：</span><br><span class="line">查看集群状态</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl get node</span><br><span class="line">NAME             STATUS    ROLES     AGE       VERSION</span><br><span class="line">192.168.13.142   Ready     &lt;none&gt;    1h        v1.11.0</span><br><span class="line">192.168.13.143   Ready     &lt;none&gt;    1h        v1.11.0</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl get cs</span><br><span class="line">NAME                 STATUS    MESSAGE              ERROR</span><br><span class="line">scheduler            Healthy   ok                   </span><br><span class="line">controller-manager   Healthy   ok                   </span><br><span class="line">etcd-1               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line">etcd-2               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line"></span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/23/markdown-mermiad%E6%B5%81%E7%A8%8B%E5%9B%BE%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/23/markdown-mermiad%E6%B5%81%E7%A8%8B%E5%9B%BE%E4%BD%BF%E7%94%A8%E6%96%B9%E6%B3%95/" class="post-title-link" itemprop="url">markdown mermiad流程图使用方法</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-23 11:56:00 / 修改时间：13:14:49" itemprop="dateCreated datePublished" datetime="2021-09-23T11:56:00+08:00">2021-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="1-what-is-mermiad"><a href="#1-what-is-mermiad" class="headerlink" title="1 what is mermiad?"></a>1 what is mermiad?</h3><p>mermaid是一个基于Javascript的图表和图表工具，用文本和代码创建图表和可视化, 可以动态创建和修改图表。</p>
<h3 id="2-mermaid实例"><a href="#2-mermaid实例" class="headerlink" title="2  mermaid实例"></a>2  mermaid实例</h3><p>这是怎么做到的呢？ </p>
<p>我们看看语法，以下语法来自<a target="_blank" rel="noopener" href="https://mermaid-js.github.io/mermaid/">mermaid官网</a></p>
<h3 id="3-基本语法"><a href="#3-基本语法" class="headerlink" title="3 基本语法"></a>3 基本语法</h3><p>所有流程图都由节点、几何形状和边、箭头或线组成。mermiad代码定义了这些节点和边的制作和交互方式。</p>
<p>它还可以容纳不同类型的箭头、多方向箭头以及与子图的链接。</p>
<h4 id="3-1-流程图方向"><a href="#3-1-流程图方向" class="headerlink" title="3.1 流程图方向"></a>3.1 流程图方向</h4><p>流程图的方向有以下几种 :</p>
<ul>
<li>TB - top to bottom 由上至下</li>
<li>TD - top-down/ same as top to bottom 由上至下</li>
<li>BT - bottom to top 由下至上</li>
<li>RL - right to left 从右到左</li>
<li>LR - left to right 从左到右</li>
</ul>
<h3 id="3-2-节点形状"><a href="#3-2-节点形状" class="headerlink" title="3.2 节点形状"></a>3.2 节点形状</h3><p>即流程图中每个文本块，包括开始、结束、处理、判断等。Mermaid 中每个节点都有一个 id，以及节点的文字。</p>
<table>
<thead>
<tr>
<th><code>id[文字]</code></th>
<th>矩形节点</th>
</tr>
</thead>
<tbody><tr>
<td><code>id(文字)</code></td>
<td>圆角矩形节点</td>
</tr>
<tr>
<td><code>id([文字])</code></td>
<td>体育场型节点</td>
</tr>
<tr>
<td><code>id[[文字]]</code></td>
<td>子程序型节点</td>
</tr>
<tr>
<td><code>id[(文字)]</code></td>
<td>圆柱型节点</td>
</tr>
<tr>
<td><code>id((文字))</code></td>
<td>圆形节点</td>
</tr>
<tr>
<td><code>id&gt;文字]</code></td>
<td>右向旗帜状节点</td>
</tr>
<tr>
<td><code>id&#123;文字&#125;</code></td>
<td>菱形节点</td>
</tr>
<tr>
<td><code>id&#123;&#123;文字&#125;&#125;</code></td>
<td>六边形节点</td>
</tr>
<tr>
<td><code>id[/文字/]</code></td>
<td>平行四边形节点</td>
</tr>
<tr>
<td><code>id[\文字\]</code></td>
<td>反向平行四边形节点</td>
</tr>
<tr>
<td><code>id[/文字\]</code></td>
<td>梯型节点</td>
</tr>
<tr>
<td><code>id[\文字/]</code></td>
<td>向下梯型节点</td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">id1(圆角矩形节点)---id2([体育场型节点])---id3[[子程序型节点]];</span><br></pre></td></tr></table></figure>


<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">id1(圆角矩形节点)---id2([体育场型节点])---id3[[子程序型节点]];</span><br></pre></td></tr></table></figure>

<h3 id="3-3-线条、箭头形状"><a href="#3-3-线条、箭头形状" class="headerlink" title="3.3 线条、箭头形状"></a>3.3 线条、箭头形状</h3><table>
<thead>
<tr>
<th>表述</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td><code>--&gt;</code></td>
<td>添加尾部箭头</td>
</tr>
<tr>
<td><code>---</code></td>
<td>不添加尾部箭头</td>
</tr>
<tr>
<td><code>----</code></td>
<td>单线</td>
</tr>
<tr>
<td><code>--text--</code></td>
<td>单线上加文字</td>
</tr>
<tr>
<td><code>--text--&gt;</code></td>
<td>箭头上加文字</td>
</tr>
<tr>
<td><code>==</code></td>
<td>粗线</td>
</tr>
<tr>
<td><code>==text==</code></td>
<td>粗线加文字</td>
</tr>
<tr>
<td><code>-.-</code></td>
<td>虚线</td>
</tr>
<tr>
<td><code>-.text.-</code></td>
<td>虚线加文字</td>
</tr>
<tr>
<td><code>o--o</code></td>
<td>双向圆点</td>
</tr>
<tr>
<td><code>&lt;--&gt;</code></td>
<td>双向箭头</td>
</tr>
<tr>
<td>`x–x</td>
<td>双向x</td>
</tr>
</tbody></table>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">flowchart LR</span><br><span class="line">id1(1)---id2(2)--&gt;id3(3)--文字---id4(4);</span><br></pre></td></tr></table></figure>

<p><strong>线的加长或加粗</strong></p>
<table>
<thead>
<tr>
<th>Length</th>
<th>1</th>
<th>2</th>
<th>3</th>
</tr>
</thead>
<tbody><tr>
<td>线条</td>
<td><code>---</code></td>
<td><code>----</code></td>
<td><code>-----</code></td>
</tr>
<tr>
<td>箭头</td>
<td><code>--&gt;</code></td>
<td><code>---&gt;</code></td>
<td><code>----&gt;</code></td>
</tr>
<tr>
<td>加粗</td>
<td><code>===</code></td>
<td><code>====</code></td>
<td><code>=====</code></td>
</tr>
<tr>
<td>加粗箭头</td>
<td><code>==&gt;</code></td>
<td><code>===&gt;</code></td>
<td><code>====&gt;</code></td>
</tr>
<tr>
<td>加长点</td>
<td><code>-.-</code></td>
<td><code>-..-</code></td>
<td><code>-...-</code></td>
</tr>
<tr>
<td>加长点加箭头</td>
<td><code>-.-&gt;</code></td>
<td><code>-..-&gt;</code></td>
<td><code>-...-&gt;</code></td>
</tr>
</tbody></table>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[Start] --&gt; B&#123;Is it?&#125;;</span><br><span class="line">    B --&gt;|Yes| C[OK];</span><br><span class="line">    C --&gt; D[Rethink];</span><br><span class="line">    D --&gt; B;</span><br><span class="line">    B ----&gt;|No| E[End];</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">flowchart TD</span><br><span class="line">    A[Start] --&gt; B&#123;Is it?&#125;;</span><br><span class="line">    B --&gt;|Yes| C[OK];</span><br><span class="line">    C --&gt; D[Rethink];</span><br><span class="line">    D --&gt; B;</span><br><span class="line">    B ----&gt;|No| E[End];</span><br></pre></td></tr></table></figure>



<h3 id="3-4-子图"><a href="#3-4-子图" class="headerlink" title="3.4 子图"></a>3.4 子图</h3><p>可以在流程中添加子图，语法简明，如下 ：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">flowchart TB</span><br><span class="line">    c1--&gt;a2</span><br><span class="line">    subgraph one</span><br><span class="line">    a1--&gt;a2</span><br><span class="line">    end</span><br><span class="line">    subgraph two</span><br><span class="line">    b1--&gt;b2</span><br><span class="line">    end</span><br><span class="line">    subgraph three</span><br><span class="line">    c1--&gt;c2</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">flowchart TB</span><br><span class="line">    c1--&gt;a2</span><br><span class="line">    subgraph one</span><br><span class="line">    a1--&gt;a2</span><br><span class="line">    end</span><br><span class="line">    subgraph two</span><br><span class="line">    b1--&gt;b2</span><br><span class="line">    end</span><br><span class="line">    subgraph three</span><br><span class="line">    c1--&gt;c2</span><br><span class="line">    end</span><br></pre></td></tr></table></figure>

<p>更多用法见官网</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/23/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/23/golang%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">golang学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-23 11:05:00 / 修改时间：19:05:17" itemprop="dateCreated datePublished" datetime="2021-09-23T11:05:00+08:00">2021-09-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-golang开山篇"><a href="#1-golang开山篇" class="headerlink" title="1 golang开山篇"></a>1 golang开山篇</h2><p>本笔记来自尚硅谷课程<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1ME411Y71o">《Golang入门到实战教程》</a></p>
<h3 id="1-1-golang学习方向"><a href="#1-1-golang学习方向" class="headerlink" title="1.1 golang学习方向"></a>1.1 golang学习方向</h3><ul>
<li> 区块链研发工程师</li>
<li>go服务器端/游戏软件工程师</li>
<li>go分布式/云计算工程师</li>
</ul>
<h3 id="1-2-应用领域"><a href="#1-2-应用领域" class="headerlink" title="1.2 应用领域"></a>1.2 应用领域</h3><ul>
<li>区块链（blockchain technology）的应用开发,  也称分布式账本技术， 是一种互联网数据库技术，其特点是去中心化、公开透明，让每个人均可参与数据库记录</li>
<li>后端服务器应用， 如美团后台流量支撑，游戏后端。</li>
<li>云计算、云服务器 </li>
</ul>
<h3 id="1-3-学习方法推荐"><a href="#1-3-学习方法推荐" class="headerlink" title="1.3 学习方法推荐"></a>1.3 学习方法推荐</h3><ul>
<li>高效而愉快的学习</li>
<li>先建立一个整体框架，然后再扣细节</li>
<li>在实际工作中，要培养用到什么，能够快速学习的能力</li>
<li>要先 know how, 在 know why——工科</li>
<li>软件编程是一们做中学的学科</li>
<li>适当的囫囵吞枣</li>
<li>学习软件编程是在琢磨别人怎么做 #向优美的代码学习</li>
</ul>
<h3 id="1-4-go语言吉祥物"><a href="#1-4-go语言吉祥物" class="headerlink" title="1.4 go语言吉祥物"></a>1.4 go语言吉祥物</h3><p>金花鼠gordon </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/go1.png"></p>
<h3 id="1-4-讲课方式的说明"><a href="#1-4-讲课方式的说明" class="headerlink" title="1.4 讲课方式的说明"></a>1.4 讲课方式的说明</h3><ol>
<li>努力做到通俗易懂</li>
<li>注重语言体系，同时兼顾技术细节</li>
<li>在实际工作中， 如何快速的掌握一个技术的分享，讲解 </li>
</ol>
<p><strong>如何快速深入的学习技术</strong>？(建议)</p>
<p>需求-&gt;现有技术的缺陷-&gt;学习新技术-&gt;快速入门-&gt;框架-&gt;不断补充细节</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graph LR</span><br><span class="line">    id1(需求)--&gt;id2(现有技术的缺陷)--&gt;id3(学习新技术)--&gt;id4(快速入门)--&gt;id5(理解框架)--&gt;id6(不断积累补充细节)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="2-Golang导论"><a href="#2-Golang导论" class="headerlink" title="2 Golang导论"></a>2 Golang导论</h2><h3 id="2-1-什么是程序？"><a href="#2-1-什么是程序？" class="headerlink" title="2.1 什么是程序？"></a>2.1 什么是程序？</h3><p>要让人做事需要告诉他做什么事，让程序做一件事要告诉计算机怎么做。 </p>
<blockquote>
<p>程序：为了让计算机执行某些操作或解决某个问题而编写的一系列有序指令的集合。 </p>
</blockquote>
<h3 id="2-2-go诞生小故事"><a href="#2-2-go诞生小故事" class="headerlink" title="2.2 go诞生小故事"></a>2.2 go诞生小故事</h3><p>核心开发团队：</p>
<ul>
<li> Ken Thompson  </li>
<li>Rob Pike </li>
<li>Robert Griesemer</li>
</ul>
<h3 id="2-3-google-创造golang的原因"><a href="#2-3-google-创造golang的原因" class="headerlink" title="2.3 google 创造golang的原因"></a>2.3 google 创造golang的原因</h3><ol>
<li>计算机硬件技术更新频繁，性能提高很快， 目前主流的编程语言发展明显落后于硬件，不能合理利用多核多cpu的优势提升软件系统性能 </li>
<li>软件系统复杂度越来越高，维护成本越来越高，目前缺乏一个足够简介高效的编程语言（认为现有的编程语言，风格不够统一，计算能力不够，处理大并发不够好）</li>
<li>企业运行维护很多c/c++的项目，c/c++程序速度虽然很快，但是编译速度确实很慢，还存在内存泄漏的问题。 </li>
</ol>
<h3 id="2-4-golang-的发展历程"><a href="#2-4-golang-的发展历程" class="headerlink" title="2.4 golang 的发展历程"></a>2.4 golang 的发展历程</h3><ul>
<li> 2007，谷歌工程师Rob Pike, Ken Thomson, Robert Griesemer开始设计一门全新的语言，这是go的原型。 </li>
<li>2009年11月10日， google将go语言以开放源代码的放方向向全球发布</li>
<li>2015年8月19日， go 1.5版本发布， 本次更新移除了最后参与的c代码</li>
<li>2017年2月17日，go1.8版本发布</li>
<li>2017年8月24日， go语言1.9发布</li>
<li>2018年2月16日， go语言1.10发布</li>
</ul>
<h3 id="2-5-go的语言特点"><a href="#2-5-go的语言特点" class="headerlink" title="2.5 go的语言特点"></a>2.5 go的语言特点</h3><ul>
<li><p> go语言保证了既能达到静态编译语言的安全和性能，又达到了动态语言开发维护的高效率。使用一个表达式来形容go语言： go = c+ python </p>
</li>
<li><p>从c语言中继承了很多理念，包括表达式语法，控制结构， 基础数据结构，调用参数传值，指针等。</p>
</li>
<li><p>引入包的的概念， 用于组织程序结构，go语言每一个文件都要归属一个包，而不能单独存在 </p>
</li>
<li><p>垃圾回收机制， 内存自动回收，不需要开发人员管理</p>
</li>
<li><p>天然并发</p>
<ol>
<li>从语言层面支持并发，实现简单</li>
<li>goroutine，轻量级线程，可实现大并发处理，高效利用多核</li>
<li>基于CPS(communicating sequential processes)实现</li>
</ol>
</li>
<li><p>吸收了管道通信机制， 形成go特有的管道channel，通过channel，可以实现不同观点goroute之间的相互通信</p>
</li>
<li><p>函数可以返回 多个值 </p>
</li>
<li><p>切片slice, 延时执行 </p>
</li>
</ul>
<h3 id="2-4-开发工具的介绍"><a href="#2-4-开发工具的介绍" class="headerlink" title="2.4 开发工具的介绍"></a>2.4 开发工具的介绍</h3><h4 id="2-4-1-工具介绍"><a href="#2-4-1-工具介绍" class="headerlink" title="2.4.1 工具介绍"></a>2.4.1 工具介绍</h4><ul>
<li>visual studio code, 提供go语言的语法高亮， 安装go语言插件，支持智能提示</li>
<li>sublime text </li>
<li>vim </li>
<li>emacs </li>
<li>eclipse </li>
<li>liteIDE </li>
<li>jitBrains</li>
</ul>
<h4 id="2-4-2-工具选择"><a href="#2-4-2-工具选择" class="headerlink" title="2.4.2 工具选择"></a>2.4.2 工具选择</h4><p>先使用vscode, 到对go由一定的了解之后， 再换成其他的工具</p>
<p>为什么呢？</p>
<blockquote>
<p>更深刻的理解go语言技术，培养代码感</p>
<p>有利于公司面试， 手撕代码</p>
</blockquote>
<h4 id="2-4-3-配置sdk"><a href="#2-4-3-配置sdk" class="headerlink" title="2.4.3 配置sdk"></a>2.4.3 配置sdk</h4><p><a target="_blank" rel="noopener" href="https://golang.google.cn/dl/">中文官网</a>下载安装即可</p>
<p>安装好自动配置环境变量</p>
<h4 id="2-4-4-vscode下载安装"><a href="#2-4-4-vscode下载安装" class="headerlink" title="2.4.4 vscode下载安装"></a>2.4.4 vscode下载安装</h4><p>官网[<a target="_blank" rel="noopener" href="https://code.visualstudio.com/download">Download Visual Studio Code - Mac, Linux, Windows</a>]下载安装</p>
<h3 id="2-5-go-开发快速入门"><a href="#2-5-go-开发快速入门" class="headerlink" title="2.5 go 开发快速入门"></a>2.5 go 开发快速入门</h3><h4 id="2-5-1-需求"><a href="#2-5-1-需求" class="headerlink" title="2.5.1 需求"></a>2.5.1 需求</h4><p>开发一个hello.go程序，输出 ”hello, world“</p>
<h4 id="2-5-2步骤"><a href="#2-5-2步骤" class="headerlink" title="2.5.2步骤"></a>2.5.2步骤</h4><ol>
<li>目录结构</li>
</ol>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/go3.png"></p>
<ol start="2">
<li>代码 </li>
</ol>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 输出 hello world </span></span><br><span class="line"><span class="keyword">package</span> main </span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span>&#123;</span><br><span class="line">	fmt.Println(<span class="string">&quot;hello world&quot;</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 说明 </li>
</ol>
<ul>
<li> go 文件后缀是.go</li>
<li>package main, 所在文件的包是main, 在go中，每个文件都必须属于一个包</li>
<li>import “fmt”, 引入一个包fmt， 引入后可以使用其函数 </li>
<li>func main(){} ,<ol>
<li>func是一个关键字，表示一个函数 </li>
<li>main是函数名， 是一个主函数， 即程序的入口</li>
</ol>
</li>
<li>fmt.Pritln(“hello, world”) ， 调用fmt函数Pirntln输出</li>
</ul>
<ol start="4">
<li> 编译 </li>
</ol>
<p>   cmd中编译: go build</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">D:\&gt;<span class="title">cd</span> <span class="title">D</span>:\<span class="title">gopackage</span>\<span class="title">src</span>\<span class="title">go_code</span>\<span class="title">project01</span>\<span class="title">main</span>\</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">D</span>:\<span class="title">gopackage</span>\<span class="title">src</span>\<span class="title">go_code</span>\<span class="title">project01</span>\<span class="title">main</span> 的目录</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">2021-09-23  18:52    &lt;<span class="title">DIR</span>&gt;          .</span></span><br><span class="line"><span class="function">2021-09-23  18:52    &lt;<span class="title">DIR</span>&gt;          ..</span></span><br><span class="line"><span class="function">2021-09-23  18:36                97 <span class="title">hello.go</span></span></span><br><span class="line"><span class="function">               1 个文件             97 字节</span></span><br><span class="line"><span class="function">               2 个目录 91,778,326,528 可用字节</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">D</span>:\<span class="title">gopackage</span>\<span class="title">src</span>\<span class="title">go_code</span>\<span class="title">project01</span>\<span class="title">main</span>&gt;<span class="title">go</span> <span class="title">build</span> <span class="title">hello.go</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">D</span>:\<span class="title">gopackage</span>\<span class="title">src</span>\<span class="title">go_code</span>\<span class="title">project01</span>\<span class="title">main</span>&gt;<span class="title">dir</span></span></span><br><span class="line"><span class="function"> 驱动器 <span class="title">D</span> 中的卷是 代码</span></span><br><span class="line"><span class="function"> 卷的序列号是 <span class="title">EC0E</span>-<span class="title">DCEA</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"> <span class="title">D</span>:\<span class="title">gopackage</span>\<span class="title">src</span>\<span class="title">go_code</span>\<span class="title">project01</span>\<span class="title">main</span> 的目录</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">2021-09-23  18:56    &lt;<span class="title">DIR</span>&gt;          .</span></span><br><span class="line"><span class="function">2021-09-23  18:56    &lt;<span class="title">DIR</span>&gt;          ..</span></span><br><span class="line"><span class="function">2021-09-23  18:56         1,924,608 <span class="title">hello.exe</span></span></span><br><span class="line"><span class="function">2021-09-23  18:36                97 <span class="title">hello.go</span></span></span><br><span class="line"><span class="function">               2 个文件      1,924,705 字节</span></span><br><span class="line"><span class="function">               2 个目录 91,776,401,408 可用字节</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li>运行 </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">D:\gopackage\src\go_code\project01\main&gt;hello,go</span><br><span class="line">hello world</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/22/%E3%80%8A%E6%88%91%E4%BB%AC%E3%80%8B%20%E6%91%98%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/22/%E3%80%8A%E6%88%91%E4%BB%AC%E3%80%8B%20%E6%91%98%E5%BD%95/" class="post-title-link" itemprop="url">《我们》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-22 00:00:00 / 修改时间：08:59:18" itemprop="dateCreated datePublished" datetime="2021-09-22T00:00:00+08:00">2021-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="《我们》-摘录"><a href="#《我们》-摘录" class="headerlink" title="《我们》 摘录"></a>《我们》 摘录</h2><p>叶甫盖尼·扎米亚京  陈超译 </p>
<ul>
<li>上帝曾经让天堂里那两位作出自己的选择：或者选择没有自由的幸福，或者选择没有幸福的自由，第三种选择是没有的。</li>
<li>“这表明，你喜欢。你怕它，是因为它的力量大于你。你讨厌它，是因为你怕它。你喜欢它，是因为你无法使它顺从你。人只喜欢他无法占有的东西。”</li>
<li>自由与犯罪是密不可分的，就像…嗯，就像飞机的运动与它的速度，当它速度为零时，它就是静止的，当人没有自由时，他就不会犯罪。这是很清楚的道理。不让人犯罪的唯一途径就是剥夺他的自由。</li>
<li>“告诉我们什么是最后的数字，最终的数字，最大的数字。” “但这太荒唐了！数字的数目是无限的，怎么会有最后的数字呢？” “那怎么会有最后的革命呢？最后的革命是不存在的：革命是无休止的。” </li>
</ul>
<p><strong>附录部分：</strong></p>
<ul>
<li>革命无处不在， 革命蕴涵在万物之中。他是无限的，没有最后的革命，也没有最终的数字。 社会革命只是无限的数字革命中的一个：革命的法则不是社会法则，而是无法估量的更伟大的法则。它是普世的宇宙法则——就像能亮守恒法则和能量耗散法则。终有一天，一道确切的革命法则公式将会确立，在这道公司里，国家、阶级、星星——还有书籍，都会作为数字变量加以描述。</li>
<li>有害的文学作品要比有用的文学作品更有意义，因为它在与熵对抗，它是对抗僵化、硬化、结痂、苔藓、静止的手段。 </li>
<li>异端对于健康是必须的，如果没有异端，就应该催生异端。 </li>
<li>孩子们是最勇敢的哲学家，他们赤裸裸的来到世上，不为最细微的教条、绝对真理、信条所蒙蔽。这就是为什么他们问的每一个问题都很荒唐、天真而又复杂的惊人。</li>
<li>生机勃勃的人总在犯错，总是在追寻、提问、受折磨。</li>
<li>答案可能是错的，哲学可能是谬误——错误比真理更有价值：真理就像机器， 而错误是鲜活的。</li>
<li>荒唐吗？是的。平行线相交也是荒唐的，但它只是在欧几里得的经典几何才是荒唐的。在非欧几何里，它是一则定理，你需要做的就是不再局限于平面，超越平面。</li>
<li>刺痛自己是很困难的，甚至是危险的。但对于那些活着的人来说，在今天像昨天一样生活是更加困难的事情。 </li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/21/2021-09-21-1984/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/21/2021-09-21-1984/" class="post-title-link" itemprop="url">1984</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-21 00:00:00 / 修改时间：11:45:13" itemprop="dateCreated datePublished" datetime="2021-09-21T00:00:00+08:00">2021-09-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h3 id="《1984》摘录"><a href="#《1984》摘录" class="headerlink" title="《1984》摘录"></a>《1984》摘录</h3><ul>
<li><p>有史以来，大概自从新石器时代结束以来，世上就有三种人，即上等人、中等人、下等人。 这三种人的目标是完全不可调和的。上等人的目标是要保持他们的地位。中等人的目标是要同高等人交换地位。下等人的特点始终是，他们劳苦之余无暇旁顾，偶而才顾到日常生活以外的事，因此他们如果有目标的话，无非是取消一切差别，建立一个人人平等的社会。这样，在历史上始终存在着一场一而再再而三发生的斗争，其大致轮廓相同。 他们（上等人）就被中等人所推翻，因为中等人标榜自己为自由和正义而奋斗，把下等人争取到自己一边来。中等人一旦达到目的就把下等人重又推回到原来的被奴役地位，自己变成了上等人。不久，其他两等人中有一等人，或者两等人都分裂出一批新的中等人来，这场斗争就周而复始。 三等人中只有下等人从来没有实现过自己的目标，哪怕是暂时实现自己的目标。 从下等人的观点来看，历史若有变化，大不了是主子名字改变而已。 中等人只要还在争取权力的时候，总是利用自由、正义、博爱这种好听的字眼。 中等人在平等的旗帜下闹革命，一旦推翻了原来的暴政，自己又建立了新的暴政。</p>
</li>
<li><p>在本世纪中叶出现的所谓“取消私有制”，实际上意味着把财产集中到比以前更少得多的一批人手中；不同的只是：新主人是一个集团，而不是一批个人。</p>
</li>
<li><p>把等级社会永久化的问题却比这深刻得多。统治集团只有在四种情况下才会丧失权力：或者是被外部力量所征服；或者是统治无能，群众起来造反；或者是让一个强大而不满的中等人集团出现；或者是自己丧失了统治的信心和意志。这四个原因并不单个起作用，在某种程度上总是同时存在。统治阶级如能防止这四个原因的产生就能永久当权。 在实际生活中，无产阶级者是没有机会升入党内的。他们中间最有天赋的人，若有可能成为不满的核心人物，则干脆由思想警察逐个消灭掉。</p>
</li>
<li><p>从无产阶级那里，没有什么可以担心的。你不去惹他们，他们就会一代又一代地、一个世纪又一个世纪地做工、繁殖、死亡，不仅没有造反的冲动，而且也没有能力理解可以有一个不同于目前世界的世界。只有在工业技术的发展使得你必须给他们以较高的教育的时候，他们才会具有危险性；但是由于军事和商业竞争已不复重要，民众教育水平实际已趋下降。群众有什么看法，或者没有什么看法，已被视为无足轻重的事。因为他们没有智力，所以不妨给予学术自由。而在一个党员身上，哪怕在最无足轻重的问题上都不容有丝毫的不同意见。</p>
</li>
<li><p>历史不是一面镜子，而是黑板上的记号，可以随时擦去，随时填补。更为可怕的是，一旦涂改了，你找不到证据去证明这是篡改历史的行为。</p>
</li>
<li><p>他们生了下来以后就在街头长大，十二岁去做工，经过短短一个美丽的情窦初开时期，在二十岁就结了婚，上三十岁就开始衰老，大多数人在六十岁就死掉了。重体力活、照顾家庭子女、同邻居吵架、电影、足球、啤酒，而尤其是赌博，就是他们心目中的一切。</p>
</li>
<li><p>党的一句口号说：“谁控制过去就控制未来；谁控制现在就控制过去。”虽然从其性质来说，过去是可以改变的，但是却从来没有改变过。凡是现在是正确的东西，永远也是正确的。</p>
</li>
<li><p>但如果不是纯粹为了某件事，他还是能忍着和她一起生活的，那就是性。</p>
</li>
<li><p>除非他们觉醒，否则永远不会反抗；但除非他们反抗，否则不会觉醒。</p>
</li>
<li><p>“你做爱时，耗尽了全部力气，然后你感到愉快，对一切都无所谓。他们不能忍受你有这种感觉，他们想要你时时保持精力充沛。所有那些来来去去的操练、欢呼、挥舞旗帜等等，都无非是另外的性发泄方式。如果你内心感觉愉快，你干吗还要为老大哥、三年计划、两分钟仇恨会以及所有别的操蛋玩意儿激动？”</p>
</li>
<li><p>“你腰部以下才是个造反派。”他告诉她。 她觉得这句话异常精彩，高兴得一把抱住他。</p>
</li>
<li><p>可是，又不想就这样死去，即使看不到未来，也还是要尽可能地延长现在的生活。只能活一天算一天，得过且过。就好比人的肺一遇空气就会呼吸一样，这是一种本能。</p>
</li>
<li><p>寡头集体主义政体的实质，不是父业子承的世袭，而是特定世界观与生活方式的传承与延续，由死人传至活人。统治阶层之所以是统治阶层，便因为只要它指定继任者，政权就可以延续。党所在意的不是血统在政治上的维系而是党本身的存在。由谁掌权并不重要，重要的是，保持社会等级制度始终如一。 </p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/20/2021-09-20-%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/20/2021-09-20-%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A6/" class="post-title-link" itemprop="url">行为经济学</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-09-20T00:00:00+08:00">2021-09-20</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-21 09:37:32" itemprop="dateModified" datetime="2021-09-21T09:37:32+08:00">2021-09-21</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BB%8F%E6%B5%8E%E5%AD%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">经济学笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="导论"><a href="#导论" class="headerlink" title="导论"></a>导论</h2><h2 id="第十二讲-损失厌恶：-赢与输总是绝对的吗？"><a href="#第十二讲-损失厌恶：-赢与输总是绝对的吗？" class="headerlink" title="第十二讲 损失厌恶： 赢与输总是绝对的吗？"></a>第十二讲 损失厌恶： 赢与输总是绝对的吗？</h2><p>损失厌恶：人们讨厌损失</p>
<p>但真的是一种非理性的行为吗? </p>
<p>实验： 训练猴子使用硬币。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A61.png"></p>
<p>从进化论，错配的角度来说，损失厌恶让我更有动力， 有更大的冒险欲望。大脑对盈利和损失是不对称的。 </p>
<p>例子：为什么经营不好的时候， 公司不减低工资而去裁员。降低工资会给员工带来损失厌恶。</p>
<p>框架效应： 同样一个东西， 可以在一个框架下，是盈利的。另一个框架下，是损失的。</p>
<p>处置效应： 卖掉挣钱的，保留亏钱的。 </p>
<p>应用： </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A62.png"></p>
<p>改进：</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A63.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A65.png"></p>
<p>沉没成本： </p>
<p>已经失去的损失，我们不应该再留恋他。</p>
<h2 id="第十三讲：-突出事件放大：-为什么有人买彩票"><a href="#第十三讲：-突出事件放大：-为什么有人买彩票" class="headerlink" title="第十三讲： 突出事件放大： 为什么有人买彩票"></a>第十三讲： 突出事件放大： 为什么有人买彩票</h2><p>小概率事件高估： 预期中的偏差 </p>
<p>突出事件较大的权重： 偏好的偏差</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A66.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A67.png"></p>
<h2 id="第十四讲：心智账户：我们把钱存在哪-？"><a href="#第十四讲：心智账户：我们把钱存在哪-？" class="headerlink" title="第十四讲：心智账户：我们把钱存在哪 ？"></a>第十四讲：心智账户：我们把钱存在哪 ？</h2><p>心智账户，人常把钱分到不同的想象的账户里</p>
<p>由于CEO和部门经理的心智账户不同，导致不同投资策略。 </p>
<p>每个人的心智账户都不同。 </p>
<p>一块100元巧克力自己吃，你可能会觉得贵，但是买送给女朋友，你觉得不贵。</p>
<p>因为自己消费的账户和社交不是一个账户</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A68.png"></p>
<p><strong>禀赋效应</strong>是指当个人一旦拥有某项物品，那么他对该物品价值的评价要比未拥有之前大大提高。它是由Richard Thaler(1980)提出的。这一<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E7%8E%B0%E8%B1%A1/2808631">现象</a>可以用<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E8%A1%8C%E4%B8%BA%E9%87%91%E8%9E%8D%E5%AD%A6/58795">行为金融学</a>中的“<a target="_blank" rel="noopener" href="https://baike.baidu.com/item/%E6%8D%9F%E5%A4%B1%E5%8E%8C%E6%81%B6/2921704">损失厌恶</a>”理论来解释，该理论认为一定量的损失给人们带来的效用降低要多过相同的收益给人们带来的效用增加。因此人们在决策过程中对利害的权衡是不均衡的，对“避害”的考虑远大于对“趋利”的考虑。出于对损失的畏惧，人们在出卖商品时往往索要过高的价格。</p>
<h2 id="第十五章：-羊群效应：人为什么喜欢模仿"><a href="#第十五章：-羊群效应：人为什么喜欢模仿" class="headerlink" title="第十五章： 羊群效应：人为什么喜欢模仿"></a>第十五章： 羊群效应：人为什么喜欢模仿</h2><p>羊群效应：人类的群体模仿行为</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A69.png"></p>
<p>人有盲目跟从的冲动 。</p>
<p>镜像神经元：来体会别人的感受</p>
<h2 id="第十六章：-当前偏差-拖延症是怎么来的？"><a href="#第十六章：-当前偏差-拖延症是怎么来的？" class="headerlink" title="第十六章： 当前偏差 拖延症是怎么来的？"></a>第十六章： 当前偏差 拖延症是怎么来的？</h2><p>当前偏差：当前的折现率会高于未来的折现率。会导致我们更看重当前的快乐。</p>
<p>原因：错配</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A610.png"></p>
<p>当前偏差和讲话语言有没有未来时态有关</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A611.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A612.png"></p>
<p>自控是需要消耗能量的，累的时候更难自控</p>
<p>冥想有助于增加前额皮层的灰质 </p>
<p>呼吸变慢有助于让你冷静</p>
<h2 id="第17讲-市场情绪：怎么衡量非理性？"><a href="#第17讲-市场情绪：怎么衡量非理性？" class="headerlink" title="第17讲 市场情绪：怎么衡量非理性？"></a>第17讲 市场情绪：怎么衡量非理性？</h2><p>投资者情绪高：投资者对它有过分的需求，过高的预期，并非基本面的原因</p>
<p>各种偏差的总结。</p>
<p>投资者心情影响股票市场。 </p>
<p>投资者心情可能受到月亮的影响。</p>
<p>罪恶股票和社会价值股票的差异</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A613.png"></p>
<p>如何测量市场情绪？</p>
<p>ipo数量， 新开账户等。</p>
<p>百度指数 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A613.png"></p>
<h2 id="第18讲-低风险策略：低风险可以有高收益么？"><a href="#第18讲-低风险策略：低风险可以有高收益么？" class="headerlink" title="第18讲 低风险策略：低风险可以有高收益么？"></a>第18讲 低风险策略：低风险可以有高收益么？</h2><h2 id="第19讲-高品质策略：巴菲特真的喜欢价值投资么？"><a href="#第19讲-高品质策略：巴菲特真的喜欢价值投资么？" class="headerlink" title="第19讲 高品质策略：巴菲特真的喜欢价值投资么？"></a>第19讲 高品质策略：巴菲特真的喜欢价值投资么？</h2><p>大佬的投资策略</p>
<p>索罗斯和沃森 ：低风险高收益</p>
<p>巴菲特： 高品质投资， 价值投资</p>
<h2 id="第20讲-量化投资的风险有哪些？"><a href="#第20讲-量化投资的风险有哪些？" class="headerlink" title="第20讲 量化投资的风险有哪些？"></a>第20讲 量化投资的风险有哪些？</h2><p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A615.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A616.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A617.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A618.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A619.png"></p>
<p>量化投资策略三个风险： </p>
<p>失效风险</p>
<p>流通性风险 </p>
<p>模型风险</p>
<h2 id="第二十一讲：-量化投资误区有哪些？"><a href="#第二十一讲：-量化投资误区有哪些？" class="headerlink" title="第二十一讲： 量化投资误区有哪些？"></a>第二十一讲： 量化投资误区有哪些？</h2><p>1 基本面好就会收益率高，不一定。 国家GDP增速好不一定股票表现好， 新新行业不一定比老行业收益率高。 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A620.png"></p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/%E8%A1%8C%E4%B8%BA%E7%BB%8F%E6%B5%8E%E5%AD%A621.png"></p>
<p>2 AI 投资不一定比人好。 </p>
<p>3 智能投顾效果有限</p>
<p>4 在国外市场得出的经验不一定在中国有效</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/19/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%A4%87%E6%B3%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/19/%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%A4%87%E6%B3%A8/" class="post-title-link" itemprop="url">二进制备注</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-19 18:15:00" itemprop="dateCreated datePublished" datetime="2021-09-19T18:15:00+08:00">2021-09-19</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-10-03 18:15:44" itemprop="dateModified" datetime="2021-10-03T18:15:44+08:00">2021-10-03</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>二进制备注 </p>
<p>待整理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line">在Node节点部署组件</span><br><span class="line">Master apiserver启用TLS认证后，Node节点kubelet组件想要加入集群，必须使用CA签发的有效证书才能与apiserver通信，当Node节点很多时，签署证书是一件很繁琐的事情，因此有了TLS Bootstrapping机制，kubelet会以一个低权限用户自动向apiserver申请证书，kubelet的证书由apiserver动态签署。</span><br><span class="line"></span><br><span class="line">master节点部署</span><br><span class="line">将kubelet-bootstrap用户绑定到系统集群角色</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl create clusterrolebinding kubelet-bootstrap \</span><br><span class="line">  --clusterrole=system:node-bootstrapper \</span><br><span class="line">  --user=kubelet-bootstrap</span><br><span class="line"></span><br><span class="line">创建kubeconfig文件:</span><br><span class="line">在生成kubernetes证书的目录下执行以下命令生成kubeconfig文件：</span><br><span class="line">[root@master ~]# cd /k8s</span><br><span class="line">指定apiserver 内网负载均衡地址</span><br><span class="line">[root@master k8s]# KUBE_APISERVER=&quot;https://10.206.176.19:6443&quot;</span><br><span class="line">[root@master k8s]# BOOTSTRAP_TOKEN=674c457d4dcf2eefe4920d7dbb6b0ddc   #这个和上面创建token文件的一致</span><br><span class="line"></span><br><span class="line">设置集群参数</span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=./ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=$&#123;KUBE_APISERVER&#125; \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">设置客户端认证参数</span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-credentials kubelet-bootstrap \</span><br><span class="line">  --token=$&#123;BOOTSTRAP_TOKEN&#125; \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">设置上下文参数</span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kubelet-bootstrap \</span><br><span class="line">  --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">设置默认上下文</span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config use-context default --kubeconfig=bootstrap.kubeconfig</span><br><span class="line"></span><br><span class="line">创建kube-proxy kubeconfig文件</span><br><span class="line"></span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-cluster kubernetes \</span><br><span class="line">  --certificate-authority=./ca.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --server=$&#123;KUBE_APISERVER&#125; \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-credentials kube-proxy \</span><br><span class="line">  --client-certificate=./kube-proxy.pem \</span><br><span class="line">  --client-key=./kube-proxy-key.pem \</span><br><span class="line">  --embed-certs=true \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config set-context default \</span><br><span class="line">  --cluster=kubernetes \</span><br><span class="line">  --user=kube-proxy \</span><br><span class="line">  --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">[root@master k8s]# /opt/kubernetes/bin/kubectl config use-context default --kubeconfig=kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">[root@master k8s]# ls    #会多出下面两个.kubeconfig文件</span><br><span class="line">bootstrap.kubeconfig  kube-proxy.kubeconfig</span><br><span class="line"></span><br><span class="line">将这两个文件拷贝到Node节点/opt/kubernetes/cfg目录下。 !!!!不能忽略</span><br><span class="line">[root@master k8s]# scp bootstrap.kubeconfig  kube-proxy.kubeconfig node1:/opt/kubernetes/cfg</span><br><span class="line">[root@master k8s]# scp bootstrap.kubeconfig  kube-proxy.kubeconfig node2:/opt/kubernetes/cfg</span><br><span class="line"></span><br><span class="line">部署kubelet组件</span><br><span class="line">将前面下载的二进制包中的kubelet和kube-proxy拷贝到/opt/kubernetes/bin目录下。 </span><br><span class="line">（master节点）</span><br><span class="line">cd /root/kubernetes/server/bin/</span><br><span class="line">scp kubelet kube-proxy node1:/opt/kubernetes/bin</span><br><span class="line">scp kubelet kube-proxy node2:/opt/kubernetes/bin</span><br><span class="line">----------------------下面这些操作在所有node节点完成：---------------------------</span><br><span class="line">创建kubelet配置文件：</span><br><span class="line"># vim /opt/kubernetes/cfg/kubelet</span><br><span class="line">KUBELET_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--hostname-override=192.168.13.142 \</span><br><span class="line">--kubeconfig=/opt/kubernetes/cfg/kubelet.kubeconfig \</span><br><span class="line">--bootstrap-kubeconfig=/opt/kubernetes/cfg/bootstrap.kubeconfig \</span><br><span class="line">--config=/opt/kubernetes/cfg/kubelet.config \</span><br><span class="line">--cert-dir=/opt/kubernetes/ssl \</span><br><span class="line">--pod-infra-container-image=registry.cn-hangzhou.aliyuncs.com/google-containers/pause-amd64:3.0&quot;</span><br><span class="line">===============================================================</span><br><span class="line">参数说明：</span><br><span class="line">* --hostname-override 在集群中显示的主机名（你改成node1，node2也可以）</span><br><span class="line">* --kubeconfig 指定kubeconfig文件位置，会自动生成</span><br><span class="line">* --bootstrap-kubeconfig 指定刚才生成的bootstrap.kubeconfig文件</span><br><span class="line">* --cert-dir 颁发证书存放位置</span><br><span class="line">* --pod-infra-container-image 管理Pod网络的镜像</span><br><span class="line">===============================================================</span><br><span class="line">其中/opt/kubernetes/cfg/kubelet.config配置文件如下：</span><br><span class="line"># vim /opt/kubernetes/cfg/kubelet.config</span><br><span class="line">kind: KubeletConfiguration</span><br><span class="line">apiVersion: kubelet.config.k8s.io/v1beta1</span><br><span class="line">address: 192.168.13.142</span><br><span class="line">port: 10250</span><br><span class="line">readOnlyPort: 10255</span><br><span class="line">cgroupDriver: cgroupfs</span><br><span class="line">clusterDNS: [&quot;10.0.0.2&quot;]</span><br><span class="line">clusterDomain: cluster.local.</span><br><span class="line">failSwapOn: false</span><br><span class="line">authentication:</span><br><span class="line">  anonymous:</span><br><span class="line">    enabled: true </span><br><span class="line">  webhook:</span><br><span class="line">    enabled: false</span><br><span class="line"></span><br><span class="line">systemd管理kubelet组件：</span><br><span class="line"># vim /usr/lib/systemd/system/kubelet.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Kubelet</span><br><span class="line">After=docker.service</span><br><span class="line">Requires=docker.service</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=/opt/kubernetes/cfg/kubelet</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kubelet $KUBELET_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line">KillMode=process</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line"># systemctl daemon-reload</span><br><span class="line"># systemctl enable kubelet</span><br><span class="line"># systemctl start kubelet</span><br><span class="line"></span><br><span class="line">master节点：</span><br><span class="line">在Master审批Node加入集群：</span><br><span class="line">启动后还没加入到集群中，需要手动允许该节点才可以。</span><br><span class="line">在Master节点查看请求签名的Node：</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl get csr</span><br><span class="line">找到NAME</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl certificate approve 刚刚获取到的NAME</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl get node</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">node节点：</span><br><span class="line">部署kube-proxy组件</span><br><span class="line">创建kube-proxy配置文件：</span><br><span class="line"># vim /opt/kubernetes/cfg/kube-proxy</span><br><span class="line">KUBE_PROXY_OPTS=&quot;--logtostderr=true \</span><br><span class="line">--v=4 \</span><br><span class="line">--hostname-override=192.168.13.142 \</span><br><span class="line">--cluster-cidr=10.0.0.0/24 \</span><br><span class="line">--kubeconfig=/opt/kubernetes/cfg/kube-proxy.kubeconfig&quot;</span><br><span class="line"></span><br><span class="line">systemd管理kube-proxy组件：</span><br><span class="line"># vim /usr/lib/systemd/system/kube-proxy.service </span><br><span class="line">[Unit]</span><br><span class="line">Description=Kubernetes Proxy</span><br><span class="line">After=network.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">EnvironmentFile=-/opt/kubernetes/cfg/kube-proxy</span><br><span class="line">ExecStart=/opt/kubernetes/bin/kube-proxy $KUBE_PROXY_OPTS</span><br><span class="line">Restart=on-failure</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br><span class="line">启动：</span><br><span class="line"># systemctl daemon-reload</span><br><span class="line"># systemctl enable kube-proxy</span><br><span class="line"># systemctl start kube-proxy</span><br><span class="line"></span><br><span class="line">master节点：</span><br><span class="line">查看集群状态</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl get node</span><br><span class="line">NAME             STATUS    ROLES     AGE       VERSION</span><br><span class="line">192.168.13.142   Ready     &lt;none&gt;    1h        v1.11.0</span><br><span class="line">192.168.13.143   Ready     &lt;none&gt;    1h        v1.11.0</span><br><span class="line">[root@master ~]# /opt/kubernetes/bin/kubectl get cs</span><br><span class="line">NAME                 STATUS    MESSAGE              ERROR</span><br><span class="line">scheduler            Healthy   ok                   </span><br><span class="line">controller-manager   Healthy   ok                   </span><br><span class="line">etcd-1               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line">etcd-2               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line">etcd-0               Healthy   &#123;&quot;health&quot;: &quot;true&quot;&#125;   </span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/13/2021-09-13-linux%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%9C%E4%B8%8E%E7%A3%81%E7%9B%98%E5%88%92%E5%88%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/13/2021-09-13-linux%E5%AD%98%E5%82%A8%E7%BB%93%E6%9E%9C%E4%B8%8E%E7%A3%81%E7%9B%98%E5%88%92%E5%88%86/" class="post-title-link" itemprop="url">linux存储结果与磁盘划分</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-09-13 00:00:00 / 修改时间：11:01:20" itemprop="dateCreated datePublished" datetime="2021-09-13T00:00:00+08:00">2021-09-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>linux系统中文件储存结果颇具特色， 对理解和操作系统也非常重要，这篇笔记总结一下文件层次化标准系统、udev硬件命名规则以及硬盘区分的规划方法。 </p>
<h2 id="1-根目录"><a href="#1-根目录" class="headerlink" title="1 根目录 /"></a>1 根目录 /</h2>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/09/2021-09-09-VM%E5%A4%9A%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E8%B7%AF%E8%AE%BE%E7%BD%AE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/09/2021-09-09-VM%E5%A4%9A%E5%8F%B0%E8%99%9A%E6%8B%9F%E6%9C%BA%E7%BD%91%E8%B7%AF%E8%AE%BE%E7%BD%AE/" class="post-title-link" itemprop="url">VM多台虚拟机网路设置</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-09 22:40:00" itemprop="dateCreated datePublished" datetime="2021-09-09T22:40:00+08:00">2021-09-09</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-09-17 10:45:13" itemprop="dateModified" datetime="2021-09-17T10:45:13+08:00">2021-09-17</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="VM多台虚拟机网路设置"><a href="#VM多台虚拟机网路设置" class="headerlink" title="VM多台虚拟机网路设置"></a>VM多台虚拟机网路设置</h2><p>背景：我需要多台联网的虚拟机搭建集群，使用vmmare构建，设置网路使得：</p>
<ul>
<li> 虚拟机1，虚拟机2 能联通外网</li>
<li>虚拟机1，虚拟机2能相互ping</li>
<li>虚拟机1，虚拟机2ping通主机 </li>
</ul>
<h3 id="第一步-查看当前主机网路的ip、子网掩码、网关"><a href="#第一步-查看当前主机网路的ip、子网掩码、网关" class="headerlink" title="第一步  查看当前主机网路的ip、子网掩码、网关"></a><strong><code>第一步</code></strong>  查看当前主机网路的ip、子网掩码、网关</h3><p>在cmd中使用 <code>ipconfig</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">C:\Users\brisk&gt;ipconfig</span><br><span class="line">Windows IP 配置</span><br><span class="line">...</span><br><span class="line">无线局域网适配器 WLAN:</span><br><span class="line"></span><br><span class="line">   连接特定的 DNS 后缀 . . . . . . . :</span><br><span class="line">   IPv6 地址 . . . . . . . . . . . . : 2001:db8:1:0:e9a5:d9a2:231d:a421</span><br><span class="line">   临时 IPv6 地址. . . . . . . . . . : 2001:db8:1:0:157c:d1b:73f2:2c43</span><br><span class="line">   本地链接 IPv6 地址. . . . . . . . : fe80::e9a5:d9a2:231d:a421%8</span><br><span class="line">   IPv4 地址 . . . . . . . . . . . . : 192.168.2.101</span><br><span class="line">   子网掩码  . . . . . . . . . . . . : 255.255.255.0</span><br><span class="line">   默认网关. . . . . . . . . . . . . : fe80::2eb2:1aff:fe5f:5699%8</span><br><span class="line">                                       192.168.2.1</span><br></pre></td></tr></table></figure>

<ul>
<li> ip: 192.168.2.10</li>
<li>子网掩码：255.255.255.0</li>
<li>网关：192.168.2.1 </li>
</ul>
<h3 id="第二步-设置虚拟网卡"><a href="#第二步-设置虚拟网卡" class="headerlink" title="第二步 设置虚拟网卡"></a><strong><code>第二步</code></strong> 设置虚拟网卡</h3><p>网络设配器—&gt;VMnet8—&gt;属性，按照下图所示设置</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/k8s2.png"></p>
<p>将VMnet8的ip设为192.168.1.1，即为win10网络的网关。这里其实就是把vmnet8这个当成一个虚拟的网关了。</p>
<h3 id="第三步-设置NAT"><a href="#第三步-设置NAT" class="headerlink" title="第三步 设置NAT"></a><strong><code>第三步</code></strong> 设置NAT</h3><p>打开vmware中的 编辑—&gt;编辑虚拟网络编辑器 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/k8s3.png"></p>
<h3 id="第四步-编辑每个虚拟机的网络配置"><a href="#第四步-编辑每个虚拟机的网络配置" class="headerlink" title="第四步 编辑每个虚拟机的网络配置"></a><strong><code>第四步</code></strong> 编辑每个虚拟机的网络配置</h3><p>   配置文件在/etc/sysconfig/network-scripts路径下，一个ip配置为192.168.1.10，另一个192.168.1.11.</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# vi /etc/sysconfig/network-scripts/ifcfg-ens33 </span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=150fb0ae-7bba-4aa1-b6dd-a335f9f116ca</span><br><span class="line">DEVICE=ens33</span><br><span class="line">ONBOOT=yes</span><br><span class="line">IPADDR=192.168.2.10</span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line">GATEWAY=192.168.2.2</span><br><span class="line">DNS1=114.114.114.114</span><br></pre></td></tr></table></figure>

<p>注意修改的如下： </p>
<ul>
<li>BOOTPROTO=static</li>
<li>ONBOOT=yes</li>
<li>IPADDR=192.168.2.10<br>NETMASK=255.255.255.0<br>GATEWAY=192.168.2.2<br>DNS1=114.114.114.114</li>
</ul>
<p>另一台虚拟机相同设置，只是IPADDR不同， IPADDR=192.168.2.11</p>
<h3 id="测试："><a href="#测试：" class="headerlink" title="测试："></a>测试：</h3><ol>
<li> 虚拟机ping 百度 </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@localhost /]# ping www.baidu.com</span><br><span class="line">PING www.a.shifen.com (36.152.44.95) 56(84) bytes of data.</span><br><span class="line">64 bytes from 36.152.44.95 (36.152.44.95): icmp_seq=1 ttl=128 time=18.7 ms</span><br><span class="line">64 bytes from 36.152.44.95 (36.152.44.95): icmp_seq=2 ttl=128 time=19.1 ms</span><br><span class="line">64 bytes from 36.152.44.95 (36.152.44.95): icmp_seq=3 ttl=128 time=18.9 ms</span><br><span class="line">^C</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="2">
<li> 虚拟机1 ping 虚拟机2 </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# ping 192.168.2.10</span><br><span class="line">PING 192.168.2.10 (192.168.2.10) 56(84) bytes of data.</span><br><span class="line">64 bytes from 192.168.2.10: icmp_seq=1 ttl=64 time=2.88 ms</span><br><span class="line">64 bytes from 192.168.2.10: icmp_seq=2 ttl=64 time=3.05 ms</span><br><span class="line">64 bytes from 192.168.2.10: icmp_seq=3 ttl=64 time=2.22 ms</span><br><span class="line">^C</span><br></pre></td></tr></table></figure>

<ol start="3">
<li> 虚拟机1ping 主机</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost /]# ping 192.168.2.101</span><br><span class="line">PING 192.168.2.101 (192.168.2.101) 56(84) bytes of data.</span><br><span class="line">From 192.168.2.11 icmp_seq=1 Destination Host Unreachable</span><br><span class="line">From 192.168.2.11 icmp_seq=2 Destination Host Unreachable</span><br><span class="line">From 192.168.2.11 icmp_seq=3 Destination Host Unreachable</span><br><span class="line">^C</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yuanwanli</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
