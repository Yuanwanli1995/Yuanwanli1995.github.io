<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.3/css/all.min.css" integrity="sha256-2H3fkXt6FEmrReK448mDVGKb3WW2ZZw35gI7vqHOE4Y=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"yuanwanli1995.github.io","root":"/","images":"/images","scheme":"Pisces","version":"8.7.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>
<meta name="description" content="等不是办法，干才有出路">
<meta property="og:type" content="website">
<meta property="og:title" content="brisk">
<meta property="og:url" content="http://yuanwanli1995.github.io/index.html">
<meta property="og:site_name" content="brisk">
<meta property="og:description" content="等不是办法，干才有出路">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="yuanwanli">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://yuanwanli1995.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>brisk</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">brisk</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">welcome</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-overview">
            <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">yuanwanli</p>
  <div class="site-description" itemprop="description">等不是办法，干才有出路</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">39</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>



          </div>
        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/31/2021-10-31-%E3%80%8A%E5%91%A8%E6%81%A9%E6%9D%A5%E4%BC%A0%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/31/2021-10-31-%E3%80%8A%E5%91%A8%E6%81%A9%E6%9D%A5%E4%BC%A0%E3%80%8B/" class="post-title-link" itemprop="url">《周恩来传》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-10-31 00:00:00 / 修改时间：09:11:30" itemprop="dateCreated datePublished" datetime="2021-10-31T00:00:00+08:00">2021-10-31</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="《周恩来传》"><a href="#《周恩来传》" class="headerlink" title="《周恩来传》"></a>《周恩来传》</h2><p>原文摘录：</p>
<ul>
<li> 在人们看来，赫鲁晓夫可能令人恼怒地攻击过周的阶级出身“你的这种批评很好，周同志，”他说，“不过你得承认，我来自工人阶级，而你却出于资产阶级家庭。” 一 阵沉默。而后，周镇静地答道：“是的，赫鲁晓夫同志。但是我俩少有一点是共同的，我们俩都背叛了自己的阶级。” </li>
<li>周思来同志 我们要造你一点反，就是请求你改变现在的工作方式和生活习惯，以适应你的身体变化情，从而你才能为党工作得长久一些，更多一些。这是我们从党和革命的最高的长远的利益出发。所以强烈地请求你接受我们的恳求。</li>
<li>周开始向外国人解释为什么中国不能像西方国家那样行事。他告诉一位外国记者： 中国不能轻率地实行像美国、英国和其他真正民主国家那样的民主。中国人民受过长期的压迫，在他们理解诚实投票的重要性和意义之前，还需要几代人的政治训练。我们还没有为一个彻底的民主制度做好准备。我们必须慢慢来。</li>
<li>司徒雷登本想在6月底访问北京，但未能成行，他收到周一封相当消极的私人信件，该信件戳了一些老伤疤，周取消了对司徒雷登的邀请。几周后又把这个运气不佳的大使描绘成“惯于以和蔼可亲的面目掩盖其虚伪和欺骗”。 周的直率和他那不装模作样的共产主义作风在1949年夏季中的一次讲演中大放光彩，他在北京的一次青年大会上对那些共产主义的下一代谈到毛时说，毛是一个伟人，但与普通人没什么两样，他不应该被看成是“一个偶然的、天生的、神秘的、无法学习的领袖”，年轻人向他学实习时应该从他的历史发展来学习，不要只看今天的成就伟大而不看历史的发展”，昨天迷信的孩子可以变成今天的毛主席(当然，我不是说所有的孩子都可以成毛主席)。他再次提醒说，毛也曾在农村问题上犯过错误。然而，毛已经开始美化他自己的历史，允许献媚的助手去篡改文献。这一腐败倾向在7年前的“整风运动”中就开始了。 周讲话结束时表示完全同意刘少奇对毛的赞扬之词，即毛成功地运用普遍真理于中国的实际。但他补充说，为了使老百姓在这一真理中受益，必须首先通过教育和宣传来使他们提高政治觉悟，因此，周正确地预见了以后10年中国的政策路线斗争，表明他选择了一种缓慢而实用的变革进程，而不是向一种难以捉摸的社会主义作疯狂冲刺。</li>
<li>中国不能轻率地实行像美国、英国和其他真正的民主国家那样的民主。中国人民受过长期的压迫，在他们理解诚实投票的重要性和意义之前，还需要几代人的政治训练。我们还没有为一个初底的民主制度做好准备。我们必须慢慢来。</li>
<li>在一次修面时，周恩来突然咳嗽起来，结果理发师刮破了他的下巴。周恩来看到他那惶恐的样子，迅速道歉说：“我本该在咳嗽前先给你打声招呼。”</li>
<li>周恩来一直没有遭到什么毁灭性的麻烦，因为毛泽东和江青都需要他。甚至在某种程度上，当默默羞辱他的时候，他们也需要利用他那别人无法比拟的才能。</li>
<li>在天安门出现了这样一份悼词，它写道：“他没有遗产，他没有嗣息，他没有坟墓，他也没有留下骨灰，他的骨灰撒在祖国的山河中。他似乎什么也没有给我们留下，但是他拥有全中国，他儿孙好几亿，遍地黄士都是他的。”</li>
<li>他的考虑是对方既富有，家中又有权势，自己家中贫穷，将来会受制于人。</li>
<li>从高级领导层看，这场“文化大革命”也可算作一场夺权的斗争。在斗争中，毛泽东依靠他与周来和代表军队的林彪建立的强大联盟，从刘少奇手中重新夺回了他的领导权。西方观察家一般都认为周恩来是一个温和派，但在这场特殊的斗争中，他与毛泽东站在一起。这可能是因为他更信任、尊敬毛泽东。周恩来与他亲密地共同工作了35年，而刘少奇与周恩来却不太熟悉。</li>
<li>诱使一个世界上最有权力的政治领导人，同时也是一个长期以来对中国共产主义怀有深仇大恨的国家的元首来中国进行官方访问(他的政府甚至还没有承认中国)并与中国领导人就悬而未决的双边问题进行谈判，这是周恩来长期外交生涯中最辉煌的成就。甚至周恩来自己也用同样夸张的语言把它称为国际关系中令人高兴的一个突破。</li>
<li>一名医生后来回忆说：“周恩来是被逼死的。······他们不让他休息。······甚至在我们给周总理输血时，江青也会挂电话来命令在她与总理说话时停止输血，她尽扯些无聊的事，她却把这些称为‘国家大事’。”传说有名医生还声称，中国最优秀的癌症专家提出的治疗方案没被采纳。</li>
<li>周恩来接受了这样一个事实，那就是，中国共产主义的活力将不得不由一个农民领袖来提供。这个人知道农民是如何生活的，并清楚他们在想些什么。而另一方面，毛泽东则需要一个能在世界上代表中国共产主义运动的外交家。周恩来并不奉承毛泽东，但他熟悉毛泽东的个性。毛泽东一方面不信任溜须拍马之辈，另一方面又对潜在的背叛十分敏感。周恩来能够熟练地平息这些不安全因素，而毛泽东为周恩来提供了一个坚如磐石般的长者形象，周恩来童年的经历或许已使他对这样一个形象十分向往。</li>
<li>不是周恩来低估了共产主义，而是毛泽东等走的太快，因为他们在目标与手段之间失去了平衡，他们贪心地以违背自然规律的速度去追求效果，准备把人性中最坏的部分引导出来，还着魔似的相信这可以达到好的目的。这不是共产主义，这只是一个壮观的带有孩子气的梦幻。只有周恩来才是真正的共产主义者，别的人只不过是在玩弄空头政治，而这是他所不擅长的，他有着经过改头换面的拿破仑式的博学，还带有梅特涅式的政治上的坚韧。</li>
<li>周恩来一生的事业可以用消极的色彩来描绘。他献身于共产主义事业，而它能否实现还是个问题；他后来发现，甚至在经济发展这类问题上，其精选出来的信条加上他自己那第一流的实干技巧也不能带来所希望的结果。他自己也在20世纪40年代就认识到除非千百万人民被成功地教育过来，把他们的思想改造得具有合作与集体主义精神，否则的话，共产主义在中国就不会起什么作用。但是，一旦他成为这个巨大国家的政府领导人，他就被驱使着为立即实现共产主义的所有目标而全速前进。</li>
<li>周恩来最后没能实现他的诺言，终其一生也没能把中国决定性地带入一个明显有着更高生活水平的更先进的工业和技术发展的现代社会。严格地说，这不是他的错，而更多的应归因于客观条件的无情。任何想在这样一个落后的大国迅速取得巨大进步的人都难免会遭到巨大挫折。然而，周恩来没有在这不可避免的挫折面前撒手不管或是作出过激的反应。他只是不动声色地坚守他的阵地，为使共产党中国的改革能继续下去提供唯一的一股主要动力。他这么做的时候，不像其他领导人那样以一种执拗的、决不通融的方式进行，而是以一种永远使人感到振奋的、非常民主的风格来进行，这就使得别人不断地集合在他的周围并帮助他奋力去实现目标。</li>
<li>苗谴责周为他的革命把少帅当成了牺牲品。 “不，苗兄，不是我的革命，是为了我们民族的命运，为了正在流血牺牲的千千万万个我们的同胞。你在少帅的舒适的司令部里待得太久了。你还没有亲自到川西、陕北，以及那么多无法生活的地方走走，你还没有看见我们的大多数人民是怎样生活的，他们祖祖辈辈都过着非人的生活啊！” 苗坚持说周对少帅没有感情。“我曾听说共产党人从不为自己同志的死而落泪。” “不！”周回答，“我们从不为悲哀落泪，我们只有愤怒的相，这是绝对不同的，我们正在为人民而战，感伤是没有用的。我们的革命经验是我们的同志用生命换来的，我们的政策是用鲜血写成的，靠几滴伤感的泪水是不行的。” </li>
<li>妇女权利是周恩来热忱改革的对象之一。他对上海的一个妇女组织说：“家庭是很重要的。你们不要看不起家务工作。不管怎么说，你们每个人都负责个一人政府。你们每个人都管理着你们家庭的内政部和外交部。还有谁的工作比这还重要？” </li>
<li>他们是一些错误地判断了人类本性的理想主义者。周恩来接着说，社会主义道路应该是一步一步地走，首先要教育群众，使他们达到一个公平社会的道德水平所要求的高度。在过渡时期，必须认识到群众仍是一些普通的人，他们中间有些人先进，有些人落后，因此“物质刺激”是必要的，鉴于那些一厢情愿的思想家曾经一度认为中国在十几年内就能跨入发达国家的行列，周恩来估计中国还将需要30~-40年才能做到资金和消费品的自给自足，而要达到西方那么高的生活水平，还需要差不多100年的时间。</li>
<li>一些国民党人想把他从共产党这里争取过去，“他们从来没有成功过，因为他从不在意个人的安逸、财富和势力”。</li>
<li>像以往一样，周恩来的策略是找出双方的理亏之处，迫使双方都作出使对方满意的让步。</li>
<li>“文化大革命”中所发生的事是如此复杂，使人们几乎不可能对它作一个简单的分析。但是，看清它的最好的方法是重新观察一下三个融合在一起的,性质截然不同而又都刻有“文革”标记的现象。首先，我们看到的是一场为改变大部分党员和非党员头脑中的传统观念以及封建主义和非社会主义 思想而进行的意识形态运动。这场运动的最终目标是使民主、社会主义和集体主义精神达到一个更高的水平，周恩来是这一愿望的拥护者。 后来，周恩来就是从这个意义出发，把“文革”解释为一个漫长过程 第一步，认为它“不可能一下子解决所有的问题”。几年后，他在与费利克斯・格林谈话时引述了毛的革命思想，并说道：“类似这样的革命应该一次又一次地进行，而且每一次都应达到一个更高的阶段，每一次都应比前一次更深入。”周恩来在这里并不是违心地讲话，而是以一个热心的社会主义者的身份讲这番话的。他在这里以他一的乐观主义态度假定下一次革命可以免无政府主义和权力斗争。 从高级领导层看，这场“文化大革命”也可算作一场夺权的斗争。在斗争中、毛泽东依靠他与周恩来和代表军队的林彪建立的强大联盟，从少奇手中新夺回了他的领导权。西方观察家一般都认为周恩来是一个温和派，但在这场特殊的斗争中，他与毛泽东站在起。这可能是因为他更信任、尊敬毛泽东。周恩来与他亲密地共同工作了35年，而刘少奇与周恩来却不太熟悉。 最后，还有一个低层次的“文化大革命”。这一革命发生在远离北京的地方。它打破正常的法律和秩序的限制，允许一些个人和派别进行报复活动权行动。这场革命最初像是一次有益的周期性放血，但最后却演变成 影全国性的混乱，于是周恩来转而坚决反对它并在最后取得了成功。 </li>
<li>他的一个崇拜者后来这样写道：“他甚至能与魔鬼共事，并从中获胜。 毛泽东开始把周恩来叫做“管家”，这是一个善意的称呼。有一个欧洲外交家曾经这样评论道：如果把中国比作一个家庭，那么，“深受人民喜爱的周恩来就扮演了一个母亲的角色，而一开始受人尊敬、后来又让人害怕的毛泽东则扮演了父亲的角色”。 一个美国学者在华盛顿举行的参议院听证会上警告说，不应过于乐观地把周恩来看做一个实用主义者和一个讲道理的人。“实际上”弗朗茨・迈克尔教授说他是一个很难对付的领导人，但迈克尔所代表的观点在美国舆论界的优势地位正在动摇。周恩来那过人的才能使他不仅在国内压倒了林彪和陈伯达，而且在国外也击败了那些反对他的人。</li>
</ul>
<p>同在《毛泽东传》中一样，作者把总理漫长一生的政治道路选择投射到其童年经历，企图追根溯源作出宿命论的诠释。真可笑。不过，算上文化的间隔，总体上还算客观。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/24/2021-10-24-promethous+grafana/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/24/2021-10-24-promethous+grafana/" class="post-title-link" itemprop="url">promethous+grafana</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-10-24 00:00:00 / 修改时间：22:47:36" itemprop="dateCreated datePublished" datetime="2021-10-24T00:00:00+08:00">2021-10-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <ol>
<li> rbac-setup.yaml </li>
<li>configmap </li>
<li>prometheus.deploy</li>
<li>prometheus.svc</li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/22/2021-10-22-k8s%E9%83%A8%E7%BD%B2%E7%95%99%E8%A8%80%E6%9D%BFguestbook/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/22/2021-10-22-k8s%E9%83%A8%E7%BD%B2%E7%95%99%E8%A8%80%E6%9D%BFguestbook/" class="post-title-link" itemprop="url">k8s部署留言板guestbook</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-10-22 00:00:00 / 修改时间：23:40:11" itemprop="dateCreated datePublished" datetime="2021-10-22T00:00:00+08:00">2021-10-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">编程</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>测试环境为一个master, 两个worker的k8s集群。</p>
<ol>
<li>配置redis-master服务</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; redis-master-deployment.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: apps/v1 </span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-master</span><br><span class="line">  labels:</span><br><span class="line">    app: redis</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: redis</span><br><span class="line">      role: master</span><br><span class="line">      tier: backend</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: redis</span><br><span class="line">        role: master</span><br><span class="line">        tier: backend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: master</span><br><span class="line">        image: kubeguide/redis-master</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6379</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>Kubernetes中Service中起到了负载均衡器的作用，通过Proxy和Selector决定服务请求传递给后端提供服务的Pod，对外提供固定的IP,这样的话Redis Master Pod迁移变化也不会影响。</p>
<ol start="2">
<li>配置redis-master-service.yaml</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; redis-master-service.yaml &lt;&lt; EOF </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-master</span><br><span class="line">  labels:</span><br><span class="line">    app: redis</span><br><span class="line">    role: master</span><br><span class="line">    tier: backend</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 6379</span><br><span class="line">    targetPort: 6379</span><br><span class="line">  selector:</span><br><span class="line">    app: redis</span><br><span class="line">    role: master</span><br><span class="line">    tier: backend</span><br><span class="line">EOF   </span><br></pre></td></tr></table></figure>

<p>部署</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f redis-master-deployment.yaml </span><br><span class="line">kubectl apply -f redis-master-service.yaml</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>配置redis-slave-deployment</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; redis-slave-deployment.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: apps/v1 </span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-slave</span><br><span class="line">  labels:</span><br><span class="line">    app: redis</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: redis</span><br><span class="line">      role: slave</span><br><span class="line">      tier: backend</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: redis</span><br><span class="line">        role: slave</span><br><span class="line">        tier: backend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: slave</span><br><span class="line">        image: kubeguide/guestbook-redis-slave</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        env:</span><br><span class="line">        - name: GET_HOSTS_FROM</span><br><span class="line">          value: dns</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 6379</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol start="4">
<li>配置redis-slave-service.yaml</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; redis-slave-service.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: redis-slave</span><br><span class="line">  labels:</span><br><span class="line">    app: redis</span><br><span class="line">    role: slave</span><br><span class="line">    tier: backend</span><br><span class="line">spec:</span><br><span class="line">  ports:</span><br><span class="line">  - port: 6379</span><br><span class="line">  selector:</span><br><span class="line">    app: redis</span><br><span class="line">    role: slave</span><br><span class="line">    tier: backend</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>启动redis-slave服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f redis-slave-deployment.yaml </span><br><span class="line">kubectl apply -f redis-slave-service.yaml</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>配置前端frontend-deployment.yaml </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; frontend-deployment.yaml  &lt;&lt; EOF</span><br><span class="line">apiVersion: apps/v1 </span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: frontend</span><br><span class="line">  labels:</span><br><span class="line">    app: guestbook</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: guestbook</span><br><span class="line">      tier: frontend</span><br><span class="line">  replicas: 1</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: guestbook</span><br><span class="line">        tier: frontend</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: php-redis</span><br><span class="line">        image: kubeguide/guestbook-php-frontend</span><br><span class="line">        imagePullPolicy: IfNotPresent</span><br><span class="line">        env:</span><br><span class="line">        - name: GET_HOSTS_FROM</span><br><span class="line">          value: dns</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>配置 frontend-service.yaml</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; frontend-service.yaml &lt;&lt; EOF</span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: frontend</span><br><span class="line">  labels:</span><br><span class="line">    app: guestbook</span><br><span class="line">    tier: frontend</span><br><span class="line">spec:</span><br><span class="line">  type: NodePort </span><br><span class="line">  ports:</span><br><span class="line">  - port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 30001</span><br><span class="line">  selector:</span><br><span class="line">    app: guestbook</span><br><span class="line">    tier: frontend</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>启动web服务</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">kubectl apply -f frontend-deployment.yaml </span><br><span class="line">kubectl apply -f frontend-service.yaml</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>查看 </li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@nginx guestbook]# kubectl get pods -o wide</span><br><span class="line">NAME                           READY   STATUS    RESTARTS   AGE   IP           NODE            NOMINATED NODE   READINESS GATES</span><br><span class="line">frontend-56465cb4c6-r4kxz      1/1     Running   0          24m   10.42.0.35   81.68.101.212   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">redis-master-884889466-9jzrt   1/1     Running   0          25m   10.42.1.34   81.68.229.215   &lt;none&gt;           &lt;none&gt;</span><br><span class="line">redis-slave-55c9767c85-t96nf   1/1     Running   0          24m   10.42.1.35   81.68.229.215   &lt;none&gt;           &lt;none&gt;</span><br><span class="line"></span><br><span class="line">[root@nginx guestbook]# kubectl get deployment </span><br><span class="line">NAME           READY   UP-TO-DATE   AVAILABLE   AGE</span><br><span class="line">frontend       1/1     1            1           25m</span><br><span class="line">redis-master   1/1     1            1           25m</span><br><span class="line">redis-slave    1/1     1            1           25m</span><br><span class="line"></span><br><span class="line">[root@nginx guestbook]# kubectl get svc -o wide</span><br><span class="line">NAME           TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE    SELECTOR</span><br><span class="line">frontend       NodePort    10.43.194.57    &lt;none&gt;        80:30001/TCP   25m    app=guestbook,tier=frontend</span><br><span class="line">kubernetes     ClusterIP   10.43.0.1       &lt;none&gt;        443/TCP        4h8m   &lt;none&gt;</span><br><span class="line">redis-master   ClusterIP   10.43.10.250    &lt;none&gt;        6379/TCP       25m    app=redis,role=master,tier=backend</span><br><span class="line">redis-slave    ClusterIP   10.43.183.219   &lt;none&gt;        6379/TCP       25m    app=redis,role=slave,tier=backend</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>暴露的端口是30001, 节点ip:30001可访问</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/guestbook.png"></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/13/2021-10-13-rancher%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/13/2021-10-13-rancher%E9%85%8D%E7%BD%AE%E9%9B%86%E7%BE%A4/" class="post-title-link" itemprop="url">集群安装rancher</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-13 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-13T00:00:00+08:00">2021-10-13</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-10-14 09:39:09" itemprop="dateModified" datetime="2021-10-14T09:39:09+08:00">2021-10-14</time>
      </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>1 安装helm 2 </p>
<h3 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h3><p>在官网下载指定2.16.6版本的helm并传入服务器：<br>下载地址：<a target="_blank" rel="noopener" href="https://get.helm.sh/helm-v2.16.6-linux-amd64.tar.gz%E3%80%82">https://get.helm.sh/helm-v2.16.6-linux-amd64.tar.gz。</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 下载解压即可</span><br><span class="line">tar -xvf helm-v2.16.6-linux-amd64.tar.gz</span><br><span class="line">mv linux-amd64/helm /usr/local/bin/</span><br><span class="line">helm version #查看helm client版本</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>安装tiller </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">cat &gt; rbac-config.yaml &lt;&lt; EOF </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: tiller</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: tiller</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: tiller</span><br><span class="line">    namespace: kube-system</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<p>初始化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 阿里源</span><br><span class="line">helm init --service-account tiller --upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.16.6 --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 查看结果</span><br><span class="line">[root@nginx ops]# helm version</span><br><span class="line">Client: &amp;version.Version&#123;SemVer:&quot;v2.16.6&quot;, GitCommit:&quot;dd2e5695da88625b190e6b22e9542550ab503a47&quot;, GitTreeState:&quot;clean&quot;&#125;</span><br><span class="line">Server: &amp;version.Version&#123;SemVer:&quot;v2.16.6&quot;, GitCommit:&quot;dd2e5695da88625b190e6b22e9542550ab503a47&quot;, GitTreeState:&quot;clean&quot;&#125;</span><br></pre></td></tr></table></figure>





<p>配置nginx.conf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">upstream rancher &#123;</span><br><span class="line">    server 81.68.101.212:443;</span><br><span class="line">    server 81.68.229.215:443;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">    default Upgrade;</span><br><span class="line">    &#x27;&#x27;      close;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl http2; # 如果是升级或者全新安装v2.2.2,需要禁止http2，其他版本不需修改。</span><br><span class="line">    server_name rancher.test.com;</span><br><span class="line">    ssl_certificate /root/ssl/rancher.test.com.crt;</span><br><span class="line">    ssl_certificate_key /root/ssl/rancher.test.com.key;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        proxy_set_header Host $host;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">        proxy_set_header X-Forwarded-Port $server_port;</span><br><span class="line">        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">        proxy_pass https://rancher;</span><br><span class="line">        proxy_http_version 1.1;</span><br><span class="line">        proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">        proxy_set_header Connection $connection_upgrade;</span><br><span class="line">        # This allows the ability for the execute shell window to remain open for up to 15 minutes. </span><br><span class="line">        ## Without this parameter, the default is 1 minute and will automatically close.</span><br><span class="line">        proxy_read_timeout 900s;</span><br><span class="line">        proxy_buffering off;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">server &#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    server_name rancher.test.com;</span><br><span class="line">    return 301 https://$server_name$request_uri;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>安装rancher </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cd /root/ssl</span><br><span class="line"># 添加rancher的repo</span><br><span class="line">helm repo add rancher-stable https://releases.rancher.com/server-charts/stable</span><br><span class="line"># 创建namespace</span><br><span class="line">kubectl create ns cattle-system</span><br><span class="line"># ca证书密文</span><br><span class="line">kubectl -n cattle-system create secret generic tls-ca --from-file=cacerts.pem</span><br><span class="line"># 安装Rancher Server</span><br><span class="line">helm install rancher-stable/rancher \</span><br><span class="line">    --name rancher --namespace cattle-system \</span><br><span class="line">    --set hostname=rancher.test.com \</span><br><span class="line">    --set privateCA=true \</span><br><span class="line">	--set ingress.tls.source=secret</span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/12/2021-10-12-k8s%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2helm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/12/2021-10-12-k8s%E9%9B%86%E7%BE%A4%E9%83%A8%E7%BD%B2helm/" class="post-title-link" itemprop="url">k8s集群部署helm</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-10-12 00:00:00 / 修改时间：18:23:40" itemprop="dateCreated datePublished" datetime="2021-10-12T00:00:00+08:00">2021-10-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>安装helm </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf helm-v2.16.6-linux-amd64.tar.gz</span><br><span class="line"> mv linux-amd64/helm /usr/local/bin/</span><br><span class="line">helm version #查看helm client版本</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; rbac-config.yaml &lt;&lt; EOF </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: ServiceAccount</span><br><span class="line">metadata:</span><br><span class="line">  name: tiller</span><br><span class="line">  namespace: kube-system</span><br><span class="line">---</span><br><span class="line">apiVersion: rbac.authorization.k8s.io/v1beta1</span><br><span class="line">kind: ClusterRoleBinding</span><br><span class="line">metadata:</span><br><span class="line">  name: tiller</span><br><span class="line">roleRef:</span><br><span class="line">  apiGroup: rbac.authorization.k8s.io</span><br><span class="line">  kind: ClusterRole</span><br><span class="line">  name: cluster-admin</span><br><span class="line">subjects:</span><br><span class="line">  - kind: ServiceAccount</span><br><span class="line">    name: tiller</span><br><span class="line">    namespace: kube-system</span><br><span class="line">EOF </span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create -f rbac-config.yaml</span><br></pre></td></tr></table></figure>





<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 阿里源</span><br><span class="line">helm init --service-account tiller --upgrade -i registry.cn-hangzhou.aliyuncs.com/google_containers/tiller:v2.16.6 --stable-repo-url https://kubernetes.oss-cn-hangzhou.aliyuncs.com/charts</span><br><span class="line"></span><br></pre></td></tr></table></figure>
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/11/2021-10-11-nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/11/2021-10-11-nginx%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">nginx学习笔记</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-10-11 00:00:00 / 修改时间：13:10:28" itemprop="dateCreated datePublished" datetime="2021-10-11T00:00:00+08:00">2021-10-11</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="Nginx学习笔记"><a href="#Nginx学习笔记" class="headerlink" title="Nginx学习笔记"></a>Nginx学习笔记</h1><h2 id="1-什么是nginx"><a href="#1-什么是nginx" class="headerlink" title="1 什么是nginx"></a>1 什么是nginx</h2><p>Nginx (engine x) 是一个高性能的HTTP和反向代理web服务器，同时也提供了IMAP/POP3/SMTP服务。Nginx是由伊戈尔·赛索耶夫为俄罗斯访问量第二的Rambler.ru站点（俄文：Рамблер）开发的，第一个公开版本0.1.0发布于2004年10月4日。2011年6月1日，nginx 1.0.4发布。</p>
<p>其特点是占有内存少，并发能力强，事实上nginx的并发能力在同类型的网页服务器中表现较好，中国大陆使用nginx网站用户有：百度、京东、新浪、网易、腾讯、淘宝等。在全球活跃的网站中有12.18%的使用比率，大约为2220万个网站。</p>
<p>Nginx 是一个安装非常的简单、配置文件非常简洁（还能够支持perl语法）、Bug非常少的服务。Nginx 启动特别容易，并且几乎可以做到7*24不间断运行，即使运行数个月也不需要重新启动。你还能够不间断服务的情况下进行软件版本的升级。</p>
<p>Nginx代码完全用C语言从头写成。官方数据测试表明能够支持高达 50,000 个并发连接数的响应。</p>
<h3 id="2-nginx的作用？"><a href="#2-nginx的作用？" class="headerlink" title="2 nginx的作用？"></a>2 nginx的作用？</h3><h4 id="2-1-反向代理"><a href="#2-1-反向代理" class="headerlink" title="2.1 反向代理"></a>2.1 反向代理</h4><blockquote>
<p>Http代理，反向代理：作为web服务器最常用的功能之一，尤其是反向代理。正向带来就是代理客户端，如vpn。 反向代理代理服务器端。</p>
</blockquote>
<ul>
<li>正向代理</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/nginx1.png"></p>
<ul>
<li>反向代理</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/nginx2.png"></p>
<h4 id="2-2-负载均衡"><a href="#2-2-负载均衡" class="headerlink" title="2.2 负载均衡"></a>2.2 负载均衡</h4><blockquote>
<p>Nginx提供的负载均衡策略有2种：内置策略和扩展策略。内置策略为轮询，加权轮询，Ip hash。扩展策略，就天马行空，只有你想不到的没有他做不到的。</p>
</blockquote>
<ul>
<li>轮询</li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/nginx3.png"></p>
<ul>
<li> 加权轮询 </li>
</ul>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/nginx4.png"></p>
<ul>
<li>iphash </li>
</ul>
<p>iphash对客户端请求的ip进行hash操作，然后根据hash结果将同一个客户端ip的请求分发给同一台服务器进行处理，可以解决session不共享的问题。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/nginx5.png"></p>
<h4 id="2-3-动静分离"><a href="#2-3-动静分离" class="headerlink" title="2.3 动静分离"></a>2.3 动静分离</h4><p>动静分离，在我们的软件开发中，有些请求是需要后台处理的，有些请求是不需要经过后台处理的（如：css、html、jpg、js等等文件），这些不需要经过后台处理的文件称为静态文件。让动态网站里的动态网页根据一定规则把不变的资源和经常变的资源区分开来，动静资源做好了拆分以后，我们就可以根据静态资源的特点将其做缓存操作。提高资源响应的速度。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/nginx7.png"></p>
<h2 id="3-nginx安装"><a href="#3-nginx安装" class="headerlink" title="3 nginx安装"></a>3 nginx安装</h2><h4 id="3-1-windows-安装"><a href="#3-1-windows-安装" class="headerlink" title="3.1 windows 安装"></a>3.1 windows 安装</h4><ol>
<li>下载</li>
</ol>
<p><a target="_blank" rel="noopener" href="http://nginx.org/en/download.html">http://nginx.org/en/download.html</a> 下载稳定版本。<br>以nginx/Windows-1.16.1为例，直接下载 nginx-1.16.1.zip。<br>下载后解压，解压后如下：</p>
<ol start="2">
<li>启动nginx</li>
</ol>
<p>有很多种方法启动nginx</p>
<p>(1)直接双击nginx.exe，双击后一个黑色的弹窗一闪而过</p>
<p>(2)打开cmd命令窗口，切换到nginx解压目录下，输入命令 <code>nginx.exe</code> ，回车即可</p>
<ol start="3">
<li>检查nginx是否启动成功</li>
</ol>
<p>直接在浏览器地址栏输入网址 <a target="_blank" rel="noopener" href="http://localhost/">http://localhost:80</a> 回车，出现以下页面说明启动成功！</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/nginx8.png"></p>
<p>4、配置监听</p>
<p>nginx的配置文件是conf目录下的nginx.conf，默认配置的nginx监听的端口为80，如果80端口被占用可以修改为未被占用的端口即可。</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/nginx9.png" alt="图片"></p>
<p>当我们修改了nginx的配置文件nginx.conf 时，不需要关闭nginx后重新启动nginx，只需要执行命令 <code>nginx -s reload</code> 即可让改动生效</p>
<ol start="5">
<li>关闭nginx</li>
</ol>
<p>如果使用cmd命令窗口启动nginx， 关闭cmd窗口是不能结束nginx进程的，可使用两种方法关闭nginx</p>
<p>(1)输入nginx命令 <code>nginx -s stop</code>(快速停止nginx) 或 <code>nginx -s quit</code>(完整有序的停止nginx)</p>
<p>(2)使用taskkill <code>taskkill /f /t /im nginx.exe</code></p>
<blockquote>
<ol>
<li><code>taskkill是用来终止进程的，</code></li>
<li><code>/f是强制终止 .</code></li>
<li><code>/t终止指定的进程和任何由此启动的子进程。</code></li>
<li><code>/im示指定的进程名称 .</code></li>
</ol>
</blockquote>
<h4 id="3-2-linux-安装"><a href="#3-2-linux-安装" class="headerlink" title="3.2 linux 安装"></a>3.2 linux 安装</h4><p><strong>1、安装gcc</strong></p>
<p>安装 nginx 需要先将官网下载的源码进行编译，编译依赖 gcc 环境，如果没有 gcc 环境，则需要安装：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install gcc-c++</span><br></pre></td></tr></table></figure>

<p><strong>2、PCRE pcre-devel 安装</strong></p>
<p>PCRE(Perl Compatible Regular Expressions) 是一个Perl库，包括 perl 兼容的正则表达式库。nginx 的 http 模块使用 pcre 来解析正则表达式，所以需要在 linux 上安装 pcre 库，pcre-devel 是使用 pcre 开发的一个二次开发库。nginx也需要此库。命令：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y pcre pcre-devel</span><br></pre></td></tr></table></figure>

<p><strong>3、zlib 安装</strong></p>
<p>zlib 库提供了很多种压缩和解压缩的方式， nginx 使用 zlib 对 http 包的内容进行 gzip ，所以需要在 Centos 上安装 zlib 库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y zlib zlib-devel</span><br></pre></td></tr></table></figure>

<p><strong>4、OpenSSL 安装</strong><br>OpenSSL 是一个强大的安全套接字层密码库，囊括主要的密码算法、常用的密钥和证书封装管理功能及 SSL 协议，并提供丰富的应用程序供测试或其它目的使用。<br>nginx 不仅支持 http 协议，还支持 https（即在ssl协议上传输http），所以需要在 Centos 安装 OpenSSL 库。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install -y openssl openssl-devel</span><br></pre></td></tr></table></figure>

<p><strong>5、下载安装包</strong></p>
<p>手动下载.tar.gz安装包，地址：<a target="_blank" rel="noopener" href="https://nginx.org/en/download.html">https://nginx.org/en/download.html</a></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GgEZetmcQNL1d9LWeKibdOWh9rKCtOIyiapbBdvkkLxbroTS7UJqVEGYMoykpNCJCd8s2J8gt5Kx1wTa20x4Fcew/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p>下载完毕上传到服务器上 /root</p>
<p><strong>6、解压</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -zxvf nginx-1.18.0.tar.gzcd nginx-1.18.0</span><br></pre></td></tr></table></figure>

<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GgEZetmcQNL1d9LWeKibdOWh9rKCtOIyiav8kobxVCqCtT1fKwz5Sjp56Cyq2icoNOZv4D0qfBAfy6GenkzeiamZicw/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<p><strong>7、配置</strong></p>
<p>使用默认配置，在nginx根目录下执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./configuremakemake install</span><br></pre></td></tr></table></figure>

<p>查找安装路径： <code>whereis nginx</code></p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/GgEZetmcQNL1d9LWeKibdOWh9rKCtOIyiaKiaWxd2xrGwMWWt6CETsZ7K0n23PWRZbgrmxa1qwq0075IM2IFKtHDg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1" alt="图片"></p>
<h3 id="4-Nginx常用命令"><a href="#4-Nginx常用命令" class="headerlink" title="4 Nginx常用命令"></a>4 Nginx常用命令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin/</span><br><span class="line">./nginx  启动</span><br><span class="line">./nginx -s stop  停止</span><br><span class="line">./nginx -s quit  安全退出</span><br><span class="line">./nginx -s reload  重新加载配置文件</span><br><span class="line">ps aux|grep nginx  查看nginx进程</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意：如何连接不上，检查阿里云安全组是否开放端口，或者服务器防火墙是否开放端口</p>
<p>相关命令：</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"># 开启service firewalld start</span><br><span class="line"># 重启service firewalld restart</span><br><span class="line"># 关闭service firewalld stop</span><br><span class="line"># 查看防火墙规则firewall-cmd --list-all</span><br><span class="line"># 查询端口是否开放firewall-cmd --query-port=8080/tcp</span><br><span class="line"># 开放80端口firewall-cmd --permanent --add-port=80/tcp</span><br><span class="line"># 移除端口firewall-cmd --permanent --remove-port=8080/tcp</span><br><span class="line"># 重启防火墙(修改配置后要重启防火墙)firewall-cmd --reload</span><br><span class="line"># 参数解释1、firwall-cmd：是Linux提供的操作firewall的一个工具；2、--permanent：表示设置为持久；3、--add-port：标识添加的端口；</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/11/2021-10-11-RKE%E9%83%A8%E7%BD%B2K8S/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/11/2021-10-11-RKE%E9%83%A8%E7%BD%B2K8S/" class="post-title-link" itemprop="url">RKE部署K8S</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-10-11 00:00:00" itemprop="dateCreated datePublished" datetime="2021-10-11T00:00:00+08:00">2021-10-11</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-10-14 16:46:52" itemprop="dateModified" datetime="2021-10-14T16:46:52+08:00">2021-10-14</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E7%BC%96%E7%A8%8B%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">编程笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1  准备工作"></a>1  准备工作</h2><h3 id="1-1-集群配置"><a href="#1-1-集群配置" class="headerlink" title="1.1 集群配置"></a>1.1 集群配置</h3><p>一台nignxf负载均衡，2台使用RKE配置k8s集群，然后在这个集群上配置高可用Rancher</p>
<table>
<thead>
<tr>
<th>主机IP</th>
<th>主机名</th>
<th>角色</th>
</tr>
</thead>
<tbody><tr>
<td>1.117.61.155</td>
<td>nginx</td>
<td>controlplane,etcd</td>
</tr>
<tr>
<td>81.68.101.212</td>
<td>k8s-node01</td>
<td>controlplane,etcd,worker</td>
</tr>
<tr>
<td>81.68.229.215</td>
<td>k8s-node02</td>
<td>controlplane,etcd,worker</td>
</tr>
</tbody></table>
<blockquote>
<p> 分开买的腾讯云服务器，所以ip地址不连续</p>
</blockquote>
<h3 id="1-2-修改主机名-所有节点操作"><a href="#1-2-修改主机名-所有节点操作" class="headerlink" title="1.2 修改主机名  ( 所有节点操作 )"></a>1.2 修改主机名  ( 所有节点操作 )</h3><p>master:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname nginx</span><br></pre></td></tr></table></figure>

<p>node1:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname k8s-node01</span><br></pre></td></tr></table></figure>

<p>node2:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hostnamectl set-hostname k8s-node02</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果命令失败， 直接修改 /etc/hostname, 重启后生效  </p>
<p>hostname # 可查看是否修改成功</p>
</blockquote>
<h3 id="1-3-安装一些常用工具"><a href="#1-3-安装一些常用工具" class="headerlink" title="1.3 安装一些常用工具"></a>1.3 安装一些常用工具</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install lrzsz vim gcc glibc openssl openssl-devel net-tools wget curl</span><br></pre></td></tr></table></figure>

<h3 id="1-4-关闭防火强-所有节点操作"><a href="#1-4-关闭防火强-所有节点操作" class="headerlink" title="1.4 关闭防火强 ( 所有节点操作 )"></a>1.4 关闭防火强 ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br></pre></td></tr></table></figure>

<blockquote>
<p>所有节点相同操作可使用同时发送到所有会话</p>
</blockquote>
<h3 id="1-5-关闭selinux-所有节点操作"><a href="#1-5-关闭selinux-所有节点操作" class="headerlink" title="1.5 关闭selinux ( 所有节点操作 )"></a>1.5 关闭selinux ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">setenforce 0 # 临时关闭</span><br><span class="line">sed -i &#x27;s/SELINUX=enforcing/SELINUX=disabled/g&#x27; /etc/selinux/config # 永久关闭</span><br></pre></td></tr></table></figure>

<h3 id="1-6-关闭swap-所有节点操作"><a href="#1-6-关闭swap-所有节点操作" class="headerlink" title="1.6 关闭swap ( 所有节点操作 )"></a>1.6 关闭swap ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">swapoff -a # 临时关闭；关闭swap主要是为了性能考虑</span><br><span class="line">sed -ri &#x27;s/.*swap.*/#&amp;/&#x27; /etc/fstab</span><br></pre></td></tr></table></figure>

<blockquote>
<p>free # 可以通过这个命令查看swap是否关闭了 </p>
</blockquote>
<h3 id="1-7-同步时间-所有节点操作"><a href="#1-7-同步时间-所有节点操作" class="headerlink" title="1.7 同步时间 ( 所有节点操作 )"></a>1.7 同步时间 ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum install ntpdate -y</span><br><span class="line">ntpdate time.windows.com</span><br></pre></td></tr></table></figure>

<h3 id="1-8-Kernel性能调优-所有节点操作"><a href="#1-8-Kernel性能调优-所有节点操作" class="headerlink" title="1.8 Kernel性能调优 ( 所有节点操作 )"></a>1.8 Kernel性能调优 ( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/sysctl.conf&lt;&lt;EOF</span><br><span class="line">net.ipv4.ip_forward=1</span><br><span class="line">net.bridge.bridge-nf-call-iptables=1</span><br><span class="line">net.ipv4.neigh.default.gc_thresh1=4096</span><br><span class="line">net.ipv4.neigh.default.gc_thresh2=6144</span><br><span class="line">net.ipv4.neigh.default.gc_thresh3=8192</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 加载配置文件</span><br><span class="line">sysctl -p</span><br></pre></td></tr></table></figure>

<h3 id="1-9-添加主机名与IP对应的关系-所有节点操作"><a href="#1-9-添加主机名与IP对应的关系-所有节点操作" class="headerlink" title="1.9 添加主机名与IP对应的关系( 所有节点操作 )"></a>1.9 添加主机名与IP对应的关系( 所有节点操作 )</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &gt;&gt; /etc/hosts &lt;&lt; EOF </span><br><span class="line">1.117.61.155  nginx</span><br><span class="line">81.68.101.212 k8s-node01</span><br><span class="line">81.68.229.215 k8s-node02</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<h4 id="1-10-加载ipvs相关模块"><a href="#1-10-加载ipvs相关模块" class="headerlink" title="1.10 加载ipvs相关模块"></a>1.10 加载ipvs相关模块</h4><p>由于ipvs已经加入到了内核的主干，所以为kube-proxy开启ipvs的前提需要加载以下的内核模块：<br>在所有的Kubernetes节点执行以下脚本:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; /etc/sysconfig/modules/ipvs.modules &lt;&lt;EOF</span><br><span class="line">#!/bin/bash</span><br><span class="line">modprobe -- ip_vs</span><br><span class="line">modprobe -- ip_vs_rr</span><br><span class="line">modprobe -- ip_vs_wrr</span><br><span class="line">modprobe -- ip_vs_sh</span><br><span class="line">modprobe -- nf_conntrack_ipv4</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 执行脚本</span><br><span class="line">chmod 755 /etc/sysconfig/modules/ipvs.modules &amp;&amp; bash /etc/sysconfig/modules/ipvs.modules &amp;&amp; lsmod | grep -e ip_vs -e nf_conntrack_ipv4</span><br></pre></td></tr></table></figure>



<h2 id="2-安装docker-所有节点操作"><a href="#2-安装docker-所有节点操作" class="headerlink" title="2 安装docker(所有节点操作)"></a>2 安装docker(所有节点操作)</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"># 1 安装依赖工具</span><br><span class="line">  yum install -y yum-utils</span><br><span class="line"> </span><br><span class="line"># 2 配置docker仓库</span><br><span class="line"> sudo yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">   </span><br><span class="line"># 国外的仓库很慢，可以使用国内的镜像快一点 </span><br><span class="line"> sudo yum-config-manager \</span><br><span class="line">	--add-repo \</span><br><span class="line">	http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line"></span><br><span class="line"># 3 安装docker</span><br><span class="line"># sudo yum install docker-ce docker-ce-cli containerd.io</span><br><span class="line"># 3 指定版本docekr 例如 18.09.7 # 这里不能用最新版本的，经过测试，最新版本和rek2不兼容。</span><br><span class="line"> # yum list docker-ce --showduplicates | sort -r # 查看可用版本</span><br><span class="line"> #yum install docker-ce-18.09.7  docker-ce-cli-18.09.7</span><br><span class="line"># 4 配置腾讯云镜像 </span><br><span class="line">cat &gt; /etc/docker/daemon.json &lt;EOF</span><br><span class="line">    &#123;</span><br><span class="line">    &quot;registry-mirrors&quot;: [</span><br><span class="line">     &quot;https://mirror.ccs.tencentyun.com&quot;</span><br><span class="line">    ]</span><br><span class="line">    &#125;</span><br><span class="line">EOF</span><br><span class="line"># 5 重启启动 </span><br><span class="line">systemctl restart docker </span><br></pre></td></tr></table></figure>



<h2 id="3-rke部署集群"><a href="#3-rke部署集群" class="headerlink" title="3 rke部署集群"></a>3 rke部署集群</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line"># 1 添加用户，rke不能用root操作(三个节点)，创建普通用户rke</span><br><span class="line">useradd ops -G docker</span><br><span class="line">echo &quot;123456&quot; | passwd --stdin ops</span><br><span class="line"></span><br><span class="line"># 2 下载 rke_linux-amd64并放到添加权限，移动到命令文件中(node1操作)</span><br><span class="line"># 下载地址 https://github.com/rancher/rke/releases/tag/v1.0.11</span><br><span class="line">chmod +x rke_linux-amd64</span><br><span class="line">cp rke_linux-amd64 /usr/local/bin/rke</span><br><span class="line"></span><br><span class="line"># 3 节点之间免密登录(node1操作)</span><br><span class="line">su - ops</span><br><span class="line">ssh-keygen # (三次enter)</span><br><span class="line"></span><br><span class="line">ssh-copy-id ops@81.68.101.212# yes, 输入密码</span><br><span class="line">ssh-copy-id ops@81.68.229.215</span><br><span class="line"></span><br><span class="line"># 4 生成集群配置yml文件</span><br><span class="line">cat &gt; cluster.yml &lt;&lt; EOF</span><br><span class="line">nodes:</span><br><span class="line">- address: 81.68.101.212</span><br><span class="line">  port: &quot;22&quot;</span><br><span class="line">  internal_address: &quot;&quot;</span><br><span class="line">  role:</span><br><span class="line">  - controlplane</span><br><span class="line">  - worker</span><br><span class="line">  - etcd</span><br><span class="line">  hostname_override: &quot;&quot;</span><br><span class="line">  user: ops</span><br><span class="line">  docker_socket: /var/run/docker.sock</span><br><span class="line">  ssh_key: &quot;&quot;</span><br><span class="line">  ssh_key_path: ~/.ssh/id_rsa</span><br><span class="line">  ssh_cert: &quot;&quot;</span><br><span class="line">  ssh_cert_path: &quot;&quot;</span><br><span class="line">  labels: &#123;&#125;</span><br><span class="line">  taints: []</span><br><span class="line">- address: 81.68.229.215</span><br><span class="line">  port: &quot;22&quot;</span><br><span class="line">  internal_address: &quot;&quot;</span><br><span class="line">  role:</span><br><span class="line">  - controlplane</span><br><span class="line">  - worker</span><br><span class="line">  - etcd</span><br><span class="line">  hostname_override: &quot;&quot;</span><br><span class="line">  user: ops</span><br><span class="line">  docker_socket: /var/run/docker.sock</span><br><span class="line">  ssh_key: &quot;&quot;</span><br><span class="line">  ssh_key_path: ~/.ssh/id_rsa</span><br><span class="line">  ssh_cert: &quot;&quot;</span><br><span class="line">  ssh_cert_path: &quot;&quot;</span><br><span class="line">  labels: &#123;&#125;</span><br><span class="line">  taints: []</span><br><span class="line">services:</span><br><span class="line">  etcd:</span><br><span class="line">    image: &quot;&quot;</span><br><span class="line">    extra_args: &#123;&#125;</span><br><span class="line">    extra_binds: []</span><br><span class="line">    extra_env: []</span><br><span class="line">    external_urls: []</span><br><span class="line">    ca_cert: &quot;&quot;</span><br><span class="line">    cert: &quot;&quot;</span><br><span class="line">    key: &quot;&quot;</span><br><span class="line">    path: &quot;&quot;</span><br><span class="line">    uid: 0</span><br><span class="line">    gid: 0</span><br><span class="line">    snapshot: null</span><br><span class="line">    retention: &quot;&quot;</span><br><span class="line">    creation: &quot;&quot;</span><br><span class="line">    backup_config:</span><br><span class="line">      enabled: true</span><br><span class="line">      interval_hours: 12</span><br><span class="line">      retention: 6</span><br><span class="line">  kube-api:</span><br><span class="line">    image: &quot;&quot;</span><br><span class="line">    extra_args: &#123;&#125;</span><br><span class="line">    extra_binds: []</span><br><span class="line">    extra_env: []</span><br><span class="line">    service_cluster_ip_range: 10.43.0.0/16</span><br><span class="line">    service_node_port_range: &quot;&quot;</span><br><span class="line">    pod_security_policy: false</span><br><span class="line">    always_pull_images: false</span><br><span class="line">    secrets_encryption_config: null</span><br><span class="line">    audit_log: null</span><br><span class="line">    admission_configuration: null</span><br><span class="line">    event_rate_limit: null</span><br><span class="line">  kube-controller:</span><br><span class="line">    image: &quot;&quot;</span><br><span class="line">    extra_args: &#123;&#125;</span><br><span class="line">    extra_binds: []</span><br><span class="line">    extra_env: []</span><br><span class="line">    cluster_cidr: 10.42.0.0/16</span><br><span class="line">    service_cluster_ip_range: 10.43.0.0/16</span><br><span class="line">  scheduler:</span><br><span class="line">    image: &quot;&quot;</span><br><span class="line">    extra_args: &#123;&#125;</span><br><span class="line">    extra_binds: []</span><br><span class="line">    extra_env: []</span><br><span class="line">  kubelet:</span><br><span class="line">    image: &quot;&quot;</span><br><span class="line">    extra_args: &#123;&#125;</span><br><span class="line">    extra_binds: []</span><br><span class="line">    extra_env: []</span><br><span class="line">    cluster_domain: cluster.local</span><br><span class="line">    infra_container_image: &quot;&quot;</span><br><span class="line">    cluster_dns_server: 10.43.0.10</span><br><span class="line">    fail_swap_on: false</span><br><span class="line">    generate_serving_certificate: false</span><br><span class="line">  kubeproxy:</span><br><span class="line">    image: &quot;&quot;</span><br><span class="line">    extra_args: &#123;&#125;</span><br><span class="line">    extra_binds: []</span><br><span class="line">    extra_env: []</span><br><span class="line">network:</span><br><span class="line">  plugin: canal</span><br><span class="line">  options: &#123;&#125;</span><br><span class="line">  mtu: 0</span><br><span class="line">  node_selector: &#123;&#125;</span><br><span class="line">authentication:</span><br><span class="line">  strategy: x509</span><br><span class="line">  sans: []</span><br><span class="line">  webhook: null</span><br><span class="line">addons: &quot;&quot;</span><br><span class="line">addons_include: []</span><br><span class="line">system_images:</span><br><span class="line">  etcd: rancher/coreos-etcd:v3.4.3-rancher1</span><br><span class="line">  alpine: rancher/rke-tools:v0.1.59</span><br><span class="line">  nginx_proxy: rancher/rke-tools:v0.1.59</span><br><span class="line">  cert_downloader: rancher/rke-tools:v0.1.59</span><br><span class="line">  kubernetes_services_sidecar: rancher/rke-tools:v0.1.59</span><br><span class="line">  kubedns: rancher/k8s-dns-kube-dns:1.15.0</span><br><span class="line">  dnsmasq: rancher/k8s-dns-dnsmasq-nanny:1.15.0</span><br><span class="line">  kubedns_sidecar: rancher/k8s-dns-sidecar:1.15.0</span><br><span class="line">  kubedns_autoscaler: rancher/cluster-proportional-autoscaler:1.7.1</span><br><span class="line">  coredns: rancher/coredns-coredns:1.6.5</span><br><span class="line">  coredns_autoscaler: rancher/cluster-proportional-autoscaler:1.7.1</span><br><span class="line">  nodelocal: rancher/k8s-dns-node-cache:1.15.7</span><br><span class="line">  kubernetes: rancher/hyperkube:v1.17.9-rancher1</span><br><span class="line">  flannel: rancher/coreos-flannel:v0.12.0</span><br><span class="line">  flannel_cni: rancher/flannel-cni:v0.3.0-rancher6</span><br><span class="line">  calico_node: rancher/calico-node:v3.13.4</span><br><span class="line">  calico_cni: rancher/calico-cni:v3.13.4</span><br><span class="line">  calico_controllers: rancher/calico-kube-controllers:v3.13.4</span><br><span class="line">  calico_ctl: rancher/calico-ctl:v3.13.4</span><br><span class="line">  calico_flexvol: rancher/calico-pod2daemon-flexvol:v3.13.4</span><br><span class="line">  canal_node: rancher/calico-node:v3.13.4</span><br><span class="line">  canal_cni: rancher/calico-cni:v3.13.4</span><br><span class="line">  canal_flannel: rancher/coreos-flannel:v0.12.0</span><br><span class="line">  canal_flexvol: rancher/calico-pod2daemon-flexvol:v3.13.4</span><br><span class="line">  weave_node: weaveworks/weave-kube:2.6.4</span><br><span class="line">  weave_cni: weaveworks/weave-npc:2.6.4</span><br><span class="line">  pod_infra_container: rancher/pause:3.1</span><br><span class="line">  ingress: rancher/nginx-ingress-controller:nginx-0.32.0-rancher1</span><br><span class="line">  ingress_backend: rancher/nginx-ingress-controller-defaultbackend:1.5-rancher1</span><br><span class="line">  metrics_server: rancher/metrics-server:v0.3.6</span><br><span class="line">  windows_pod_infra_container: rancher/kubelet-pause:v0.1.4</span><br><span class="line">ssh_key_path: ~/.ssh/id_rsa</span><br><span class="line">ssh_cert_path: &quot;&quot;</span><br><span class="line">ssh_agent_auth: false</span><br><span class="line">authorization:</span><br><span class="line">  mode: rbac</span><br><span class="line">  options: &#123;&#125;</span><br><span class="line">ignore_docker_version: false</span><br><span class="line">kubernetes_version: &quot;&quot;</span><br><span class="line">private_registries: []</span><br><span class="line">ingress:</span><br><span class="line">  provider: &quot;&quot;</span><br><span class="line">  options: &#123;&#125;</span><br><span class="line">  node_selector: &#123;&#125;</span><br><span class="line">  extra_args: &#123;&#125;</span><br><span class="line">  dns_policy: &quot;&quot;</span><br><span class="line">  extra_envs: []</span><br><span class="line">  extra_volumes: []</span><br><span class="line">  extra_volume_mounts: []</span><br><span class="line">cluster_name: &quot;&quot;</span><br><span class="line">cloud_provider:</span><br><span class="line">  name: &quot;&quot;</span><br><span class="line">prefix_path: &quot;&quot;</span><br><span class="line">addon_job_timeout: 0</span><br><span class="line">bastion_host:</span><br><span class="line">  address: &quot;&quot;</span><br><span class="line">  port: &quot;&quot;</span><br><span class="line">  user: &quot;&quot;</span><br><span class="line">  ssh_key: &quot;&quot;</span><br><span class="line">  ssh_key_path: &quot;&quot;</span><br><span class="line">  ssh_cert: &quot;&quot;</span><br><span class="line">  ssh_cert_path: &quot;&quot;</span><br><span class="line">monitoring:</span><br><span class="line">  provider: &quot;&quot;</span><br><span class="line">  options: &#123;&#125;</span><br><span class="line">  node_selector: &#123;&#125;</span><br><span class="line">restore:</span><br><span class="line">  restore: false</span><br><span class="line">  snapshot_name: &quot;&quot;</span><br><span class="line">dns: null</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line"># 5 启动 </span><br><span class="line">rke up </span><br></pre></td></tr></table></figure>

<p>这一步可能会出现下面几个错误：</p>
<ol>
<li>​    <code>FATA[0000] Failed to parse cluster file: error unmarshalling: error converting YAML to JSON: yaml: line 6: did not find expected key </code></li>
</ol>
<p>这是因为yaml中 ： 和 - 后面必须空格， 或者要按照格式对其，按照提示的行数查看问题，然后修改就可以了 </p>
<p>(vi编辑器中 :set nu 可以显示行数)</p>
<ol start="2">
<li><code>FATA[0806] [[network] Host [81.68.101.212] is not able to connect to the following ports: [81.68.101.212:2380, 81.68.101.212:2379]. Please check network policies and firewall rules] </code></li>
</ol>
<p>这个我遇到最多的问题，按照描述是网络的问题，连接不上这两个端口，我在服务器的防火墙里开放这两个端口可以解决， 但是还会出现其他的端口无法连接，索性我添加了 开通 tcp所有端口 。就可以了 </p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/rancher3.png"></p>
<ol start="3">
<li><code> FATA[1952] Failed to get job complete status for job rke-network-plugin-deploy-job in namespace kube-system</code></li>
</ol>
<p>这个问题重新rke up 就可以解决，我也没有搞清楚是什么原因. </p>
<p>这是部署成功的提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rke up </span><br><span class="line">...</span><br><span class="line">...</span><br><span class="line">INFO[0049] [addons] Saving ConfigMap for addon rke-ingress-controller to Kubernetes </span><br><span class="line">INFO[0049] [addons] Successfully saved ConfigMap for addon rke-ingress-controller to Kubernetes </span><br><span class="line">INFO[0049] [addons] Executing deploy job rke-ingress-controller </span><br><span class="line">INFO[0059] [ingress] ingress controller nginx deployed successfully </span><br><span class="line">INFO[0059] [addons] Setting up user addons              </span><br><span class="line">INFO[0059] [addons] no user addons defined              </span><br><span class="line">INFO[0059] Finished building Kubernetes cluster successfully </span><br></pre></td></tr></table></figure>

<h3 id="4-安装kubectl"><a href="#4-安装kubectl" class="headerlink" title="4  安装kubectl"></a>4  安装kubectl</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"># 1部署成功就可以看到集群配置的yml文件 </span><br><span class="line">[ops@node01 ~]$ ls</span><br><span class="line">cluster.rkestate  cluster.yml  kube_config_cluster.yml</span><br><span class="line"></span><br><span class="line"># 2 复制kube_config_cluster.yml 到 /root/.kube/config </span><br><span class="line">su root  </span><br><span class="line">mkdir -p /root/.kube/</span><br><span class="line">cp /home/ops/kube_config_cluster.yml /root/.kube/config</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 3 安装kubectl </span><br><span class="line"></span><br><span class="line">cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo</span><br><span class="line">[kubernetes]</span><br><span class="line">name=Kubernetes</span><br><span class="line">baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/</span><br><span class="line">enabled=1</span><br><span class="line">gpgcheck=1</span><br><span class="line">repo_gpgcheck=1</span><br><span class="line">gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">yum install -y kubectl</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 4 查看集群状态 </span><br><span class="line">[root@node01 rke]# kubectl get nodes -o wide</span><br><span class="line"></span><br><span class="line">NAME          STATUS   ROLES               AGE   VERSION   INTERNAL-IP   EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION                CONTAINER-RUNTIME</span><br><span class="line">k8s-master1   Ready    controlplane,etcd   10h   v1.17.9   10.0.4.6      &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.11.1.el7.x86_64   docker://19.3.13</span><br><span class="line">k8s-master2   Ready    controlplane,etcd   10h   v1.17.9   10.0.4.15     &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.11.1.el7.x86_64   docker://19.3.13</span><br><span class="line">k8s-node1     Ready    worker              10h   v1.17.9   10.0.4.16     &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-1160.11.1.el7.x86_64   docker://19.3.13</span><br><span class="line"></span><br><span class="line"># 查看pods </span><br><span class="line">[root@node01 rke]# kubectl get pods -A</span><br><span class="line">NAMESPACE       NAME                                      READY   STATUS      RESTARTS   AGE</span><br><span class="line">ingress-nginx   default-http-backend-67cf578fc4-pvktd     1/1     Running     0          5h37m</span><br><span class="line">ingress-nginx   nginx-ingress-controller-s7fcj            1/1     Running     0          5h37m</span><br><span class="line">kube-system     canal-4pc9k                               2/2     Running     0          10h</span><br><span class="line">kube-system     canal-nrpvx                               2/2     Running     0          10h</span><br><span class="line">kube-system     canal-vmqq9                               2/2     Running     0          10h</span><br><span class="line">kube-system     coredns-7c5566588d-j6xpw                  1/1     Running     0          5h37m</span><br><span class="line">kube-system     coredns-autoscaler-65bfc8d47d-2sg8d       1/1     Running     0          5h37m</span><br><span class="line">kube-system     metrics-server-6b55c64f86-g56ww           1/1     Running     0          5h37m</span><br><span class="line">kube-system     rke-coredns-addon-deploy-job-fss2d        0/1     Completed   0          5h37m</span><br><span class="line">kube-system     rke-ingress-controller-deploy-job-vnjcl   0/1     Completed   0          5h37m</span><br><span class="line">kube-system     rke-metrics-addon-deploy-job-8kj9x        0/1     Completed   0          5h37m</span><br><span class="line">kube-system     rke-network-plugin-deploy-job-bjnvh       0/1     Completed   0          10h</span><br></pre></td></tr></table></figure>



<h3 id="5-测试一下，起个nginx服务"><a href="#5-测试一下，起个nginx服务" class="headerlink" title="5 测试一下，起个nginx服务"></a>5 测试一下，起个nginx服务</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"># 1 YML文件</span><br><span class="line">cat &gt; nginx-dep.yml &lt;&lt; EOF </span><br><span class="line">apiVersion: apps/v1</span><br><span class="line">kind: Deployment</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-deployment</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    matchLabels:</span><br><span class="line">      app: nginx</span><br><span class="line">  replicas: 2</span><br><span class="line">  template:</span><br><span class="line">    metadata:</span><br><span class="line">      labels:</span><br><span class="line">        app: nginx</span><br><span class="line">    spec:</span><br><span class="line">      containers:</span><br><span class="line">      - name: nginx</span><br><span class="line">        image: nginx:alpine</span><br><span class="line">        ports:</span><br><span class="line">        - containerPort: 80</span><br><span class="line">EOF</span><br><span class="line"># 2 创建 </span><br><span class="line">kubectl apply -f nginx-dep.yml</span><br><span class="line"></span><br><span class="line"># 3 查看状态 </span><br><span class="line">kubectl get pods nginx-dep -o wide</span><br><span class="line"># 4 启动svc,暴露端口</span><br><span class="line"></span><br><span class="line">cat &gt; nginx-svc.yml &lt;&lt; EOF </span><br><span class="line">apiVersion: v1</span><br><span class="line">kind: Service</span><br><span class="line">metadata:</span><br><span class="line">  name: nginx-service</span><br><span class="line">spec:</span><br><span class="line">  selector:</span><br><span class="line">    app: nginx</span><br><span class="line">  ports:</span><br><span class="line">  - protocol: TCP</span><br><span class="line">    port: 80</span><br><span class="line">    targetPort: 80</span><br><span class="line">    nodePort: 30080</span><br><span class="line">  type: NodePort</span><br><span class="line">EOF</span><br><span class="line"># 启动服务</span><br><span class="line">kubectl apply -f nginx-svc.yml</span><br><span class="line"># 查看</span><br><span class="line">[root@nginx ops]# kubectl get svc nginx-service -o wide </span><br><span class="line">NAME            TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE    SELECTOR</span><br><span class="line">nginx-service   NodePort   10.43.107.8   &lt;none&gt;        80:30080/TCP   102s   app=nginx</span><br><span class="line"></span><br><span class="line"># 详细</span><br><span class="line">[root@nginx ops]# kubectl describe svc nginx-service</span><br><span class="line">Name:                     nginx-service</span><br><span class="line">Namespace:                default</span><br><span class="line">Labels:                   &lt;none&gt;</span><br><span class="line">Annotations:              &lt;none&gt;</span><br><span class="line">Selector:                 app=nginx</span><br><span class="line">Type:                     NodePort</span><br><span class="line">IP Families:              &lt;none&gt;</span><br><span class="line">IP:                       10.43.107.8</span><br><span class="line">IPs:                      &lt;none&gt;</span><br><span class="line">Port:                     &lt;unset&gt;  80/TCP</span><br><span class="line">TargetPort:               80/TCP</span><br><span class="line">NodePort:                 &lt;unset&gt;  30080/TCP</span><br><span class="line">Endpoints:                10.42.0.5:80,10.42.1.4:80</span><br><span class="line">Session Affinity:         None</span><br><span class="line">External Traffic Policy:  Cluster</span><br><span class="line">Events:                   &lt;none&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>访问81.68.229.215:30080</p>
<p><img src="https://cdn.jsdelivr.net/gh/Yuanwanli1995/markdown_pic@main/blogpic/rancher4.png"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">worker_processes 4;</span><br><span class="line">worker_rlimit_nofile 40000;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 8192;</span><br><span class="line">&#125;</span><br><span class="line">stream &#123;</span><br><span class="line">    upstream rancher_servers_http &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server 81.68.101.212:80 max_fails=3 fail_timeout=5s;</span><br><span class="line">        server 81.68.229.215:80 max_fails=3 fail_timeout=5s;;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen     80;</span><br><span class="line">        proxy_pass rancher_servers_http;</span><br><span class="line">    &#125;</span><br><span class="line">    upstream rancher_servers_https &#123;</span><br><span class="line">        least_conn;</span><br><span class="line">        server 81.68.101.212:443 max_fails=3 fail_timeout=5s;</span><br><span class="line">        server 81.68.229.215:443 max_fails=3 fail_timeout=5s;</span><br><span class="line">    &#125;</span><br><span class="line">    server &#123;</span><br><span class="line">        listen     443;</span><br><span class="line">        proxy_pass rancher_servers_https;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>





<p> nginx </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">worker_processes 4;</span><br><span class="line">worker_rlimit_nofile 40000;</span><br><span class="line">events &#123;</span><br><span class="line">    worker_connections 8192;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">http&#123;</span><br><span class="line">	upstream rancher &#123;</span><br><span class="line">        server 81.68.101.212:443;</span><br><span class="line">        server 81.68.229.215:443;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    map $http_upgrade $connection_upgrade &#123;</span><br><span class="line">        default Upgrade;</span><br><span class="line">        &#x27;&#x27;      close;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 443 ssl http2; # 如果是升级或者全新安装v2.2.2,需要禁止http2，其他版本不需修改。</span><br><span class="line">        server_name rancher.test.com;</span><br><span class="line">        ssl_certificate /root/ssl/rancher.test.com.crt;</span><br><span class="line">        ssl_certificate_key /root/ssl/rancher.test.com.key;</span><br><span class="line"></span><br><span class="line">        location / &#123;</span><br><span class="line">            proxy_set_header Host $host;</span><br><span class="line">            proxy_set_header X-Forwarded-Proto $scheme;</span><br><span class="line">            proxy_set_header X-Forwarded-Port $server_port;</span><br><span class="line">            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;</span><br><span class="line">            proxy_pass https://rancher;</span><br><span class="line">            proxy_http_version 1.1;</span><br><span class="line">            proxy_set_header Upgrade $http_upgrade;</span><br><span class="line">            proxy_set_header Connection $connection_upgrade;</span><br><span class="line">            # This allows the ability for the execute shell window to remain open for up to 15 minutes. </span><br><span class="line">            ## Without this parameter, the default is 1 minute and will automatically close.</span><br><span class="line">            proxy_read_timeout 900s;</span><br><span class="line">            proxy_buffering off;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    server &#123;</span><br><span class="line">        listen 80;</span><br><span class="line">        server_name rancher.test.com;</span><br><span class="line">        return 301 https://$server_name$request_uri;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/10/2021-10-10-%E3%80%8A%E7%BB%8F%E6%B5%8E%E5%AD%A6%E9%80%9A%E8%AF%86%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/10/2021-10-10-%E3%80%8A%E7%BB%8F%E6%B5%8E%E5%AD%A6%E9%80%9A%E8%AF%86%E3%80%8B/" class="post-title-link" itemprop="url">《经济学通识》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-10-10 16:40:00 / 修改时间：17:03:18" itemprop="dateCreated datePublished" datetime="2021-10-10T16:40:00+08:00">2021-10-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="《经济学通识》"><a href="#《经济学通识》" class="headerlink" title="《经济学通识》"></a>《经济学通识》</h2><p>作者： 薛兆丰</p>
<p>摘录：</p>
<ul>
<li> 一项资产的价值，总是它未来收入的折线，而过去投入的成本是沉没成本，不论大小都不影响资产的现值。</li>
<li>以纯朴的眼光看，人类至少面临四项普遍约束：（1）东西不够；（2）生命有限；（3）互相依赖；和（4）需要协调。人类种种制度安排，一概是为了应付这些约束而衍生的。粗略地概括，这四项约束对应着四类经济理论：（1）需求定律；（2）利息理论；（3）制度理论；和（4）宏观理论。</li>
<li>读书“瘾”也是一样。没有人生来就喜欢读书。得先在“阅读理解力”上作投资。要识字、要懂文法、要自己写过、要学过天文地理，懂得人情世故，要读得多，享受才能油然而生。有些人酷爱读书，要读书才够过瘾，而有些人则只看杂志，有些人看报纸就满足了，有些人只能看懂漫画，有些人就只看电视。对“阅读理解力”的投资不同，追求享受的方式就不同。</li>
<li>科斯理论的这两个思想渊源，有三个重要的含义： 一，在解决生产资源分配时，要紧的永远是边际的数值，而不是平均或总计的数值； 二，在协调资源的争用时，要紧的是要存在私有产权； 三，只要存在私有产权，产权所有者的个数就并不重要，也就是说，不管生产要素由多少人拥有，只要他们能保持充分的理智，他们就会达致相同的生产资源分配方案。</li>
<li>增加合作，并不意味着減少竞争；要鼓励竞争，也未必要靠遏制合作来实现。我们深化对合作的理解，也就是深化了对竞争的理解。</li>
<li>第六，价格决定成本，而不是成本决定价格。价格是由对最终成品的供求决定的，决定了以后，再倒过来决定生产原料的价格。房价是完全由供求决定的，房价被供求决定后，才倒过来决定土地的拍卖价格和开发商的利润。这因果关系，是学习价格规律的难点和重点，要想个不停，才能明白。到此请重读第四点。    第七，需求旺，有原因。（1）农民进城，数以亿计，创人类纪录。（2）住房面积和质量提高，购房者的平均年龄提前。（3）人均寿命延长，退休年期增加，但养儿防老已不可能，而养老保障并不健全，购房便成了人们储蓄保值的常用手段。购房月供三千，一千实为租金，两千实为储蓄。在上述因素的推动下房价高涨实属正常，而并非个别人的阴谋。非得要说是阴谋，那么大可以清者自清，选择只租不买，自动退出购房大军。到此请重读第三点。    第八，价格规律与市场状态无关。不管中国的市场是否成熟、官商有没有勾结、政府是否廉洁、行业是否垄断</li>
<li>事实上，金融危机的症结，最重要的是银行受到了政府的操控。出于政治需要或裙带关系，银行冒险将借来的外汇转贷给经营不善的国内企业，然而到期后，这些落后的企业无法清偿借款。改变这种状况的药方，就是切断政府意志与银行贷款之间的联系，消灭政策贷款和裙带贷款，增强银行的独立性和风险意识。金融危机并不表明自由经济的机器失效了，恰恰相反，引发连串问题的症结，正在于那些违反自由经济原则的环节。 金融危机的另一个原因，是那些既有中央银行、又实施汇率管制的国家，在将借来的外汇转贷给国内企业时，以该国的本位币来记账。由于这些国家往往未能成功地抑制货币发行量，所以该国的货币一旦贬值，企业到期的还款，就无法折合成足够的外汇，进而引发债务危机。 第三个原因，是大型的私人金融机构的投资失误。如美国“长期资本管理（LTCM）”的亏蚀，致使相关的以高杠杆率放款的银行濒临破产。这些不顾风险的银行，是咎由自取的。 第四个原因，是某些地区的货币体制出现了漏洞，引致投机者兴风作浪。例如香港，在实施警花货币发行局的七项措施以前，只要大量沽出港元，就能大幅扯高港元利率。本来，忠实地执行1983年所设计的联系汇率制度，这种情况是不会发生的。国际投资者看准了这个漏洞，连番操纵香港的汇市和股市，从中获利。</li>
<li>哈耶克断言：如何协调千万人之间的行为，如何利用分散在千万人头脑中的信息，才是真正的经济学核心问题。 </li>
<li>知道此岸，也了解彼岸，改革的困难，都是过渡的困难……经济改革如果不定下“事前规则”，而靠“酌情处理”来推进，就必然阻力重重，越改越难，越改越慢。 其实，成功的经济制度，并不在于改造人们的思想，而在于激励人们的行动。 每个人的资源和时间有限，用来上产此，就不能生产彼。”顾此“的成本就是”失彼“，选择”失彼“最小的”顾此“，就是这个人的相对优势。由于这始终是自己跟自己比的结果，所以任何人都永远具有相对优势。 成本就是放弃了的最好机会。 与富人为伍，你的处境会改善。不是因为你可以仰仗他们的仁慈，而是因为你在某方面的成本必定比他们低，是因为你有颠扑不破的相对优势。他们处于自私，就会与你分工合作。 他们享受现代化成果的同时，呼吁别人选择落后。 革命的蓝图越宏伟，就越容易推延，就越是画饼充饥。</li>
<li>只要知识是增长的，那么必定有部分知识是我们明天才知道而今天不知道的，那既然社会是受我们的知识影响的，那么社会的发展就是不可预测的 </li>
<li>一个能在市场上靠其产品获利的卖家，不可能通过搭售其他产品，来获得超额利润。</li>
<li>现实有约束，愿望得取舍。这是经济学者理解世界的出发点。</li>
<li>供求”先决定最终产品的“价格”，而最终产品的“价格”再决定原材料的“成本”。 </li>
<li>但不要试图说服我，给你个基尼系数，你就有本事告诉我将会发生什么。</li>
<li>数据本身不足以说明问题，因为它至少同时支持两种对立的情况 </li>
<li>这是说，即使是同一个人，究竞是”风险爱好者”、”风险 厌恶者”还是”风险漠视者”，也与其所处的财富水平有关。 美国哲学家罗尔斯（J. Rawls) , 因”公平”而盛名远播。他 用了一个生动的比喻，来证明”公平”是先于一切”公约”的。 罗尔斯说，有人生于豪门，有人生于陋室，一切皆出偶然，只能 听天由命：但是，在投胎之前，若人们能聚首一堂，他们会达成 怎样的协议呢？罗尔斯推断，由于每个人都对自己将来的命运懷 然不知，为了规避风险，即使每个人都出于自私，他们也必定会 达成一个”公平公约”，即在出生后趋向于”均分”每个人与生 俱来的一切，因为这样能使每个人的平均幸福程度达到最大。 罗尔斯这个关于”无知之幕”(veil of ignorance) 的比喻远近 闻名。我的质疑是：即使有过那样的聚会，会上人们真会一致赞 成”公平公约”吗？答案是未必！ 因为只要他们当中有些是”风 险喜爱者”，那么后者就一定宁愿挺而走险，不会受”结果公 平”的方案。毕竞，即使在现实生活中，我们也没见过自愿买完 彩票后，又要求全部参与者平分奖金的人群。</li>
<li>按“价高者得”原则筛选出来的不是贫富，而是需求的大小</li>
<li>而人们从来就只有权衡和取舍，而没有绝对的刚需</li>
<li>人的欲望是无止境的，所以世界上的经济商品永远都是稀缺的。</li>
<li>如何协调千万人之间的行为，如何利用分散在千万人头脑中的信息，才是真正的经济学核心问题 </li>
<li>要解决问题，就必须通过市场，就必须由分立的个人并行处理他们独自拥有的信息，这样才能协调众人的行为和分散的信息</li>
<li>供求决定售价，售价决定成本</li>
<li>这个世界的任何商品，其价值都是因为有人争夺才产生的 </li>
<li>正是一国对异国资源的需求，决定了汇率</li>
<li>寻求知识是辛苦的，保持理性是吃力的 </li>
<li>“民主”是按多数原则，集体商议如何行使国家暴力，来干预人与人之间本来可以缔结的契约，本来可以进行的贸易以及本来可以保有的产业 </li>
<li>任何管制都只能改变人们竞争的方式，而无法消除竞争本身</li>
<li>经济学人应该看清一般人不容易看到的一面</li>
<li>事物的价值完全依赖于每个个人的主观判断</li>
<li>只要有人群，就存在对事物的不同估值，就会出现交易；只要有选择，就必然有机会成本；只要存在时间，就存在耐用品，就会刺激投资 </li>
<li>市场从不失灵。那并不是市场失灵，而是解释失灵。 “外部性”恰恰不是因为市场失灵，而是因为缺乏市场。不是产权失灵，而是产权缺席。 天真的发问，有时可以重塑对世情的理解。 逻辑上可能出现的“市场失灵”，恰恰就是被市场的出现而修复的。 产品的价格不是事前根据成本决定的，而是事后根据市场钞票投票的结果决定的。定价由供求决定，与成本无关。 出价太低的卖家或出价过高的买家，其谈判力强；出价太高的卖家或还价过低的买家，其谈判力弱。</li>
<li>重要的问题是：政府向地产商征税，或者向购房者征税，两者有区别吗？经济学明白无误地告诉我们：两者没有任何区别。不管政府规定税赋是向哪一方征收的，都不影响买卖双方分担税负的比例。这被戏称为“法律无效定律”（The Law of the Irrelevance of the Laws），是任何接触税务问题的经济学学生必学的内容。</li>
<li>投资和投机，从可观察的行为看，是没有区别的。</li>
<li>歧视行为的影响不是单向的，而是双向的，不仅被歧视者要受影响，歧视者本身也要受影响。</li>
<li>更直截了当地说，选择就是歧视。</li>
<li>概括一下：具体情景下的供需关系，决定了单笔交易价；无数单笔交易价累加，形成了统计学意义上的均价；时间和条件不同，均价也就不同，而想求索产品的真正“原价”只能是折腾，注定徒劳无功；真正帮助顾客享受低价的方法，不是通过“纵向原价监管”来减少单笔交易间的价格离差，而是让卖家充分竞争、形成稳定而统一的交易平台，从而让顾客通过“横向实时比价”来获得低价。</li>
<li>消费者的选择行为，是与贸易保护主义者的口号背道而驰的。贸易保护主义者总是声称，消费者需要质量更高的产品，而进口的大米有虫、进口的西红柿太小、进口的香蕉改了基因、进口的面条缺乏韧性。问题不在于他们说的是不是事实，而是他们假借消费者的名义，限制了消费者选择劣质产品的自由。</li>
<li>从经济学看，道路不是公用品（public goods），而是私用品（private goods）。所谓公用品，指的是一个人用不影响其他人用的物品。典型的例子是音乐旋律、故事情节、科学定理等。公用品既可以由政府提供，如公共电视台的节目；也可以由个人提供，如带版权的电影和书籍。 私用品，指“一个人用了别人就不能用”的物品，包括粮食、电力、用水、医疗服务、教育设施、国家公园、交通工具和公路航道等。私用品也是既可以由政府提供，也可以由个人或者私营机构提供的。关键是，不论谁提供，也不论提供者是否向使用者收费，私用品的“一个人用了别人就不能用”的属性不变。公路就是这样：尽管它很可能是政府铺设的，而政府也很可能不收费，但一条车道，一辆车用了，别的车就不能同时同地使用，所以才会发生拥堵。其他私用品，也一概如是。</li>
<li>要知道，经济学家常说交易双方是自愿的，是双赢的。这没错，但他们还说了第三句话，即交易往往会使第三方受损。经济学上所说的“帕雷托最优”状态——交易后双方得益，且没有任何第三方受损的状态——是几乎不会出现的。也就是说，任何自愿交易的背后，几乎总是能够找到一些不同程度受损害的人。</li>
<li>假设市场上存在两个互相竞争的标准或平台，分别称为方案甲和方案乙，两者都具有正的网络效应，即参与的用户越多就越具价值，其中方案甲的价值，能从2人参与时的10元上升到10人参与时的20元，而方案乙的价值，能从2人参与时的4元上升到10人参与时的34元。尽管当参与者增加到10人时，方案乙优于方案甲，但人们是否会由于方案甲的初期价值较高，而在路径依赖的作用下，被方案甲锁住而无法选择当用户数量增加后价值后来居上的方案乙呢？ 两位经济学家的回答是：取决于方案乙是否“有主”。如果方案乙是无主的，那它就会得不到推广而被放弃，而这不是“市场所造成的失败”，而是“缺乏市场所造成的失败”。反之，如果方案乙是有主的，那么其主就会设法先垫支部分未来收入，补贴方案乙的早期用户，从而推动方案乙尽快达到超越方案甲的盈利规模。在这个过程中，拥有标准或平台的产权、从而形成动力、努力预测未来收益、筹资补贴先到用户、从而扩大网络规模、提高网络增值速度等环节，恰恰是市场挣脱“路径依赖陷阱”的关键步骤。</li>
<li>唯一应该反对的垄断，就是政府设置的准入障碍和特许经营。如果解除了政府保护，市场上出现的一切似乎是垄断的竞争形态，其实就都是自由竞争的结果。</li>
<li>弗里德曼（Milton Friedman）曾经列举过四种效率递减的花钱模式：一，花自己的钱替自己办事；二，花自己的钱替别人办事；三，花别人的钱替自己办事；四，花别人的钱替别人办事。</li>
<li>经济学家阿尔钦说得准确：“竞争从来都是在需求者和需求者之间展开的，或在供应者和供应者之间展开的。需求者和供应者之间不存在竞争。”</li>
<li>1960年代，法律经济学创始人戴瑞德（Aaron Director，1901-2004）曾经发现一个规律，即任何政府针对穷人的补贴措施，最终都会让中产阶级得益，而由极穷者和极富者付账。</li>
<li>所谓“管制汇率”，就是一国通过强行控制进出口商品量和外币兑换量，把本国货币的币值，硬性维持在某个先定的价位上。……而“自主汇率”，就是一国的货币当局只盯着本国的物价水平，以维持物价稳定为原则来控制货币流通量，而让本国货币与外币的兑换率自由浮动。至于“联系汇率”，则是本国货币与某国外币按固定汇率进行兑换。</li>
<li><strong>人的思想五花八门，而人的行动却大同小异；因为前者不承受代价，后者承受代价。</strong></li>
<li>很多人并不了解罢工的真正含义。不工作是旷工，集体不工作是集体旷工，生病不工作是请假，雇主允许不工作是放假，要求加薪是劳资协议，集体要求加薪是集体协议，自己卷铺盖走人是辞工。都不是罢工。 只有通过（1）在关键时刻忽然停止工作、使得雇主临时无法找到别人替代，或（2）占着工作岗位不工作，并且设法阻止别人代替自己工作，来要挟雇主增加工资或福利的行为，才叫罢工。占着位置不干活并且不让别人代替自己干活，是罢工的基本特征。罢工就是集体敲竹杠，就是集体违约，而且必然包含暴力因素。 临时以停止工作为威胁来要求加薪，是罢工的雏形。在1902年美国的Alaska Packers’ Association v. Domenico 案中，雇主准备了渔船，雇用了渔民，从旧金山出发到阿拉斯加捕捞三文鱼。船到了目的地后，渔民们便宣布临时要求加薪，否则就停止工作，这叫罢工。同样，1965年在美国爆发了葡萄园罢工，大量的葡萄眼看就要烂掉，采摘工人集体停工并要求增加工资，这也是罢工。敲竹杠是罢工的首要特征。</li>
<li>斯密并非写了两部自相矛盾的著作，分别供市场经济的怀疑这和支持者引用。相反，他通过《道德情操论》和《国富论》构造了一个自洽体系：由于人不仅是自私的，而且还天生需要通过满足小范围的同情心来换取快感，所以不仅需要在私人领域强调爱心，而且也更需要在公众领域强调应由自私之心在看不见的手的引导下来推动公益，并强调要警惕自私的掌权者对市场机制的破坏。只有这样，才能理解斯密为什么被视为市场经济之父，而不是计划经济或福利主义之父。</li>
<li>首次为阿尔钦带来国际声誉，并为经济学科学找到了稳固的落脚点的，是在他1950年发表的《不确定性、进化和经济理论》 （Uncertainty,Evolution, and Economic Theory )一文。该文的背景很简单：当时有两位大经济学家（Richard Lester和Fritz Machlup）在争论，企业家究竟有没有在计算边际成本和边际收益。阿尔钦回答：计算与否不重要，重要的是背后主宰企业家存活的客观规律；由于存在不确定性，所以人们在逻辑上不可能求得最大化； 人们只是在争取存活；即使（或虽然）人人都是傻瓜，物竞天择的规律也仍然时刻在发挥作用。 人们总想随心所欲，但因为必须为自己的所作所为负责，所以才不得不尽量保持理性。这正是阿尔钦（Armen Alchian）在1950年的《莫测、进化和经济理论》一文的深刻主题：不管人的主观上是否有意识地追求最大化，客观上只有那些成功地达到了最大化的人或集体才能在竞争中存活。 </li>
<li>价格有三个作用，一是传递信息，二是激励最有效的生产，三是分配产品。市场上的每个人都根据价格所蕴含的信息，选择生存方式和调整生产节奏，并以社会成本最低的方式分配产品</li>
<li>世界上不存在绝对刚性的需求，人们不可能不惜任何代价地追求某个目标。 人际需求不可比原则：效用只能自己跟自己比，不能拿人与人比。 人们有追求免费服务的自由，却没有逃避付出代价的自由。</li>
<li>正是客流暴增，才导致了火车票的涨价。火车票提价的幅度是多少，取决于客流增加的幅度，而跟乘客的心理承受能力扯不上任何关系。</li>
<li>现实可能不受欢迎，甚至令人憎恶，但经济评论的任务，应该是客观地解释真实的世界，而不是给读者发送歪曲的信息，流于用一厢情愿的愿望来博取读者的欢心。</li>
<li>愿意出高价买火车票的人，他所挣得的钞票，是他在别的场合向社会其他人提供服务换来的。也就是说，他为争夺火车票而作出的努力，已经得到了社会其他人的认可。</li>
<li>多年前、老友尹忠东教了我三件事情、会我受益无穷。一，他要我讨论问题或写文章时不要用比喻；二他告诉我有一个经济学家名字叫“弗里德曼”；三，他告诉我人的言辞与行动往往是背道而驰的，说是一套，做往往是另一套；人的思想和言论可谓五花八门，但行动却是高度一致的 这第三点，是我理解人性、理解学术争论、理解市场之美的起点。要对付“不确定性”，要提高对未来的预测力，减少资源浪费或空置的现象，人类不仅需要精准的知识，还需要追求知识和信息的原始动力，而追求知识和信息，往往是昂贵而痛苦的过程，而其中的试金石，就是到市场上赌一手，因为市场会不动声色地对你的判断恰如其分的奖惩。</li>
<li>政府不再负责分配住房，大量农村人口涌入城市，城市交通网络极不发达，政府批租土地有限，而居民收入预期逐年增长，这些因素全都表明中国的住房需求不是泡沫，而是真实的、强劲的、递增的、不可能靠行政手段打压下去的</li>
<li>这是说，即使‘政府有责任’，也并不等于‘政府有能力’。政府可以轻而易举地推出各种管制措施，但这些管制措施既不能替代、也不能增加真实的供应。这是经济学教训的核心。未掌握经济学的人，往往异想天开，以为政府有多大责任就能有多大能力，于是赋予政府极大的责任，让他包办衣食住行、生老病死，结果造就了上世纪‘计划经济’的大悲剧。</li>
<li>诺贝尔经济学奖得主加里 贝克尔教授，以研究家庭、犯罪和歧视问题闻名，他给‘歧视’下了定义：只有当歧视者愿意放弃一定的利益，例如收入、利益、工资或者享受，以便满足他个人的偏好时，才是歧视。</li>
<li>那个搔首弄姿的明星，之所以赚大钱，是因为市场对她有需求。你可以讨厌她，但得承认，别的很多人喜欢她，所以她的劳动力才值钱；而不是反过来，因为她投入的成本低，所以她的表演就不值钱。培养博士和专家的成本确实很大，但他们如果去扫地，那就只能接受扫地的工资，而他们过去钻研学问的成本与此无关。如果我搬到总统套房里写专栏，那么应该提高我的稿费吗？不。 归根结底，市场的‘供需’是劳动力价格的唯一决定因素。</li>
<li>根据维基百科的定义：‘庞氏骗局就是靠投资者或后继投资者的钱来还钱，而不是靠实际盈利来还钱的运作。它通常靠别人所不能的回报来吸引新的投资者，而这些回报通常是短期还款，它要么高的不正常，要么就是持续地不正常。这种生生不息的回报需要不断增长的现金流来维持。’ …… 有别于次，庞氏骗局的特征，是举债人刻意、反复、系统地向放款人谎报其经营所得和还款来源。甄别的关键，一是举债人的还款究竟来自经营的盈利，还是新的举债；二是放贷人在做出放贷决定时，究竟是清楚了解举债人的财务运作模式，还是受到了刻意的蒙骗。</li>
<li>考试是考书上的，不要东看西看。但平时思想的时候，就要东看西看、东想西想才行。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/10/03/2021-20-03-%E3%80%8A%E5%8F%97%E6%88%92%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/10/03/2021-20-03-%E3%80%8A%E5%8F%97%E6%88%92%E3%80%8B/" class="post-title-link" itemprop="url">《受戒》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-10-03 18:20:00 / 修改时间：18:27:47" itemprop="dateCreated datePublished" datetime="2021-10-03T18:20:00+08:00">2021-10-03</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>《受戒》</p>
<p><strong>作者</strong></p>
<p>汪曾祺（1920年3月5日—1997年5月16日），男，汉族，江苏高邮人，当代作家、散文家、戏剧家，京派作家的代表人物。早年毕业于西南联大，历任中学教师、北京市文联干部、《北京文艺》编辑、北京京剧院编辑。汪曾祺在短篇小说创作上颇有成就，著有小说集《邂逅集》，小说《受戒》、《大淖记事》，散文集《蒲桥集》，其大部分作品收录在《汪曾祺全集》中。被誉为“抒情的人道主义者，中国最后一个纯粹的文人，中国最后一个士大夫。”1997年5月16日上午10点30分，汪曾祺因病医治无效去世，享年77岁。 ——豆瓣</p>
<p><strong>摘录</strong></p>
<ul>
<li><p>“当了沙弥尾跟别的和尚有什么不同？</p>
<p>” “沙弥头，沙弥尾，将来都能当方丈。现在的方丈退居了，就当。石桥原本就是沙弥尾。”</p>
<p> “你当沙弥尾吗？”</p>
<p> “还不一定哪。”</p>
<p> “你当方丈，管善因寺？管那么大一个庙？！” </p>
<p>“还早哪！” </p>
<p><strong>划了一气</strong>，小英子说：“你不要当方丈！”</p>
<p> “好，不当。” </p>
<p>“你也不要当沙弥尾！”</p>
<p> “好，不当。” <strong>又划了一气</strong>，看见那一片芦花荡子了。 小英子忽然把桨放下，走到船尾，趴在名字的耳朵旁边，小声地说： “我给你当老婆，你要不要？” <strong>明子眼睛鼓得大大的</strong>。 “你说话呀！” </p>
<p>明子说：“嗯。” </p>
<p>“什么叫‘嗯’呀！要不要，要不要？”</p>
<p> 明子大声地说：“要！” </p>
<p>“你喊什么！” </p>
<p>明子小小声地说：“要——！”</p>
<p> “快点划！” 英子跳到中舱，两只桨<strong>飞快地</strong>划起来，划进了芦花荡。 </p>
<p>——写的太温柔， 小英子的勇敢矜持，明子的懵懂羞涩，人类最美好的感情，是两小无猜的欢喜</p>
</li>
<li><p>各种卖小吃的都来了。卖牛肉高粱酒的，卖回卤豆腐干的，卖五香花生米的、芝麻灌香糖的，卖豆腐脑的，卖煮荸荠的，还有卖河鲜——卖紫皮鲜菱角和新剥鹅头米的……</p>
</li>
<li><p>同事之间为了“联络感情”，时常轮流做东，约好了在星期天早上“吃早茶”。这地方“吃早茶”不是喝茶，主要是吃各种点心——蟹肉包子、火腿烧麦、冬笋蒸饺、脂油千层糕。还可叫一个三鲜煮干丝，小酌两杯。</p>
</li>
<li><p>这家专做“草炉烧饼”。这种烧饼是一箩到底的粗面做的，做蒂子只涂很少一点油，没有什么层，因为是贴在吊炉里用一把稻草烘熟的，故名草炉烧饼，以别于在桶状的炭炉中烤出的加料插酥的“桶炉烧饼”。这种烧饼便宜，也实在，乡下人进城，爱买了当饭。几个草庐烧饼，一碗宽汤饺面，有吃有喝，就饱了。</p>
</li>
<li><p>“晚茶”大都是一碗干拌面，——葱花、猪油、酱油、虾子、虾米为料，面下在里面；或几个麻团、“油墩子”，——白铁敲成浅模，浇入稀面，以萝卜丝为馅，入油炸熟。八千岁家的晚茶，一年三百六十日，都是草炉烧饼，一人两个。这里的店铺，有“客人”，照例早上要请上茶馆。“上茶馆”是喝茶，吃包子、蒸饺、烧麦。照例由店里的“先生”或东家作陪。一般都是叫一笼“杂花色”（即各样包点都有）…… </p>
<p>——汪先生对食物的描写，妙笔柔情，劳苦大众普通的饮食，变得温柔。这些简单的东西，不知道我会写成什么样， 这样的文字应当细品，但是我都没有心思，静下来细读，我们是不是过的太着急？</p>
</li>
<li><p>高先生很孤僻，不出人情，不随份子，几乎不与人通庆吊。他家从不请客，他也从不赴宴。他教书之外，还为人写寿序，撰挽联，委托的人家照例都得请请他，知单送到，他照例都在自己的名字下书一个“谢”字。久而久之，都知道他这脾气，也就不来多此一举了。 他不吃烟，不饮酒，不打牌，不看戏。除了学校和自己的家，哪里也不去，每天他清早出门，傍晚回家。拍拍白木的板门，过了一会儿，门开了。进门是一条狭长的过道，砖缝里长着扫帚苗，苦艾，和一种名叫“七里香”其实是闻不出什么气味，开着蓝色的碎花的野草，有两个黄蝴蝶寂寞的飞着。高先生就从这些野草丛中踏着沉重的步子走进去，走进里面一个小门，好像走进了一个深深的洞穴，高大的背影消失了。木板门又关了，把门上的一副春联关在外面。</p>
</li>
<li><p>  高先生在东街住过的老屋倒塌了，临街的墙壁和白木板门倒还没有倒。板门上高先生写的春联也还在。大红朱笺被风雨漂得几乎是白色的了，墨写的字迹却还很浓，很黑。    辛夸高岭桂    未徙北溟鹏</p>
</li>
</ul>
<p>   ——汪先生笔下皆小人物，高先生有自己的个性，风格，坚持，信仰(尊师)，怎能不令人，动容</p>
<ul>
<li> 一天夜里，李小龙在梦里闻到一股醉人的香味。他忽然惊醒了：昙花开了！ 李小龙一骨碌坐了起来，划根火柴，点亮了煤油灯：昙花真的开了！ 李小龙好像在做梦。 昙花真美呀！雪白雪白的。白的像玉，想通草，像天上的云。花心淡黄，淡得像没有颜色，淡得真雅。她像一个睡醒了的美人，正在舒展着她的肢体，一面吹出醉人的香气。啊呀，真香呀！香死了！ 李小龙两手托着下巴，目不转睛的看着昙花。看了很久，很久。 他困了。他想就这样看他一夜，但是他困了。吹熄了灯，他睡了。一睡就睡着了。 睡着之后，他做了一个梦，梦见昙花开了。 于是李小龙有了两盆昙花。一盆在他的床前，一盆在他的梦里。 </li>
</ul>
<p>​       ——孩子的童心，心思 </p>
<ul>
<li>他们吃饭不怎么嚼，只在嘴里打一个滚，咕咚一声就咽下去了。看他们吃得那样香，你会觉得世界上再没有比这个饭更好吃的饭了。</li>
<li>都到岁数了，心里不是没有。只是像一片薄薄的云，飘过来，飘过去，下不成雨。</li>
<li>她们像男人一样的挣钱，走相、坐相也像男人。走起来一阵风，坐下来两条叉得很开。她们像男人一样亦脚穿草鞋（脚指甲却用风仙花 染红）。她们嘴里不生冷，男人怎么说话她们怎么说话，她们也用男人骂人的话骂人。打起号子来也是“好大娘个歪歪子咧！” 没出门子的姑娘还文雅一点 一做了媳妇就简直是“姜太公在此百无禁忌”，要多野有多野。 这里人家的婚嫁极少明媒正娶，花轿吹鼓手是挣不着他们的钱的媳妇，多是自己跑来的；姑娘，一般是自己找人。她们在男女关系上是比较随便的。姑娘在家生私孩子；一个媳妇，在丈夫之外，再“靠”个，不是稀奇事。这里的女人和男人好，还是恼，只有一个标准：情愿。有的姑娘、媳妇相与了一个男人，自然也跟他要钱买花戴，但是有的不但不要他们的钱，反而把钱给他花，叫做“倒贴”。 因此，街里的人说这里“风气不好” 到底是哪里的风气更好一些呢？难说。</li>
<li>“他们打你，你只要说不再进我家的门，就不打你了，你就不会吃这样大的苦了，你为什么不说？” “你要我说么?” “不要。” “我知道你不要。” “你值么?” “我值。 “十一子,你真好!我喜欢你!你快点好。” “你亲我一下,我就好得快。” “好,亲你!”</li>
</ul>
<p>​     ——大淖人敢爱敢恨</p>
<ul>
<li><p>小吕有一件大红的球衣，干活时他喜欢把外面的衣裳脱去，于是，在果园里就经常看见通红的一团，轻快地、兴冲冲地弹跳出没于高高低低、深深浅浅的丛绿之中，惹得过路的人看了，眼睛里也不由得漾出笑意，觉得天色也明朗，风吹得也舒服</p>
<p>——劳动人民单纯的幸福，我想到了少平把力气都用完。</p>
</li>
<li><p>晚饭米都没得一颗，还你妈的之乎——者也！</p>
</li>
</ul>
<p>——痛苦的文人，哎，读书</p>
<ul>
<li>  全县第一个大画家是季匋民，第一个鉴赏家是叶三。 </li>
</ul>
<p>——传说先秦的琴师伯牙一次在荒山野地弹琴，樵夫钟子期竟能领会这是 描绘“峨峨兮若泰山”和“洋洋兮若江河”。伯牙惊道：“善哉，子之心而与吾心同。”钟子期死后，伯牙痛失知音，摔琴绝弦，终生不弹，故有高山流水之曲。季匋民与叶三现代伯牙子期。</p>
<ul>
<li>陈相公挨了打，当时没敢哭。到了晚上，上了门，一个人呜呜地哭了半天。他向他远在故乡的母亲说：“妈妈，我又挨打了！妈妈，不要紧的，再挨两年打，我就能养活你老人家了！”</li>
<li>陈小手的得名是因为他的手特别小，比女人的手还小，比一般女人的手还更柔软细嫩。他专能治难产。横生、倒生，都能接生下来（他当然也要借助于药物和器械）。据说因为他的手小，动作细腻，可以减少产妇很多的痛苦。大户人家，非到万不得已，是不会请他的。中小户人家，忌讳较少，遇到产妇胎位不正，老娘束手，老娘就会建议：“去请陈小手吧。” …… 有一年，来了联军。我们那里那几年打来打去的，是两支军队。一支是国民革命军，当称之为“党军”；相对的一支是孙传芳的军队。孙传芳自称“五省联军总司令”，他的部队就被称为“联军”。联军驻扎在天王寺，有一团人。团长的太太（谁知道是正太太还是姨太太），要生了，生不下来。叫来几个老娘，还是弄不出来。这太太杀猪也似的乱叫。团长派人去叫称小手。 …… 这女人身上的脂油太多，陈小手费九牛二虎之力，总算把孩子掏出来了…… 陈小手出了天王寺，跨上马。团长掏出枪来，从后面，一枪就把他打了下来。 团长：“我的女人，怎么让他摸来摸去！他身上，除了我，任何男人都不许碰！这小子，太欺负人了！日他奶奶！” 团长觉得怪委屈。</li>
<li>宋侉子每年要在虞小兰家住一两个月，朝朝寒食，夜夜元宵。他老婆死了，也不续弦，这里就是他的家。他有个孩子，有时也带了孩子来玩。他和关家算起来有点远亲，小兰叫他宋大哥。到钱花得差不多了，就说一声：“我明天有事，不来了。”跨上他的踢雪乌骓骏马，一扬鞭子，没影儿了。在一起时，恩恩义义；分开时，潇潇洒洒。 虞小兰有时出来走走，逛逛宜园。夏天的傍晚，穿了一身剪裁合体的白绸衫裤，拿一柄生丝白团扇，站在柳树下面，或倚定红桥栏杆，看人捕鱼采藕。她长得像一颗水蜜桃，皮肤非常白嫩，腰身、手脚都好看。路上行人看见，就不禁放慢了脚步，或者停下来装做看天上的晚霞，好好地看她几眼。他们在心里想：这样的人，这样的命，深深为她惋惜；有人不免想到家中洗衣做饭的黄脸老婆，为自己感到一点不平；或在心里轻轻吟道：“牡丹绝色三春暖，不是梅花处士妻”，情绪相当复杂。</li>
<li>养鸭是一种游离，一种放逐，一种流浪。 </li>
</ul>
<p>——汪先生对劳苦大众有深刻的洞察，有无差别的爱</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://yuanwanli1995.github.io/2021/09/30/2021-09-30-%E3%80%8A%E7%BE%8E%E4%B8%BD%E6%96%B0%E4%B8%96%E7%95%8C%E3%80%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="yuanwanli">
      <meta itemprop="description" content="等不是办法，干才有出路">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="brisk">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2021/09/30/2021-09-30-%E3%80%8A%E7%BE%8E%E4%B8%BD%E6%96%B0%E4%B8%96%E7%95%8C%E3%80%8B/" class="post-title-link" itemprop="url">《美丽新世界》</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2021-09-30 17:17:00" itemprop="dateCreated datePublished" datetime="2021-09-30T17:17:00+08:00">2021-09-30</time>
    </span>
      <span class="post-meta-item">
        <span class="post-meta-item-icon">
          <i class="far fa-calendar-check"></i>
        </span>
        <span class="post-meta-item-text">更新于</span>
        <time title="修改时间：2021-10-03 18:22:05" itemprop="dateModified" datetime="2021-10-03T18:22:05+08:00">2021-10-03</time>
      </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/" itemprop="url" rel="index"><span itemprop="name">读书笔记</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>《美丽新世界》</p>
<p><strong>作者</strong></p>
<p>奥尔德斯•赫胥黎（Aldous Huxley, 1894—1963），英国杰出的小说家、诗人、散文家、批评家和剧作家，著名的人道主义者。他以大量的小说和散文、杂文、评论作品，有意识地担负起一个人文主义知识分子的道义职责，充当了社会道德和现代文明的拷问者。</p>
<p><strong>摘录</strong></p>
<ul>
<li>有一种东西叫做民主。好像人和人之间除了物理和化学性能平等之外还有什么别的东西也会平等似的。</li>
<li>“如果人不必考虑幸福的话，”他想，“哪会多么有趣！”</li>
<li>慢性悔恨是一种最不健康的情绪。如果你做错了事，你可以忏悔，然后尽自己所能进行弥补，让自己下一次做得更好。千万不要沉浸在过去的错误中，在淤泥中打滚绝对无法让你变得干净</li>
<li>他们为人类准备好了床，如果人类不适应这张床，那就只能自认倒霉，只能把人拉长或截短。</li>
<li>例如，我们去一个热带岛屿，在DDT杀虫剂的帮助下，我们消灭了疟疾，在两三年的时间里，拯救了成千上万的生命。这显然是件好事。但是这些被拯救的成千上万人生育了数百万的孩子，这个岛屿上的可利用资源无法满足这些孩子衣食住行和教育的需要。疟疾带来的快速死亡已经不存在了，但是由于营养不良和拥挤，这里的生活痛苦不堪，饥饿造成的慢性死亡威胁着更多人的生命。</li>
<li>在一个大规模生产和营销的世界里，资金不足的小人物常常处于劣势，在和大人物的竞争中，他失去自己的资本，最后被大人物吞食，失去作为独立生产者存在的权利。</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">yuanwanli</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  




  





</body>
</html>
